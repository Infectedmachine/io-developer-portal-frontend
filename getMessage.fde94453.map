{"version":3,"sources":["node_modules/argsarray/index.js","node_modules/immediate/lib/browser.js","node_modules/spark-md5/spark-md5.js","node_modules/pouchdb-browser/node_modules/uuid/lib/rng-browser.js","node_modules/pouchdb-browser/node_modules/uuid/lib/bytesToUuid.js","node_modules/pouchdb-browser/node_modules/uuid/v1.js","node_modules/pouchdb-browser/node_modules/uuid/v4.js","node_modules/pouchdb-browser/node_modules/uuid/index.js","node_modules/vuvuzela/index.js","node_modules/pouchdb-browser/lib/index.es.js","node_modules/pouchdb-find/node_modules/pouchdb-collections/lib/index.es.js","node_modules/pouchdb-find/node_modules/pouchdb-errors/lib/index.es.js","node_modules/pouchdb-find/node_modules/uuid/lib/rng-browser.js","node_modules/pouchdb-find/node_modules/uuid/lib/bytesToUuid.js","node_modules/pouchdb-find/node_modules/uuid/v1.js","node_modules/pouchdb-find/node_modules/uuid/v4.js","node_modules/pouchdb-find/node_modules/uuid/index.js","node_modules/pouchdb-binary-utils/lib/index-browser.es.js","node_modules/pouchdb-md5/lib/index-browser.es.js","node_modules/pouchdb-find/node_modules/pouchdb-utils/lib/index-browser.es.js","node_modules/pouchdb-fetch/lib/index-browser.es.js","node_modules/pouchdb-find/node_modules/pouchdb-collate/lib/index.es.js","node_modules/pouchdb-find/node_modules/pouchdb-selector-core/lib/index.es.js","node_modules/pouchdb-abstract-mapreduce/node_modules/pouchdb-collections/lib/index.es.js","node_modules/pouchdb-abstract-mapreduce/node_modules/pouchdb-errors/lib/index.es.js","node_modules/pouchdb-abstract-mapreduce/node_modules/uuid/lib/rng-browser.js","node_modules/pouchdb-abstract-mapreduce/node_modules/uuid/lib/bytesToUuid.js","node_modules/pouchdb-abstract-mapreduce/node_modules/uuid/v1.js","node_modules/pouchdb-abstract-mapreduce/node_modules/uuid/v4.js","node_modules/pouchdb-abstract-mapreduce/node_modules/uuid/index.js","node_modules/pouchdb-abstract-mapreduce/node_modules/pouchdb-utils/lib/index-browser.es.js","node_modules/pouchdb-abstract-mapreduce/node_modules/pouchdb-collate/lib/index.es.js","node_modules/pouchdb-mapreduce-utils/node_modules/pouchdb-collections/lib/index.es.js","node_modules/pouchdb-mapreduce-utils/node_modules/pouchdb-errors/lib/index.es.js","node_modules/pouchdb-mapreduce-utils/node_modules/uuid/lib/rng-browser.js","node_modules/pouchdb-mapreduce-utils/node_modules/uuid/lib/bytesToUuid.js","node_modules/pouchdb-mapreduce-utils/node_modules/uuid/v1.js","node_modules/pouchdb-mapreduce-utils/node_modules/uuid/v4.js","node_modules/pouchdb-mapreduce-utils/node_modules/uuid/index.js","node_modules/pouchdb-mapreduce-utils/node_modules/pouchdb-utils/lib/index-browser.es.js","node_modules/pouchdb-mapreduce-utils/lib/index.es.js","node_modules/pouchdb-abstract-mapreduce/lib/index.es.js","node_modules/pouchdb-find/lib/index-browser.es.js","node_modules/batch/index.js","src/workers/getMessage.js"],"names":["PouchDB","isBinaryObject","object","ArrayBuffer","Blob","cloneArrayBuffer","buff","slice","target","byteLength","targetArray","Uint8Array","sourceArray","set","cloneBinaryObject","size","type","webkitSlice","ExportedSet","ExportedMap","funcToString","Function","prototype","toString","objectCtorString","call","Object","isPlainObject","value","proto","getPrototypeOf","Ctor","constructor","clone","newObject","i","len","Array","isArray","length","Date","toISOString","hasOwnProperty","once","fun","called","args","Error","apply","toPromise","func","self","usedCB","pop","promise","Promise","fulfill","reject","resp","callback","err","mesg","push","then","e","result","logApiCall","name","listeners","logArgs","emit","origCallback","res","responseArgs","concat","adapterFun","_closed","_destroyed","taskqueue","isReady","addTask","failed","mangle","key","unmangle","substring","Map$1","_store","Set$1","array","add","supportsMapAndSet","Symbol","Map","Set","prop","getOwnPropertyDescriptor","species","pick","obj","arr","get","mangled","has","delete","forEach","cb","keys","defineProperty","hasLocal","assign","MAX_NUM_CONCURRENT_REQUESTS","identityFunction","x","formatResultForOpenRevsGet","bulkGet","db","opts","requests","docs","requestsById","request","id","numDocs","numDone","perDocResults","checkDone","collapseResultsAndFinish","results","info","allRequests","nextBatch","upTo","Math","min","batch","processBatch","offset","docId","j","docIdx","docRequests","docOpts","open_revs","map","rev","filter","formatResult","param","error","docIndex","setItem","localStorage","getItem","hasLocalStorage","attachBrowserEvents","Changes","_listeners","guardedConsole","method","console","arguments","randomNumber","max","parseInt","maxTimeout","random","defaultBackOff","explainError","status","str","EventEmitter","addListener","dbName","inprogress","eventFunction","on","changesOpts","changes","c","seq","since","cancelled","onChange","onError","removeListener","notifyLocalWindows","notify","$inject_Object_assign","to","index","nextSource","nextKey","PouchError","reason","message","JSON","stringify","UNAUTHORIZED","MISSING_BULK_DOCS","MISSING_DOC","REV_CONFLICT","INVALID_ID","MISSING_ID","RESERVED_ID","NOT_OPEN","UNKNOWN_ERROR","BAD_ARG","INVALID_REQUEST","QUERY_PARSE_ERROR","DOC_VALIDATION","BAD_REQUEST","NOT_AN_OBJECT","DB_MISSING","IDB_ERROR","WSQ_ERROR","LDB_ERROR","FORBIDDEN","INVALID_REV","FILE_EXISTS","MISSING_STUB","INVALID_URL","createError","CustomPouchError","p","undefined","generateErrorFromResponse","data","tryFilter","doc","req","msg","filterChange","hasFilter","query","query_params","change","filterReturn","include_docs","attachments","att","_attachments","stub","flatten","arrs","invalidIdError","test","isRemote","_remote","listenerCount","ee","parseDesignDocFunctionName","s","parts","split","normalizeDesignDocFunctionName","normalized","join","qName","qParser","parser","parseUri","m","exec","uri","encoded","indexOf","decodeURIComponent","replace","$0","$1","$2","scopeEval","source","scope","values","upsert","diffFun","docRev","_rev","newDoc","updated","_id","tryAndPut","put","thisAtob","atob","thisBtoa","btoa","createBlob","properties","Builder","builder","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","append","getBlob","binaryStringToArrayBuffer","bin","buf","charCodeAt","binStringToBluffer","binString","b64ToBluffer","b64","arrayBufferToBinaryString","buffer","binary","bytes","String","fromCharCode","readAsBinaryString","blob","reader","FileReader","hasBinaryString","onloadend","readAsArrayBuffer","blobToBinaryString","blobOrBuffer","blobToBase64","base64","setImmediateShim","global","setImmediate","setTimeout","MD5_CHUNK_SIZE","rawToBase64","raw","sliceBlob","start","end","appendBlob","arrayBuffer","appendString","string","appendBinary","binaryMd5","inputIsString","chunkSize","chunks","ceil","currentChunk","Md5","next","loadNextChunk","done","destroy","stringMd5","hash","rev$$1","deterministic_revs","clonedDoc","_rev_tree","uuidV4","v4","toLowerCase","uuid","winningRev","metadata","node","winningId","winningPos","winningDeleted","toVisit","rev_tree","tree","ids","branches","pos","deleted","traverseRevTree","revs","newCtx","ctx","sortByPos","a","b","collectLeaves","leaves","isLeaf","acc","sort","reverse","collectConflicts","win","conflicts","leaf","compactTree","revHash","rootToLeaf","paths","history","sortByPos$1","binarySearch","item","comparator","low","mid","high","insertSorted","idx","splice","pathToTree","path","numStemmed","root","currentLeaf","compareTree","mergeTree","in_tree1","in_tree2","queue","tree1","tree2","merged","doMerge","dontExpand","restree","branch","t1","t2","diff","candidateParents","trees","parent","parentIdx","elements","elementsLen","el","stem","depth","stemmedRevs","stemmed","merge","newTree","revExists","splitRev","targetPos","targetId","getTrees","isDeleted","isLocalId","latest","historyNode","historyRev","l","tryCatchInChangeListener","pending","lastSeq","Changes$1","complete","removeAllListeners","onDestroy","cancel","isCancelled","bind","validateChanges","processChange","changeList","style","_conflicts","compare","left","right","yankError","cleanDocs","_deleted","atts","compareByIdThenRev","idCompare","_revisions","computeHeight","height","edges","prnt","from","edge","allDocsKeysParse","skip","limit","descending","doNextCompaction","task","_compactionQueue","catch","last_seq","_compact","shift","attachmentNameError","charAt","AbstractPouchDB","TaskQueue","parseAdapter","match","adapters","preferredAdapters","prefix","adapterName","adapter","usePrefix","use_prefix","prepareForDestruction","onDestroyed","from_constructor","onClosed","__opts","auto_compaction","prefixedName","backend","_adapter","valid","fail","ready","_changesFilterPlugin","validate","doChanges","continuous","live","normalize","shouldFilter","newPromise","_changes","update_seq","post","bulkDocs","_putLocal","_removeLocal","oldRevId","newRevNum","newRevId","putDoc","_put","new_edits","force","ok","putAttachment","attachmentId","api","createAttachment","prevrevpos","removeAttachment","remove","docOrId","optsOrRev","was_delete","revsDiff","count","missing","addToMissing","revId","_getRevisionTree","processDoc","missingForId","missingObj","compactDocument","maxHeight","revTree","candidates","_doCompaction","compact","promises","row","onComplete","all","_getLocal","finishOpenRevs","existing","_get","revs_info","splittedRev","revNo","currentPath","hashIndex","indexOfRev","howMany","_revs_info","_getAttachment","getAttachment","allDocs","start_key","startkey","end_key","endkey","TypeError","incompatibleOpt","_allDocs","return_docs","close","_close","_info","db_name","_type","attachmentError","content_type","_bulkDocs","registerDependentDatabase","dependentDb","depDB","dependentDbs","destroyDb","_destroy","localDoc","deletedMap","trueName","RegExp","execute","AbortController","abort","f$1","fetch","h","Headers","eventEmitter","setUpEventEmitter","Pouch","destructListeners","_destructionListeners","dbList","addToPreferredAdapters","plugin","__defaults","defaults","defaultOpts","PouchAlt","url","version","getFieldFromDoc","parsedField","compare$1","parseField","fieldName","fields","current","ch","combinationFields","isCombinationalField","field","getKey","getValue","mergeAndedSelectors","selectors","selector","matcher","$eq","fieldMatchers","operator","mergeGtGte","mergeLtLte","mergeNe","mergeEq","$gte","$gt","$lte","$lt","$ne","massageSelector","input","wasAnded","orOrNor","subSelector","pad","padWith","upToLength","padding","targetLength","padLeft","MIN_MAGNITUDE","MAGNITUDE_DIGITS","SEP","collate","normalizeKey","ai","collationIndex","bi","stringCollate","arrayCollate","objectCollate","Infinity","isNaN","origKey","toJSON","k","val","indexify","numToIndexableString","toIndexableString","objKey","parseNumber","originalIdx","num","zero","neg","numAsString","magAsString","magnitude","parseFloat","stack","metaStack","lastMetaElement","element","lastElementIndex","parseIndexableString","parsedNum","parsedStr","arrayElement","objElement","ak","bk","expFormat","toExponential","magString","factor","abs","factorStr","toFixed","createFieldSorter","getFieldValuesAsArray","sorting","docFieldValue","aRow","bRow","aFieldValues","collation","filterInMemoryFields","rows","requestDef","inMemoryFields","rowFilter","fieldSorter","every","matchCominationalSelector","matchSelector","userOperator","userValue","some","orMatchers","find","matchers","fieldExists","fieldIsNotUndefined","modField","divisor","mod","arrayContainsValue","arrayContainsAllValues","arraySize","regexMatch","re","typeMatch","neValue","matchesSelector","rowsMatched","evalFilter","evalView","filterName","view","changesHandler","doc_ids","viewName","ddoc","mapFun","views","filterFun","filters","applyChangesFilterPlugin","toObject","reduce","reservedWords","dataWords","parseRevisionInfo","makeRevTreeFromRevisions","revisions","revisionIds","parseDoc","newEdits","dbOpts","nRevNum","revInfo","specialKey","parseBase64","preprocessString","blobType","asBinary","digest","preprocessBlob","md5","preprocessAttachment","preprocessAttachments","docInfos","docv","overallErr","docInfo","recv","processedAttachment","updateDoc","revLimit","prev","writeDoc","previousWinningRev","previouslyDeleted","isRoot","inConflict","newRev","rev_map","winningRev$$1","winningRevIsDeleted","delta","rootIsMissing","processDocs","fetchedDocs","tx","overallCallback","idsToDocs","docsDone","docsToDo","checkAllDocsDone","currentDoc","resultsIdx","docWritten","nextDoc","insertDoc","ADAPTER_VERSION","DOC_STORE","BY_SEQ_STORE","ATTACH_STORE","ATTACH_AND_SEQ_STORE","META_STORE","LOCAL_STORE","DETECT_BLOB_SUPPORT_STORE","safeJsonParse","parse","vuvuzela","safeJsonStringify","json","idbError","evt","encodeMetadata","decodeMetadata","storedObject","deletedOrLocal","decodeDoc","_doc_id_rev","lastIndexOf","readBlobData","body","asBlob","fetchAttachmentsIfNecessary","txn","fetchAttachment","attObj","objectStore","onsuccess","postProcessAttachments","attNames","resolve","compactRevs","possiblyOrphanedDigests","seqStore","attStore","attAndSeqStore","deleteOrphanedAttachments","countReq","IDBKeyRange","bound","openCursor","only","event","cursor","digestSeq","primaryKey","continue","openTransactionSafely","idb","stores","mode","transaction","idbBulkDocs","docStore","bySeqStore","attachStore","attachAndSeqStore","metaStore","docInfoError","metaDoc","allDocsProcessed","docCountDelta","preconditionErrored","_meta","blobSupport","onAllDocsProcessed","updateDocCountIfReady","docCount","newRevIsDeleted","isUpdate","hasAttachments","writeAttachments","collectResults","attachmentSaved","revpos","saveAttachment","newAtt","putReq","finishDoc","afterPutDoc","revsToDelete","metadataToStore","afterPutMetadata","insertAttachmentMappings","attsAdded","attsToAdd","onerror","preventDefault","stopPropagation","afterPutDocError","startTransaction","txnResult","onabort","ontimeout","oncomplete","verifyAttachments","finish","digests","filename","verifyAttachment","attErr","fetchExistingDocs","numFetched","revs_limit","readMetadata","runBatchedCursor","keyRange","batchSize","onBatch","useGetAll","keysBatch","valuesBatch","pseudoCursor","onGetAll","onGetAllKeys","onCursor","getAll","getAllKeys","continuePseudoCursor","lastKey","newKeyRange","upper","upperOpen","code","lowerBound","onSuccess","allDocsKeys","createKeyRange","inclusiveEnd","upperBound","idbAllDocs","keyRangeError","inclusive_end","onTxnComplete","onResultsReady","updateSeq","docIdRevIndex","allDocsInner","fetchDocAsynchronously","batchValues","batchValue","batchKeys","returnVal","getMaxUpdateSeq","maxKey","checkBlobSupport","blob$$1","matchedChrome","navigator","userAgent","matchedEdge","countDocs","running","tryCode","applyNext","enqueueTask","action","docIds","numResults","docIdsToMetadata","onGetMetadata","docIdRev","objectStores","winningDocs","metadatas","fetchWinningDocAndMetadata","winningDoc","onBatchDone","processMetadataAndWinningDoc","filtered","blobSupportPromise","cachedDBs","openReqList","IdbPouch","thisCallback","init","addDeletedOrLocalIndex","createIndex","unique","migrateLocalStore","localStore","local","range","seqCursor","migrateAttsAndSeqs","digestMap","migrateMetadata","metadataSeq","onGetMetadataSeq","instanceId","reqOpts","attachId","attachment","blobData","oldRev","ret","oStore","oldDoc","openReq","indexedDB","deleteDatabase","cached","open","onupgradeneeded","oldVersion","createSchema","createObjectStore","keyPath","autoIncrement","currentTarget","createLocalStoreSchema","addAttachAndSeqStore","migrations","migration","onversionchange","storedMetaDoc","completeSetup","storeMetaDocIfReady","instanceKey","IDBPouch","pool","promiseFactories","doNext","runNextBatch","thisErr","CHANGES_BATCH_SIZE","MAX_SIMULTANEOUS_REVS","CHANGES_TIMEOUT_BUFFER","DEFAULT_HEARTBEAT","supportsBulkGetMap","readAttachmentsAsBlobOrBuffer","encodeDocId","encodeURIComponent","preprocessAttachments$1","hasUrlPrefix","protocol","getHost","substr","user","password","auth","username","genDBUrl","genUrl","pathDel","host","port","paramsToStr","params","shouldCacheBust","ua","isIE","isTrident","isEdge","isGET","HttpPouch","dbUrl","ourFetch","setupPromise","options","headers","nAuth","token","unescape","fetchFun","now","adapterFun$$1","fetchJSON","response","v","setup","skip_setup","encodeAttachmentId","uuid$$1","ping","compact_running","interval","doBulkGet","doBulkGetShim","numBatches","onResult","batchNum","subOpts","supportsBulkGet","fetchAttachments","filenames","fetchData","process","browser","fetchAllAttachments","docOrDocs","contentType","paramStr","batch_size","heartbeat","requestTimeout","timeout","leftToFetch","feed","seq_interval","param_name","controller","lastFetchedSeq","aborted","fetchOpts","signal","fetched","raw_results_length","finished","HttpPouch$1","QueryParseError","captureStackTrace","NotFoundError","BuiltInError","promisedCallback","callbackify","fin","finalPromiseFactory","sequentialize","promiseFactory","that","uniq","theSet","mapToKeysArray","createBuiltInError","sum","jLen","jNum","log","evalFunctionWithEval","TaskQueue$1","createViewSignature","reduceFun","createView","sourceDB","temporary","localDocName","viewSignature","cachedViews","_cachedViews","promiseForView","depDbName","diffFunction","fullViewName","depDbs","lastSeqDoc","persistentQueues","tempViewQueue","CHANGES_BATCH_SIZE$1","parseViewName","isGenOne","emitError","createAbstractMapReduce","mapper","reducer","ddocValidator","tryMap","tryReduce","rereduce","output","sortByKeyThenValue","y","keyCompare","rowToDocId","postprocessAttachments","addHttpParam","paramName","asJson","coerceInteger","integerCandidate","asNumber","Number","checkQueryParseError","startkeyName","endkeyName","group","group_level","optionName","checkPositiveInteger","number","defaultsTo","getDocsToPersist","docIdsToChangesAndEmits","metaDocId","defaultMetaDoc","docData","indexableKeysToKeyValues","getMetaDoc","getKeyValueDocs","kvDocsRes","processKeyValueDocs","kvDocs","oldKeys","keyValue","newKeys","kvDoc","getQueue","updateView","updateViewInQueue","mapResults","currentSeq","saveKeyValues","listOfDocsToPersist","docsToPersist","processNextBatch","createDocIdsToChangesAndEmits","createIndexableKeysToKeyValues","emittedKeyValue","complexKey","queryView","queryViewInQueue","totalRows","shouldReduce","fetchFromView","viewOpts","total_rows","expectedKeys","parsedKeyAndDocId","onMapResultsReady","finalResults","reduceView","shouldGroup","groups","lvl","POSITIVE_INFINITY","last","groupKey","reduceTry","sliceResults","allDocsRes","docIdsToDocs","fetchPromises","keyStart","keyEnd","queryPromised","_query","customQuery","httpQuery","MAX_URL_LENGTH","keysAsString","createViewPromise","designDocName","stale","abstractQuery","coerceOptions","abstractViewCleanup","_viewCleanup","customViewCleanup","httpViewCleanup","localViewCleanup","docsToViews","viewsToStatus","ddocName","viewDBNames","statusIsGood","viewDBName","dbsToDelete","destroyPromises","builtInReduce","sumsqr","_sumsqr","getBuiltIn","reduceFunString","_sum","_count","_stats","origMap","builtIn","abstract","viewCleanup","mapreduce","isGenOne$1","fileHasChanged","remoteDoc","getDocAttachments","getDocAttachmentsFromTargetOrSource","src","doCheckForLocalAttachments","createBulkGetOpts","diffs","missingRev","getDocs","state","resultDocs","fetchRevisionOneDocs","hasConflicts","getRevisionOneDocs","getAllDocs","bulkGetOpts","bulkGetResponse","bulkGetInfo","Boolean","returnResult","CHECKPOINT_VERSION","REPLICATOR","CHECKPOINT_HISTORY_SIZE","LOWEST_SEQ","updateCheckpoint","checkpoint","session","returnValue","session_id","unshift","replicator","Checkpointer","writeCheckpoint","updateTarget","updateSource","writeTargetCheckpoint","writeSourceCheckpoint","isForbiddenError","comparisons","targetDoc","sourceDoc","compareReplicationLogs","srcDoc","tgtDoc","compareReplicationHistory","sourceHistory","targetHistory","S","sourceRest","T","targetRest","hasSessionId","sessionId","props","rest","floor","getCheckpoint","STARTING_BACK_OFF","backOff","retry","back_off_function","backOffSet","current_back_off","sortObjectPropertiesByKey","queryParams","generateReplicationId","filterViewName","queryData","md5sum","replicate","batches","currentBatch","repId","checkpointer","pendingBatch","writingCheckpoint","changesCompleted","replicationCompleted","batches_limit","changesPending","changedDocs","initCheckpointer","checkpointOpts","writeDocs","bulkOpts","completeReplication","errorsById","create","errorsNo","doc_write_failures","docs_written","errors","errorName","finishBatch","outResult","getChanges","getBatchDocs","got","docs_read","startNextBatch","getDiffs","processPendingBatch","immediate","abortReplication","fatalError","end_time","onChangesComplete","onCheckpointError","onChangesError","_abortChanges","abortChanges","startChanges","_addedListeners","Replication","toPouch","PouchConstructor","replicateWrapper","replicateRet","srcPouch","sync","Sync","canceled","optsPush","optsPull","pull","pullChange","pushChange","pushDenied","pullDenied","pushPaused","pullPaused","pushActive","pullActive","removed","removeAll","addOneListener","listener","out","success","replication","replicateMethods","other","_readyCalled","cleanup","typedBuffer","base64StringToBlobOrBuffer","binaryStringToBlobOrBuffer","blobOrBufferToBase64","blobOrBufferToBinaryString","clone$1","assign$1","f","hasName","res$1","bulkGetShim","functionName","nextTick","normalizeDdocFunctionName","parseDdocFunctionName","setFieldInDoc","bFieldValues","massageCreateIndexRequest","dbFetch","explain","getIndexes","deleteIndex","indexDef","getArguments","subArr","mergeObjects","oneArrayIsSubArrayOfOther","oneArrayIsStrictSubArrayOfOther","oneSetIsSubArrayOfOther","leftIdx","arrayToObject","maxScore","score","arrayEquals","arr1","arr2","createDeepMultiMapper","toEmit","iLen","createDeepSingleMapper","createShallowSingleMapper","createShallowMultiMapper","checkShallow","createMapper","isShallow","isSingle","mapFunDef","abstractMapper","massageSort","massageUseIndex","useIndex","cleanedUseIndex","massageIndexDef","getKeyFromDoc","def","filterInclusiveStart","targetValue","indexFields","docKey","reverseOptions","newOpts","inclusive_start","validateIndex","ascFields","validateSort","defaultUsed","noneIdSorts","sortItem","validateFindRequest","getUserFields","selectorFields","userFields","sortFields","MAX_VALUE","rightIdx","createIndex$1","originalIndexDef","getMd5","ddocId","hasInvalidLanguage","viewExists","updateDdoc","language","signature","getIndexes$1","indexes","viewNames","COLLATE_LO","COLLATE_HI","checkFieldInIndex","userOperatorLosesPrecision","sortFieldsByIndex","aIdx","bIdx","getBasicInMemoryFields","needToFilterInMemory","getInMemoryFieldsFromNe","getInMemoryFields","coreInMemoryFields","checkIndexFieldsMatch","sortOrder","sortMatches","selectorMatches","logicalMatchers","isNonLogicalMatcher","checkFieldsLogicallySound","firstField","matcherKey","checkIndexMatches","findMatchingIndexes","findBestMatchingIndex","matchingIndexes","defaultIndex","userFieldsMap","useIndexDdoc","useIndexName","scoreIndex","indexField","getSingleFieldQueryOptsFor","getSingleFieldCoreQueryPlan","combinedOpts","newQueryOpts","getMultiFieldCoreQueryPlan","getMultiFieldQueryOpts","inclusiveStart","usingGtlt","previousKeys","previousWasEq","previousWasSame","gtltLostSpecificity","userOperators","getDefaultQueryPlan","getCoreQueryPlan","planQuery","userFieldsRes","use_index","coreQueryPlan","queryOpts","indexToSignature","doAllDocs","originalOpts","find$1","getIndexesRes","queryPlan","indexToUse","warning","explain$1","deleteIndex$1","deltaFun","createIndexAsCallback","findAsCallback","explainAsCallback","getIndexesAsCallback","deleteIndexAsCallback","getOptions","OPTIONS","addEventListener","Batch","concurrency","entry","fiscal_code","statusCode"],"mappings":"A+ByXmDgsB,ARxRtB7qB,ACJyT+M,AExFtV,ADCA,AZDA,ADCA,AoB2F6B/M,ACJyT+M,AExFtV,ADCA,IRFA,ADEA,AZFA,ADEA,AuBFA,ADEA,ETAA,AbAA,AsBAA,ERFA,AbAA,AsBAA,ETAA,AbAA,AsBAA,GJJA,ARAA,AC6FsVA,AExFtV,AbAA,AmBLA,AC6FsVA,AExFtV,ETAA,AbAA,AsBAA,ETAA,AbAA,AsBAA,ETAA,AbAA,AsBAA,CXwFsVA,ASAAA,EF7F7Uqb,ARAArkB,ASAAA,EDAIwF,ARAGvF,ASAAA,CNKhB,AbAA,AsBAA,CJLkBqkB,ANMlB,AbAA,AsBAA,CXLS,AGKT,AbAA,AmBLS,AGKT,CJN2BC,CLM3B,AbAA,AsBAA,EJFSC,ERHA,AGKT,AbAA,AmBLS,AGKT,CVAA,AbAA,AsBAA,CHLMA,AP4FgVxb,AEvFtV,AbAA,AoBuFsVA,AEvFtV,EZLe/I,ASAAA,EDATukB,AREN,ASAA,CNGA,AbAA,AsBAA,CJLgB,ANKhB,AbAA,AsBAA,EVuFsVxb,ASAAA,CF3FhVyb,EAAeF,EAAa/e,ARCzBtF,ASAAA,CNGT,AbAA,AsBAA,CJJsC7C,ARCpB4C,ASAAA,GTCTA,AGET,AbAA,AmBFSA,AGET,GXuFsV+I,ASAAA,CFzF7Uwb,APyF6Uxb,ACvFtV,AbAA,AqBuFsVA,ACvFtV,EHFiB3L,CRAR4C,AGET,AbAA,AmBFSA,AGET,EZFaE,AEEb,AbAA,AoBFaA,AEEb,CRGA,AbAA,AsBAA,CXoFsV6I,ASAAA,EFzF5Tyb,EPyF4Tzb,ASAAA,CFxFvUsb,ENEf,AbAA,AsBAA,CHFeA,ARDQ,AGKvB,AbAA,AmBLuB,AGKvB,EJFSE,ALET,AbAA,AsBAA,CZHA,ASAA,CRuFsVxb,AEpFtV,AbAA,AoBoFsVA,AEpFtV,GTCA,AbAA,AsBAA,EJHSwb,EAGT,ALAA,AbAA,AsBAA,CZJSpkB,ASAAA,CNIT,AbAA,AsBAA,GZHOC,AGGP,AbAA,AmBHOA,AGGP,ETCA,AbAA,AsBAA,CVJA,AbAA,AsBAA,CHGSqkB,ALCT,AbAA,AsBAA,CZJOrkB,ASAAA,CDGUmF,ALEjB,AbAA,AsBAA,EJFsB8e,EAASC,ERHf,ASAA,CDKPC,ALAT,ADLA,AZKA,ADLA,AuBKA,ADLA,CVsFsVxb,ASAAA,CVlDtV,AG/BA,AbAA,AmB+BA,AG/BA,ETAA,AbAA,AsBAA,GJDgBqb,EAAI7e,APkFkUwD,ACtFtV,AbAA,AqBsFsVA,ACtFtV,CRKA,AbAA,AsBAA,CJDyBsb,ARgChBhkB,ASAAA,CN/BT,AbAA,AsBAA,CJDkCikB,ARgCnBhkB,ASAAA,CN/Bf,AbAA,AsBAA,EJAmBiF,ARmCbjF,ASAAA,ED0U6CumB,CR7U5CzmB,ASAAA,CN/BP,AbAA,AsBAA,CXgFsV2I,ASAAA,CPhFtV,AbAA,AsBAA,EZ+BO3I,AG/BP,AbAA,AmB+BOA,AG/BP,CJ4WmDymB,ANlXnD,AbAA,AsBAA,IVsFsV9d,ASAAA,CPhFtV,ADNA,AZMA,ADNA,AuBMA,ADNA,CXqCgB,ASAA,CN/BhB,AbAA,AsBAA,ETAA,AbAA,AsBAA,CZ+BoB5I,ASAAA,ETGdG,ASAAA,GD0U6CumB,AR1UpC3pB,AGlCf,ADLA,AZKA,ADLA,AoBuCeA,AGlCf,ADLA,CVqFsV6L,ASAAA,ERrFtV,AbAA,AsBAA,CRMA,AbAA,AsBAA,CVNA,AbAA,AsBAA,CXuCqB5L,AGjCrB,ADJA,AZIA,ADJA,AoBqCqBA,AGjCrB,ADJA,EH+WmD0pB,AL3WnD,AbAA,AsBAA,CX+EsV9d,ASAAA,CRnFtV,AbAA,AsBAA,ETAA,AbAA,AsBAA,EXqC6BzI,AGjC7B,AbAA,AmBiC6BA,AGjC7B,ETAA,ADJA,AZIA,ADJA,AuBIA,ADJA,CXsCS,ASAA,CNlCT,AbAA,AsBAA,CX+EsVyI,ASAAA,EF4RnS8d,ARzU1C,ASAA,CDyU0CA,EL3WnD,AbAA,AsBAA,CZkCa7pB,ASAAA,ETAI,AC6CqU+L,ACnFtV,AbAA,AoBsCiB,AC6CqUA,ACnFtV,CRKA,AbAA,AsBAA,CJ0WmD8d,ARzU/B5pB,ASAAA,CNjCpB,AbAA,AsBAA,CZiC0BqD,AEpC1B,AbAA,AoBoC0BA,AEpC1B,CRGA,AbAA,AsBAA,CJAA,ARiCgClD,ASAAA,IDjC5BsnB,CLAJ,ADHA,AZGA,ADHA,AuBGA,ADHA,EHGqB,ARiCmB1nB,AC6C8S+L,AE9EtV,AbAA,AmBiCwC/L,AC6C8S+L,AE9EtV,EZiC4C9L,AGjC5C,AbAA,AmBiC4CA,AGjC5C,EJCI0nB,ARgC6C3nB,ASAAA,EDhC1B,ANJvB,AbAA,AsBAA,EHKI4nB,ARgCOrkB,AC4C2UwI,AE9EtV,AbAA,AmBkCWxI,AC4C2UwI,AE9EtV,EJEU,ELDV,AbAA,AsBAA,CJGA,AR8BWxI,ASAAA,CNjCX,AbAA,AsBAA,ETAA,AbAA,AsBAA,CZiCeD,AEnCf,AbAA,AoBmCeA,AEnCf,EXmCqBtD,ASAAA,CR4CiU+L,ASAAA,EF1E7U8b,ALHT,AbAA,AsBAA,CZ0DA,ASAA,CDvDiBtS,ALHjB,ADHA,AZGA,ADHA,AuBGA,ADHA,EHMoBC,ALHpB,ADHA,AZGA,ADHA,AuBGA,ADHA,EVgFsVzJ,ASAAA,CFxEhVwJ,ANPN,AbAA,AsBAA,GHOMA,ARqDG/R,AG1DT,AbAA,AmB0DSA,AG1DT,IJKYgS,ARsDN,AG1DN,ADDA,AZCA,ADDA,AoB2DM,AG1DN,ADDA,CTKA,AbAA,AsBAA,CHCW,ALLX,AbAA,AsBAA,CZ0DwB,ASAA,CRkB8TzJ,AE5EtV,AbAA,AoB4EsVA,AE5EtV,CVIA,AbAA,AsBAA,ETAA,AbAA,AsBAA,EHCW,CLLX,AbAA,AsBAA,CJQM+b,ANJN,AbAA,AsBAA,CVwEsV/b,AE5EtV,AbAA,AoB4EsVA,AE5EtV,CJQM+b,CLRN,AbAA,AsBAA,CJQmBvS,ENJnB,AbAA,AsBAA,CHKMuS,EAAAA,ALRN,AbAA,AsBAA,CVKA,AbAA,AsBAA,CHGmBtS,APmEmUzJ,AE3EtV,AbAA,AoB2EsVA,AE3EtV,CZyDatI,ASAAA,CNzDb,AbAA,AsBAA,CJUMskB,GNLN,AbAA,AsBAA,CHKMA,CPiEgVhc,AE3EtV,AbAA,AoB2EsVA,AE3EtV,CJUWic,AR+C2C,ASAA,CNzDtD,AbAA,AsBAA,CJU0BzS,CLV1B,AbAA,AsBAA,EJWM0S,ANNN,AbAA,AsBAA,EHMWD,EAAexS,APgE4TzJ,AE1EtV,AbAA,AoB0EsVA,AE1EtV,ETAA,AbAA,AsBAA,CJWOgc,CLXP,AbAA,AsBAA,EJWOA,CNNP,AbAA,AsBAA,CHMYE,AP+D0Ulc,ASAAA,EP1EtV,AbAA,AsBAA,CJWoB,AR6C0BrI,AEnD9C,AbAA,AoBmD8CA,AEnD9C,CRLA,AbAA,AsBAA,CJYWqkB,CLZX,AbAA,AsBAA,CVKA,AbAA,AsBAA,CXmDoF,ASAA,CPnDpF,AbAA,AsBAA,CVqEsVhc,ASAAA,CRrEtV,AbAA,AsBAA,CHOWgc,ALTX,AbAA,AsBAA,CVEA,AbAA,AsBAA,CHOgBE,CNPhB,AbAA,AsBAA,CHSU,EP4D4Ulc,ACrEtV,AbAA,AqBqEsVA,ACrEtV,CRFA,AbAA,AsBAA,GVGA,AbAA,AsBAA,ITAA,AbAA,AsBAA,CRHA,AbAA,AsBAA,CZqD4EpI,AElD5E,AbAA,AoBkD4EA,AElD5E,CVoEsVoI,ASAAA,CF5DrUwJ,ER2CN,ASAA,CD1CF,ANTT,AbAA,AsBAA,ETAA,AbAA,AsBAA,EHSS,AP2D6UxJ,ASAAA,EVjB3U,ASAA,ETELnI,ASAAA,ITAAA,ASAAA,CD3CO2R,ANVb,AbAA,AsBAA,CXqDahW,ASAAA,IReyUwM,ACpEtV,AbAA,AqBoEsVA,ACpEtV,EHUawJ,CR2CO1R,ASAAA,CD3CH2R,EACR,EPyD6UzJ,ASAAA,EFzD7U,ANVT,AbAA,AsBAA,ETAA,AbAA,AsBAA,GTAA,AbAA,AsBAA,KHWawJ,APwDyUxJ,ASAAA,CRnEtV,AbAA,AsBAA,ETAA,AbAA,AsBAA,IHWawJ,ANXb,AbAA,AsBAA,CXoD6C7R,ACeySqI,AQfzSrI,ACeySqI,CFxDrUyJ,CNXjB,AbAA,AsBAA,EHWsB,ARyC4B/R,ASAAA,EDzCxB,ANR1B,AbAA,AsBAA,EHSS,GRwCgDK,ASAAA,CDxChD,CNTT,AbAA,AsBAA,EVgEsViI,ASAAA,KVd7UnI,ASAAA,CDxCIskB,EPsDyUnc,ASAAA,IVd7UnI,ASAAA,CDxCIskB,EAAc3S,ARwCV,ASAA,EDxCaC,GAErBtV,GRsCiB0D,ASAAA,GTAQF,ACcoTqI,AQdpTrI,ACcoTqI,CFpD7U7L,GRsC6BuD,ASAAA,GDtCvBtD,CPoDuU4L,ASAAA,GVdzSjI,ASAAA,IDtCtByR,GAAK4S,EAAa5S,EAAGC,ARsCc9R,ASAAA,ERc4RqI,ASAAA,CFpDrSqc,CR2CjD,ASAA,CD3C+D7S,EAAGC,CR2C9DzW,ASAAA,EDtCJ,ARuCIC,ACQkV+M,AQRlV/M,ACQkV+M,EVIzT/M,ASAAA,MRJyT+M,ASAAA,CF/C7U+b,ARmDoB9oB,ASAAA,EDnDPgE,GACZ,EP8C4U+I,ASAAA,QVIzT/M,ASAAA,IDlDZgE,EP8CqU+I,ASAAA,CF7C7U,CRiDoB/M,ASAAA,GDjDpB,GP6C6U+M,ASAAA,OVIzT/M,ASAAA,CTAAA,ASAAA,CDhDhB,AP4CyU+M,ASAAA,MVIzT/M,ASAAA,CDhDhB,CP4CyU+M,ASAAA,EVpFtV5I,ASAAA,EDyCS,ARzCHhE,ASAAA,IDyCG,IP2C6U4M,ASAAA,EVpFtU7H,ASAAA,GD0CNlB,CR1CY,ASAA,ERoFgU+I,ASAAA,IF1C5U/I,GR1CsBA,ASAAA,CD0CdqlB,EAAAA,ARzCZlkB,ASAAA,CRmFgV4H,ASAAA,EF1CxT/I,CRzCxBmB,ASAAA,ETAUpB,ASAAA,EDyCuBslB,ARzChBrlB,ASAAA,CRmF+T+I,ASAAA,CF1C/Ssc,CRxC9B,ASAA,EDwC0CC,KRxC1C,ASAA,CDwCgDtlB,CP0C6R+I,ASAAA,EFzCvU,CRzCD3I,ASAAA,ID2CDJ,CPuCyU+I,ASAAA,CFtC7U,CR5CY5H,ASAAA,GD4CZ,CR1CThB,ASAAA,ETAMhE,ASAAA,KRgFgV4M,ASAAA,CFrC5Uwc,IAAAA,AR3CM7pB,ASAAA,ED2CIsE,CPqCkU+I,ASAAA,CFpC5U7L,AR5CY,ASAA,GD4CZA,MAAMC,AR5CgB6C,ASAAA,ETAKvD,ACgFiTsM,AQhFjTtM,ACgFiTsM,GV/EhV5H,ASAAA,GD2CkBnB,CR3ClBmB,ASAAA,CR+EgV4H,ASAAA,CFpCxT,AR3CdhJ,ASAAA,CD4CJ9C,CR5CW+C,ASAAA,GD4CX/C,AR1CH,ASAA,ED0CS+C,EAAI5C,GR3CfgD,ASAAA,ID4CO,CR5CPA,AC8E+U2I,AQ9E/U3I,AC8E+U2I,CFlCxU,IAAI7L,ER5CJiE,ASAAA,CR8EwU4H,ASAAA,EV9E7TtM,ASAAA,CD4CDQ,ER3Cf,ASAA,CD4CI,ER1CbkD,ASAAA,ED0Ca,AR1CPhE,ASAAA,ID0CWa,EAAI,EAAGA,APiC8T+L,ASAAA,EFjC1T9L,AR1CZmE,AClBhB,AQkBgBA,AClBhB,EF4DiCpE,ER1CX,AClBtB,AQkBsB,AClBtB,EF6DcA,AP7Dd,ASAA,EF6DcA,GAAK8nB,EAAaS,AR3CAvlB,ASAAA,CRlBhC,ASAA,CF6DwChD,CRzC/BmE,ASAAA,OD4CI,AR7CGpB,ASAAA,CD6CH,CR7CUC,ASAAA,CR0E+T+I,ASAAA,CF7BrU/I,CP6BqU+I,ASAAA,EVzElU,ACyEkUA,AQzElU,ACyEkUA,GTAAA,ASAAA,EVzE7T3I,ASAAA,KD4CO/C,EP6BsT0L,ASAAA,CVvEtV5I,ASAAA,CRuEsV4I,ASAAA,CF5BvU/I,AR3CT7D,ASAAA,ERuEgV4M,ASAAA,KF5BvU/I,EAAIwlB,AP4BmUzc,ASAAA,CVvEtU1H,ASAAA,ERuEsU0H,ASAAA,ETAAA,ASAAA,GVvE7T,ASAA,CD4CZ,GAAY,IP2B6TA,ASAAA,CVvEnT/I,ASAAA,CRuEmT+I,ASAAA,CF3BrU/I,AP2BqU+I,ASAAA,CVtEhV5H,ASAAA,CD6CO,GR7CPA,ASAAA,CD6CO,CR7CGpB,ASAAA,CRsEsUgJ,ASAAA,CVtE/T/I,ASAAA,CD6CNylB,CPhEjB,ASAA,CVoBMpmB,ASAAA,ETAM8B,ASAAA,CD2CE,EAAA,ER3CS,ASAA,CD4CDokB,APhEbze,ASAAA,EFiEKye,APjEMjgB,ASAAA,EVoBQlF,ACpBA8D,AQoBA9D,ACpBA8D,CFiEdqhB,CPjEqBxe,ASAAA,CFiEbxJ,EPhEdjB,ASAAA,EVqBC+C,ASAAA,IRrBD/C,ASAAA,KTAK,ASAA,EFgEwBmpB,GAAI,AR5ChC,ACpBU1e,AQoBV,ACpBUA,CFiEH2e,EPhETpgB,ASAAA,EFgESogB,AR7CFtlB,ASAAA,ED6CQmlB,CPhEfjgB,ASAAA,CFgEuBmgB,GR7CTtkB,ASAAA,GTCZ9B,ACpBOiG,AQoBPjG,ACpBOiG,EFiEe,APhExBtG,ASAAA,CVqBPmB,ASAAA,ETAMhE,ASAAA,CD2CiBupB,CPhEhB1mB,ASAAA,GFiEWymB,EAAAA,APjEJvhB,ASAAA,ETCP8C,ASAAA,CFgEgB8d,AR5CPxjB,ASAAA,ED4CoBokB,EPhE7B1e,ASAAA,IFsEEhH,ARlDiB,ASAA,IRpBT+G,ASAAA,ETCV7C,ASAAA,CFqEElE,EAGT,ARrDoCuB,ASAAA,ERnB7B2C,ASAAA,CVqBA,ASAA,ITDD1C,ASAAA,EDoDGmkB,APxEM,ASAA,EFwEG3lB,ARpDZwB,ASAAA,CR3BN,ASAA,CV2BajF,ASAAA,CDqDPyD,APhFG8G,ASAAA,ETAAA,ASAAA,CFgFK,GRrDMtF,ASAAA,IDqDdxB,CRrDmB,AC3BhB8G,AQ2BgB,AC3BhBA,CFiFG,CPjFSlJ,ASAAA,GV2BSwC,ASAAA,IRjB9B0G,ASAAA,ETAW3K,ASAAA,EVkBAa,ASAAA,EDqDQgD,ARrDJ,ASAA,ETAG/C,ASAAA,CDsDP,CRtDauE,ASAAA,ETAKpE,AClBRhB,AQkBQgB,AClBRhB,CFwEV,MRtD0BY,ASAAA,ETAIC,AClBT,AQkBSA,AClBT,EFyEjB+C,ARvD+BhD,ASAAA,ITAK,ASAA,CTC3CgD,ASAAA,EDsDOA,EAAM,ARtDbA,AClBCiH,AQkBDjH,AClBCiH,EFwEgB,ARtDXzF,ASAAA,EDuDH,ARvDQxE,ASAAA,GTGZP,ACrBEwK,AQqBFxK,ACrBEwK,CFyEE,CRtDK,ASAA,GRnBFC,ASAAA,EVmBO9G,ASAAA,GDuDNwlB,IRvDa5lB,ASAAA,CRnBJ,ASAA,CTCZ,ASAA,CFyEG4lB,ARtDL3lB,ASAAA,EDsD0BD,ARtD1BC,ASAAA,ETASD,ASAAA,CDuDR,CP1EC,ASAA,GF0ED,CRnDXzD,ASAAA,CRvBiB+I,ASAAA,MVuBV7D,ASAAA,CD0DQzB,APhFL,ASAA,KTAA,ASAA,EFgFKA,EACJyL,CPjFIzM,ASAAA,IVsBOmB,ASAAA,CRrBT,ASAA,CVqBehE,ASAAA,CD2DT,MPhFN,ASAA,GVqB0B,ASAA,CD2DT,CPhFZ6K,ASAAA,KFiFPyE,AR5DoC,ASAA,CTCxC,ASAA,ERrBK,ASAA,EVqBL,ASAA,GD2DY,EPhFP,ASAA,KTAK1E,ASAAA,CVsBNxK,ASAAA,ED0DmB,KR1DnBA,ASAAA,CD2DAkP,CP7EX,ASAA,ITAItE,ASAAA,CVkBc3F,ASAAA,CRlBC,ASAA,CF6EA,GR3DI,AClBAsF,AQkBA,AClBAA,ETAW,ASAA,GVkBN1G,ASAAA,CRlBW,ASAA,CF6ET,MAEnB,AR7DyBhD,ASAAA,ID6DzB,IP/E4C,ASAA,EVgCvDiD,ASAAA,ETAMlE,ASAAA,CDgDMgB,IAAAA,EAAUD,GRhDNqD,ASAAA,GDgDYpD,CRhDN,ASAA,ODgDc6C,ERhDJA,ASAAA,CDiDpBiB,EAAM9D,ARhDT,ASAA,EDgDmB6C,EAAMzD,APhF9B6K,ASAAA,ETAoB,ASAA,CVgCf,ASAA,GRhCmBN,ASAAA,CFgFatF,CRhD3BpB,AChCyB,AQgCzBA,AChCyB,IFgFOJ,APhFF,ASAA,GFiFhChD,ARjDStB,ASAAA,GDiDJ,CRjDQsE,ASAAA,CDkDb/C,EAAMgE,ARlDY,ASAA,EDkDR7D,ERhDtBiD,AClC2D,AQkC3DA,AClC2D,EVkCrDlE,ASAAA,GDiDM2C,EAAS,GACT3B,ERlDIiE,ASAAA,CDkDJjE,EACK,CRnDK,ASAA,MDmDHH,EAAIC,CRnDS+C,ASAAA,EDoDV6lB,CRnDb,ASAA,EDmDaA,CPrFlBxe,ASAAA,CFqFoCpG,CPrFtB,ASAA,CFqF0BjE,CRnDnC,ASAA,ERlCa8J,ASAAA,ETAW,ASAA,CVkCnB1G,ASAAA,GDsDG,APxFqB,ASAA,IVkCjBgB,ASAAA,GDsDFpE,CRtDMgD,ASAAA,CDsDF/C,GAAK,ARpD5BoD,ACpCmD,AQoCnDA,ACpCmD,CFyFnCylB,CRrDV3pB,ASAAA,GDqDU2pB,EAAS7kB,EAAIjE,EPxFzBsK,ASAAA,CFyFkBue,ARtDNvkB,ASAAA,CRnCG,ASAA,EFyFGukB,EAAkBC,APzFjBhf,ASAAA,ETAW,ASAA,CF0FlB+e,ARvDU,ASAA,EDuDQ7lB,CP1FK,ASAA,CF0FD8lB,IAGvBhnB,CR1DqByC,ASAAA,GTC7BnB,ASAAA,ERpC4C,ASAA,CF6FpCtB,EAGN,AR5DFsB,ASAAA,MD4DE,CR5DKkB,ASAAA,EDkEd,MRlEsB,ASAA,GDkEbukB,EAAkB7lB,GAGlBglB,CRrEuBvoB,ASAAA,CRnC5B8K,ASAAA,CVmCmCvH,ASAAA,CRnCtB,ASAA,EVoCVA,ASAAA,CDoEEglB,CRpEFhlB,ACpCc8G,AQoCd9G,ACpCc8G,CFuGbge,CPvGwB,ASAA,CFuGxBA,EAAa9kB,CRhErBzD,ACvCqC,AQuCrCA,ACvCqC,GFwGNqoB,EAAMe,EAAS3lB,ARjEvCyB,ASAAA,GD+DM,IPtGuC,ASAA,CF2GpD,ORpEsBpB,ASAAA,EDoEb0lB,ARpEmB5pB,ASAAA,EDoEPoJ,EAAKvI,GACpBgpB,GRrEiC,ASAA,CDsEjCC,EADAD,EAAchpB,EAGdkpB,ARxEyC,ASAA,CTCxC,ASAA,EDsEiB,ERtEjB,ASAA,GRvCH1e,ASAAA,CF6GSjC,CP7GI,ASAA,CF6GAvI,GAEP,AP/GW8J,ASAAA,EF+GX,ARvEC,ACxCqB,AQwCrB,ACxCqB,EFgH5B9J,EPhHiC,ASAA,GVwC1B,ASAA,GDyEF,CACDmpB,CR1EQ/lB,ASAAA,GD0ER+lB,EAAiB,APlH0B,ASAA,EVwC5BvqB,ASAAA,ID0ET2J,EAAIvI,ERpDZwD,ASAAA,CDqDFxD,IACIopB,AR7CgBzlB,ASAAA,ID6ChBylB,EAAc,ER7CEzlB,ASAAA,CD8ChB0lB,EAAc9gB,CRtDJ5E,ASAAA,CDsDQT,APpHtBuH,ASAAA,CV8Dc9G,ASAAA,CR9DA,ASAA,GVsE0BD,ASAAA,CRtEtBoG,ASAAA,ETAW,ASAA,EFoHG9J,EAAGA,APpHD,ASAA,CVsEM0D,ASAAA,CD8CDikB,GACnC2B,ARtDU5lB,ASAAA,EDsDEuE,ARtDFvE,ASAAA,MTOMC,ASAAA,CRtE6B,ASAA,EFqHxB0lB,EAAa,GR/ClB1lB,ASAAA,CD+CwB+jB,EAMrC,CR1DOrkB,ASAAA,ETAAA,ASAAA,CDsDV8lB,CRjDoCzlB,ASAAA,GDkD1B,GAAC4lB,ERlDyB5lB,ASAAA,CDoDnCikB,GAAAA,ARxDSxkB,ASAAA,ETAAA,ASAAA,EDyDD,CACPsiB,ARtDc9hB,ASAAA,IDsDd8hB,EAAKld,EAAIvI,ARtDK2D,ASAAA,GDuDd8hB,CRvDD1mB,ASAAA,EDuDQ,ARvD2B2E,ASAAA,ODuDlC+hB,CRvDkC/hB,ASAAA,CDwDpC,EP7HJgH,ASAAA,CVqEyB1L,ASAAA,CRrEd,ASAA,EF+HQymB,EP/HJ3b,ASAAA,CF+HI2b,CP/HO,ASAA,CFiIxBzlB,GPjI6B,ASAA,CFqIvBiI,EADmB,KADbmhB,EAAAA,EAAYzb,MAAM,IPnIsB,ASAA,EFoItCvN,OACR6H,SAASmhB,EAAa,CPpI9Bze,ASAAA,ETAgB,ASAA,CFuIR4e,GPvIYzf,ASAAA,ETAW,ASAA,ITAK,ASAA,EFuIjBsf,EAAY,GAAK,IAAMA,EAAY,GPvID,ASAA,CF0IjDD,IACIF,GAAM,IAGI,IAAdK,IAIIC,EAAAA,WAAWN,EAAM,IAAMK,EPjJ/B1e,ASAAA,EFoJK,APpJK,ASAA,ITAId,ASAAA,EFoJT,APpJoB,ASAA,CFoJnBmf,GPpJwB,ASAA,CFoJnBA,EAAK7oB,MPpJwB,ASAA,CFoJfJ,EAAIgpB,GAKjC,SAAS9nB,EAAIsoB,EAAOC,GACdzlB,IAAAA,EAAMwlB,EAAMtoB,IPzJd2J,ASAAA,EF2JE4e,AP3JgB,ASAA,GF2JhBA,CP3JoB3f,ASAAA,CF2JV1J,CP3JqB,ASAA,ITAK,ASAA,EF2JlB,CAChBspB,IAAAA,EAAkBD,EAAUA,EAAUrpB,KP5Je,ASAA,EF4JN,GAC/C4D,IAAQ0lB,EAAgBC,UAEhBzoB,EAAAA,AP9JZ4J,ASAAA,ETAoB,ASAA,IF+JA2e,AP/JI3f,ASAAA,EF+JJ2f,AP/Je,ASAA,EF+JLA,EAAUrpB,AP/JA,ASAA,OF+JS,IAE7CupB,IAAAA,EAAUD,EAAgBC,CPjK+B,ASAA,OFkKzDC,EAAmBF,EAAgB/f,MACnCzJ,GAAAA,MAAMC,QAAQwpB,CPlKlB5e,ASAAA,EFmKUpJ,APnKO,ASAA,EFmKPA,EPnKWmI,ASAAA,ETAW,ASAA,CFmKjB9F,GPnKsB,ASAA,KFoK9B,GAAI4lB,IAAqBJ,EAAMppB,GPpKiB,ASAA,IFoKR,EAAG,CAExC4C,EADEwmB,EAAMtoB,OACD8C,OAETrC,EAAAA,IPvKRqJ,ASAAA,CFuKahH,CPvKC,ASAA,GF4KlB,CP5KsB8F,ASAAA,ETAW,ASAA,ITAK,ASAA,EF4K7B+f,EAAqBthB,GAMrB,IALHihB,GP7K+C,ASAA,CF6K/CA,EAAQ,GACRC,EAAY,GACZzpB,EAAI,IAGK,CACPgoB,IAAAA,EAAiBzf,EAAIvI,KACrBgoB,GAAmB,EPnLvB/c,ASAAA,ETAgB,ASAA,GFmLZ+c,CPnLgBle,ASAAA,CF2LZke,CP3LuB,ASAA,ITAK,ASAA,EF2L5BA,GACD,IAAA,IACGrmB,CP7LyC,ASAA,CF6LzCA,KAAK,MACX,MACG,IAAA,IACGA,EAAAA,KAAgB,CP/L1BuJ,ASAAA,ETAa,ASAA,GF+LE3C,CP/LEuB,ASAAA,CF+LE9J,CP/LS,ASAA,GFgMxBA,CPhM6B,ASAA,GFiM7B,MACG,GPlMuC,ASAA,CFkMvC,IACC8pB,IAAAA,EAAYf,EAAYxgB,EAAKvI,GAC3B2B,EAAAA,EPnMVwJ,ASAAA,ETAY,ASAA,CFmMG2e,EAAUb,CPnMTnf,ASAAA,ETAW,ASAA,EFoMlBggB,EPpMuB,ASAA,CFoMvBA,EAAU1pB,OACf,MACG,IAAA,EPtMgD,ASAA,EFyM5C,IAFH2pB,IAAAA,CPtMR3e,ASAAA,CFsMoB,CPtMR,ASAA,IFwMK,APxMDtB,ASAAA,CFyMN2b,CPzMiB,ASAA,GFyMjBA,CPzMsB,ASAA,CFyMjBld,EAAIvI,GACTylB,GAAO,OAAPA,EACF,CP3M4C,ASAA,KF6MjCA,GAAAA,EACbzlB,CP7MNqL,ASAAA,ETAY,ASAA,CFkNI0e,EAAAA,CPlNAjgB,ASAAA,CFkNU2E,CPlNC,ASAA,ITAK,ASAA,GFkNE,gBAAiB,KPlNM,ASAA,CFmNlDA,QAAQ,EPlNfnD,ASAAA,ETAY,ASAA,ITAIxB,ASAAA,ETAW,ASAA,ITAK,ASAA,EFkNA,KACzB2E,KPnNsC,ASAA,GFmN9B,gBAAiB,KAEtB9M,EAAAA,KAAKooB,GACX,MACG,IAAA,IACCC,IAAAA,EAAe,CAAEL,CPvNzBpe,ASAAA,ETAc,ASAA,ITAIzB,ASAAA,CFuNgB,CPvNL,ASAA,EFuNSH,EPvNJ,ASAA,IFuNW6f,EAAMppB,QACzCuB,APxNuC,ASAA,EFwNvCA,KAAKqoB,EAAaL,SACdhoB,EAAAA,EPxNd6J,ASAAA,ETAc,ASAA,CFwNKwe,GACf,APzNclgB,ASAAA,ETAW,ASAA,IF0NtB,AP1N2B,ASAA,IF0N3B,IACCmgB,IAAAA,EAAa,AP3N4B,ASAA,CF2N1BN,QAAS,GAAIhgB,MAAO6f,EAAMppB,QACvCuB,EAAAA,KAAKsoB,EAAWN,SACZhoB,EAAAA,KAAKsoB,GACf,MAEF,CP/NFxe,ASAAA,ETAe,ASAA,ITAI3B,ASAAA,CFgOT,CPhOoB,ASAA,ITAK,ASAA,CFgOzB,IAAIlJ,MACR,IPjO6C,ASAA,+CTCnD8K,ASAAA,ETAc,ASAA,ITAI5B,ASAAA,ETAW,ASAA,CFiOrBke,GPjO0B,ASAA,IF0K9BA,CACEwB,GAAiB,IAAjBA,EAAMppB,AP3KqC,ASAA,OF4KtCopB,OAAAA,EAAMtoB,MAETsoB,EAAAA,EAAOC,CP5KnB,ASAA,IFoOA,KPpOS9d,ASAAA,ETAYzE,ASAAA,EFoOZihB,APpOmBpe,ASAAA,EFoONwL,CPnOX3J,ASAAA,CFmOc4J,GAElB,IADDvV,CPpOK2L,ASAAA,ETAiB7B,ASAAA,CFoOtB9J,EAAMiG,APhOH,ASAA,ITAA,ASAA,CFgOQC,GPhOJ0F,ASAAA,CFgOQ0J,EAAEnV,EPhOL8G,ASAAA,ETCY,ASAA,GF+NCsO,EAAEpV,QACtBJ,EAAI,EAAGA,EAAIC,APhOLiH,ASAAA,EFgOUlH,APhOJ6L,ASAAA,IFgOS,CACxBgK,APhOKhK,ASAAA,IFgOLgK,CPhOKhK,ASAAA,CFgOEgc,EAAQtS,APhOLrO,ASAAA,EFgOOlH,APhOD6L,ASAAA,GFgOK2J,EAAExV,IACvB6V,AP7NW/J,ASAAA,GF6NF,CP7NT/B,ASAAA,GF6NA8L,CP5NG9L,ASAAA,CF6NE8L,IP7NF9L,ASAAA,GF6NE8L,EAGHN,EPhOUxL,ASAAA,GTIX,ASAA,EF4NCwL,EAAEnV,GP7NOjB,ASAAA,ETAAA,ASAAA,IF6NIqW,EAAEpV,IP7NM0J,ASAAA,ETAW3K,ASAAA,CF6NP,EAC9BoW,EAAEnV,KP7NE,ASAA,EF6NOoV,EAAEpV,AP7NLwL,ASAAA,ETAiB7B,ASAAA,GTG9B,ASAA,EF0N4B,GAAK,EAEjC,EP5NSgC,ASAAA,ETA0BtK,ASAAA,GTE7B,ASAA,EF0NGymB,CP1NY,ASAA,CF0NE3S,EAAGC,GAIhBD,OAAAA,IAAMC,AP9NH/T,ASAAA,EF8NQ,AP9NU,ASAA,CTCvBuK,ASAAA,CF6NmBuJ,EAAIC,CP7NvBxJ,ASAAA,CF6N4B,CP7NrBvK,ASAAA,EF6N0B,CP5N/BkJ,ASAAA,CF8NV,CP9NUA,ASAAA,GTCFqB,ASAAA,KF6NCoc,AP7NMpc,ASAAA,EF6NQuJ,APzMd9T,ASAAA,EFyMiB+T,GAGnB,CP7ND,ASAA,GF2NA0U,IAAAA,EAAK3qB,CP3NMkC,ASAAA,GTAqB,ASAA,GF2NpB+C,KAAK+Q,GAAI4U,EAAK5qB,AP3NRkC,ASAAA,ETAIyF,ASAAA,KF2NW1C,GP1N/BxC,ASAAA,EF0NoCwT,AP1NpCxT,ASAAA,GF2NF/B,EAAMiG,AP3NG,ASAA,KF2NEC,IAAI+jB,EAAG9pB,AP1NhBkI,ASAAA,ETAAA,ASAAA,KF0NwB6hB,EAAG/pB,AP1NlB,ASAA,KTGT,ASAA,GFwNGJ,EAAI,EAAGA,EAAIC,APxNJwB,ASAAA,EFwNSzB,EPvNnBgC,ASAAA,EFuNwB,APvNxBA,ASAAA,CFyNA6T,IAAAA,APzNOpU,ASAAA,EFyNAomB,APzNI3gB,ASAAA,EFyNIgjB,EAAGlqB,GAAImqB,APzNF,ASAA,EFyNKnqB,IACzB6V,GAAS,EPvNT,ASAA,EFuNAA,EACKA,OAAAA,APxNOpU,ASAAA,EF4NZoU,EP3NAvN,ASAAA,CF2NS,CP3NTA,ASAAA,IF0NGuf,EAAAA,CP1NM,ASAA,CF0NEtS,EAAE2U,EAAGlqB,APvNhB,ASAA,IFuNqBwV,EAAE2U,EAAGnqB,IPvNbyB,ASAAA,EFyNRoU,EPxNL7L,ASAAA,ETAAA,ASAAA,GFwNK6L,EAIHqU,GP5NQzoB,ASAAA,ETAIuI,ASAAA,EF4NZkgB,EAAG9pB,KP5NoBqB,ASAAA,ETAIsI,ASAAA,EF4NbogB,EAAG/pB,IPzNlBqB,ASAAA,ETGA0I,ASAAA,CFsN4B,EAChC+f,EAAG9pB,GPvNC+J,ASAAA,IFuNQggB,EAAG/pB,OAAU,APvNrB+J,ASAAA,ETAcC,ASAAA,CFuNY,EAMnC,KP7NuBA,ASAAA,IF6Nd4d,EAAeljB,GAClBS,IACAyR,EADK,CAAC,EP9NW5M,ASAAA,ETAmBC,ASAAA,MF8NnB,EP9NmBA,ASAAA,OF8NT,KP9NSA,ASAAA,ETAaC,ASAAA,EF8NZ,MP9NYA,ASAAA,IF+NxCiE,SP/NwCjE,ASAAA,ETAcC,ASAAA,IF+NvCzF,GAExB,CPjO+DyF,ASAAA,MFiO9DyM,EACO,GPlOuDzM,ASAAA,ETAYC,ASAAA,EFkOzE1F,EACK,EAEL5E,EPrOyEsK,ASAAA,IFqOnErK,OPrOmEqK,ASAAA,CFqO3D1F,CPrOuE2F,ASAAA,EFsOhF,EAEFuM,EAAM,EAAKA,APxOuEvM,ASAAA,EFwOjE,EAAMuM,EAAM,EAGlC9W,IP3OuFuK,ASAAA,EF2OjFtK,AP3O8FuK,ASAAA,QF2OtF5F,AP3OsF4F,ASAAA,GF4O/F,MP5O+FA,ASAAA,CF2OpGxK,CP3O8GyK,ASAAA,CFqPpH,OPrPoHA,ASAAA,EFqP3Gie,EAAqBK,GAExBA,GAAQ,IAARA,APvP8Gte,ASAAA,EFwPzG,APxPwHC,ASAAA,MFwPxH,EPxPwHA,ASAAA,EF6P7Hwf,IAAAA,EAAYnB,AP7PiHre,ASAAA,EF6P7Gyf,AP7PsHxf,ASAAA,QTAAA,ASAAA,QF6PtG8C,MAAM,EP7PgG9C,ASAAA,ETAiBC,ASAAA,IF8PvJwe,EAAYrhB,EP9P2I6C,ASAAA,OF8PlIsf,EAAU,GAAI,IAEnCjB,EAAMF,APhQiJne,ASAAA,EFgQ3I,APhQ8JC,ASAAA,EFkQ1KjJ,EAASqnB,EAAM,EPlQ2Jpe,ASAAA,EFkQrJ,IAKrBuf,EAAY7C,IADS0B,GAAOG,APtQ8Ive,ASAAA,EFsQlIue,APtQkJte,ASAAA,GFsQrI0c,GACdtoB,EPvQmJ4L,ASAAA,SFuQvI,GPvQuIA,ASAAA,CFuQlI2c,CPvQ+I1c,ASAAA,EFyQjM2c,GAAAA,EAAM0C,CPzQ2Lrf,ASAAA,CF4QvMsf,IAAAA,EAASrkB,KAAKskB,EP5QyLvf,ASAAA,EF4QrLse,AP5QoMre,ASAAA,QTAAA,ASAAA,GF4QzLkf,EAAU,KAEvCjB,CP9QsNje,ASAAA,ETAYE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","file":"getMessage.fde94453.map","sourceRoot":"..","sourcesContent":["'use strict';\n\nmodule.exports = argsArray;\n\nfunction argsArray(fun) {\n  return function () {\n    var len = arguments.length;\n    if (len) {\n      var args = [];\n      var i = -1;\n      while (++i < len) {\n        args[i] = arguments[i];\n      }\n      return fun.call(this, args);\n    } else {\n      return fun.call(this, []);\n    }\n  };\n}","'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} raw     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     raw True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && msCrypto.getRandomValues.bind(msCrypto));\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","'use strict';\n\n/**\n * Stringify/parse functions that don't operate\n * recursively, so they avoid call stack exceeded\n * errors.\n */\nexports.stringify = function stringify(input) {\n  var queue = [];\n  queue.push({obj: input});\n\n  var res = '';\n  var next, obj, prefix, val, i, arrayPrefix, keys, k, key, value, objPrefix;\n  while ((next = queue.pop())) {\n    obj = next.obj;\n    prefix = next.prefix || '';\n    val = next.val || '';\n    res += prefix;\n    if (val) {\n      res += val;\n    } else if (typeof obj !== 'object') {\n      res += typeof obj === 'undefined' ? null : JSON.stringify(obj);\n    } else if (obj === null) {\n      res += 'null';\n    } else if (Array.isArray(obj)) {\n      queue.push({val: ']'});\n      for (i = obj.length - 1; i >= 0; i--) {\n        arrayPrefix = i === 0 ? '' : ',';\n        queue.push({obj: obj[i], prefix: arrayPrefix});\n      }\n      queue.push({val: '['});\n    } else { // object\n      keys = [];\n      for (k in obj) {\n        if (obj.hasOwnProperty(k)) {\n          keys.push(k);\n        }\n      }\n      queue.push({val: '}'});\n      for (i = keys.length - 1; i >= 0; i--) {\n        key = keys[i];\n        value = obj[key];\n        objPrefix = (i > 0 ? ',' : '');\n        objPrefix += JSON.stringify(key) + ':';\n        queue.push({obj: value, prefix: objPrefix});\n      }\n      queue.push({val: '{'});\n    }\n  }\n  return res;\n};\n\n// Convenience function for the parse function.\n// This pop function is basically copied from\n// pouchCollate.parseIndexableString\nfunction pop(obj, stack, metaStack) {\n  var lastMetaElement = metaStack[metaStack.length - 1];\n  if (obj === lastMetaElement.element) {\n    // popping a meta-element, e.g. an object whose value is another object\n    metaStack.pop();\n    lastMetaElement = metaStack[metaStack.length - 1];\n  }\n  var element = lastMetaElement.element;\n  var lastElementIndex = lastMetaElement.index;\n  if (Array.isArray(element)) {\n    element.push(obj);\n  } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n    var key = stack.pop();\n    element[key] = obj;\n  } else {\n    stack.push(obj); // obj with key only\n  }\n}\n\nexports.parse = function (str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n  var collationIndex,parsedNum,numChar;\n  var parsedString,lastCh,numConsecutiveSlashes,ch;\n  var arrayElement, objElement;\n  while (true) {\n    collationIndex = str[i++];\n    if (collationIndex === '}' ||\n        collationIndex === ']' ||\n        typeof collationIndex === 'undefined') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack.pop(), stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case ' ':\n      case '\\t':\n      case '\\n':\n      case ':':\n      case ',':\n        break;\n      case 'n':\n        i += 3; // 'ull'\n        pop(null, stack, metaStack);\n        break;\n      case 't':\n        i += 3; // 'rue'\n        pop(true, stack, metaStack);\n        break;\n      case 'f':\n        i += 4; // 'alse'\n        pop(false, stack, metaStack);\n        break;\n      case '0':\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n      case '-':\n        parsedNum = '';\n        i--;\n        while (true) {\n          numChar = str[i++];\n          if (/[\\d\\.\\-e\\+]/.test(numChar)) {\n            parsedNum += numChar;\n          } else {\n            i--;\n            break;\n          }\n        }\n        pop(parseFloat(parsedNum), stack, metaStack);\n        break;\n      case '\"':\n        parsedString = '';\n        lastCh = void 0;\n        numConsecutiveSlashes = 0;\n        while (true) {\n          ch = str[i++];\n          if (ch !== '\"' || (lastCh === '\\\\' &&\n              numConsecutiveSlashes % 2 === 1)) {\n            parsedString += ch;\n            lastCh = ch;\n            if (lastCh === '\\\\') {\n              numConsecutiveSlashes++;\n            } else {\n              numConsecutiveSlashes = 0;\n            }\n          } else {\n            break;\n          }\n        }\n        pop(JSON.parse('\"' + parsedString + '\"'), stack, metaStack);\n        break;\n      case '[':\n        arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '{':\n        objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      default:\n        throw new Error(\n          'unexpectedly reached end of input: ' + collationIndex);\n    }\n  }\n};\n","import getArguments from 'argsarray';\nimport nextTick from 'immediate';\nimport { EventEmitter } from 'events';\nimport inherits from 'inherits';\nimport Md5 from 'spark-md5';\nimport uuidV4 from 'uuid';\nimport vuvuzela from 'vuvuzela';\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\nfunction mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new ExportedMap();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        nextTick(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar $inject_Object_assign = assign;\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nvar thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\n\nvar setImmediateShim = global.setImmediate || global.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return thisBtoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nfunction rev$$1(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\n// We fetch all leafs of the revision tree, and sort them based on tree length\n// and whether they were deleted, undeleted documents with the longest revision\n// tree (most edits) win\n// The final sort algorithm is slightly documented in a sidebar here:\n// http://guide.couchdb.org/draft/conflicts.html\nfunction winningRev(metadata) {\n  var winningId;\n  var winningPos;\n  var winningDeleted;\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var tree = node.ids;\n    var branches = tree[2];\n    var pos = node.pos;\n    if (branches.length) { // non-leaf\n      for (var i = 0, len = branches.length; i < len; i++) {\n        toVisit.push({pos: pos + 1, ids: branches[i]});\n      }\n      continue;\n    }\n    var deleted = !!tree[1].deleted;\n    var id = tree[0];\n    // sort by deleted, then pos, then id\n    if (!winningId || (winningDeleted !== deleted ? winningDeleted :\n        winningPos !== pos ? winningPos < pos : winningId < id)) {\n      winningId = id;\n      winningPos = pos;\n      winningDeleted = deleted;\n    }\n  }\n\n  return winningPos + '-' + winningId;\n}\n\n// Pretty much all below can be combined into a higher order function to\n// traverse revisions\n// The return value from the callback will be passed as context to all\n// children of that node\nfunction traverseRevTree(revs, callback) {\n  var toVisit = revs.slice();\n\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var branches = tree[2];\n    var newCtx =\n      callback(branches.length === 0, pos, tree[0], node.ctx, tree[1]);\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], ctx: newCtx});\n    }\n  }\n}\n\nfunction sortByPos(a, b) {\n  return a.pos - b.pos;\n}\n\nfunction collectLeaves(revs) {\n  var leaves = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, acc, opts) {\n    if (isLeaf) {\n      leaves.push({rev: pos + \"-\" + id, pos: pos, opts: opts});\n    }\n  });\n  leaves.sort(sortByPos).reverse();\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    delete leaves[i].pos;\n  }\n  return leaves;\n}\n\n// returns revs of all conflicts that is leaves such that\n// 1. are not deleted and\n// 2. are different than winning revision\nfunction collectConflicts(metadata) {\n  var win = winningRev(metadata);\n  var leaves = collectLeaves(metadata.rev_tree);\n  var conflicts = [];\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    var leaf = leaves[i];\n    if (leaf.rev !== win && !leaf.opts.deleted) {\n      conflicts.push(leaf.rev);\n    }\n  }\n  return conflicts;\n}\n\n// compact a tree by marking its non-leafs as missing,\n// and return a list of revs to delete\nfunction compactTree(metadata) {\n  var revs = [];\n  traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                               revHash, ctx, opts) {\n    if (opts.status === 'available' && !isLeaf) {\n      revs.push(pos + '-' + revHash);\n      opts.status = 'missing';\n    }\n  });\n  return revs;\n}\n\n// build up a list of all the paths to the leafs in this revision tree\nfunction rootToLeaf(revs) {\n  var paths = [];\n  var toVisit = revs.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, opts: opts});\n    if (isLeaf) {\n      paths.push({pos: (pos + 1 - history.length), ids: history});\n    }\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], history: history});\n    }\n  }\n  return paths.reverse();\n}\n\n// for a better overview of what this is doing, read:\n\nfunction sortByPos$1(a, b) {\n  return a.pos - b.pos;\n}\n\n// classic binary search\nfunction binarySearch(arr, item, comparator) {\n  var low = 0;\n  var high = arr.length;\n  var mid;\n  while (low < high) {\n    mid = (low + high) >>> 1;\n    if (comparator(arr[mid], item) < 0) {\n      low = mid + 1;\n    } else {\n      high = mid;\n    }\n  }\n  return low;\n}\n\n// assuming the arr is sorted, insert the item in the proper place\nfunction insertSorted(arr, item, comparator) {\n  var idx = binarySearch(arr, item, comparator);\n  arr.splice(idx, 0, item);\n}\n\n// Turn a path as a flat array into a tree with a single branch.\n// If any should be stemmed from the beginning of the array, that's passed\n// in as the second argument\nfunction pathToTree(path, numStemmed) {\n  var root;\n  var leaf;\n  for (var i = numStemmed, len = path.length; i < len; i++) {\n    var node = path[i];\n    var currentLeaf = [node.id, node.opts, []];\n    if (leaf) {\n      leaf[2].push(currentLeaf);\n      leaf = currentLeaf;\n    } else {\n      root = leaf = currentLeaf;\n    }\n  }\n  return root;\n}\n\n// compare the IDs of two trees\nfunction compareTree(a, b) {\n  return a[0] < b[0] ? -1 : 1;\n}\n\n// Merge two trees together\n// The roots of tree1 and tree2 must be the same revision\nfunction mergeTree(in_tree1, in_tree2) {\n  var queue = [{tree1: in_tree1, tree2: in_tree2}];\n  var conflicts = false;\n  while (queue.length > 0) {\n    var item = queue.pop();\n    var tree1 = item.tree1;\n    var tree2 = item.tree2;\n\n    if (tree1[1].status || tree2[1].status) {\n      tree1[1].status =\n        (tree1[1].status ===  'available' ||\n        tree2[1].status === 'available') ? 'available' : 'missing';\n    }\n\n    for (var i = 0; i < tree2[2].length; i++) {\n      if (!tree1[2][0]) {\n        conflicts = 'new_leaf';\n        tree1[2][0] = tree2[2][i];\n        continue;\n      }\n\n      var merged = false;\n      for (var j = 0; j < tree1[2].length; j++) {\n        if (tree1[2][j][0] === tree2[2][i][0]) {\n          queue.push({tree1: tree1[2][j], tree2: tree2[2][i]});\n          merged = true;\n        }\n      }\n      if (!merged) {\n        conflicts = 'new_branch';\n        insertSorted(tree1[2], tree2[2][i], compareTree);\n      }\n    }\n  }\n  return {conflicts: conflicts, tree: in_tree1};\n}\n\nfunction doMerge(tree, path, dontExpand) {\n  var restree = [];\n  var conflicts = false;\n  var merged = false;\n  var res;\n\n  if (!tree.length) {\n    return {tree: [path], conflicts: 'new_leaf'};\n  }\n\n  for (var i = 0, len = tree.length; i < len; i++) {\n    var branch = tree[i];\n    if (branch.pos === path.pos && branch.ids[0] === path.ids[0]) {\n      // Paths start at the same position and have the same root, so they need\n      // merged\n      res = mergeTree(branch.ids, path.ids);\n      restree.push({pos: branch.pos, ids: res.tree});\n      conflicts = conflicts || res.conflicts;\n      merged = true;\n    } else if (dontExpand !== true) {\n      // The paths start at a different position, take the earliest path and\n      // traverse up until it as at the same point from root as the path we\n      // want to merge.  If the keys match we return the longer path with the\n      // other merged After stemming we dont want to expand the trees\n\n      var t1 = branch.pos < path.pos ? branch : path;\n      var t2 = branch.pos < path.pos ? path : branch;\n      var diff = t2.pos - t1.pos;\n\n      var candidateParents = [];\n\n      var trees = [];\n      trees.push({ids: t1.ids, diff: diff, parent: null, parentIdx: null});\n      while (trees.length > 0) {\n        var item = trees.pop();\n        if (item.diff === 0) {\n          if (item.ids[0] === t2.ids[0]) {\n            candidateParents.push(item);\n          }\n          continue;\n        }\n        var elements = item.ids[2];\n        for (var j = 0, elementsLen = elements.length; j < elementsLen; j++) {\n          trees.push({\n            ids: elements[j],\n            diff: item.diff - 1,\n            parent: item.ids,\n            parentIdx: j\n          });\n        }\n      }\n\n      var el = candidateParents[0];\n\n      if (!el) {\n        restree.push(branch);\n      } else {\n        res = mergeTree(el.ids, t2.ids);\n        el.parent[2][el.parentIdx] = res.tree;\n        restree.push({pos: t1.pos, ids: t1.ids});\n        conflicts = conflicts || res.conflicts;\n        merged = true;\n      }\n    } else {\n      restree.push(branch);\n    }\n  }\n\n  // We didnt find\n  if (!merged) {\n    restree.push(path);\n  }\n\n  restree.sort(sortByPos$1);\n\n  return {\n    tree: restree,\n    conflicts: conflicts || 'internal_node'\n  };\n}\n\n// To ensure we dont grow the revision tree infinitely, we stem old revisions\nfunction stem(tree, depth) {\n  // First we break out the tree into a complete list of root to leaf paths\n  var paths = rootToLeaf(tree);\n  var stemmedRevs;\n\n  var result;\n  for (var i = 0, len = paths.length; i < len; i++) {\n    // Then for each path, we cut off the start of the path based on the\n    // `depth` to stem to, and generate a new set of flat trees\n    var path = paths[i];\n    var stemmed = path.ids;\n    var node;\n    if (stemmed.length > depth) {\n      // only do the stemming work if we actually need to stem\n      if (!stemmedRevs) {\n        stemmedRevs = {}; // avoid allocating this object unnecessarily\n      }\n      var numStemmed = stemmed.length - depth;\n      node = {\n        pos: path.pos + numStemmed,\n        ids: pathToTree(stemmed, numStemmed)\n      };\n\n      for (var s = 0; s < numStemmed; s++) {\n        var rev = (path.pos + s) + '-' + stemmed[s].id;\n        stemmedRevs[rev] = true;\n      }\n    } else { // no need to actually stem\n      node = {\n        pos: path.pos,\n        ids: pathToTree(stemmed, 0)\n      };\n    }\n\n    // Then we remerge all those flat trees together, ensuring that we dont\n    // connect trees that would go beyond the depth limit\n    if (result) {\n      result = doMerge(result, node, true).tree;\n    } else {\n      result = [node];\n    }\n  }\n\n  // this is memory-heavy per Chrome profiler, avoid unless we actually stemmed\n  if (stemmedRevs) {\n    traverseRevTree(result, function (isLeaf, pos, revHash) {\n      // some revisions may have been removed in a branch but not in another\n      delete stemmedRevs[pos + '-' + revHash];\n    });\n  }\n\n  return {\n    tree: result,\n    revs: stemmedRevs ? Object.keys(stemmedRevs) : []\n  };\n}\n\nfunction merge(tree, path, depth) {\n  var newTree = doMerge(tree, path);\n  var stemmed = stem(newTree.tree, depth);\n  return {\n    tree: stemmed.tree,\n    stemmedRevs: stemmed.revs,\n    conflicts: newTree.conflicts\n  };\n}\n\n// return true if a rev exists in the rev tree, false otherwise\nfunction revExists(revs, rev) {\n  var toVisit = revs.slice();\n  var splitRev = rev.split('-');\n  var targetPos = parseInt(splitRev[0], 10);\n  var targetId = splitRev[1];\n\n  var node;\n  while ((node = toVisit.pop())) {\n    if (node.pos === targetPos && node.ids[0] === targetId) {\n      return true;\n    }\n    var branches = node.ids[2];\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: node.pos + 1, ids: branches[i]});\n    }\n  }\n  return false;\n}\n\nfunction getTrees(node) {\n  return node.ids;\n}\n\n// check if a specific revision of a doc has been deleted\n//  - metadata: the metadata object from the doc store\n//  - rev: (optional) the revision to check. defaults to winning revision\nfunction isDeleted(metadata, rev) {\n  if (!rev) {\n    rev = winningRev(metadata);\n  }\n  var id = rev.substring(rev.indexOf('-') + 1);\n  var toVisit = metadata.rev_tree.map(getTrees);\n\n  var tree;\n  while ((tree = toVisit.pop())) {\n    if (tree[0] === id) {\n      return !!tree[1].deleted;\n    }\n    toVisit = toVisit.concat(tree[2]);\n  }\n}\n\nfunction isLocalId(id) {\n  return (/^_local/).test(id);\n}\n\n// returns the current leaf node for a given revision\nfunction latest(rev, metadata) {\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, pos: pos, opts: opts});\n\n    if (isLeaf) {\n      for (var i = 0, len = history.length; i < len; i++) {\n        var historyNode = history[i];\n        var historyRev = historyNode.pos + '-' + historyNode.id;\n\n        if (historyRev === rev) {\n          // return the rev of this leaf\n          return pos + '-' + id;\n        }\n      }\n    }\n\n    for (var j = 0, l = branches.length; j < l; j++) {\n      toVisit.push({pos: pos + 1, ids: branches[j], history: history});\n    }\n  }\n\n  /* istanbul ignore next */\n  throw new Error('Unable to resolve latest revision for id ' + metadata.id + ', rev ' + rev);\n}\n\ninherits(Changes$1, EventEmitter);\n\nfunction tryCatchInChangeListener(self, change, pending, lastSeq) {\n  // isolate try/catches to avoid V8 deoptimizations\n  try {\n    self.emit('change', change, pending, lastSeq);\n  } catch (e) {\n    guardedConsole('error', 'Error in .on(\"change\", function):', e);\n  }\n}\n\nfunction Changes$1(db, opts, callback) {\n  EventEmitter.call(this);\n  var self = this;\n  this.db = db;\n  opts = opts ? clone(opts) : {};\n  var complete = opts.complete = once(function (err, resp) {\n    if (err) {\n      if (listenerCount(self, 'error') > 0) {\n        self.emit('error', err);\n      }\n    } else {\n      self.emit('complete', resp);\n    }\n    self.removeAllListeners();\n    db.removeListener('destroyed', onDestroy);\n  });\n  if (callback) {\n    self.on('complete', function (resp) {\n      callback(null, resp);\n    });\n    self.on('error', callback);\n  }\n  function onDestroy() {\n    self.cancel();\n  }\n  db.once('destroyed', onDestroy);\n\n  opts.onChange = function (change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (self.isCancelled) {\n      return;\n    }\n    tryCatchInChangeListener(self, change, pending, lastSeq);\n  };\n\n  var promise = new Promise(function (fulfill, reject) {\n    opts.complete = function (err, res) {\n      if (err) {\n        reject(err);\n      } else {\n        fulfill(res);\n      }\n    };\n  });\n  self.once('cancel', function () {\n    db.removeListener('destroyed', onDestroy);\n    opts.complete(null, {status: 'cancelled'});\n  });\n  this.then = promise.then.bind(promise);\n  this['catch'] = promise['catch'].bind(promise);\n  this.then(function (result) {\n    complete(null, result);\n  }, complete);\n\n\n\n  if (!db.taskqueue.isReady) {\n    db.taskqueue.addTask(function (failed) {\n      if (failed) {\n        opts.complete(failed);\n      } else if (self.isCancelled) {\n        self.emit('cancel');\n      } else {\n        self.validateChanges(opts);\n      }\n    });\n  } else {\n    self.validateChanges(opts);\n  }\n}\nChanges$1.prototype.cancel = function () {\n  this.isCancelled = true;\n  if (this.db.taskqueue.isReady) {\n    this.emit('cancel');\n  }\n};\nfunction processChange(doc, metadata, opts) {\n  var changeList = [{rev: doc._rev}];\n  if (opts.style === 'all_docs') {\n    changeList = collectLeaves(metadata.rev_tree)\n    .map(function (x) { return {rev: x.rev}; });\n  }\n  var change = {\n    id: metadata.id,\n    changes: changeList,\n    doc: doc\n  };\n\n  if (isDeleted(metadata, doc._rev)) {\n    change.deleted = true;\n  }\n  if (opts.conflicts) {\n    change.doc._conflicts = collectConflicts(metadata);\n    if (!change.doc._conflicts.length) {\n      delete change.doc._conflicts;\n    }\n  }\n  return change;\n}\n\nChanges$1.prototype.validateChanges = function (opts) {\n  var callback = opts.complete;\n  var self = this;\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.validate(opts, function (err) {\n      if (err) {\n        return callback(err);\n      }\n      self.doChanges(opts);\n    });\n  } else {\n    self.doChanges(opts);\n  }\n};\n\nChanges$1.prototype.doChanges = function (opts) {\n  var self = this;\n  var callback = opts.complete;\n\n  opts = clone(opts);\n  if ('live' in opts && !('continuous' in opts)) {\n    opts.continuous = opts.live;\n  }\n  opts.processChange = processChange;\n\n  if (opts.since === 'latest') {\n    opts.since = 'now';\n  }\n  if (!opts.since) {\n    opts.since = 0;\n  }\n  if (opts.since === 'now') {\n    this.db.info().then(function (info) {\n      /* istanbul ignore if */\n      if (self.isCancelled) {\n        callback(null, {status: 'cancelled'});\n        return;\n      }\n      opts.since = info.update_seq;\n      self.doChanges(opts);\n    }, callback);\n    return;\n  }\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.normalize(opts);\n    if (PouchDB._changesFilterPlugin.shouldFilter(this, opts)) {\n      return PouchDB._changesFilterPlugin.filter(this, opts);\n    }\n  } else {\n    ['doc_ids', 'filter', 'selector', 'view'].forEach(function (key) {\n      if (key in opts) {\n        guardedConsole('warn',\n          'The \"' + key + '\" option was passed in to changes/replicate, ' +\n          'but pouchdb-changes-filter plugin is not installed, so it ' +\n          'was ignored. Please install the plugin to enable filtering.'\n        );\n      }\n    });\n  }\n\n  if (!('descending' in opts)) {\n    opts.descending = false;\n  }\n\n  // 0 and 1 should return 1 document\n  opts.limit = opts.limit === 0 ? 1 : opts.limit;\n  opts.complete = callback;\n  var newPromise = this.db._changes(opts);\n  /* istanbul ignore else */\n  if (newPromise && typeof newPromise.cancel === 'function') {\n    var cancel = self.cancel;\n    self.cancel = getArguments(function (args) {\n      newPromise.cancel();\n      cancel.apply(this, args);\n    });\n  }\n};\n\n/*\n * A generic pouch adapter\n */\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Wrapper for functions that call the bulkdocs api with a single doc,\n// if the first result is an error, return an error\nfunction yankError(callback, docId) {\n  return function (err, results) {\n    if (err || (results[0] && results[0].error)) {\n      err = err || results[0];\n      err.docId = docId;\n      callback(err);\n    } else {\n      callback(null, results.length ? results[0]  : results);\n    }\n  };\n}\n\n// clean docs given to us by the user\nfunction cleanDocs(docs) {\n  for (var i = 0; i < docs.length; i++) {\n    var doc = docs[i];\n    if (doc._deleted) {\n      delete doc._attachments; // ignore atts for deleted docs\n    } else if (doc._attachments) {\n      // filter out extraneous keys from _attachments\n      var atts = Object.keys(doc._attachments);\n      for (var j = 0; j < atts.length; j++) {\n        var att = atts[j];\n        doc._attachments[att] = pick(doc._attachments[att],\n          ['data', 'digest', 'content_type', 'length', 'revpos', 'stub']);\n      }\n    }\n  }\n}\n\n// compare two docs, first by _id then by _rev\nfunction compareByIdThenRev(a, b) {\n  var idCompare = compare(a._id, b._id);\n  if (idCompare !== 0) {\n    return idCompare;\n  }\n  var aStart = a._revisions ? a._revisions.start : 0;\n  var bStart = b._revisions ? b._revisions.start : 0;\n  return compare(aStart, bStart);\n}\n\n// for every node in a revision tree computes its distance from the closest\n// leaf\nfunction computeHeight(revs) {\n  var height = {};\n  var edges = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, prnt) {\n    var rev = pos + \"-\" + id;\n    if (isLeaf) {\n      height[rev] = 0;\n    }\n    if (prnt !== undefined) {\n      edges.push({from: prnt, to: rev});\n    }\n    return rev;\n  });\n\n  edges.reverse();\n  edges.forEach(function (edge) {\n    if (height[edge.from] === undefined) {\n      height[edge.from] = 1 + height[edge.to];\n    } else {\n      height[edge.from] = Math.min(height[edge.from], 1 + height[edge.to]);\n    }\n  });\n  return height;\n}\n\nfunction allDocsKeysParse(opts) {\n  var keys =  ('limit' in opts) ?\n    opts.keys.slice(opts.skip, opts.limit + opts.skip) :\n    (opts.skip > 0) ? opts.keys.slice(opts.skip) : opts.keys;\n  opts.keys = keys;\n  opts.skip = 0;\n  delete opts.limit;\n  if (opts.descending) {\n    keys.reverse();\n    opts.descending = false;\n  }\n}\n\n// all compaction is done in a queue, to avoid attaching\n// too many listeners at once\nfunction doNextCompaction(self) {\n  var task = self._compactionQueue[0];\n  var opts = task.opts;\n  var callback = task.callback;\n  self.get('_local/compaction').catch(function () {\n    return false;\n  }).then(function (doc) {\n    if (doc && doc.last_seq) {\n      opts.last_seq = doc.last_seq;\n    }\n    self._compact(opts, function (err, res) {\n      /* istanbul ignore if */\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, res);\n      }\n      nextTick(function () {\n        self._compactionQueue.shift();\n        if (self._compactionQueue.length) {\n          doNextCompaction(self);\n        }\n      });\n    });\n  });\n}\n\nfunction attachmentNameError(name) {\n  if (name.charAt(0) === '_') {\n    return name + ' is not a valid attachment name, attachment ' +\n      'names cannot start with \\'_\\'';\n  }\n  return false;\n}\n\ninherits(AbstractPouchDB, EventEmitter);\n\nfunction AbstractPouchDB() {\n  EventEmitter.call(this);\n\n  // re-bind prototyped methods\n  for (var p in AbstractPouchDB.prototype) {\n    if (typeof this[p] === 'function') {\n      this[p] = this[p].bind(this);\n    }\n  }\n}\n\nAbstractPouchDB.prototype.post =\n  adapterFun('post', function (doc, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return callback(createError(NOT_AN_OBJECT));\n  }\n  this.bulkDocs({docs: [doc]}, opts, yankError(callback, doc._id));\n});\n\nAbstractPouchDB.prototype.put = adapterFun('put', function (doc, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return cb(createError(NOT_AN_OBJECT));\n  }\n  invalidIdError(doc._id);\n  if (isLocalId(doc._id) && typeof this._putLocal === 'function') {\n    if (doc._deleted) {\n      return this._removeLocal(doc, cb);\n    } else {\n      return this._putLocal(doc, cb);\n    }\n  }\n  var self = this;\n  if (opts.force && doc._rev) {\n    transformForceOptionToNewEditsOption();\n    putDoc(function (err) {\n      var result = err ? null : {ok: true, id: doc._id, rev: doc._rev};\n      cb(err, result);\n    });\n  } else {\n    putDoc(cb);\n  }\n\n  function transformForceOptionToNewEditsOption() {\n    var parts = doc._rev.split('-');\n    var oldRevId = parts[1];\n    var oldRevNum = parseInt(parts[0], 10);\n\n    var newRevNum = oldRevNum + 1;\n    var newRevId = rev$$1();\n\n    doc._revisions = {\n      start: newRevNum,\n      ids: [newRevId, oldRevId]\n    };\n    doc._rev = newRevNum + '-' + newRevId;\n    opts.new_edits = false;\n  }\n  function putDoc(next) {\n    if (typeof self._put === 'function' && opts.new_edits !== false) {\n      self._put(doc, opts, next);\n    } else {\n      self.bulkDocs({docs: [doc]}, opts, yankError(next, doc._id));\n    }\n  }\n});\n\nAbstractPouchDB.prototype.putAttachment =\n  adapterFun('putAttachment', function (docId, attachmentId, rev,\n                                              blob, type) {\n  var api = this;\n  if (typeof type === 'function') {\n    type = blob;\n    blob = rev;\n    rev = null;\n  }\n  // Lets fix in https://github.com/pouchdb/pouchdb/issues/3267\n  /* istanbul ignore if */\n  if (typeof type === 'undefined') {\n    type = blob;\n    blob = rev;\n    rev = null;\n  }\n  if (!type) {\n    guardedConsole('warn', 'Attachment', attachmentId, 'on document', docId, 'is missing content_type');\n  }\n\n  function createAttachment(doc) {\n    var prevrevpos = '_rev' in doc ? parseInt(doc._rev, 10) : 0;\n    doc._attachments = doc._attachments || {};\n    doc._attachments[attachmentId] = {\n      content_type: type,\n      data: blob,\n      revpos: ++prevrevpos\n    };\n    return api.put(doc);\n  }\n\n  return api.get(docId).then(function (doc) {\n    if (doc._rev !== rev) {\n      throw createError(REV_CONFLICT);\n    }\n\n    return createAttachment(doc);\n  }, function (err) {\n     // create new doc\n    /* istanbul ignore else */\n    if (err.reason === MISSING_DOC.message) {\n      return createAttachment({_id: docId});\n    } else {\n      throw err;\n    }\n  });\n});\n\nAbstractPouchDB.prototype.removeAttachment =\n  adapterFun('removeAttachment', function (docId, attachmentId, rev,\n                                                 callback) {\n  var self = this;\n  self.get(docId, function (err, obj) {\n    /* istanbul ignore if */\n    if (err) {\n      callback(err);\n      return;\n    }\n    if (obj._rev !== rev) {\n      callback(createError(REV_CONFLICT));\n      return;\n    }\n    /* istanbul ignore if */\n    if (!obj._attachments) {\n      return callback();\n    }\n    delete obj._attachments[attachmentId];\n    if (Object.keys(obj._attachments).length === 0) {\n      delete obj._attachments;\n    }\n    self.put(obj, callback);\n  });\n});\n\nAbstractPouchDB.prototype.remove =\n  adapterFun('remove', function (docOrId, optsOrRev, opts, callback) {\n  var doc;\n  if (typeof optsOrRev === 'string') {\n    // id, rev, opts, callback style\n    doc = {\n      _id: docOrId,\n      _rev: optsOrRev\n    };\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n  } else {\n    // doc, opts, callback style\n    doc = docOrId;\n    if (typeof optsOrRev === 'function') {\n      callback = optsOrRev;\n      opts = {};\n    } else {\n      callback = opts;\n      opts = optsOrRev;\n    }\n  }\n  opts = opts || {};\n  opts.was_delete = true;\n  var newDoc = {_id: doc._id, _rev: (doc._rev || opts.rev)};\n  newDoc._deleted = true;\n  if (isLocalId(newDoc._id) && typeof this._removeLocal === 'function') {\n    return this._removeLocal(doc, callback);\n  }\n  this.bulkDocs({docs: [newDoc]}, opts, yankError(callback, newDoc._id));\n});\n\nAbstractPouchDB.prototype.revsDiff =\n  adapterFun('revsDiff', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  var ids = Object.keys(req);\n\n  if (!ids.length) {\n    return callback(null, {});\n  }\n\n  var count = 0;\n  var missing = new ExportedMap();\n\n  function addToMissing(id, revId) {\n    if (!missing.has(id)) {\n      missing.set(id, {missing: []});\n    }\n    missing.get(id).missing.push(revId);\n  }\n\n  function processDoc(id, rev_tree) {\n    // Is this fast enough? Maybe we should switch to a set simulated by a map\n    var missingForId = req[id].slice(0);\n    traverseRevTree(rev_tree, function (isLeaf, pos, revHash, ctx,\n      opts) {\n        var rev = pos + '-' + revHash;\n        var idx = missingForId.indexOf(rev);\n        if (idx === -1) {\n          return;\n        }\n\n        missingForId.splice(idx, 1);\n        /* istanbul ignore if */\n        if (opts.status !== 'available') {\n          addToMissing(id, rev);\n        }\n      });\n\n    // Traversing the tree is synchronous, so now `missingForId` contains\n    // revisions that were not found in the tree\n    missingForId.forEach(function (rev) {\n      addToMissing(id, rev);\n    });\n  }\n\n  ids.map(function (id) {\n    this._getRevisionTree(id, function (err, rev_tree) {\n      if (err && err.status === 404 && err.message === 'missing') {\n        missing.set(id, {missing: req[id]});\n      } else if (err) {\n        /* istanbul ignore next */\n        return callback(err);\n      } else {\n        processDoc(id, rev_tree);\n      }\n\n      if (++count === ids.length) {\n        // convert LazyMap to object\n        var missingObj = {};\n        missing.forEach(function (value, key) {\n          missingObj[key] = value;\n        });\n        return callback(null, missingObj);\n      }\n    });\n  }, this);\n});\n\n// _bulk_get API for faster replication, as described in\n// https://github.com/apache/couchdb-chttpd/pull/33\n// At the \"abstract\" level, it will just run multiple get()s in\n// parallel, because this isn't much of a performance cost\n// for local databases (except the cost of multiple transactions, which is\n// small). The http adapter overrides this in order\n// to do a more efficient single HTTP request.\nAbstractPouchDB.prototype.bulkGet =\n  adapterFun('bulkGet', function (opts, callback) {\n  bulkGet(this, opts, callback);\n});\n\n// compact one document and fire callback\n// by compacting we mean removing all revisions which\n// are further from the leaf in revision tree than max_height\nAbstractPouchDB.prototype.compactDocument =\n  adapterFun('compactDocument', function (docId, maxHeight, callback) {\n  var self = this;\n  this._getRevisionTree(docId, function (err, revTree) {\n    /* istanbul ignore if */\n    if (err) {\n      return callback(err);\n    }\n    var height = computeHeight(revTree);\n    var candidates = [];\n    var revs = [];\n    Object.keys(height).forEach(function (rev) {\n      if (height[rev] > maxHeight) {\n        candidates.push(rev);\n      }\n    });\n\n    traverseRevTree(revTree, function (isLeaf, pos, revHash, ctx, opts) {\n      var rev = pos + '-' + revHash;\n      if (opts.status === 'available' && candidates.indexOf(rev) !== -1) {\n        revs.push(rev);\n      }\n    });\n    self._doCompaction(docId, revs, callback);\n  });\n});\n\n// compact the whole database using single document\n// compaction\nAbstractPouchDB.prototype.compact =\n  adapterFun('compact', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  self._compactionQueue = self._compactionQueue || [];\n  self._compactionQueue.push({opts: opts, callback: callback});\n  if (self._compactionQueue.length === 1) {\n    doNextCompaction(self);\n  }\n});\nAbstractPouchDB.prototype._compact = function (opts, callback) {\n  var self = this;\n  var changesOpts = {\n    return_docs: false,\n    last_seq: opts.last_seq || 0\n  };\n  var promises = [];\n\n  function onChange(row) {\n    promises.push(self.compactDocument(row.id, 0));\n  }\n  function onComplete(resp) {\n    var lastSeq = resp.last_seq;\n    Promise.all(promises).then(function () {\n      return upsert(self, '_local/compaction', function deltaFunc(doc) {\n        if (!doc.last_seq || doc.last_seq < lastSeq) {\n          doc.last_seq = lastSeq;\n          return doc;\n        }\n        return false; // somebody else got here first, don't update\n      });\n    }).then(function () {\n      callback(null, {ok: true});\n    }).catch(callback);\n  }\n  self.changes(changesOpts)\n    .on('change', onChange)\n    .on('complete', onComplete)\n    .on('error', callback);\n};\n\n/* Begin api wrappers. Specific functionality to storage belongs in the\n   _[method] */\nAbstractPouchDB.prototype.get = adapterFun('get', function (id, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof id !== 'string') {\n    return cb(createError(INVALID_ID));\n  }\n  if (isLocalId(id) && typeof this._getLocal === 'function') {\n    return this._getLocal(id, cb);\n  }\n  var leaves = [], self = this;\n\n  function finishOpenRevs() {\n    var result = [];\n    var count = leaves.length;\n    /* istanbul ignore if */\n    if (!count) {\n      return cb(null, result);\n    }\n\n    // order with open_revs is unspecified\n    leaves.forEach(function (leaf) {\n      self.get(id, {\n        rev: leaf,\n        revs: opts.revs,\n        latest: opts.latest,\n        attachments: opts.attachments,\n        binary: opts.binary\n      }, function (err, doc) {\n        if (!err) {\n          // using latest=true can produce duplicates\n          var existing;\n          for (var i = 0, l = result.length; i < l; i++) {\n            if (result[i].ok && result[i].ok._rev === doc._rev) {\n              existing = true;\n              break;\n            }\n          }\n          if (!existing) {\n            result.push({ok: doc});\n          }\n        } else {\n          result.push({missing: leaf});\n        }\n        count--;\n        if (!count) {\n          cb(null, result);\n        }\n      });\n    });\n  }\n\n  if (opts.open_revs) {\n    if (opts.open_revs === \"all\") {\n      this._getRevisionTree(id, function (err, rev_tree) {\n        /* istanbul ignore if */\n        if (err) {\n          return cb(err);\n        }\n        leaves = collectLeaves(rev_tree).map(function (leaf) {\n          return leaf.rev;\n        });\n        finishOpenRevs();\n      });\n    } else {\n      if (Array.isArray(opts.open_revs)) {\n        leaves = opts.open_revs;\n        for (var i = 0; i < leaves.length; i++) {\n          var l = leaves[i];\n          // looks like it's the only thing couchdb checks\n          if (!(typeof (l) === \"string\" && /^\\d+-/.test(l))) {\n            return cb(createError(INVALID_REV));\n          }\n        }\n        finishOpenRevs();\n      } else {\n        return cb(createError(UNKNOWN_ERROR, 'function_clause'));\n      }\n    }\n    return; // open_revs does not like other options\n  }\n\n  return this._get(id, opts, function (err, result) {\n    if (err) {\n      err.docId = id;\n      return cb(err);\n    }\n\n    var doc = result.doc;\n    var metadata = result.metadata;\n    var ctx = result.ctx;\n\n    if (opts.conflicts) {\n      var conflicts = collectConflicts(metadata);\n      if (conflicts.length) {\n        doc._conflicts = conflicts;\n      }\n    }\n\n    if (isDeleted(metadata, doc._rev)) {\n      doc._deleted = true;\n    }\n\n    if (opts.revs || opts.revs_info) {\n      var splittedRev = doc._rev.split('-');\n      var revNo       = parseInt(splittedRev[0], 10);\n      var revHash     = splittedRev[1];\n\n      var paths = rootToLeaf(metadata.rev_tree);\n      var path = null;\n\n      for (var i = 0; i < paths.length; i++) {\n        var currentPath = paths[i];\n        var hashIndex = currentPath.ids.map(function (x) { return x.id; })\n          .indexOf(revHash);\n        var hashFoundAtRevPos = hashIndex === (revNo - 1);\n\n        if (hashFoundAtRevPos || (!path && hashIndex !== -1)) {\n          path = currentPath;\n        }\n      }\n\n      var indexOfRev = path.ids.map(function (x) { return x.id; })\n        .indexOf(doc._rev.split('-')[1]) + 1;\n      var howMany = path.ids.length - indexOfRev;\n      path.ids.splice(indexOfRev, howMany);\n      path.ids.reverse();\n\n      if (opts.revs) {\n        doc._revisions = {\n          start: (path.pos + path.ids.length) - 1,\n          ids: path.ids.map(function (rev) {\n            return rev.id;\n          })\n        };\n      }\n      if (opts.revs_info) {\n        var pos =  path.pos + path.ids.length;\n        doc._revs_info = path.ids.map(function (rev) {\n          pos--;\n          return {\n            rev: pos + '-' + rev.id,\n            status: rev.opts.status\n          };\n        });\n      }\n    }\n\n    if (opts.attachments && doc._attachments) {\n      var attachments = doc._attachments;\n      var count = Object.keys(attachments).length;\n      if (count === 0) {\n        return cb(null, doc);\n      }\n      Object.keys(attachments).forEach(function (key) {\n        this._getAttachment(doc._id, key, attachments[key], {\n          // Previously the revision handling was done in adapter.js\n          // getAttachment, however since idb-next doesnt we need to\n          // pass the rev through\n          rev: doc._rev,\n          binary: opts.binary,\n          ctx: ctx\n        }, function (err, data) {\n          var att = doc._attachments[key];\n          att.data = data;\n          delete att.stub;\n          delete att.length;\n          if (!--count) {\n            cb(null, doc);\n          }\n        });\n      }, self);\n    } else {\n      if (doc._attachments) {\n        for (var key in doc._attachments) {\n          /* istanbul ignore else */\n          if (doc._attachments.hasOwnProperty(key)) {\n            doc._attachments[key].stub = true;\n          }\n        }\n      }\n      cb(null, doc);\n    }\n  });\n});\n\n// TODO: I dont like this, it forces an extra read for every\n// attachment read and enforces a confusing api between\n// adapter.js and the adapter implementation\nAbstractPouchDB.prototype.getAttachment =\n  adapterFun('getAttachment', function (docId, attachmentId, opts, callback) {\n  var self = this;\n  if (opts instanceof Function) {\n    callback = opts;\n    opts = {};\n  }\n  this._get(docId, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (res.doc._attachments && res.doc._attachments[attachmentId]) {\n      opts.ctx = res.ctx;\n      opts.binary = true;\n      self._getAttachment(docId, attachmentId,\n                          res.doc._attachments[attachmentId], opts, callback);\n    } else {\n      return callback(createError(MISSING_DOC));\n    }\n  });\n});\n\nAbstractPouchDB.prototype.allDocs =\n  adapterFun('allDocs', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  opts.skip = typeof opts.skip !== 'undefined' ? opts.skip : 0;\n  if (opts.start_key) {\n    opts.startkey = opts.start_key;\n  }\n  if (opts.end_key) {\n    opts.endkey = opts.end_key;\n  }\n  if ('keys' in opts) {\n    if (!Array.isArray(opts.keys)) {\n      return callback(new TypeError('options.keys must be an array'));\n    }\n    var incompatibleOpt =\n      ['startkey', 'endkey', 'key'].filter(function (incompatibleOpt) {\n      return incompatibleOpt in opts;\n    })[0];\n    if (incompatibleOpt) {\n      callback(createError(QUERY_PARSE_ERROR,\n        'Query parameter `' + incompatibleOpt +\n        '` is not compatible with multi-get'\n      ));\n      return;\n    }\n    if (!isRemote(this)) {\n      allDocsKeysParse(opts);\n      if (opts.keys.length === 0) {\n        return this._allDocs({limit: 0}, callback);\n      }\n    }\n  }\n\n  return this._allDocs(opts, callback);\n});\n\nAbstractPouchDB.prototype.changes = function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  // By default set return_docs to false if the caller has opts.live = true,\n  // this will prevent us from collecting the set of changes indefinitely\n  // resulting in growing memory\n  opts.return_docs = ('return_docs' in opts) ? opts.return_docs : !opts.live;\n\n  return new Changes$1(this, opts, callback);\n};\n\nAbstractPouchDB.prototype.close = adapterFun('close', function (callback) {\n  this._closed = true;\n  this.emit('closed');\n  return this._close(callback);\n});\n\nAbstractPouchDB.prototype.info = adapterFun('info', function (callback) {\n  var self = this;\n  this._info(function (err, info) {\n    if (err) {\n      return callback(err);\n    }\n    // assume we know better than the adapter, unless it informs us\n    info.db_name = info.db_name || self.name;\n    info.auto_compaction = !!(self.auto_compaction && !isRemote(self));\n    info.adapter = self.adapter;\n    callback(null, info);\n  });\n});\n\nAbstractPouchDB.prototype.id = adapterFun('id', function (callback) {\n  return this._id(callback);\n});\n\n/* istanbul ignore next */\nAbstractPouchDB.prototype.type = function () {\n  return (typeof this._type === 'function') ? this._type() : this.adapter;\n};\n\nAbstractPouchDB.prototype.bulkDocs =\n  adapterFun('bulkDocs', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  if (Array.isArray(req)) {\n    req = {\n      docs: req\n    };\n  }\n\n  if (!req || !req.docs || !Array.isArray(req.docs)) {\n    return callback(createError(MISSING_BULK_DOCS));\n  }\n\n  for (var i = 0; i < req.docs.length; ++i) {\n    if (typeof req.docs[i] !== 'object' || Array.isArray(req.docs[i])) {\n      return callback(createError(NOT_AN_OBJECT));\n    }\n  }\n\n  var attachmentError;\n  req.docs.forEach(function (doc) {\n    if (doc._attachments) {\n      Object.keys(doc._attachments).forEach(function (name) {\n        attachmentError = attachmentError || attachmentNameError(name);\n        if (!doc._attachments[name].content_type) {\n          guardedConsole('warn', 'Attachment', name, 'on document', doc._id, 'is missing content_type');\n        }\n      });\n    }\n  });\n\n  if (attachmentError) {\n    return callback(createError(BAD_REQUEST, attachmentError));\n  }\n\n  if (!('new_edits' in opts)) {\n    if ('new_edits' in req) {\n      opts.new_edits = req.new_edits;\n    } else {\n      opts.new_edits = true;\n    }\n  }\n\n  var adapter = this;\n  if (!opts.new_edits && !isRemote(adapter)) {\n    // ensure revisions of the same doc are sorted, so that\n    // the local adapter processes them correctly (#2935)\n    req.docs.sort(compareByIdThenRev);\n  }\n\n  cleanDocs(req.docs);\n\n  // in the case of conflicts, we want to return the _ids to the user\n  // however, the underlying adapter may destroy the docs array, so\n  // create a copy here\n  var ids = req.docs.map(function (doc) {\n    return doc._id;\n  });\n\n  return this._bulkDocs(req, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (!opts.new_edits) {\n      // this is what couch does when new_edits is false\n      res = res.filter(function (x) {\n        return x.error;\n      });\n    }\n    // add ids for error/conflict responses (not required for CouchDB)\n    if (!isRemote(adapter)) {\n      for (var i = 0, l = res.length; i < l; i++) {\n        res[i].id = res[i].id || ids[i];\n      }\n    }\n\n    callback(null, res);\n  });\n});\n\nAbstractPouchDB.prototype.registerDependentDatabase =\n  adapterFun('registerDependentDatabase', function (dependentDb,\n                                                          callback) {\n  var depDB = new this.constructor(dependentDb, this.__opts);\n\n  function diffFun(doc) {\n    doc.dependentDbs = doc.dependentDbs || {};\n    if (doc.dependentDbs[dependentDb]) {\n      return false; // no update required\n    }\n    doc.dependentDbs[dependentDb] = true;\n    return doc;\n  }\n  upsert(this, '_local/_pouch_dependentDbs', diffFun)\n    .then(function () {\n      callback(null, {db: depDB});\n    }).catch(callback);\n});\n\nAbstractPouchDB.prototype.destroy =\n  adapterFun('destroy', function (opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  var usePrefix = 'use_prefix' in self ? self.use_prefix : true;\n\n  function destroyDb() {\n    // call destroy method of the particular adaptor\n    self._destroy(opts, function (err, resp) {\n      if (err) {\n        return callback(err);\n      }\n      self._destroyed = true;\n      self.emit('destroyed');\n      callback(null, resp || { 'ok': true });\n    });\n  }\n\n  if (isRemote(self)) {\n    // no need to check for dependent DBs if it's a remote DB\n    return destroyDb();\n  }\n\n  self.get('_local/_pouch_dependentDbs', function (err, localDoc) {\n    if (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        return callback(err);\n      } else { // no dependencies\n        return destroyDb();\n      }\n    }\n    var dependentDbs = localDoc.dependentDbs;\n    var PouchDB = self.constructor;\n    var deletedMap = Object.keys(dependentDbs).map(function (name) {\n      // use_prefix is only false in the browser\n      /* istanbul ignore next */\n      var trueName = usePrefix ?\n        name.replace(new RegExp('^' + PouchDB.prefix), '') : name;\n      return new PouchDB(trueName, self.__opts).destroy();\n    });\n    Promise.all(deletedMap).then(destroyDb, callback);\n  });\n});\n\nfunction TaskQueue() {\n  this.isReady = false;\n  this.failed = false;\n  this.queue = [];\n}\n\nTaskQueue.prototype.execute = function () {\n  var fun;\n  if (this.failed) {\n    while ((fun = this.queue.shift())) {\n      fun(this.failed);\n    }\n  } else {\n    while ((fun = this.queue.shift())) {\n      fun();\n    }\n  }\n};\n\nTaskQueue.prototype.fail = function (err) {\n  this.failed = err;\n  this.execute();\n};\n\nTaskQueue.prototype.ready = function (db) {\n  this.isReady = true;\n  this.db = db;\n  this.execute();\n};\n\nTaskQueue.prototype.addTask = function (fun) {\n  this.queue.push(fun);\n  if (this.failed) {\n    this.execute();\n  }\n};\n\nfunction parseAdapter(name, opts) {\n  var match = name.match(/([a-z-]*):\\/\\/(.*)/);\n  if (match) {\n    // the http adapter expects the fully qualified name\n    return {\n      name: /https?/.test(match[1]) ? match[1] + '://' + match[2] : match[2],\n      adapter: match[1]\n    };\n  }\n\n  var adapters = PouchDB.adapters;\n  var preferredAdapters = PouchDB.preferredAdapters;\n  var prefix = PouchDB.prefix;\n  var adapterName = opts.adapter;\n\n  if (!adapterName) { // automatically determine adapter\n    for (var i = 0; i < preferredAdapters.length; ++i) {\n      adapterName = preferredAdapters[i];\n      // check for browsers that have been upgraded from websql-only to websql+idb\n      /* istanbul ignore if */\n      if (adapterName === 'idb' && 'websql' in adapters &&\n          hasLocalStorage() && localStorage['_pouch__websqldb_' + prefix + name]) {\n        // log it, because this can be confusing during development\n        guardedConsole('log', 'PouchDB is downgrading \"' + name + '\" to WebSQL to' +\n          ' avoid data loss, because it was already opened with WebSQL.');\n        continue; // keep using websql to avoid user data loss\n      }\n      break;\n    }\n  }\n\n  var adapter = adapters[adapterName];\n\n  // if adapter is invalid, then an error will be thrown later\n  var usePrefix = (adapter && 'use_prefix' in adapter) ?\n    adapter.use_prefix : true;\n\n  return {\n    name: usePrefix ? (prefix + name) : name,\n    adapter: adapterName\n  };\n}\n\n// OK, so here's the deal. Consider this code:\n//     var db1 = new PouchDB('foo');\n//     var db2 = new PouchDB('foo');\n//     db1.destroy();\n// ^ these two both need to emit 'destroyed' events,\n// as well as the PouchDB constructor itself.\n// So we have one db object (whichever one got destroy() called on it)\n// responsible for emitting the initial event, which then gets emitted\n// by the constructor, which then broadcasts it to any other dbs\n// that may have been created with the same name.\nfunction prepareForDestruction(self) {\n\n  function onDestroyed(from_constructor) {\n    self.removeListener('closed', onClosed);\n    if (!from_constructor) {\n      self.constructor.emit('destroyed', self.name);\n    }\n  }\n\n  function onClosed() {\n    self.removeListener('destroyed', onDestroyed);\n    self.constructor.emit('unref', self);\n  }\n\n  self.once('destroyed', onDestroyed);\n  self.once('closed', onClosed);\n  self.constructor.emit('ref', self);\n}\n\ninherits(PouchDB, AbstractPouchDB);\nfunction PouchDB(name, opts) {\n  // In Node our test suite only tests this for PouchAlt unfortunately\n  /* istanbul ignore if */\n  if (!(this instanceof PouchDB)) {\n    return new PouchDB(name, opts);\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  if (name && typeof name === 'object') {\n    opts = name;\n    name = opts.name;\n    delete opts.name;\n  }\n\n  if (opts.deterministic_revs === undefined) {\n    opts.deterministic_revs = true;\n  }\n\n  this.__opts = opts = clone(opts);\n\n  self.auto_compaction = opts.auto_compaction;\n  self.prefix = PouchDB.prefix;\n\n  if (typeof name !== 'string') {\n    throw new Error('Missing/invalid DB name');\n  }\n\n  var prefixedName = (opts.prefix || '') + name;\n  var backend = parseAdapter(prefixedName, opts);\n\n  opts.name = backend.name;\n  opts.adapter = opts.adapter || backend.adapter;\n\n  self.name = name;\n  self._adapter = opts.adapter;\n  PouchDB.emit('debug', ['adapter', 'Picked adapter: ', opts.adapter]);\n\n  if (!PouchDB.adapters[opts.adapter] ||\n      !PouchDB.adapters[opts.adapter].valid()) {\n    throw new Error('Invalid Adapter: ' + opts.adapter);\n  }\n\n  AbstractPouchDB.call(self);\n  self.taskqueue = new TaskQueue();\n\n  self.adapter = opts.adapter;\n\n  PouchDB.adapters[opts.adapter].call(self, opts, function (err) {\n    if (err) {\n      return self.taskqueue.fail(err);\n    }\n    prepareForDestruction(self);\n\n    self.emit('created', self);\n    PouchDB.emit('created', self.name);\n    self.taskqueue.ready(self);\n  });\n\n}\n\n// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f$1 = fetch;\nvar h = Headers;\n\nPouchDB.adapters = {};\nPouchDB.preferredAdapters = [];\n\nPouchDB.prefix = '_pouch_';\n\nvar eventEmitter = new EventEmitter();\n\nfunction setUpEventEmitter(Pouch) {\n  Object.keys(EventEmitter.prototype).forEach(function (key) {\n    if (typeof EventEmitter.prototype[key] === 'function') {\n      Pouch[key] = eventEmitter[key].bind(eventEmitter);\n    }\n  });\n\n  // these are created in constructor.js, and allow us to notify each DB with\n  // the same name that it was destroyed, via the constructor object\n  var destructListeners = Pouch._destructionListeners = new ExportedMap();\n\n  Pouch.on('ref', function onConstructorRef(db) {\n    if (!destructListeners.has(db.name)) {\n      destructListeners.set(db.name, []);\n    }\n    destructListeners.get(db.name).push(db);\n  });\n\n  Pouch.on('unref', function onConstructorUnref(db) {\n    if (!destructListeners.has(db.name)) {\n      return;\n    }\n    var dbList = destructListeners.get(db.name);\n    var pos = dbList.indexOf(db);\n    if (pos < 0) {\n      /* istanbul ignore next */\n      return;\n    }\n    dbList.splice(pos, 1);\n    if (dbList.length > 1) {\n      /* istanbul ignore next */\n      destructListeners.set(db.name, dbList);\n    } else {\n      destructListeners.delete(db.name);\n    }\n  });\n\n  Pouch.on('destroyed', function onConstructorDestroyed(name) {\n    if (!destructListeners.has(name)) {\n      return;\n    }\n    var dbList = destructListeners.get(name);\n    destructListeners.delete(name);\n    dbList.forEach(function (db) {\n      db.emit('destroyed',true);\n    });\n  });\n}\n\nsetUpEventEmitter(PouchDB);\n\nPouchDB.adapter = function (id, obj, addToPreferredAdapters) {\n  /* istanbul ignore else */\n  if (obj.valid()) {\n    PouchDB.adapters[id] = obj;\n    if (addToPreferredAdapters) {\n      PouchDB.preferredAdapters.push(id);\n    }\n  }\n};\n\nPouchDB.plugin = function (obj) {\n  if (typeof obj === 'function') { // function style for plugins\n    obj(PouchDB);\n  } else if (typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    throw new Error('Invalid plugin: got \"' + obj + '\", expected an object or a function');\n  } else {\n    Object.keys(obj).forEach(function (id) { // object style for plugins\n      PouchDB.prototype[id] = obj[id];\n    });\n  }\n  if (this.__defaults) {\n    PouchDB.__defaults = $inject_Object_assign({}, this.__defaults);\n  }\n  return PouchDB;\n};\n\nPouchDB.defaults = function (defaultOpts) {\n  function PouchAlt(name, opts) {\n    if (!(this instanceof PouchAlt)) {\n      return new PouchAlt(name, opts);\n    }\n\n    opts = opts || {};\n\n    if (name && typeof name === 'object') {\n      opts = name;\n      name = opts.name;\n      delete opts.name;\n    }\n\n    opts = $inject_Object_assign({}, PouchAlt.__defaults, opts);\n    PouchDB.call(this, name, opts);\n  }\n\n  inherits(PouchAlt, PouchDB);\n\n  PouchAlt.preferredAdapters = PouchDB.preferredAdapters.slice();\n  Object.keys(PouchDB).forEach(function (key) {\n    if (!(key in PouchAlt)) {\n      PouchAlt[key] = PouchDB[key];\n    }\n  });\n\n  // make default options transitive\n  // https://github.com/pouchdb/pouchdb/issues/5922\n  PouchAlt.__defaults = $inject_Object_assign({}, this.__defaults, defaultOpts);\n\n  return PouchAlt;\n};\n\nPouchDB.fetch = function (url, opts) {\n  return f$1(url, opts);\n};\n\n// managed automatically by set-version.js\nvar version = \"7.0.0\";\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction compare$1(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n  if ('$and' in result) {\n    result = mergeAndedSelectors(result['$and']);\n    wasAnded = true;\n  }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\nfunction pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare$1(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  return Object.keys(matcher).every(function (userOperator) {\n    var userValue = matcher[userOperator];\n    return match(userOperator, doc, userValue, parsedField, docFieldValue);\n  });\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nfunction evalFilter(input) {\n  return scopeEval('\"use strict\";\\nreturn ' + input + ';', {});\n}\n\nfunction evalView(input) {\n  var code = [\n    'return function(doc) {',\n    '  \"use strict\";',\n    '  var emitted = false;',\n    '  var emit = function (a, b) {',\n    '    emitted = true;',\n    '  };',\n    '  var view = ' + input + ';',\n    '  view(doc);',\n    '  if (emitted) {',\n    '    return true;',\n    '  }',\n    '};'\n  ].join('\\n');\n\n  return scopeEval(code, {});\n}\n\nfunction validate(opts, callback) {\n  if (opts.selector) {\n    if (opts.filter && opts.filter !== '_selector') {\n      var filterName = typeof opts.filter === 'string' ?\n        opts.filter : 'function';\n      return callback(new Error('selector invalid for filter \"' + filterName + '\"'));\n    }\n  }\n  callback();\n}\n\nfunction normalize(opts) {\n  if (opts.view && !opts.filter) {\n    opts.filter = '_view';\n  }\n\n  if (opts.selector && !opts.filter) {\n    opts.filter = '_selector';\n  }\n\n  if (opts.filter && typeof opts.filter === 'string') {\n    if (opts.filter === '_view') {\n      opts.view = normalizeDesignDocFunctionName(opts.view);\n    } else {\n      opts.filter = normalizeDesignDocFunctionName(opts.filter);\n    }\n  }\n}\n\nfunction shouldFilter(changesHandler, opts) {\n  return opts.filter && typeof opts.filter === 'string' &&\n    !opts.doc_ids && !isRemote(changesHandler.db);\n}\n\nfunction filter(changesHandler, opts) {\n  var callback = opts.complete;\n  if (opts.filter === '_view') {\n    if (!opts.view || typeof opts.view !== 'string') {\n      var err = createError(BAD_REQUEST,\n        '`view` filter parameter not found or invalid.');\n      return callback(err);\n    }\n    // fetch a view from a design doc, make it behave like a filter\n    var viewName = parseDesignDocFunctionName(opts.view);\n    changesHandler.db.get('_design/' + viewName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var mapFun = ddoc && ddoc.views && ddoc.views[viewName[1]] &&\n        ddoc.views[viewName[1]].map;\n      if (!mapFun) {\n        return callback(createError(MISSING_DOC,\n          (ddoc.views ? 'missing json key: ' + viewName[1] :\n            'missing json key: views')));\n      }\n      opts.filter = evalView(mapFun);\n      changesHandler.doChanges(opts);\n    });\n  } else if (opts.selector) {\n    opts.filter = function (doc) {\n      return matchesSelector(doc, opts.selector);\n    };\n    changesHandler.doChanges(opts);\n  } else {\n    // fetch a filter from a design doc\n    var filterName = parseDesignDocFunctionName(opts.filter);\n    changesHandler.db.get('_design/' + filterName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var filterFun = ddoc && ddoc.filters && ddoc.filters[filterName[1]];\n      if (!filterFun) {\n        return callback(createError(MISSING_DOC,\n          ((ddoc && ddoc.filters) ? 'missing json key: ' + filterName[1]\n            : 'missing json key: filters')));\n      }\n      opts.filter = evalFilter(filterFun);\n      changesHandler.doChanges(opts);\n    });\n  }\n}\n\nfunction applyChangesFilterPlugin(PouchDB) {\n  PouchDB._changesFilterPlugin = {\n    validate: validate,\n    normalize: normalize,\n    shouldFilter: shouldFilter,\n    filter: filter\n  };\n}\n\n// TODO: remove from pouchdb-core (breaking)\nPouchDB.plugin(applyChangesFilterPlugin);\n\nPouchDB.version = version;\n\nfunction toObject(array) {\n  return array.reduce(function (obj, item) {\n    obj[item] = true;\n    return obj;\n  }, {});\n}\n// List of top level reserved words for doc\nvar reservedWords = toObject([\n  '_id',\n  '_rev',\n  '_attachments',\n  '_deleted',\n  '_revisions',\n  '_revs_info',\n  '_conflicts',\n  '_deleted_conflicts',\n  '_local_seq',\n  '_rev_tree',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats',\n  // Specific to Couchbase Sync Gateway\n  '_removed'\n]);\n\n// List of reserved words that should end up the document\nvar dataWords = toObject([\n  '_attachments',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats'\n]);\n\nfunction parseRevisionInfo(rev) {\n  if (!/^\\d+-./.test(rev)) {\n    return createError(INVALID_REV);\n  }\n  var idx = rev.indexOf('-');\n  var left = rev.substring(0, idx);\n  var right = rev.substring(idx + 1);\n  return {\n    prefix: parseInt(left, 10),\n    id: right\n  };\n}\n\nfunction makeRevTreeFromRevisions(revisions, opts) {\n  var pos = revisions.start - revisions.ids.length + 1;\n\n  var revisionIds = revisions.ids;\n  var ids = [revisionIds[0], opts, []];\n\n  for (var i = 1, len = revisionIds.length; i < len; i++) {\n    ids = [revisionIds[i], {status: 'missing'}, [ids]];\n  }\n\n  return [{\n    pos: pos,\n    ids: ids\n  }];\n}\n\n// Preprocess documents, parse their revisions, assign an id and a\n// revision for new writes that are missing them, etc\nfunction parseDoc(doc, newEdits, dbOpts) {\n  if (!dbOpts) {\n    dbOpts = {\n      deterministic_revs: true\n    };\n  }\n\n  var nRevNum;\n  var newRevId;\n  var revInfo;\n  var opts = {status: 'available'};\n  if (doc._deleted) {\n    opts.deleted = true;\n  }\n\n  if (newEdits) {\n    if (!doc._id) {\n      doc._id = uuid();\n    }\n    newRevId = rev$$1(doc, dbOpts.deterministic_revs);\n    if (doc._rev) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      doc._rev_tree = [{\n        pos: revInfo.prefix,\n        ids: [revInfo.id, {status: 'missing'}, [[newRevId, opts, []]]]\n      }];\n      nRevNum = revInfo.prefix + 1;\n    } else {\n      doc._rev_tree = [{\n        pos: 1,\n        ids : [newRevId, opts, []]\n      }];\n      nRevNum = 1;\n    }\n  } else {\n    if (doc._revisions) {\n      doc._rev_tree = makeRevTreeFromRevisions(doc._revisions, opts);\n      nRevNum = doc._revisions.start;\n      newRevId = doc._revisions.ids[0];\n    }\n    if (!doc._rev_tree) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      nRevNum = revInfo.prefix;\n      newRevId = revInfo.id;\n      doc._rev_tree = [{\n        pos: nRevNum,\n        ids: [newRevId, opts, []]\n      }];\n    }\n  }\n\n  invalidIdError(doc._id);\n\n  doc._rev = nRevNum + '-' + newRevId;\n\n  var result = {metadata : {}, data : {}};\n  for (var key in doc) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(doc, key)) {\n      var specialKey = key[0] === '_';\n      if (specialKey && !reservedWords[key]) {\n        var error = createError(DOC_VALIDATION, key);\n        error.message = DOC_VALIDATION.message + ': ' + key;\n        throw error;\n      } else if (specialKey && !dataWords[key]) {\n        result.metadata[key.slice(1)] = doc[key];\n      } else {\n        result.data[key] = doc[key];\n      }\n    }\n  }\n  return result;\n}\n\nfunction parseBase64(data) {\n  try {\n    return thisAtob(data);\n  } catch (e) {\n    var err = createError(BAD_ARG,\n      'Attachment is not a valid base64 string');\n    return {error: err};\n  }\n}\n\nfunction preprocessString(att, blobType, callback) {\n  var asBinary = parseBase64(att.data);\n  if (asBinary.error) {\n    return callback(asBinary.error);\n  }\n\n  att.length = asBinary.length;\n  if (blobType === 'blob') {\n    att.data = binStringToBluffer(asBinary, att.content_type);\n  } else if (blobType === 'base64') {\n    att.data = thisBtoa(asBinary);\n  } else { // binary\n    att.data = asBinary;\n  }\n  binaryMd5(asBinary, function (result) {\n    att.digest = 'md5-' + result;\n    callback();\n  });\n}\n\nfunction preprocessBlob(att, blobType, callback) {\n  binaryMd5(att.data, function (md5) {\n    att.digest = 'md5-' + md5;\n    // size is for blobs (browser), length is for buffers (node)\n    att.length = att.data.size || att.data.length || 0;\n    if (blobType === 'binary') {\n      blobToBinaryString(att.data, function (binString) {\n        att.data = binString;\n        callback();\n      });\n    } else if (blobType === 'base64') {\n      blobToBase64(att.data, function (b64) {\n        att.data = b64;\n        callback();\n      });\n    } else {\n      callback();\n    }\n  });\n}\n\nfunction preprocessAttachment(att, blobType, callback) {\n  if (att.stub) {\n    return callback();\n  }\n  if (typeof att.data === 'string') { // input is a base64 string\n    preprocessString(att, blobType, callback);\n  } else { // input is a blob\n    preprocessBlob(att, blobType, callback);\n  }\n}\n\nfunction preprocessAttachments(docInfos, blobType, callback) {\n\n  if (!docInfos.length) {\n    return callback();\n  }\n\n  var docv = 0;\n  var overallErr;\n\n  docInfos.forEach(function (docInfo) {\n    var attachments = docInfo.data && docInfo.data._attachments ?\n      Object.keys(docInfo.data._attachments) : [];\n    var recv = 0;\n\n    if (!attachments.length) {\n      return done();\n    }\n\n    function processedAttachment(err) {\n      overallErr = err;\n      recv++;\n      if (recv === attachments.length) {\n        done();\n      }\n    }\n\n    for (var key in docInfo.data._attachments) {\n      if (docInfo.data._attachments.hasOwnProperty(key)) {\n        preprocessAttachment(docInfo.data._attachments[key],\n          blobType, processedAttachment);\n      }\n    }\n  });\n\n  function done() {\n    docv++;\n    if (docInfos.length === docv) {\n      if (overallErr) {\n        callback(overallErr);\n      } else {\n        callback();\n      }\n    }\n  }\n}\n\nfunction updateDoc(revLimit, prev, docInfo, results,\n                   i, cb, writeDoc, newEdits) {\n\n  if (revExists(prev.rev_tree, docInfo.metadata.rev) && !newEdits) {\n    results[i] = docInfo;\n    return cb();\n  }\n\n  // sometimes this is pre-calculated. historically not always\n  var previousWinningRev = prev.winningRev || winningRev(prev);\n  var previouslyDeleted = 'deleted' in prev ? prev.deleted :\n    isDeleted(prev, previousWinningRev);\n  var deleted = 'deleted' in docInfo.metadata ? docInfo.metadata.deleted :\n    isDeleted(docInfo.metadata);\n  var isRoot = /^1-/.test(docInfo.metadata.rev);\n\n  if (previouslyDeleted && !deleted && newEdits && isRoot) {\n    var newDoc = docInfo.data;\n    newDoc._rev = previousWinningRev;\n    newDoc._id = docInfo.metadata.id;\n    docInfo = parseDoc(newDoc, newEdits);\n  }\n\n  var merged = merge(prev.rev_tree, docInfo.metadata.rev_tree[0], revLimit);\n\n  var inConflict = newEdits && ((\n    (previouslyDeleted && deleted && merged.conflicts !== 'new_leaf') ||\n    (!previouslyDeleted && merged.conflicts !== 'new_leaf') ||\n    (previouslyDeleted && !deleted && merged.conflicts === 'new_branch')));\n\n  if (inConflict) {\n    var err = createError(REV_CONFLICT);\n    results[i] = err;\n    return cb();\n  }\n\n  var newRev = docInfo.metadata.rev;\n  docInfo.metadata.rev_tree = merged.tree;\n  docInfo.stemmedRevs = merged.stemmedRevs || [];\n  /* istanbul ignore else */\n  if (prev.rev_map) {\n    docInfo.metadata.rev_map = prev.rev_map; // used only by leveldb\n  }\n\n  // recalculate\n  var winningRev$$1 = winningRev(docInfo.metadata);\n  var winningRevIsDeleted = isDeleted(docInfo.metadata, winningRev$$1);\n\n  // calculate the total number of documents that were added/removed,\n  // from the perspective of total_rows/doc_count\n  var delta = (previouslyDeleted === winningRevIsDeleted) ? 0 :\n    previouslyDeleted < winningRevIsDeleted ? -1 : 1;\n\n  var newRevIsDeleted;\n  if (newRev === winningRev$$1) {\n    // if the new rev is the same as the winning rev, we can reuse that value\n    newRevIsDeleted = winningRevIsDeleted;\n  } else {\n    // if they're not the same, then we need to recalculate\n    newRevIsDeleted = isDeleted(docInfo.metadata, newRev);\n  }\n\n  writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n    true, delta, i, cb);\n}\n\nfunction rootIsMissing(docInfo) {\n  return docInfo.metadata.rev_tree[0].ids[1].status === 'missing';\n}\n\nfunction processDocs(revLimit, docInfos, api, fetchedDocs, tx, results,\n                     writeDoc, opts, overallCallback) {\n\n  // Default to 1000 locally\n  revLimit = revLimit || 1000;\n\n  function insertDoc(docInfo, resultsIdx, callback) {\n    // Cant insert new deleted documents\n    var winningRev$$1 = winningRev(docInfo.metadata);\n    var deleted = isDeleted(docInfo.metadata, winningRev$$1);\n    if ('was_delete' in opts && deleted) {\n      results[resultsIdx] = createError(MISSING_DOC, 'deleted');\n      return callback();\n    }\n\n    // 4712 - detect whether a new document was inserted with a _rev\n    var inConflict = newEdits && rootIsMissing(docInfo);\n\n    if (inConflict) {\n      var err = createError(REV_CONFLICT);\n      results[resultsIdx] = err;\n      return callback();\n    }\n\n    var delta = deleted ? 0 : 1;\n\n    writeDoc(docInfo, winningRev$$1, deleted, deleted, false,\n      delta, resultsIdx, callback);\n  }\n\n  var newEdits = opts.new_edits;\n  var idsToDocs = new ExportedMap();\n\n  var docsDone = 0;\n  var docsToDo = docInfos.length;\n\n  function checkAllDocsDone() {\n    if (++docsDone === docsToDo && overallCallback) {\n      overallCallback();\n    }\n  }\n\n  docInfos.forEach(function (currentDoc, resultsIdx) {\n\n    if (currentDoc._id && isLocalId(currentDoc._id)) {\n      var fun = currentDoc._deleted ? '_removeLocal' : '_putLocal';\n      api[fun](currentDoc, {ctx: tx}, function (err, res) {\n        results[resultsIdx] = err || res;\n        checkAllDocsDone();\n      });\n      return;\n    }\n\n    var id = currentDoc.metadata.id;\n    if (idsToDocs.has(id)) {\n      docsToDo--; // duplicate\n      idsToDocs.get(id).push([currentDoc, resultsIdx]);\n    } else {\n      idsToDocs.set(id, [[currentDoc, resultsIdx]]);\n    }\n  });\n\n  // in the case of new_edits, the user can provide multiple docs\n  // with the same id. these need to be processed sequentially\n  idsToDocs.forEach(function (docs, id) {\n    var numDone = 0;\n\n    function docWritten() {\n      if (++numDone < docs.length) {\n        nextDoc();\n      } else {\n        checkAllDocsDone();\n      }\n    }\n    function nextDoc() {\n      var value = docs[numDone];\n      var currentDoc = value[0];\n      var resultsIdx = value[1];\n\n      if (fetchedDocs.has(id)) {\n        updateDoc(revLimit, fetchedDocs.get(id), currentDoc, results,\n          resultsIdx, docWritten, writeDoc, newEdits);\n      } else {\n        // Ensure stemming applies to new writes as well\n        var merged = merge([], currentDoc.metadata.rev_tree[0], revLimit);\n        currentDoc.metadata.rev_tree = merged.tree;\n        currentDoc.stemmedRevs = merged.stemmedRevs || [];\n        insertDoc(currentDoc, resultsIdx, docWritten);\n      }\n    }\n    nextDoc();\n  });\n}\n\n// IndexedDB requires a versioned database structure, so we use the\n// version here to manage migrations.\nvar ADAPTER_VERSION = 5;\n\n// The object stores created for each database\n// DOC_STORE stores the document meta data, its revision history and state\n// Keyed by document id\nvar DOC_STORE = 'document-store';\n// BY_SEQ_STORE stores a particular version of a document, keyed by its\n// sequence id\nvar BY_SEQ_STORE = 'by-sequence';\n// Where we store attachments\nvar ATTACH_STORE = 'attach-store';\n// Where we store many-to-many relations\n// between attachment digests and seqs\nvar ATTACH_AND_SEQ_STORE = 'attach-seq-store';\n\n// Where we store database-wide meta data in a single record\n// keyed by id: META_STORE\nvar META_STORE = 'meta-store';\n// Where we store local documents\nvar LOCAL_STORE = 'local-store';\n// Where we detect blob support\nvar DETECT_BLOB_SUPPORT_STORE = 'detect-blob-support';\n\nfunction safeJsonParse(str) {\n  // This try/catch guards against stack overflow errors.\n  // JSON.parse() is faster than vuvuzela.parse() but vuvuzela\n  // cannot overflow.\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.parse(str);\n  }\n}\n\nfunction safeJsonStringify(json) {\n  try {\n    return JSON.stringify(json);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.stringify(json);\n  }\n}\n\nfunction idbError(callback) {\n  return function (evt) {\n    var message = 'unknown_error';\n    if (evt.target && evt.target.error) {\n      message = evt.target.error.name || evt.target.error.message;\n    }\n    callback(createError(IDB_ERROR, message, evt.type));\n  };\n}\n\n// Unfortunately, the metadata has to be stringified\n// when it is put into the database, because otherwise\n// IndexedDB can throw errors for deeply-nested objects.\n// Originally we just used JSON.parse/JSON.stringify; now\n// we use this custom vuvuzela library that avoids recursion.\n// If we could do it all over again, we'd probably use a\n// format for the revision trees other than JSON.\nfunction encodeMetadata(metadata, winningRev, deleted) {\n  return {\n    data: safeJsonStringify(metadata),\n    winningRev: winningRev,\n    deletedOrLocal: deleted ? '1' : '0',\n    seq: metadata.seq, // highest seq for this doc\n    id: metadata.id\n  };\n}\n\nfunction decodeMetadata(storedObject) {\n  if (!storedObject) {\n    return null;\n  }\n  var metadata = safeJsonParse(storedObject.data);\n  metadata.winningRev = storedObject.winningRev;\n  metadata.deleted = storedObject.deletedOrLocal === '1';\n  metadata.seq = storedObject.seq;\n  return metadata;\n}\n\n// read the doc back out from the database. we don't store the\n// _id or _rev because we already have _doc_id_rev.\nfunction decodeDoc(doc) {\n  if (!doc) {\n    return doc;\n  }\n  var idx = doc._doc_id_rev.lastIndexOf(':');\n  doc._id = doc._doc_id_rev.substring(0, idx - 1);\n  doc._rev = doc._doc_id_rev.substring(idx + 1);\n  delete doc._doc_id_rev;\n  return doc;\n}\n\n// Read a blob from the database, encoding as necessary\n// and translating from base64 if the IDB doesn't support\n// native Blobs\nfunction readBlobData(body, type, asBlob, callback) {\n  if (asBlob) {\n    if (!body) {\n      callback(createBlob([''], {type: type}));\n    } else if (typeof body !== 'string') { // we have blob support\n      callback(body);\n    } else { // no blob support\n      callback(b64ToBluffer(body, type));\n    }\n  } else { // as base64 string\n    if (!body) {\n      callback('');\n    } else if (typeof body !== 'string') { // we have blob support\n      readAsBinaryString(body, function (binary) {\n        callback(thisBtoa(binary));\n      });\n    } else { // no blob support\n      callback(body);\n    }\n  }\n}\n\nfunction fetchAttachmentsIfNecessary(doc, opts, txn, cb) {\n  var attachments = Object.keys(doc._attachments || {});\n  if (!attachments.length) {\n    return cb && cb();\n  }\n  var numDone = 0;\n\n  function checkDone() {\n    if (++numDone === attachments.length && cb) {\n      cb();\n    }\n  }\n\n  function fetchAttachment(doc, att) {\n    var attObj = doc._attachments[att];\n    var digest = attObj.digest;\n    var req = txn.objectStore(ATTACH_STORE).get(digest);\n    req.onsuccess = function (e) {\n      attObj.body = e.target.result.body;\n      checkDone();\n    };\n  }\n\n  attachments.forEach(function (att) {\n    if (opts.attachments && opts.include_docs) {\n      fetchAttachment(doc, att);\n    } else {\n      doc._attachments[att].stub = true;\n      checkDone();\n    }\n  });\n}\n\n// IDB-specific postprocessing necessary because\n// we don't know whether we stored a true Blob or\n// a base64-encoded string, and if it's a Blob it\n// needs to be read outside of the transaction context\nfunction postProcessAttachments(results, asBlob) {\n  return Promise.all(results.map(function (row) {\n    if (row.doc && row.doc._attachments) {\n      var attNames = Object.keys(row.doc._attachments);\n      return Promise.all(attNames.map(function (att) {\n        var attObj = row.doc._attachments[att];\n        if (!('body' in attObj)) { // already processed\n          return;\n        }\n        var body = attObj.body;\n        var type = attObj.content_type;\n        return new Promise(function (resolve) {\n          readBlobData(body, type, asBlob, function (data) {\n            row.doc._attachments[att] = $inject_Object_assign(\n              pick(attObj, ['digest', 'content_type']),\n              {data: data}\n            );\n            resolve();\n          });\n        });\n      }));\n    }\n  }));\n}\n\nfunction compactRevs(revs, docId, txn) {\n\n  var possiblyOrphanedDigests = [];\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var attStore = txn.objectStore(ATTACH_STORE);\n  var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n  var count = revs.length;\n\n  function checkDone() {\n    count--;\n    if (!count) { // done processing all revs\n      deleteOrphanedAttachments();\n    }\n  }\n\n  function deleteOrphanedAttachments() {\n    if (!possiblyOrphanedDigests.length) {\n      return;\n    }\n    possiblyOrphanedDigests.forEach(function (digest) {\n      var countReq = attAndSeqStore.index('digestSeq').count(\n        IDBKeyRange.bound(\n          digest + '::', digest + '::\\uffff', false, false));\n      countReq.onsuccess = function (e) {\n        var count = e.target.result;\n        if (!count) {\n          // orphaned\n          attStore.delete(digest);\n        }\n      };\n    });\n  }\n\n  revs.forEach(function (rev) {\n    var index = seqStore.index('_doc_id_rev');\n    var key = docId + \"::\" + rev;\n    index.getKey(key).onsuccess = function (e) {\n      var seq = e.target.result;\n      if (typeof seq !== 'number') {\n        return checkDone();\n      }\n      seqStore.delete(seq);\n\n      var cursor = attAndSeqStore.index('seq')\n        .openCursor(IDBKeyRange.only(seq));\n\n      cursor.onsuccess = function (event) {\n        var cursor = event.target.result;\n        if (cursor) {\n          var digest = cursor.value.digestSeq.split('::')[0];\n          possiblyOrphanedDigests.push(digest);\n          attAndSeqStore.delete(cursor.primaryKey);\n          cursor.continue();\n        } else { // done\n          checkDone();\n        }\n      };\n    };\n  });\n}\n\nfunction openTransactionSafely(idb, stores, mode) {\n  try {\n    return {\n      txn: idb.transaction(stores, mode)\n    };\n  } catch (err) {\n    return {\n      error: err\n    };\n  }\n}\n\nvar changesHandler = new Changes();\n\nfunction idbBulkDocs(dbOpts, req, opts, api, idb, callback) {\n  var docInfos = req.docs;\n  var txn;\n  var docStore;\n  var bySeqStore;\n  var attachStore;\n  var attachAndSeqStore;\n  var metaStore;\n  var docInfoError;\n  var metaDoc;\n\n  for (var i = 0, len = docInfos.length; i < len; i++) {\n    var doc = docInfos[i];\n    if (doc._id && isLocalId(doc._id)) {\n      continue;\n    }\n    doc = docInfos[i] = parseDoc(doc, opts.new_edits, dbOpts);\n    if (doc.error && !docInfoError) {\n      docInfoError = doc;\n    }\n  }\n\n  if (docInfoError) {\n    return callback(docInfoError);\n  }\n\n  var allDocsProcessed = false;\n  var docCountDelta = 0;\n  var results = new Array(docInfos.length);\n  var fetchedDocs = new ExportedMap();\n  var preconditionErrored = false;\n  var blobType = api._meta.blobSupport ? 'blob' : 'base64';\n\n  preprocessAttachments(docInfos, blobType, function (err) {\n    if (err) {\n      return callback(err);\n    }\n    startTransaction();\n  });\n\n  function startTransaction() {\n\n    var stores = [\n      DOC_STORE, BY_SEQ_STORE,\n      ATTACH_STORE,\n      LOCAL_STORE, ATTACH_AND_SEQ_STORE,\n      META_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    txn = txnResult.txn;\n    txn.onabort = idbError(callback);\n    txn.ontimeout = idbError(callback);\n    txn.oncomplete = complete;\n    docStore = txn.objectStore(DOC_STORE);\n    bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    attachStore = txn.objectStore(ATTACH_STORE);\n    attachAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n    metaStore = txn.objectStore(META_STORE);\n\n    metaStore.get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result;\n      updateDocCountIfReady();\n    };\n\n    verifyAttachments(function (err) {\n      if (err) {\n        preconditionErrored = true;\n        return callback(err);\n      }\n      fetchExistingDocs();\n    });\n  }\n\n  function onAllDocsProcessed() {\n    allDocsProcessed = true;\n    updateDocCountIfReady();\n  }\n\n  function idbProcessDocs() {\n    processDocs(dbOpts.revs_limit, docInfos, api, fetchedDocs,\n                txn, results, writeDoc, opts, onAllDocsProcessed);\n  }\n\n  function updateDocCountIfReady() {\n    if (!metaDoc || !allDocsProcessed) {\n      return;\n    }\n    // caching the docCount saves a lot of time in allDocs() and\n    // info(), which is why we go to all the trouble of doing this\n    metaDoc.docCount += docCountDelta;\n    metaStore.put(metaDoc);\n  }\n\n  function fetchExistingDocs() {\n\n    if (!docInfos.length) {\n      return;\n    }\n\n    var numFetched = 0;\n\n    function checkDone() {\n      if (++numFetched === docInfos.length) {\n        idbProcessDocs();\n      }\n    }\n\n    function readMetadata(event) {\n      var metadata = decodeMetadata(event.target.result);\n\n      if (metadata) {\n        fetchedDocs.set(metadata.id, metadata);\n      }\n      checkDone();\n    }\n\n    for (var i = 0, len = docInfos.length; i < len; i++) {\n      var docInfo = docInfos[i];\n      if (docInfo._id && isLocalId(docInfo._id)) {\n        checkDone(); // skip local docs\n        continue;\n      }\n      var req = docStore.get(docInfo.metadata.id);\n      req.onsuccess = readMetadata;\n    }\n  }\n\n  function complete() {\n    if (preconditionErrored) {\n      return;\n    }\n\n    changesHandler.notify(api._meta.name);\n    callback(null, results);\n  }\n\n  function verifyAttachment(digest, callback) {\n\n    var req = attachStore.get(digest);\n    req.onsuccess = function (e) {\n      if (!e.target.result) {\n        var err = createError(MISSING_STUB,\n          'unknown stub attachment with digest ' +\n          digest);\n        err.status = 412;\n        callback(err);\n      } else {\n        callback();\n      }\n    };\n  }\n\n  function verifyAttachments(finish) {\n\n\n    var digests = [];\n    docInfos.forEach(function (docInfo) {\n      if (docInfo.data && docInfo.data._attachments) {\n        Object.keys(docInfo.data._attachments).forEach(function (filename) {\n          var att = docInfo.data._attachments[filename];\n          if (att.stub) {\n            digests.push(att.digest);\n          }\n        });\n      }\n    });\n    if (!digests.length) {\n      return finish();\n    }\n    var numDone = 0;\n    var err;\n\n    function checkDone() {\n      if (++numDone === digests.length) {\n        finish(err);\n      }\n    }\n    digests.forEach(function (digest) {\n      verifyAttachment(digest, function (attErr) {\n        if (attErr && !err) {\n          err = attErr;\n        }\n        checkDone();\n      });\n    });\n  }\n\n  function writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n                    isUpdate, delta, resultsIdx, callback) {\n\n    docInfo.metadata.winningRev = winningRev$$1;\n    docInfo.metadata.deleted = winningRevIsDeleted;\n\n    var doc = docInfo.data;\n    doc._id = docInfo.metadata.id;\n    doc._rev = docInfo.metadata.rev;\n\n    if (newRevIsDeleted) {\n      doc._deleted = true;\n    }\n\n    var hasAttachments = doc._attachments &&\n      Object.keys(doc._attachments).length;\n    if (hasAttachments) {\n      return writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n        isUpdate, resultsIdx, callback);\n    }\n\n    docCountDelta += delta;\n    updateDocCountIfReady();\n\n    finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n      isUpdate, resultsIdx, callback);\n  }\n\n  function finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n                     isUpdate, resultsIdx, callback) {\n\n    var doc = docInfo.data;\n    var metadata = docInfo.metadata;\n\n    doc._doc_id_rev = metadata.id + '::' + metadata.rev;\n    delete doc._id;\n    delete doc._rev;\n\n    function afterPutDoc(e) {\n      var revsToDelete = docInfo.stemmedRevs || [];\n\n      if (isUpdate && api.auto_compaction) {\n        revsToDelete = revsToDelete.concat(compactTree(docInfo.metadata));\n      }\n\n      if (revsToDelete && revsToDelete.length) {\n        compactRevs(revsToDelete, docInfo.metadata.id, txn);\n      }\n\n      metadata.seq = e.target.result;\n      // Current _rev is calculated from _rev_tree on read\n      // delete metadata.rev;\n      var metadataToStore = encodeMetadata(metadata, winningRev$$1,\n        winningRevIsDeleted);\n      var metaDataReq = docStore.put(metadataToStore);\n      metaDataReq.onsuccess = afterPutMetadata;\n    }\n\n    function afterPutDocError(e) {\n      // ConstraintError, need to update, not put (see #1638 for details)\n      e.preventDefault(); // avoid transaction abort\n      e.stopPropagation(); // avoid transaction onerror\n      var index = bySeqStore.index('_doc_id_rev');\n      var getKeyReq = index.getKey(doc._doc_id_rev);\n      getKeyReq.onsuccess = function (e) {\n        var putReq = bySeqStore.put(doc, e.target.result);\n        putReq.onsuccess = afterPutDoc;\n      };\n    }\n\n    function afterPutMetadata() {\n      results[resultsIdx] = {\n        ok: true,\n        id: metadata.id,\n        rev: metadata.rev\n      };\n      fetchedDocs.set(docInfo.metadata.id, docInfo.metadata);\n      insertAttachmentMappings(docInfo, metadata.seq, callback);\n    }\n\n    var putReq = bySeqStore.put(doc);\n\n    putReq.onsuccess = afterPutDoc;\n    putReq.onerror = afterPutDocError;\n  }\n\n  function writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n                            isUpdate, resultsIdx, callback) {\n\n\n    var doc = docInfo.data;\n\n    var numDone = 0;\n    var attachments = Object.keys(doc._attachments);\n\n    function collectResults() {\n      if (numDone === attachments.length) {\n        finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n          isUpdate, resultsIdx, callback);\n      }\n    }\n\n    function attachmentSaved() {\n      numDone++;\n      collectResults();\n    }\n\n    attachments.forEach(function (key) {\n      var att = docInfo.data._attachments[key];\n      if (!att.stub) {\n        var data = att.data;\n        delete att.data;\n        att.revpos = parseInt(winningRev$$1, 10);\n        var digest = att.digest;\n        saveAttachment(digest, data, attachmentSaved);\n      } else {\n        numDone++;\n        collectResults();\n      }\n    });\n  }\n\n  // map seqs to attachment digests, which\n  // we will need later during compaction\n  function insertAttachmentMappings(docInfo, seq, callback) {\n\n    var attsAdded = 0;\n    var attsToAdd = Object.keys(docInfo.data._attachments || {});\n\n    if (!attsToAdd.length) {\n      return callback();\n    }\n\n    function checkDone() {\n      if (++attsAdded === attsToAdd.length) {\n        callback();\n      }\n    }\n\n    function add(att) {\n      var digest = docInfo.data._attachments[att].digest;\n      var req = attachAndSeqStore.put({\n        seq: seq,\n        digestSeq: digest + '::' + seq\n      });\n\n      req.onsuccess = checkDone;\n      req.onerror = function (e) {\n        // this callback is for a constaint error, which we ignore\n        // because this docid/rev has already been associated with\n        // the digest (e.g. when new_edits == false)\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n        checkDone();\n      };\n    }\n    for (var i = 0; i < attsToAdd.length; i++) {\n      add(attsToAdd[i]); // do in parallel\n    }\n  }\n\n  function saveAttachment(digest, data, callback) {\n\n\n    var getKeyReq = attachStore.count(digest);\n    getKeyReq.onsuccess = function (e) {\n      var count = e.target.result;\n      if (count) {\n        return callback(); // already exists\n      }\n      var newAtt = {\n        digest: digest,\n        body: data\n      };\n      var putReq = attachStore.put(newAtt);\n      putReq.onsuccess = callback;\n    };\n  }\n}\n\n// Abstraction over IDBCursor and getAll()/getAllKeys() that allows us to batch our operations\n// while falling back to a normal IDBCursor operation on browsers that don't support getAll() or\n// getAllKeys(). This allows for a much faster implementation than just straight-up cursors, because\n// we're not processing each document one-at-a-time.\nfunction runBatchedCursor(objectStore, keyRange, descending, batchSize, onBatch) {\n\n  if (batchSize === -1) {\n    batchSize = 1000;\n  }\n\n  // Bail out of getAll()/getAllKeys() in the following cases:\n  // 1) either method is unsupported - we need both\n  // 2) batchSize is 1 (might as well use IDBCursor)\n  // 3) descending – no real way to do this via getAll()/getAllKeys()\n\n  var useGetAll = typeof objectStore.getAll === 'function' &&\n    typeof objectStore.getAllKeys === 'function' &&\n    batchSize > 1 && !descending;\n\n  var keysBatch;\n  var valuesBatch;\n  var pseudoCursor;\n\n  function onGetAll(e) {\n    valuesBatch = e.target.result;\n    if (keysBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function onGetAllKeys(e) {\n    keysBatch = e.target.result;\n    if (valuesBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function continuePseudoCursor() {\n    if (!keysBatch.length) { // no more results\n      return onBatch();\n    }\n    // fetch next batch, exclusive start\n    var lastKey = keysBatch[keysBatch.length - 1];\n    var newKeyRange;\n    if (keyRange && keyRange.upper) {\n      try {\n        newKeyRange = IDBKeyRange.bound(lastKey, keyRange.upper,\n          true, keyRange.upperOpen);\n      } catch (e) {\n        if (e.name === \"DataError\" && e.code === 0) {\n          return onBatch(); // we're done, startkey and endkey are equal\n        }\n      }\n    } else {\n      newKeyRange = IDBKeyRange.lowerBound(lastKey, true);\n    }\n    keyRange = newKeyRange;\n    keysBatch = null;\n    valuesBatch = null;\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  }\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (!cursor) { // done\n      return onBatch();\n    }\n    // regular IDBCursor acts like a batch where batch size is always 1\n    onBatch([cursor.key], [cursor.value], cursor);\n  }\n\n  if (useGetAll) {\n    pseudoCursor = {\"continue\": continuePseudoCursor};\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  } else if (descending) {\n    objectStore.openCursor(keyRange, 'prev').onsuccess = onCursor;\n  } else {\n    objectStore.openCursor(keyRange).onsuccess = onCursor;\n  }\n}\n\n// simple shim for objectStore.getAll(), falling back to IDBCursor\nfunction getAll(objectStore, keyRange, onSuccess) {\n  if (typeof objectStore.getAll === 'function') {\n    // use native getAll\n    objectStore.getAll(keyRange).onsuccess = onSuccess;\n    return;\n  }\n  // fall back to cursors\n  var values = [];\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (cursor) {\n      values.push(cursor.value);\n      cursor.continue();\n    } else {\n      onSuccess({\n        target: {\n          result: values\n        }\n      });\n    }\n  }\n\n  objectStore.openCursor(keyRange).onsuccess = onCursor;\n}\n\nfunction allDocsKeys(keys, docStore, onBatch) {\n  // It's not guaranted to be returned in right order  \n  var valuesBatch = new Array(keys.length);\n  var count = 0;\n  keys.forEach(function (key, index) {\n    docStore.get(key).onsuccess = function (event) {\n      if (event.target.result) {\n        valuesBatch[index] = event.target.result;\n      } else {\n        valuesBatch[index] = {key: key, error: 'not_found'};\n      }\n      count++;\n      if (count === keys.length) {\n        onBatch(keys, valuesBatch, {});\n      }\n    };\n  });\n}\n\nfunction createKeyRange(start, end, inclusiveEnd, key, descending) {\n  try {\n    if (start && end) {\n      if (descending) {\n        return IDBKeyRange.bound(end, start, !inclusiveEnd, false);\n      } else {\n        return IDBKeyRange.bound(start, end, false, !inclusiveEnd);\n      }\n    } else if (start) {\n      if (descending) {\n        return IDBKeyRange.upperBound(start);\n      } else {\n        return IDBKeyRange.lowerBound(start);\n      }\n    } else if (end) {\n      if (descending) {\n        return IDBKeyRange.lowerBound(end, !inclusiveEnd);\n      } else {\n        return IDBKeyRange.upperBound(end, !inclusiveEnd);\n      }\n    } else if (key) {\n      return IDBKeyRange.only(key);\n    }\n  } catch (e) {\n    return {error: e};\n  }\n  return null;\n}\n\nfunction idbAllDocs(opts, idb, callback) {\n  var start = 'startkey' in opts ? opts.startkey : false;\n  var end = 'endkey' in opts ? opts.endkey : false;\n  var key = 'key' in opts ? opts.key : false;\n  var keys = 'keys' in opts ? opts.keys : false; \n  var skip = opts.skip || 0;\n  var limit = typeof opts.limit === 'number' ? opts.limit : -1;\n  var inclusiveEnd = opts.inclusive_end !== false;\n\n  var keyRange ; \n  var keyRangeError;\n  if (!keys) {\n    keyRange = createKeyRange(start, end, inclusiveEnd, key, opts.descending);\n    keyRangeError = keyRange && keyRange.error;\n    if (keyRangeError && \n      !(keyRangeError.name === \"DataError\" && keyRangeError.code === 0)) {\n      // DataError with error code 0 indicates start is less than end, so\n      // can just do an empty query. Else need to throw\n      return callback(createError(IDB_ERROR,\n        keyRangeError.name, keyRangeError.message));\n    }\n  }\n\n  var stores = [DOC_STORE, BY_SEQ_STORE, META_STORE];\n\n  if (opts.attachments) {\n    stores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, stores, 'readonly');\n  if (txnResult.error) {\n    return callback(txnResult.error);\n  }\n  var txn = txnResult.txn;\n  txn.oncomplete = onTxnComplete;\n  txn.onabort = idbError(callback);\n  var docStore = txn.objectStore(DOC_STORE);\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var metaStore = txn.objectStore(META_STORE);\n  var docIdRevIndex = seqStore.index('_doc_id_rev');\n  var results = [];\n  var docCount;\n  var updateSeq;\n\n  metaStore.get(META_STORE).onsuccess = function (e) {\n    docCount = e.target.result.docCount;\n  };\n\n  /* istanbul ignore if */\n  if (opts.update_seq) {\n    getMaxUpdateSeq(seqStore, function (e) { \n      if (e.target.result && e.target.result.length > 0) {\n        updateSeq = e.target.result[0];\n      }\n    });\n  }\n\n  function getMaxUpdateSeq(objectStore, onSuccess) {\n    function onCursor(e) {\n      var cursor = e.target.result;\n      var maxKey = undefined;\n      if (cursor && cursor.key) {\n        maxKey = cursor.key;\n      } \n      return onSuccess({\n        target: {\n          result: [maxKey]\n        }\n      });\n    }\n    objectStore.openCursor(null, 'prev').onsuccess = onCursor;\n  }\n\n  // if the user specifies include_docs=true, then we don't\n  // want to block the main cursor while we're fetching the doc\n  function fetchDocAsynchronously(metadata, row, winningRev$$1) {\n    var key = metadata.id + \"::\" + winningRev$$1;\n    docIdRevIndex.get(key).onsuccess =  function onGetDoc(e) {\n      row.doc = decodeDoc(e.target.result) || {};\n      if (opts.conflicts) {\n        var conflicts = collectConflicts(metadata);\n        if (conflicts.length) {\n          row.doc._conflicts = conflicts;\n        }\n      }\n      fetchAttachmentsIfNecessary(row.doc, opts, txn);\n    };\n  }\n\n  function allDocsInner(winningRev$$1, metadata) {\n    var row = {\n      id: metadata.id,\n      key: metadata.id,\n      value: {\n        rev: winningRev$$1\n      }\n    };\n    var deleted = metadata.deleted;\n    if (deleted) {\n      if (keys) {\n        results.push(row);\n        // deleted docs are okay with \"keys\" requests\n        row.value.deleted = true;\n        row.doc = null;\n      }\n    } else if (skip-- <= 0) {\n      results.push(row);\n      if (opts.include_docs) {\n        fetchDocAsynchronously(metadata, row, winningRev$$1);\n      }\n    }\n  }\n\n  function processBatch(batchValues) {\n    for (var i = 0, len = batchValues.length; i < len; i++) {\n      if (results.length === limit) {\n        break;\n      }\n      var batchValue = batchValues[i];\n      if (batchValue.error && keys) {\n        // key was not found with \"keys\" requests\n        results.push(batchValue);\n        continue;\n      }\n      var metadata = decodeMetadata(batchValue);\n      var winningRev$$1 = metadata.winningRev;\n      allDocsInner(winningRev$$1, metadata);\n    }\n  }\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor) {\n      return;\n    }\n    processBatch(batchValues);\n    if (results.length < limit) {\n      cursor.continue();\n    }\n  }\n\n  function onGetAll(e) {\n    var values = e.target.result;\n    if (opts.descending) {\n      values = values.reverse();\n    }\n    processBatch(values);\n  }\n\n  function onResultsReady() {\n    var returnVal = {\n      total_rows: docCount,\n      offset: opts.skip,\n      rows: results\n    };\n    \n    /* istanbul ignore if */\n    if (opts.update_seq && updateSeq !== undefined) {\n      returnVal.update_seq = updateSeq;\n    }\n    callback(null, returnVal);\n  }\n\n  function onTxnComplete() {\n    if (opts.attachments) {\n      postProcessAttachments(results, opts.binary).then(onResultsReady);\n    } else {\n      onResultsReady();\n    }\n  }\n\n  // don't bother doing any requests if start > end or limit === 0\n  if (keyRangeError || limit === 0) {\n    return;\n  }\n  if (keys) {\n    return allDocsKeys(opts.keys, docStore, onBatch);\n  }\n  if (limit === -1) { // just fetch everything\n    return getAll(docStore, keyRange, onGetAll);\n  }\n  // else do a cursor\n  // choose a batch size based on the skip, since we'll need to skip that many\n  runBatchedCursor(docStore, keyRange, opts.descending, limit + skip, onBatch);\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\nfunction checkBlobSupport(txn) {\n  return new Promise(function (resolve) {\n    var blob$$1 = createBlob(['']);\n    var req = txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob$$1, 'key');\n\n    req.onsuccess = function () {\n      var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n      var matchedEdge = navigator.userAgent.match(/Edge\\//);\n      // MS Edge pretends to be Chrome 42:\n      // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n      resolve(matchedEdge || !matchedChrome ||\n        parseInt(matchedChrome[1], 10) >= 43);\n    };\n\n    req.onerror = txn.onabort = function (e) {\n      // If the transaction aborts now its due to not being able to\n      // write to the database, likely due to the disk being full\n      e.preventDefault();\n      e.stopPropagation();\n      resolve(false);\n    };\n  }).catch(function () {\n    return false; // error, so assume unsupported\n  });\n}\n\nfunction countDocs(txn, cb) {\n  var index = txn.objectStore(DOC_STORE).index('deletedOrLocal');\n  index.count(IDBKeyRange.only('0')).onsuccess = function (e) {\n    cb(e.target.result);\n  };\n}\n\n// This task queue ensures that IDB open calls are done in their own tick\n\nvar running = false;\nvar queue = [];\n\nfunction tryCode(fun, err, res, PouchDB) {\n  try {\n    fun(err, res);\n  } catch (err) {\n    // Shouldn't happen, but in some odd cases\n    // IndexedDB implementations might throw a sync\n    // error, in which case this will at least log it.\n    PouchDB.emit('error', err);\n  }\n}\n\nfunction applyNext() {\n  if (running || !queue.length) {\n    return;\n  }\n  running = true;\n  queue.shift()();\n}\n\nfunction enqueueTask(action, callback, PouchDB) {\n  queue.push(function runAction() {\n    action(function runCallback(err, res) {\n      tryCode(callback, err, res, PouchDB);\n      running = false;\n      nextTick(function runNext() {\n        applyNext(PouchDB);\n      });\n    });\n  });\n  applyNext();\n}\n\nfunction changes(opts, api, dbName, idb) {\n  opts = clone(opts);\n\n  if (opts.continuous) {\n    var id = dbName + ':' + uuid();\n    changesHandler.addListener(dbName, id, api, opts);\n    changesHandler.notify(dbName);\n    return {\n      cancel: function () {\n        changesHandler.removeListener(dbName, id);\n      }\n    };\n  }\n\n  var docIds = opts.doc_ids && new ExportedSet(opts.doc_ids);\n\n  opts.since = opts.since || 0;\n  var lastSeq = opts.since;\n\n  var limit = 'limit' in opts ? opts.limit : -1;\n  if (limit === 0) {\n    limit = 1; // per CouchDB _changes spec\n  }\n\n  var results = [];\n  var numResults = 0;\n  var filter = filterChange(opts);\n  var docIdsToMetadata = new ExportedMap();\n\n  var txn;\n  var bySeqStore;\n  var docStore;\n  var docIdRevIndex;\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor || !batchKeys.length) { // done\n      return;\n    }\n\n    var winningDocs = new Array(batchKeys.length);\n    var metadatas = new Array(batchKeys.length);\n\n    function processMetadataAndWinningDoc(metadata, winningDoc) {\n      var change = opts.processChange(winningDoc, metadata, opts);\n      lastSeq = change.seq = metadata.seq;\n\n      var filtered = filter(change);\n      if (typeof filtered === 'object') { // anything but true/false indicates error\n        return Promise.reject(filtered);\n      }\n\n      if (!filtered) {\n        return Promise.resolve();\n      }\n      numResults++;\n      if (opts.return_docs) {\n        results.push(change);\n      }\n      // process the attachment immediately\n      // for the benefit of live listeners\n      if (opts.attachments && opts.include_docs) {\n        return new Promise(function (resolve) {\n          fetchAttachmentsIfNecessary(winningDoc, opts, txn, function () {\n            postProcessAttachments([change], opts.binary).then(function () {\n              resolve(change);\n            });\n          });\n        });\n      } else {\n        return Promise.resolve(change);\n      }\n    }\n\n    function onBatchDone() {\n      var promises = [];\n      for (var i = 0, len = winningDocs.length; i < len; i++) {\n        if (numResults === limit) {\n          break;\n        }\n        var winningDoc = winningDocs[i];\n        if (!winningDoc) {\n          continue;\n        }\n        var metadata = metadatas[i];\n        promises.push(processMetadataAndWinningDoc(metadata, winningDoc));\n      }\n\n      Promise.all(promises).then(function (changes) {\n        for (var i = 0, len = changes.length; i < len; i++) {\n          if (changes[i]) {\n            opts.onChange(changes[i]);\n          }\n        }\n      }).catch(opts.complete);\n\n      if (numResults !== limit) {\n        cursor.continue();\n      }\n    }\n\n    // Fetch all metadatas/winningdocs from this batch in parallel, then process\n    // them all only once all data has been collected. This is done in parallel\n    // because it's faster than doing it one-at-a-time.\n    var numDone = 0;\n    batchValues.forEach(function (value, i) {\n      var doc = decodeDoc(value);\n      var seq = batchKeys[i];\n      fetchWinningDocAndMetadata(doc, seq, function (metadata, winningDoc) {\n        metadatas[i] = metadata;\n        winningDocs[i] = winningDoc;\n        if (++numDone === batchKeys.length) {\n          onBatchDone();\n        }\n      });\n    });\n  }\n\n  function onGetMetadata(doc, seq, metadata, cb) {\n    if (metadata.seq !== seq) {\n      // some other seq is later\n      return cb();\n    }\n\n    if (metadata.winningRev === doc._rev) {\n      // this is the winning doc\n      return cb(metadata, doc);\n    }\n\n    // fetch winning doc in separate request\n    var docIdRev = doc._id + '::' + metadata.winningRev;\n    var req = docIdRevIndex.get(docIdRev);\n    req.onsuccess = function (e) {\n      cb(metadata, decodeDoc(e.target.result));\n    };\n  }\n\n  function fetchWinningDocAndMetadata(doc, seq, cb) {\n    if (docIds && !docIds.has(doc._id)) {\n      return cb();\n    }\n\n    var metadata = docIdsToMetadata.get(doc._id);\n    if (metadata) { // cached\n      return onGetMetadata(doc, seq, metadata, cb);\n    }\n    // metadata not cached, have to go fetch it\n    docStore.get(doc._id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      docIdsToMetadata.set(doc._id, metadata);\n      onGetMetadata(doc, seq, metadata, cb);\n    };\n  }\n\n  function finish() {\n    opts.complete(null, {\n      results: results,\n      last_seq: lastSeq\n    });\n  }\n\n  function onTxnComplete() {\n    if (!opts.continuous && opts.attachments) {\n      // cannot guarantee that postProcessing was already done,\n      // so do it again\n      postProcessAttachments(results).then(finish);\n    } else {\n      finish();\n    }\n  }\n\n  var objectStores = [DOC_STORE, BY_SEQ_STORE];\n  if (opts.attachments) {\n    objectStores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, objectStores, 'readonly');\n  if (txnResult.error) {\n    return opts.complete(txnResult.error);\n  }\n  txn = txnResult.txn;\n  txn.onabort = idbError(opts.complete);\n  txn.oncomplete = onTxnComplete;\n\n  bySeqStore = txn.objectStore(BY_SEQ_STORE);\n  docStore = txn.objectStore(DOC_STORE);\n  docIdRevIndex = bySeqStore.index('_doc_id_rev');\n\n  var keyRange = (opts.since && !opts.descending) ?\n    IDBKeyRange.lowerBound(opts.since, true) : null;\n\n  runBatchedCursor(bySeqStore, keyRange, opts.descending, limit, onBatch);\n}\n\nvar cachedDBs = new ExportedMap();\nvar blobSupportPromise;\nvar openReqList = new ExportedMap();\n\nfunction IdbPouch(opts, callback) {\n  var api = this;\n\n  enqueueTask(function (thisCallback) {\n    init(api, opts, thisCallback);\n  }, callback, api.constructor);\n}\n\nfunction init(api, opts, callback) {\n\n  var dbName = opts.name;\n\n  var idb = null;\n  api._meta = null;\n\n  // called when creating a fresh new database\n  function createSchema(db) {\n    var docStore = db.createObjectStore(DOC_STORE, {keyPath : 'id'});\n    db.createObjectStore(BY_SEQ_STORE, {autoIncrement: true})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n    db.createObjectStore(ATTACH_STORE, {keyPath: 'digest'});\n    db.createObjectStore(META_STORE, {keyPath: 'id', autoIncrement: false});\n    db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n\n    // added in v2\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    // added in v3\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'});\n\n    // added in v4\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 2\n  // unfortunately \"deletedOrLocal\" is a misnomer now that we no longer\n  // store local docs in the main doc-store, but whaddyagonnado\n  function addDeletedOrLocalIndex(txn, callback) {\n    var docStore = txn.objectStore(DOC_STORE);\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    docStore.openCursor().onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var deleted = isDeleted(metadata);\n        metadata.deletedOrLocal = deleted ? \"1\" : \"0\";\n        docStore.put(metadata);\n        cursor.continue();\n      } else {\n        callback();\n      }\n    };\n  }\n\n  // migration to version 3 (part 1)\n  function createLocalStoreSchema(db) {\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n  }\n\n  // migration to version 3 (part 2)\n  function migrateLocalStore(txn, cb) {\n    var localStore = txn.objectStore(LOCAL_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var docId = metadata.id;\n        var local = isLocalId(docId);\n        var rev = winningRev(metadata);\n        if (local) {\n          var docIdRev = docId + \"::\" + rev;\n          // remove all seq entries\n          // associated with this docId\n          var start = docId + \"::\";\n          var end = docId + \"::~\";\n          var index = seqStore.index('_doc_id_rev');\n          var range = IDBKeyRange.bound(start, end, false, false);\n          var seqCursor = index.openCursor(range);\n          seqCursor.onsuccess = function (e) {\n            seqCursor = e.target.result;\n            if (!seqCursor) {\n              // done\n              docStore.delete(cursor.primaryKey);\n              cursor.continue();\n            } else {\n              var data = seqCursor.value;\n              if (data._doc_id_rev === docIdRev) {\n                localStore.put(data);\n              }\n              seqStore.delete(seqCursor.primaryKey);\n              seqCursor.continue();\n            }\n          };\n        } else {\n          cursor.continue();\n        }\n      } else if (cb) {\n        cb();\n      }\n    };\n  }\n\n  // migration to version 4 (part 1)\n  function addAttachAndSeqStore(db) {\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 4 (part 2)\n  function migrateAttsAndSeqs(txn, callback) {\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n    var attStore = txn.objectStore(ATTACH_STORE);\n    var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n\n    // need to actually populate the table. this is the expensive part,\n    // so as an optimization, check first that this database even\n    // contains attachments\n    var req = attStore.count();\n    req.onsuccess = function (e) {\n      var count = e.target.result;\n      if (!count) {\n        return callback(); // done\n      }\n\n      seqStore.openCursor().onsuccess = function (e) {\n        var cursor = e.target.result;\n        if (!cursor) {\n          return callback(); // done\n        }\n        var doc = cursor.value;\n        var seq = cursor.primaryKey;\n        var atts = Object.keys(doc._attachments || {});\n        var digestMap = {};\n        for (var j = 0; j < atts.length; j++) {\n          var att = doc._attachments[atts[j]];\n          digestMap[att.digest] = true; // uniq digests, just in case\n        }\n        var digests = Object.keys(digestMap);\n        for (j = 0; j < digests.length; j++) {\n          var digest = digests[j];\n          attAndSeqStore.put({\n            seq: seq,\n            digestSeq: digest + '::' + seq\n          });\n        }\n        cursor.continue();\n      };\n    };\n  }\n\n  // migration to version 5\n  // Instead of relying on on-the-fly migration of metadata,\n  // this brings the doc-store to its modern form:\n  // - metadata.winningrev\n  // - metadata.seq\n  // - stringify the metadata when storing it\n  function migrateMetadata(txn) {\n\n    function decodeMetadataCompat(storedObject) {\n      if (!storedObject.data) {\n        // old format, when we didn't store it stringified\n        storedObject.deleted = storedObject.deletedOrLocal === '1';\n        return storedObject;\n      }\n      return decodeMetadata(storedObject);\n    }\n\n    // ensure that every metadata has a winningRev and seq,\n    // which was previously created on-the-fly but better to migrate\n    var bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (e) {\n      var cursor = e.target.result;\n      if (!cursor) {\n        return; // done\n      }\n      var metadata = decodeMetadataCompat(cursor.value);\n\n      metadata.winningRev = metadata.winningRev ||\n        winningRev(metadata);\n\n      function fetchMetadataSeq() {\n        // metadata.seq was added post-3.2.0, so if it's missing,\n        // we need to fetch it manually\n        var start = metadata.id + '::';\n        var end = metadata.id + '::\\uffff';\n        var req = bySeqStore.index('_doc_id_rev').openCursor(\n          IDBKeyRange.bound(start, end));\n\n        var metadataSeq = 0;\n        req.onsuccess = function (e) {\n          var cursor = e.target.result;\n          if (!cursor) {\n            metadata.seq = metadataSeq;\n            return onGetMetadataSeq();\n          }\n          var seq = cursor.primaryKey;\n          if (seq > metadataSeq) {\n            metadataSeq = seq;\n          }\n          cursor.continue();\n        };\n      }\n\n      function onGetMetadataSeq() {\n        var metadataToStore = encodeMetadata(metadata,\n          metadata.winningRev, metadata.deleted);\n\n        var req = docStore.put(metadataToStore);\n        req.onsuccess = function () {\n          cursor.continue();\n        };\n      }\n\n      if (metadata.seq) {\n        return onGetMetadataSeq();\n      }\n\n      fetchMetadataSeq();\n    };\n\n  }\n\n  api._remote = false;\n  api.type = function () {\n    return 'idb';\n  };\n\n  api._id = toPromise(function (callback) {\n    callback(null, api._meta.instanceId);\n  });\n\n  api._bulkDocs = function idb_bulkDocs(req, reqOpts, callback) {\n    idbBulkDocs(opts, req, reqOpts, api, idb, callback);\n  };\n\n  // First we look up the metadata in the ids database, then we fetch the\n  // current revision(s) from the by sequence store\n  api._get = function idb_get(id, opts, callback) {\n    var doc;\n    var metadata;\n    var err;\n    var txn = opts.ctx;\n    if (!txn) {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n\n    function finish() {\n      callback(err, {doc: doc, metadata: metadata, ctx: txn});\n    }\n\n    txn.objectStore(DOC_STORE).get(id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      // we can determine the result here if:\n      // 1. there is no such document\n      // 2. the document is deleted and we don't ask about specific rev\n      // When we ask with opts.rev we expect the answer to be either\n      // doc (possibly with _deleted=true) or missing error\n      if (!metadata) {\n        err = createError(MISSING_DOC, 'missing');\n        return finish();\n      }\n\n      var rev;\n      if (!opts.rev) {\n        rev = metadata.winningRev;\n        var deleted = isDeleted(metadata);\n        if (deleted) {\n          err = createError(MISSING_DOC, \"deleted\");\n          return finish();\n        }\n      } else {\n        rev = opts.latest ? latest(opts.rev, metadata) : opts.rev;\n      }\n\n      var objectStore = txn.objectStore(BY_SEQ_STORE);\n      var key = metadata.id + '::' + rev;\n\n      objectStore.index('_doc_id_rev').get(key).onsuccess = function (e) {\n        doc = e.target.result;\n        if (doc) {\n          doc = decodeDoc(doc);\n        }\n        if (!doc) {\n          err = createError(MISSING_DOC, 'missing');\n          return finish();\n        }\n        finish();\n      };\n    };\n  };\n\n  api._getAttachment = function (docId, attachId, attachment, opts, callback) {\n    var txn;\n    if (opts.ctx) {\n      txn = opts.ctx;\n    } else {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n    var digest = attachment.digest;\n    var type = attachment.content_type;\n\n    txn.objectStore(ATTACH_STORE).get(digest).onsuccess = function (e) {\n      var body = e.target.result.body;\n      readBlobData(body, type, opts.binary, function (blobData) {\n        callback(null, blobData);\n      });\n    };\n  };\n\n  api._info = function idb_info(callback) {\n    var updateSeq;\n    var docCount;\n\n    var txnResult = openTransactionSafely(idb, [META_STORE, BY_SEQ_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      docCount = e.target.result.docCount;\n    };\n    txn.objectStore(BY_SEQ_STORE).openCursor(null, 'prev').onsuccess = function (e) {\n      var cursor = e.target.result;\n      updateSeq = cursor ? cursor.key : 0;\n    };\n\n    txn.oncomplete = function () {\n      callback(null, {\n        doc_count: docCount,\n        update_seq: updateSeq,\n        // for debugging\n        idb_attachment_format: (api._meta.blobSupport ? 'binary' : 'base64')\n      });\n    };\n  };\n\n  api._allDocs = function idb_allDocs(opts, callback) {\n    idbAllDocs(opts, idb, callback);\n  };\n\n  api._changes = function idbChanges(opts) {\n    return changes(opts, api, dbName, idb);\n  };\n\n  api._close = function (callback) {\n    // https://developer.mozilla.org/en-US/docs/IndexedDB/IDBDatabase#close\n    // \"Returns immediately and closes the connection in a separate thread...\"\n    idb.close();\n    cachedDBs.delete(dbName);\n    callback();\n  };\n\n  api._getRevisionTree = function (docId, callback) {\n    var txnResult = openTransactionSafely(idb, [DOC_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    var req = txn.objectStore(DOC_STORE).get(docId);\n    req.onsuccess = function (event) {\n      var doc = decodeMetadata(event.target.result);\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        callback(null, doc.rev_tree);\n      }\n    };\n  };\n\n  // This function removes revisions of document docId\n  // which are listed in revs and sets this document\n  // revision to to rev_tree\n  api._doCompaction = function (docId, revs, callback) {\n    var stores = [\n      DOC_STORE,\n      BY_SEQ_STORE,\n      ATTACH_STORE,\n      ATTACH_AND_SEQ_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n\n    var docStore = txn.objectStore(DOC_STORE);\n\n    docStore.get(docId).onsuccess = function (event) {\n      var metadata = decodeMetadata(event.target.result);\n      traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                                         revHash, ctx, opts) {\n        var rev = pos + '-' + revHash;\n        if (revs.indexOf(rev) !== -1) {\n          opts.status = 'missing';\n        }\n      });\n      compactRevs(revs, docId, txn);\n      var winningRev$$1 = metadata.winningRev;\n      var deleted = metadata.deleted;\n      txn.objectStore(DOC_STORE).put(\n        encodeMetadata(metadata, winningRev$$1, deleted));\n    };\n    txn.onabort = idbError(callback);\n    txn.oncomplete = function () {\n      callback();\n    };\n  };\n\n\n  api._getLocal = function (id, callback) {\n    var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var tx = txnResult.txn;\n    var req = tx.objectStore(LOCAL_STORE).get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var doc = e.target.result;\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        delete doc['_doc_id_rev']; // for backwards compat\n        callback(null, doc);\n      }\n    };\n  };\n\n  api._putLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    delete doc._revisions; // ignore this, trust the rev\n    var oldRev = doc._rev;\n    var id = doc._id;\n    if (!oldRev) {\n      doc._rev = '0-1';\n    } else {\n      doc._rev = '0-' + (parseInt(oldRev.split('-')[1], 10) + 1);\n    }\n\n    var tx = opts.ctx;\n    var ret;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.onerror = idbError(callback);\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req;\n    if (oldRev) {\n      req = oStore.get(id);\n      req.onsuccess = function (e) {\n        var oldDoc = e.target.result;\n        if (!oldDoc || oldDoc._rev !== oldRev) {\n          callback(createError(REV_CONFLICT));\n        } else { // update\n          var req = oStore.put(doc);\n          req.onsuccess = function () {\n            ret = {ok: true, id: doc._id, rev: doc._rev};\n            if (opts.ctx) { // return immediately\n              callback(null, ret);\n            }\n          };\n        }\n      };\n    } else { // new doc\n      req = oStore.add(doc);\n      req.onerror = function (e) {\n        // constraint error, already exists\n        callback(createError(REV_CONFLICT));\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n      };\n      req.onsuccess = function () {\n        ret = {ok: true, id: doc._id, rev: doc._rev};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      };\n    }\n  };\n\n  api._removeLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var tx = opts.ctx;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n    var ret;\n    var id = doc._id;\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req = oStore.get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var oldDoc = e.target.result;\n      if (!oldDoc || oldDoc._rev !== doc._rev) {\n        callback(createError(MISSING_DOC));\n      } else {\n        oStore.delete(id);\n        ret = {ok: true, id: id, rev: '0-0'};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      }\n    };\n  };\n\n  api._destroy = function (opts, callback) {\n    changesHandler.removeAllListeners(dbName);\n\n    //Close open request for \"dbName\" database to fix ie delay.\n    var openReq = openReqList.get(dbName);\n    if (openReq && openReq.result) {\n      openReq.result.close();\n      cachedDBs.delete(dbName);\n    }\n    var req = indexedDB.deleteDatabase(dbName);\n\n    req.onsuccess = function () {\n      //Remove open request from the list.\n      openReqList.delete(dbName);\n      if (hasLocalStorage() && (dbName in localStorage)) {\n        delete localStorage[dbName];\n      }\n      callback(null, { 'ok': true });\n    };\n\n    req.onerror = idbError(callback);\n  };\n\n  var cached = cachedDBs.get(dbName);\n\n  if (cached) {\n    idb = cached.idb;\n    api._meta = cached.global;\n    return nextTick(function () {\n      callback(null, api);\n    });\n  }\n\n  var req = indexedDB.open(dbName, ADAPTER_VERSION);\n  openReqList.set(dbName, req);\n\n  req.onupgradeneeded = function (e) {\n    var db = e.target.result;\n    if (e.oldVersion < 1) {\n      return createSchema(db); // new db, initial schema\n    }\n    // do migrations\n\n    var txn = e.currentTarget.transaction;\n    // these migrations have to be done in this function, before\n    // control is returned to the event loop, because IndexedDB\n\n    if (e.oldVersion < 3) {\n      createLocalStoreSchema(db); // v2 -> v3\n    }\n    if (e.oldVersion < 4) {\n      addAttachAndSeqStore(db); // v3 -> v4\n    }\n\n    var migrations = [\n      addDeletedOrLocalIndex, // v1 -> v2\n      migrateLocalStore,      // v2 -> v3\n      migrateAttsAndSeqs,     // v3 -> v4\n      migrateMetadata         // v4 -> v5\n    ];\n\n    var i = e.oldVersion;\n\n    function next() {\n      var migration = migrations[i - 1];\n      i++;\n      if (migration) {\n        migration(txn, next);\n      }\n    }\n\n    next();\n  };\n\n  req.onsuccess = function (e) {\n\n    idb = e.target.result;\n\n    idb.onversionchange = function () {\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    idb.onabort = function (e) {\n      guardedConsole('error', 'Database has a global failure', e.target.error);\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    // Do a few setup operations (in parallel as much as possible):\n    // 1. Fetch meta doc\n    // 2. Check blob support\n    // 3. Calculate docCount\n    // 4. Generate an instanceId if necessary\n    // 5. Store docCount and instanceId on meta doc\n\n    var txn = idb.transaction([\n      META_STORE,\n      DETECT_BLOB_SUPPORT_STORE,\n      DOC_STORE\n    ], 'readwrite');\n\n    var storedMetaDoc = false;\n    var metaDoc;\n    var docCount;\n    var blobSupport;\n    var instanceId;\n\n    function completeSetup() {\n      if (typeof blobSupport === 'undefined' || !storedMetaDoc) {\n        return;\n      }\n      api._meta = {\n        name: dbName,\n        instanceId: instanceId,\n        blobSupport: blobSupport\n      };\n\n      cachedDBs.set(dbName, {\n        idb: idb,\n        global: api._meta\n      });\n      callback(null, api);\n    }\n\n    function storeMetaDocIfReady() {\n      if (typeof docCount === 'undefined' || typeof metaDoc === 'undefined') {\n        return;\n      }\n      var instanceKey = dbName + '_id';\n      if (instanceKey in metaDoc) {\n        instanceId = metaDoc[instanceKey];\n      } else {\n        metaDoc[instanceKey] = instanceId = uuid();\n      }\n      metaDoc.docCount = docCount;\n      txn.objectStore(META_STORE).put(metaDoc);\n    }\n\n    //\n    // fetch or generate the instanceId\n    //\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result || { id: META_STORE };\n      storeMetaDocIfReady();\n    };\n\n    //\n    // countDocs\n    //\n    countDocs(txn, function (count) {\n      docCount = count;\n      storeMetaDocIfReady();\n    });\n\n    //\n    // check blob support\n    //\n    if (!blobSupportPromise) {\n      // make sure blob support is only checked once\n      blobSupportPromise = checkBlobSupport(txn);\n    }\n\n    blobSupportPromise.then(function (val) {\n      blobSupport = val;\n      completeSetup();\n    });\n\n    // only when the metadata put transaction has completed,\n    // consider the setup done\n    txn.oncomplete = function () {\n      storedMetaDoc = true;\n      completeSetup();\n    };\n    txn.onabort = idbError(callback);\n  };\n\n  req.onerror = function () {\n    var msg = 'Failed to open indexedDB, are you in private browsing mode?';\n    guardedConsole('error', msg);\n    callback(createError(IDB_ERROR, msg));\n  };\n}\n\nIdbPouch.valid = function () {\n  // Following #7085 buggy idb versions (typically Safari < 10.1) are\n  // considered valid.\n\n  // On Firefox SecurityError is thrown while referencing indexedDB if cookies\n  // are not allowed. `typeof indexedDB` also triggers the error.\n  try {\n    // some outdated implementations of IDB that appear on Samsung\n    // and HTC Android devices <4.4 are missing IDBKeyRange\n    return typeof indexedDB !== 'undefined' && typeof IDBKeyRange !== 'undefined';\n  } catch (e) {\n    return false;\n  }\n};\n\nfunction IDBPouch (PouchDB) {\n  PouchDB.adapter('idb', IdbPouch, true);\n}\n\n// dead simple promise pool, inspired by https://github.com/timdp/es6-promise-pool\n// but much smaller in code size. limits the number of concurrent promises that are executed\n\n\nfunction pool(promiseFactories, limit) {\n  return new Promise(function (resolve, reject) {\n    var running = 0;\n    var current = 0;\n    var done = 0;\n    var len = promiseFactories.length;\n    var err;\n\n    function runNext() {\n      running++;\n      promiseFactories[current++]().then(onSuccess, onError);\n    }\n\n    function doNext() {\n      if (++done === len) {\n        /* istanbul ignore if */\n        if (err) {\n          reject(err);\n        } else {\n          resolve();\n        }\n      } else {\n        runNextBatch();\n      }\n    }\n\n    function onSuccess() {\n      running--;\n      doNext();\n    }\n\n    /* istanbul ignore next */\n    function onError(thisErr) {\n      running--;\n      err = err || thisErr;\n      doNext();\n    }\n\n    function runNextBatch() {\n      while (running < limit && current < len) {\n        runNext();\n      }\n    }\n\n    runNextBatch();\n  });\n}\n\nvar CHANGES_BATCH_SIZE = 25;\nvar MAX_SIMULTANEOUS_REVS = 50;\nvar CHANGES_TIMEOUT_BUFFER = 5000;\nvar DEFAULT_HEARTBEAT = 10000;\n\nvar supportsBulkGetMap = {};\n\nfunction readAttachmentsAsBlobOrBuffer(row) {\n  var doc = row.doc || row.ok;\n  var atts = doc._attachments;\n  if (!atts) {\n    return;\n  }\n  Object.keys(atts).forEach(function (filename) {\n    var att = atts[filename];\n    att.data = b64ToBluffer(att.data, att.content_type);\n  });\n}\n\nfunction encodeDocId(id) {\n  if (/^_design/.test(id)) {\n    return '_design/' + encodeURIComponent(id.slice(8));\n  }\n  if (/^_local/.test(id)) {\n    return '_local/' + encodeURIComponent(id.slice(7));\n  }\n  return encodeURIComponent(id);\n}\n\nfunction preprocessAttachments$1(doc) {\n  if (!doc._attachments || !Object.keys(doc._attachments)) {\n    return Promise.resolve();\n  }\n\n  return Promise.all(Object.keys(doc._attachments).map(function (key) {\n    var attachment = doc._attachments[key];\n    if (attachment.data && typeof attachment.data !== 'string') {\n      return new Promise(function (resolve) {\n        blobToBase64(attachment.data, resolve);\n      }).then(function (b64) {\n        attachment.data = b64;\n      });\n    }\n  }));\n}\n\nfunction hasUrlPrefix(opts) {\n  if (!opts.prefix) {\n    return false;\n  }\n  var protocol = parseUri(opts.prefix).protocol;\n  return protocol === 'http' || protocol === 'https';\n}\n\n// Get all the information you possibly can about the URI given by name and\n// return it as a suitable object.\nfunction getHost(name, opts) {\n  // encode db name if opts.prefix is a url (#5574)\n  if (hasUrlPrefix(opts)) {\n    var dbName = opts.name.substr(opts.prefix.length);\n    // Ensure prefix has a trailing slash\n    var prefix = opts.prefix.replace(/\\/?$/, '/');\n    name = prefix + encodeURIComponent(dbName);\n  }\n\n  var uri = parseUri(name);\n  if (uri.user || uri.password) {\n    uri.auth = {username: uri.user, password: uri.password};\n  }\n\n  // Split the path part of the URI into parts using '/' as the delimiter\n  // after removing any leading '/' and any trailing '/'\n  var parts = uri.path.replace(/(^\\/|\\/$)/g, '').split('/');\n\n  uri.db = parts.pop();\n  // Prevent double encoding of URI component\n  if (uri.db.indexOf('%') === -1) {\n    uri.db = encodeURIComponent(uri.db);\n  }\n\n  uri.path = parts.join('/');\n\n  return uri;\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genDBUrl(opts, path) {\n  return genUrl(opts, opts.db + '/' + path);\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genUrl(opts, path) {\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  var pathDel = !opts.path ? '' : '/';\n\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  return opts.protocol + '://' + opts.host +\n         (opts.port ? (':' + opts.port) : '') +\n         '/' + opts.path + pathDel + path;\n}\n\nfunction paramsToStr(params) {\n  return '?' + Object.keys(params).map(function (k) {\n    return k + '=' + encodeURIComponent(params[k]);\n  }).join('&');\n}\n\nfunction shouldCacheBust(opts) {\n  var ua = (typeof navigator !== 'undefined' && navigator.userAgent) ?\n      navigator.userAgent.toLowerCase() : '';\n  var isIE = ua.indexOf('msie') !== -1;\n  var isTrident = ua.indexOf('trident') !== -1;\n  var isEdge = ua.indexOf('edge') !== -1;\n  var isGET = !('method' in opts) || opts.method === 'GET';\n  return (isIE || isTrident || isEdge) && isGET;\n}\n\n// Implements the PouchDB API for dealing with CouchDB instances over HTTP\nfunction HttpPouch(opts, callback) {\n\n  // The functions that will be publicly available for HttpPouch\n  var api = this;\n\n  var host = getHost(opts.name, opts);\n  var dbUrl = genDBUrl(host, '');\n\n  opts = clone(opts);\n\n  var ourFetch = function (url, options) {\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (opts.auth || host.auth) {\n      var nAuth = opts.auth || host.auth;\n      var str = nAuth.username + ':' + nAuth.password;\n      var token = thisBtoa(unescape(encodeURIComponent(str)));\n      options.headers.set('Authorization', 'Basic ' + token);\n    }\n\n    var headers = opts.headers || {};\n    Object.keys(headers).forEach(function (key) {\n      options.headers.append(key, headers[key]);\n    });\n\n    /* istanbul ignore if */\n    if (shouldCacheBust(options)) {\n      url += (url.indexOf('?') === -1 ? '?' : '&') + '_nonce=' + Date.now();\n    }\n\n    var fetchFun = opts.fetch || f$1;\n    return fetchFun(url, options);\n  };\n\n  function adapterFun$$1(name, fun) {\n    return adapterFun(name, getArguments(function (args) {\n      setup().then(function () {\n        return fun.apply(this, args);\n      }).catch(function (e) {\n        var callback = args.pop();\n        callback(e);\n      });\n    })).bind(api);\n  }\n\n  function fetchJSON(url, options, callback) {\n\n    var result = {};\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (!options.headers.get('Content-Type')) {\n      options.headers.set('Content-Type', 'application/json');\n    }\n    if (!options.headers.get('Accept')) {\n      options.headers.set('Accept', 'application/json');\n    }\n\n    return ourFetch(url, options).then(function (response) {\n      result.ok = response.ok;\n      result.status = response.status;\n      return response.json();\n    }).then(function (json) {\n      result.data = json;\n      if (!result.ok) {\n        result.data.status = result.status;\n        var err = generateErrorFromResponse(result.data);\n        if (callback) {\n          return callback(err);\n        } else {\n          throw err;\n        }\n      }\n\n      if (Array.isArray(result.data)) {\n        result.data = result.data.map(function (v) {\n          if (v.error || v.missing) {\n            return generateErrorFromResponse(v);\n          } else {\n            return v;\n          }\n        });\n      }\n\n      if (callback) {\n        callback(null, result.data);\n      } else {\n        return result;\n      }\n    });\n  }\n\n  var setupPromise;\n\n  function setup() {\n    if (opts.skip_setup) {\n      return Promise.resolve();\n    }\n\n    // If there is a setup in process or previous successful setup\n    // done then we will use that\n    // If previous setups have been rejected we will try again\n    if (setupPromise) {\n      return setupPromise;\n    }\n\n    setupPromise = fetchJSON(dbUrl).catch(function (err) {\n      if (err && err.status && err.status === 404) {\n        // Doesnt exist, create it\n        explainError(404, 'PouchDB is just detecting if the remote exists.');\n        return fetchJSON(dbUrl, {method: 'PUT'});\n      } else {\n        return Promise.reject(err);\n      }\n    }).catch(function (err) {\n      // If we try to create a database that already exists, skipped in\n      // istanbul since its catching a race condition.\n      /* istanbul ignore if */\n      if (err && err.status && err.status === 412) {\n        return true;\n      }\n      return Promise.reject(err);\n    });\n\n    setupPromise.catch(function () {\n      setupPromise = null;\n    });\n\n    return setupPromise;\n  }\n\n  nextTick(function () {\n    callback(null, api);\n  });\n\n  api._remote = true;\n\n  /* istanbul ignore next */\n  api.type = function () {\n    return 'http';\n  };\n\n  api.id = adapterFun$$1('id', function (callback) {\n    ourFetch(genUrl(host, '')).then(function (response) {\n      return response.json();\n    }).then(function (result) {\n      var uuid$$1 = (result && result.uuid) ?\n          (result.uuid + host.db) : genDBUrl(host, '');\n      callback(null, uuid$$1);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Sends a POST request to the host calling the couchdb _compact function\n  //    version: The version of CouchDB it is running\n  api.compact = adapterFun$$1('compact', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    fetchJSON(genDBUrl(host, '_compact'), {method: 'POST'}).then(function () {\n      function ping() {\n        api.info(function (err, res) {\n          // CouchDB may send a \"compact_running:true\" if it's\n          // already compacting. PouchDB Server doesn't.\n          /* istanbul ignore else */\n          if (res && !res.compact_running) {\n            callback(null, {ok: true});\n          } else {\n            setTimeout(ping, opts.interval || 200);\n          }\n        });\n      }\n      // Ping the http if it's finished compaction\n      ping();\n    });\n  });\n\n  api.bulkGet = adapterFun('bulkGet', function (opts, callback) {\n    var self = this;\n\n    function doBulkGet(cb) {\n      var params = {};\n      if (opts.revs) {\n        params.revs = true;\n      }\n      if (opts.attachments) {\n        /* istanbul ignore next */\n        params.attachments = true;\n      }\n      if (opts.latest) {\n        params.latest = true;\n      }\n      fetchJSON(genDBUrl(host, '_bulk_get' + paramsToStr(params)), {\n        method: 'POST',\n        body: JSON.stringify({ docs: opts.docs})\n      }).then(function (result) {\n        if (opts.attachments && opts.binary) {\n          result.data.results.forEach(function (res) {\n            res.docs.forEach(readAttachmentsAsBlobOrBuffer);\n          });\n        }\n        cb(null, result.data);\n      }).catch(cb);\n    }\n\n    /* istanbul ignore next */\n    function doBulkGetShim() {\n      // avoid \"url too long error\" by splitting up into multiple requests\n      var batchSize = MAX_SIMULTANEOUS_REVS;\n      var numBatches = Math.ceil(opts.docs.length / batchSize);\n      var numDone = 0;\n      var results = new Array(numBatches);\n\n      function onResult(batchNum) {\n        return function (err, res) {\n          // err is impossible because shim returns a list of errs in that case\n          results[batchNum] = res.results;\n          if (++numDone === numBatches) {\n            callback(null, {results: flatten(results)});\n          }\n        };\n      }\n\n      for (var i = 0; i < numBatches; i++) {\n        var subOpts = pick(opts, ['revs', 'attachments', 'binary', 'latest']);\n        subOpts.docs = opts.docs.slice(i * batchSize,\n          Math.min(opts.docs.length, (i + 1) * batchSize));\n        bulkGet(self, subOpts, onResult(i));\n      }\n    }\n\n    // mark the whole database as either supporting or not supporting _bulk_get\n    var dbUrl = genUrl(host, '');\n    var supportsBulkGet = supportsBulkGetMap[dbUrl];\n\n    /* istanbul ignore next */\n    if (typeof supportsBulkGet !== 'boolean') {\n      // check if this database supports _bulk_get\n      doBulkGet(function (err, res) {\n        if (err) {\n          supportsBulkGetMap[dbUrl] = false;\n          explainError(\n            err.status,\n            'PouchDB is just detecting if the remote ' +\n            'supports the _bulk_get API.'\n          );\n          doBulkGetShim();\n        } else {\n          supportsBulkGetMap[dbUrl] = true;\n          callback(null, res);\n        }\n      });\n    } else if (supportsBulkGet) {\n      doBulkGet(callback);\n    } else {\n      doBulkGetShim();\n    }\n  });\n\n  // Calls GET on the host, which gets back a JSON string containing\n  //    couchdb: A welcome string\n  //    version: The version of CouchDB it is running\n  api._info = function (callback) {\n    setup().then(function () {\n      return ourFetch(genDBUrl(host, ''));\n    }).then(function (response) {\n      return response.json();\n    }).then(function (info) {\n      info.host = genDBUrl(host, '');\n      callback(null, info);\n    }).catch(callback);\n  };\n\n  api.fetch = function (path, options) {\n    return setup().then(function () {\n      return ourFetch(genDBUrl(host, path), options);\n    });\n  };\n\n  // Get the document with the given id from the database given by host.\n  // The id could be solely the _id in the database, or it may be a\n  // _design/ID or _local/ID path\n  api.get = adapterFun$$1('get', function (id, opts, callback) {\n    // If no options were given, set the callback to the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n\n    if (opts.revs) {\n      params.revs = true;\n    }\n\n    if (opts.revs_info) {\n      params.revs_info = true;\n    }\n\n    if (opts.latest) {\n      params.latest = true;\n    }\n\n    if (opts.open_revs) {\n      if (opts.open_revs !== \"all\") {\n        opts.open_revs = JSON.stringify(opts.open_revs);\n      }\n      params.open_revs = opts.open_revs;\n    }\n\n    if (opts.rev) {\n      params.rev = opts.rev;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = opts.conflicts;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = opts.update_seq;\n    }\n\n    id = encodeDocId(id);\n\n    function fetchAttachments(doc) {\n      var atts = doc._attachments;\n      var filenames = atts && Object.keys(atts);\n      if (!atts || !filenames.length) {\n        return;\n      }\n      // we fetch these manually in separate XHRs, because\n      // Sync Gateway would normally send it back as multipart/mixed,\n      // which we cannot parse. Also, this is more efficient than\n      // receiving attachments as base64-encoded strings.\n      function fetchData(filename) {\n        var att = atts[filename];\n        var path = encodeDocId(doc._id) + '/' + encodeAttachmentId(filename) +\n            '?rev=' + doc._rev;\n        return ourFetch(genDBUrl(host, path)).then(function (response) {\n          if (typeof process !== 'undefined' && !process.browser) {\n            return response.buffer();\n          } else {\n            /* istanbul ignore next */\n            return response.blob();\n          }\n        }).then(function (blob) {\n          if (opts.binary) {\n            // TODO: Can we remove this?\n            if (typeof process !== 'undefined' && !process.browser) {\n              blob.type = att.content_type;\n            }\n            return blob;\n          }\n          return new Promise(function (resolve) {\n            blobToBase64(blob, resolve);\n          });\n        }).then(function (data) {\n          delete att.stub;\n          delete att.length;\n          att.data = data;\n        });\n      }\n\n      var promiseFactories = filenames.map(function (filename) {\n        return function () {\n          return fetchData(filename);\n        };\n      });\n\n      // This limits the number of parallel xhr requests to 5 any time\n      // to avoid issues with maximum browser request limits\n      return pool(promiseFactories, 5);\n    }\n\n    function fetchAllAttachments(docOrDocs) {\n      if (Array.isArray(docOrDocs)) {\n        return Promise.all(docOrDocs.map(function (doc) {\n          if (doc.ok) {\n            return fetchAttachments(doc.ok);\n          }\n        }));\n      }\n      return fetchAttachments(docOrDocs);\n    }\n\n    var url = genDBUrl(host, id + paramsToStr(params));\n    fetchJSON(url).then(function (res) {\n      return Promise.resolve().then(function () {\n        if (opts.attachments) {\n          return fetchAllAttachments(res.data);\n        }\n      }).then(function () {\n        callback(null, res.data);\n      });\n    }).catch(function (e) {\n      e.docId = id;\n      callback(e);\n    });\n  });\n\n\n  // Delete the document given by doc from the database given by host.\n  api.remove = adapterFun$$1('remove', function (docOrId, optsOrRev, opts, cb) {\n    var doc;\n    if (typeof optsOrRev === 'string') {\n      // id, rev, opts, callback style\n      doc = {\n        _id: docOrId,\n        _rev: optsOrRev\n      };\n      if (typeof opts === 'function') {\n        cb = opts;\n        opts = {};\n      }\n    } else {\n      // doc, opts, callback style\n      doc = docOrId;\n      if (typeof optsOrRev === 'function') {\n        cb = optsOrRev;\n        opts = {};\n      } else {\n        cb = opts;\n        opts = optsOrRev;\n      }\n    }\n\n    var rev = (doc._rev || opts.rev);\n    var url = genDBUrl(host, encodeDocId(doc._id)) + '?rev=' + rev;\n\n    fetchJSON(url, {method: 'DELETE'}, cb).catch(cb);\n  });\n\n  function encodeAttachmentId(attachmentId) {\n    return attachmentId.split(\"/\").map(encodeURIComponent).join(\"/\");\n  }\n\n  // Get the attachment\n  api.getAttachment = adapterFun$$1('getAttachment', function (docId, attachmentId,\n                                                            opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var params = opts.rev ? ('?rev=' + opts.rev) : '';\n    var url = genDBUrl(host, encodeDocId(docId)) + '/' +\n        encodeAttachmentId(attachmentId) + params;\n    var contentType;\n    ourFetch(url, {method: 'GET'}).then(function (response) {\n      contentType = response.headers.get('content-type');\n      if (!response.ok) {\n        throw response;\n      } else {\n        if (typeof process !== 'undefined' && !process.browser) {\n          return response.buffer();\n        } else {\n          /* istanbul ignore next */\n          return response.blob();\n        }\n      }\n    }).then(function (blob) {\n      // TODO: also remove\n      if (typeof process !== 'undefined' && !process.browser) {\n        blob.type = contentType;\n      }\n      callback(null, blob);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Remove the attachment given by the id and rev\n  api.removeAttachment =  adapterFun$$1('removeAttachment', function (docId,\n                                                                   attachmentId,\n                                                                   rev,\n                                                                   callback) {\n    var url = genDBUrl(host, encodeDocId(docId) + '/' +\n                       encodeAttachmentId(attachmentId)) + '?rev=' + rev;\n    fetchJSON(url, {method: 'DELETE'}, callback).catch(callback);\n  });\n\n  // Add the attachment given by blob and its contentType property\n  // to the document with the given id, the revision given by rev, and\n  // add it to the database given by host.\n  api.putAttachment = adapterFun$$1('putAttachment', function (docId, attachmentId,\n                                                            rev, blob,\n                                                            type, callback) {\n    if (typeof type === 'function') {\n      callback = type;\n      type = blob;\n      blob = rev;\n      rev = null;\n    }\n    var id = encodeDocId(docId) + '/' + encodeAttachmentId(attachmentId);\n    var url = genDBUrl(host, id);\n    if (rev) {\n      url += '?rev=' + rev;\n    }\n\n    if (typeof blob === 'string') {\n      // input is assumed to be a base64 string\n      var binary;\n      try {\n        binary = thisAtob(blob);\n      } catch (err) {\n        return callback(createError(BAD_ARG,\n                        'Attachment is not a valid base64 string'));\n      }\n      blob = binary ? binStringToBluffer(binary, type) : '';\n    }\n\n    // Add the attachment\n    fetchJSON(url, {\n      headers: new h({'Content-Type': type}),\n      method: 'PUT',\n      body: blob\n    }, callback).catch(callback);\n  });\n\n  // Update/create multiple documents given by req in the database\n  // given by host.\n  api._bulkDocs = function (req, opts, callback) {\n    // If new_edits=false then it prevents the database from creating\n    // new revision numbers for the documents. Instead it just uses\n    // the old ones. This is used in database replication.\n    req.new_edits = opts.new_edits;\n\n    setup().then(function () {\n      return Promise.all(req.docs.map(preprocessAttachments$1));\n    }).then(function () {\n      // Update/create the documents\n      return fetchJSON(genDBUrl(host, '_bulk_docs'), {\n        method: 'POST',\n        body: JSON.stringify(req)\n      }, callback);\n    }).catch(callback);\n  };\n\n\n  // Update/create document\n  api._put = function (doc, opts, callback) {\n    setup().then(function () {\n      return preprocessAttachments$1(doc);\n    }).then(function () {\n      return fetchJSON(genDBUrl(host, encodeDocId(doc._id)), {\n        method: 'PUT',\n        body: JSON.stringify(doc)\n      });\n    }).then(function (result) {\n      callback(null, result.data);\n    }).catch(function (err) {\n      err.docId = doc && doc._id;\n      callback(err);\n    });\n  };\n\n\n  // Get a listing of the documents in the database given\n  // by host and ordered by increasing id.\n  api.allDocs = adapterFun$$1('allDocs', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n    var body;\n    var method = 'GET';\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    if (opts.include_docs) {\n      params.include_docs = true;\n    }\n\n    // added in CouchDB 1.6.0\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.key) {\n      params.key = JSON.stringify(opts.key);\n    }\n\n    if (opts.start_key) {\n      opts.startkey = opts.start_key;\n    }\n\n    if (opts.startkey) {\n      params.startkey = JSON.stringify(opts.startkey);\n    }\n\n    if (opts.end_key) {\n      opts.endkey = opts.end_key;\n    }\n\n    if (opts.endkey) {\n      params.endkey = JSON.stringify(opts.endkey);\n    }\n\n    if (typeof opts.inclusive_end !== 'undefined') {\n      params.inclusive_end = !!opts.inclusive_end;\n    }\n\n    if (typeof opts.limit !== 'undefined') {\n      params.limit = opts.limit;\n    }\n\n    if (typeof opts.skip !== 'undefined') {\n      params.skip = opts.skip;\n    }\n\n    var paramStr = paramsToStr(params);\n\n    if (typeof opts.keys !== 'undefined') {\n      method = 'POST';\n      body = {keys: opts.keys};\n    }\n\n    fetchJSON(genDBUrl(host, '_all_docs' + paramStr), {\n       method: method,\n      body: JSON.stringify(body)\n    }).then(function (result) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        result.data.rows.forEach(readAttachmentsAsBlobOrBuffer);\n      }\n      callback(null, result.data);\n    }).catch(callback);\n  });\n\n  // Get a list of changes made to documents in the database given by host.\n  // TODO According to the README, there should be two other methods here,\n  // api.changes.addListener and api.changes.removeListener.\n  api._changes = function (opts) {\n\n    // We internally page the results of a changes request, this means\n    // if there is a large set of changes to be returned we can start\n    // processing them quicker instead of waiting on the entire\n    // set of changes to return and attempting to process them at once\n    var batchSize = 'batch_size' in opts ? opts.batch_size : CHANGES_BATCH_SIZE;\n\n    opts = clone(opts);\n\n    if (opts.continuous && !('heartbeat' in opts)) {\n      opts.heartbeat = DEFAULT_HEARTBEAT;\n    }\n\n    var requestTimeout = ('timeout' in opts) ? opts.timeout : 30 * 1000;\n\n    // ensure CHANGES_TIMEOUT_BUFFER applies\n    if ('timeout' in opts && opts.timeout &&\n      (requestTimeout - opts.timeout) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.timeout + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    /* istanbul ignore if */\n    if ('heartbeat' in opts && opts.heartbeat &&\n       (requestTimeout - opts.heartbeat) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.heartbeat + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    var params = {};\n    if ('timeout' in opts && opts.timeout) {\n      params.timeout = opts.timeout;\n    }\n\n    var limit = (typeof opts.limit !== 'undefined') ? opts.limit : false;\n    var leftToFetch = limit;\n\n    if (opts.style) {\n      params.style = opts.style;\n    }\n\n    if (opts.include_docs || opts.filter && typeof opts.filter === 'function') {\n      params.include_docs = true;\n    }\n\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.continuous) {\n      params.feed = 'longpoll';\n    }\n\n    if (opts.seq_interval) {\n      params.seq_interval = opts.seq_interval;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n    \n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if ('heartbeat' in opts) {\n      // If the heartbeat value is false, it disables the default heartbeat\n      if (opts.heartbeat) {\n        params.heartbeat = opts.heartbeat;\n      }\n    }\n\n    if (opts.filter && typeof opts.filter === 'string') {\n      params.filter = opts.filter;\n    }\n\n    if (opts.view && typeof opts.view === 'string') {\n      params.filter = '_view';\n      params.view = opts.view;\n    }\n\n    // If opts.query_params exists, pass it through to the changes request.\n    // These parameters may be used by the filter on the source database.\n    if (opts.query_params && typeof opts.query_params === 'object') {\n      for (var param_name in opts.query_params) {\n        /* istanbul ignore else */\n        if (opts.query_params.hasOwnProperty(param_name)) {\n          params[param_name] = opts.query_params[param_name];\n        }\n      }\n    }\n\n    var method = 'GET';\n    var body;\n\n    if (opts.doc_ids) {\n      // set this automagically for the user; it's annoying that couchdb\n      // requires both a \"filter\" and a \"doc_ids\" param.\n      params.filter = '_doc_ids';\n      method = 'POST';\n      body = {doc_ids: opts.doc_ids };\n    }\n    /* istanbul ignore next */\n    else if (opts.selector) {\n      // set this automagically for the user, similar to above\n      params.filter = '_selector';\n      method = 'POST';\n      body = {selector: opts.selector };\n    }\n\n    var controller = new a();\n    var lastFetchedSeq;\n\n    // Get all the changes starting wtih the one immediately after the\n    // sequence number given by since.\n    var fetchData = function (since, callback) {\n      if (opts.aborted) {\n        return;\n      }\n      params.since = since;\n      // \"since\" can be any kind of json object in Cloudant/CouchDB 2.x\n      /* istanbul ignore next */\n      if (typeof params.since === \"object\") {\n        params.since = JSON.stringify(params.since);\n      }\n\n      if (opts.descending) {\n        if (limit) {\n          params.limit = leftToFetch;\n        }\n      } else {\n        params.limit = (!limit || leftToFetch > batchSize) ?\n          batchSize : leftToFetch;\n      }\n\n      // Set the options for the ajax call\n      var url = genDBUrl(host, '_changes' + paramsToStr(params));\n      var fetchOpts = {\n        signal: controller.signal,\n        method: method,\n        body: JSON.stringify(body)\n      };\n      lastFetchedSeq = since;\n\n      /* istanbul ignore if */\n      if (opts.aborted) {\n        return;\n      }\n\n      // Get the changes\n      setup().then(function () {\n        return fetchJSON(url, fetchOpts, callback);\n      }).catch(callback);\n    };\n\n    // If opts.since exists, get all the changes from the sequence\n    // number given by opts.since. Otherwise, get all the changes\n    // from the sequence number 0.\n    var results = {results: []};\n\n    var fetched = function (err, res) {\n      if (opts.aborted) {\n        return;\n      }\n      var raw_results_length = 0;\n      // If the result of the ajax call (res) contains changes (res.results)\n      if (res && res.results) {\n        raw_results_length = res.results.length;\n        results.last_seq = res.last_seq;\n        var pending = null;\n        var lastSeq = null;\n        // Attach 'pending' property if server supports it (CouchDB 2.0+)\n        /* istanbul ignore if */\n        if (typeof res.pending === 'number') {\n          pending = res.pending;\n        }\n        if (typeof results.last_seq === 'string' || typeof results.last_seq === 'number') {\n          lastSeq = results.last_seq;\n        }\n        // For each change\n        var req = {};\n        req.query = opts.query_params;\n        res.results = res.results.filter(function (c) {\n          leftToFetch--;\n          var ret = filterChange(opts)(c);\n          if (ret) {\n            if (opts.include_docs && opts.attachments && opts.binary) {\n              readAttachmentsAsBlobOrBuffer(c);\n            }\n            if (opts.return_docs) {\n              results.results.push(c);\n            }\n            opts.onChange(c, pending, lastSeq);\n          }\n          return ret;\n        });\n      } else if (err) {\n        // In case of an error, stop listening for changes and call\n        // opts.complete\n        opts.aborted = true;\n        opts.complete(err);\n        return;\n      }\n\n      // The changes feed may have timed out with no results\n      // if so reuse last update sequence\n      if (res && res.last_seq) {\n        lastFetchedSeq = res.last_seq;\n      }\n\n      var finished = (limit && leftToFetch <= 0) ||\n        (res && raw_results_length < batchSize) ||\n        (opts.descending);\n\n      if ((opts.continuous && !(limit && leftToFetch <= 0)) || !finished) {\n        // Queue a call to fetch again with the newest sequence number\n        nextTick(function () { fetchData(lastFetchedSeq, fetched); });\n      } else {\n        // We're done, call the callback\n        opts.complete(null, results);\n      }\n    };\n\n    fetchData(opts.since || 0, fetched);\n\n    // Return a method to cancel this method from processing any more\n    return {\n      cancel: function () {\n        opts.aborted = true;\n        controller.abort();\n      }\n    };\n  };\n\n  // Given a set of document/revision IDs (given by req), tets the subset of\n  // those that do NOT correspond to revisions stored in the database.\n  // See http://wiki.apache.org/couchdb/HttpPostRevsDiff\n  api.revsDiff = adapterFun$$1('revsDiff', function (req, opts, callback) {\n    // If no options were given, set the callback to be the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n\n    // Get the missing document/revision IDs\n    fetchJSON(genDBUrl(host, '_revs_diff'), {\n      method: 'POST',\n      body: JSON.stringify(req)\n    }, callback).catch(callback);\n  });\n\n  api._close = function (callback) {\n    callback();\n  };\n\n  api._destroy = function (options, callback) {\n    fetchJSON(genDBUrl(host, ''), {method: 'DELETE'}).then(function (json) {\n      callback(null, json);\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status === 404) {\n        callback(null, {ok: true});\n      } else {\n        callback(err);\n      }\n    });\n  };\n}\n\n// HttpPouch is a valid adapter.\nHttpPouch.valid = function () {\n  return true;\n};\n\nfunction HttpPouch$1 (PouchDB) {\n  PouchDB.adapter('http', HttpPouch, false);\n  PouchDB.adapter('https', HttpPouch, false);\n}\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      nextTick(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      nextTick(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new ExportedSet(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nfunction createBuiltInError(name) {\n  var message = 'builtin ' + name +\n    ' function requires map values to be numbers' +\n    ' or number arrays';\n  return new BuiltInError(message);\n}\n\nfunction sum(values) {\n  var result = 0;\n  for (var i = 0, len = values.length; i < len; i++) {\n    var num = values[i];\n    if (typeof num !== 'number') {\n      if (Array.isArray(num)) {\n        // lists of numbers are also allowed, sum them separately\n        result = typeof result === 'number' ? [result] : result;\n        for (var j = 0, jLen = num.length; j < jLen; j++) {\n          var jNum = num[j];\n          if (typeof jNum !== 'number') {\n            throw createBuiltInError('_sum');\n          } else if (typeof result[j] === 'undefined') {\n            result.push(jNum);\n          } else {\n            result[j] += jNum;\n          }\n        }\n      } else { // not array/number\n        throw createBuiltInError('_sum');\n      }\n    } else if (typeof result === 'number') {\n      result += num;\n    } else { // add number to array\n      result[0] += num;\n    }\n  }\n  return result;\n}\n\nvar log = guardedConsole.bind(null, 'log');\nvar isArray = Array.isArray;\nvar toJSON = JSON.parse;\n\nfunction evalFunctionWithEval(func, emit) {\n  return scopeEval(\n    \"return (\" + func.replace(/;\\s*$/, \"\") + \");\",\n    {\n      emit: emit,\n      sum: sum,\n      log: log,\n      isArray: isArray,\n      toJSON: toJSON\n    }\n  );\n}\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue$1() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue$1.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue$1.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue$1();\nvar CHANGES_BATCH_SIZE$1 = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = b64ToBluffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new h({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new ExportedSet();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue$1();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue$1();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE$1\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE$1) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new ExportedMap();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new ExportedMap();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new ExportedMap();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new ExportedMap();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new ExportedSet();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              nextTick(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nvar builtInReduce = {\n  _sum: function (keys, values) {\n    return sum(values);\n  },\n\n  _count: function (keys, values) {\n    return values.length;\n  },\n\n  _stats: function (keys, values) {\n    // no need to implement rereduce=true, because Pouch\n    // will never call it\n    function sumsqr(values) {\n      var _sumsqr = 0;\n      for (var i = 0, len = values.length; i < len; i++) {\n        var num = values[i];\n        _sumsqr += (num * num);\n      }\n      return _sumsqr;\n    }\n    return {\n      sum     : sum(values),\n      min     : Math.min.apply(null, values),\n      max     : Math.max.apply(null, values),\n      count   : values.length,\n      sumsqr : sumsqr(values)\n    };\n  }\n};\n\nfunction getBuiltIn(reduceFunString) {\n  if (/^_sum/.test(reduceFunString)) {\n    return builtInReduce._sum;\n  } else if (/^_count/.test(reduceFunString)) {\n    return builtInReduce._count;\n  } else if (/^_stats/.test(reduceFunString)) {\n    return builtInReduce._stats;\n  } else if (/^_/.test(reduceFunString)) {\n    throw new Error(reduceFunString + ' is not a supported reduce function.');\n  }\n}\n\nfunction mapper(mapFun, emit) {\n  // for temp_views one can use emit(doc, emit), see #38\n  if (typeof mapFun === \"function\" && mapFun.length === 2) {\n    var origMap = mapFun;\n    return function (doc) {\n      return origMap(doc, emit);\n    };\n  } else {\n    return evalFunctionWithEval(mapFun.toString(), emit);\n  }\n}\n\nfunction reducer(reduceFun) {\n  var reduceFunString = reduceFun.toString();\n  var builtIn = getBuiltIn(reduceFunString);\n  if (builtIn) {\n    return builtIn;\n  } else {\n    return evalFunctionWithEval(reduceFunString);\n  }\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var fun = ddoc.views && ddoc.views[viewName];\n  if (typeof fun.map !== 'string') {\n    throw new NotFoundError('ddoc ' + ddoc._id + ' has no string view named ' +\n      viewName + ', instead found object of type: ' + typeof fun.map);\n  }\n}\n\nvar localDocName = 'mrviews';\nvar abstract = createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator);\n\nfunction query(fun, opts, callback) {\n  return abstract.query.call(this, fun, opts, callback);\n}\n\nfunction viewCleanup(callback) {\n  return abstract.viewCleanup.call(this, callback);\n}\n\nvar mapreduce = {\n  query: query,\n  viewCleanup: viewCleanup\n};\n\nfunction isGenOne$1(rev) {\n  return /^1-/.test(rev);\n}\n\nfunction fileHasChanged(localDoc, remoteDoc, filename) {\n  return !localDoc._attachments ||\n         !localDoc._attachments[filename] ||\n         localDoc._attachments[filename].digest !== remoteDoc._attachments[filename].digest;\n}\n\nfunction getDocAttachments(db, doc) {\n  var filenames = Object.keys(doc._attachments);\n  return Promise.all(filenames.map(function (filename) {\n    return db.getAttachment(doc._id, filename, {rev: doc._rev});\n  }));\n}\n\nfunction getDocAttachmentsFromTargetOrSource(target, src, doc) {\n  var doCheckForLocalAttachments = isRemote(src) && !isRemote(target);\n  var filenames = Object.keys(doc._attachments);\n\n  if (!doCheckForLocalAttachments) {\n    return getDocAttachments(src, doc);\n  }\n\n  return target.get(doc._id).then(function (localDoc) {\n    return Promise.all(filenames.map(function (filename) {\n      if (fileHasChanged(localDoc, doc, filename)) {\n        return src.getAttachment(doc._id, filename);\n      }\n\n      return target.getAttachment(localDoc._id, filename);\n    }));\n  }).catch(function (error) {\n    /* istanbul ignore if */\n    if (error.status !== 404) {\n      throw error;\n    }\n\n    return getDocAttachments(src, doc);\n  });\n}\n\nfunction createBulkGetOpts(diffs) {\n  var requests = [];\n  Object.keys(diffs).forEach(function (id) {\n    var missingRevs = diffs[id].missing;\n    missingRevs.forEach(function (missingRev) {\n      requests.push({\n        id: id,\n        rev: missingRev\n      });\n    });\n  });\n\n  return {\n    docs: requests,\n    revs: true,\n    latest: true\n  };\n}\n\n//\n// Fetch all the documents from the src as described in the \"diffs\",\n// which is a mapping of docs IDs to revisions. If the state ever\n// changes to \"cancelled\", then the returned promise will be rejected.\n// Else it will be resolved with a list of fetched documents.\n//\nfunction getDocs(src, target, diffs, state) {\n  diffs = clone(diffs); // we do not need to modify this\n\n  var resultDocs = [],\n      ok = true;\n\n  function getAllDocs() {\n\n    var bulkGetOpts = createBulkGetOpts(diffs);\n\n    if (!bulkGetOpts.docs.length) { // optimization: skip empty requests\n      return;\n    }\n\n    return src.bulkGet(bulkGetOpts).then(function (bulkGetResponse) {\n      /* istanbul ignore if */\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      return Promise.all(bulkGetResponse.results.map(function (bulkGetInfo) {\n        return Promise.all(bulkGetInfo.docs.map(function (doc) {\n          var remoteDoc = doc.ok;\n\n          if (doc.error) {\n            // when AUTO_COMPACTION is set, docs can be returned which look\n            // like this: {\"missing\":\"1-7c3ac256b693c462af8442f992b83696\"}\n            ok = false;\n          }\n\n          if (!remoteDoc || !remoteDoc._attachments) {\n            return remoteDoc;\n          }\n\n          return getDocAttachmentsFromTargetOrSource(target, src, remoteDoc)\n                   .then(function (attachments) {\n                           var filenames = Object.keys(remoteDoc._attachments);\n                           attachments\n                             .forEach(function (attachment, i) {\n                                        var att = remoteDoc._attachments[filenames[i]];\n                                        delete att.stub;\n                                        delete att.length;\n                                        att.data = attachment;\n                                      });\n\n                                      return remoteDoc;\n                                    });\n        }));\n      }))\n\n      .then(function (results) {\n        resultDocs = resultDocs.concat(flatten(results).filter(Boolean));\n      });\n    });\n  }\n\n  function hasAttachments(doc) {\n    return doc._attachments && Object.keys(doc._attachments).length > 0;\n  }\n\n  function hasConflicts(doc) {\n    return doc._conflicts && doc._conflicts.length > 0;\n  }\n\n  function fetchRevisionOneDocs(ids) {\n    // Optimization: fetch gen-1 docs and attachments in\n    // a single request using _all_docs\n    return src.allDocs({\n      keys: ids,\n      include_docs: true,\n      conflicts: true\n    }).then(function (res) {\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      res.rows.forEach(function (row) {\n        if (row.deleted || !row.doc || !isGenOne$1(row.value.rev) ||\n            hasAttachments(row.doc) || hasConflicts(row.doc)) {\n          // if any of these conditions apply, we need to fetch using get()\n          return;\n        }\n\n        // strip _conflicts array to appease CSG (#5793)\n        /* istanbul ignore if */\n        if (row.doc._conflicts) {\n          delete row.doc._conflicts;\n        }\n\n        // the doc we got back from allDocs() is sufficient\n        resultDocs.push(row.doc);\n        delete diffs[row.id];\n      });\n    });\n  }\n\n  function getRevisionOneDocs() {\n    // filter out the generation 1 docs and get them\n    // leaving the non-generation one docs to be got otherwise\n    var ids = Object.keys(diffs).filter(function (id) {\n      var missing = diffs[id].missing;\n      return missing.length === 1 && isGenOne$1(missing[0]);\n    });\n    if (ids.length > 0) {\n      return fetchRevisionOneDocs(ids);\n    }\n  }\n\n  function returnResult() {\n    return { ok:ok, docs:resultDocs };\n  }\n\n  return Promise.resolve()\n    .then(getRevisionOneDocs)\n    .then(getAllDocs)\n    .then(returnResult);\n}\n\nvar CHECKPOINT_VERSION = 1;\nvar REPLICATOR = \"pouchdb\";\n// This is an arbitrary number to limit the\n// amount of replication history we save in the checkpoint.\n// If we save too much, the checkpoing docs will become very big,\n// if we save fewer, we'll run a greater risk of having to\n// read all the changes from 0 when checkpoint PUTs fail\n// CouchDB 2.0 has a more involved history pruning,\n// but let's go for the simple version for now.\nvar CHECKPOINT_HISTORY_SIZE = 5;\nvar LOWEST_SEQ = 0;\n\nfunction updateCheckpoint(db, id, checkpoint, session, returnValue) {\n  return db.get(id).catch(function (err) {\n    if (err.status === 404) {\n      if (db.adapter === 'http' || db.adapter === 'https') {\n        explainError(\n          404, 'PouchDB is just checking if a remote checkpoint exists.'\n        );\n      }\n      return {\n        session_id: session,\n        _id: id,\n        history: [],\n        replicator: REPLICATOR,\n        version: CHECKPOINT_VERSION\n      };\n    }\n    throw err;\n  }).then(function (doc) {\n    if (returnValue.cancelled) {\n      return;\n    }\n\n    // if the checkpoint has not changed, do not update\n    if (doc.last_seq === checkpoint) {\n      return;\n    }\n\n    // Filter out current entry for this replication\n    doc.history = (doc.history || []).filter(function (item) {\n      return item.session_id !== session;\n    });\n\n    // Add the latest checkpoint to history\n    doc.history.unshift({\n      last_seq: checkpoint,\n      session_id: session\n    });\n\n    // Just take the last pieces in history, to\n    // avoid really big checkpoint docs.\n    // see comment on history size above\n    doc.history = doc.history.slice(0, CHECKPOINT_HISTORY_SIZE);\n\n    doc.version = CHECKPOINT_VERSION;\n    doc.replicator = REPLICATOR;\n\n    doc.session_id = session;\n    doc.last_seq = checkpoint;\n\n    return db.put(doc).catch(function (err) {\n      if (err.status === 409) {\n        // retry; someone is trying to write a checkpoint simultaneously\n        return updateCheckpoint(db, id, checkpoint, session, returnValue);\n      }\n      throw err;\n    });\n  });\n}\n\nfunction Checkpointer(src, target, id, returnValue, opts) {\n  this.src = src;\n  this.target = target;\n  this.id = id;\n  this.returnValue = returnValue;\n  this.opts = opts || {};\n}\n\nCheckpointer.prototype.writeCheckpoint = function (checkpoint, session) {\n  var self = this;\n  return this.updateTarget(checkpoint, session).then(function () {\n    return self.updateSource(checkpoint, session);\n  });\n};\n\nCheckpointer.prototype.updateTarget = function (checkpoint, session) {\n  if (this.opts.writeTargetCheckpoint) {\n    return updateCheckpoint(this.target, this.id, checkpoint,\n      session, this.returnValue);\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nCheckpointer.prototype.updateSource = function (checkpoint, session) {\n  if (this.opts.writeSourceCheckpoint) {\n    var self = this;\n    return updateCheckpoint(this.src, this.id, checkpoint,\n      session, this.returnValue)\n      .catch(function (err) {\n        if (isForbiddenError(err)) {\n          self.opts.writeSourceCheckpoint = false;\n          return true;\n        }\n        throw err;\n      });\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nvar comparisons = {\n  \"undefined\": function (targetDoc, sourceDoc) {\n    // This is the previous comparison function\n    if (collate(targetDoc.last_seq, sourceDoc.last_seq) === 0) {\n      return sourceDoc.last_seq;\n    }\n    /* istanbul ignore next */\n    return 0;\n  },\n  \"1\": function (targetDoc, sourceDoc) {\n    // This is the comparison function ported from CouchDB\n    return compareReplicationLogs(sourceDoc, targetDoc).last_seq;\n  }\n};\n\nCheckpointer.prototype.getCheckpoint = function () {\n  var self = this;\n\n  if (self.opts && self.opts.writeSourceCheckpoint && !self.opts.writeTargetCheckpoint) {\n    return self.src.get(self.id).then(function (sourceDoc) {\n      return sourceDoc.last_seq || LOWEST_SEQ;\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        throw err;\n      }\n      return LOWEST_SEQ;\n    });\n  }\n\n  return self.target.get(self.id).then(function (targetDoc) {\n    if (self.opts && self.opts.writeTargetCheckpoint && !self.opts.writeSourceCheckpoint) {\n      return targetDoc.last_seq || LOWEST_SEQ;\n    }\n\n    return self.src.get(self.id).then(function (sourceDoc) {\n      // Since we can't migrate an old version doc to a new one\n      // (no session id), we just go with the lowest seq in this case\n      /* istanbul ignore if */\n      if (targetDoc.version !== sourceDoc.version) {\n        return LOWEST_SEQ;\n      }\n\n      var version;\n      if (targetDoc.version) {\n        version = targetDoc.version.toString();\n      } else {\n        version = \"undefined\";\n      }\n\n      if (version in comparisons) {\n        return comparisons[version](targetDoc, sourceDoc);\n      }\n      /* istanbul ignore next */\n      return LOWEST_SEQ;\n    }, function (err) {\n      if (err.status === 404 && targetDoc.last_seq) {\n        return self.src.put({\n          _id: self.id,\n          last_seq: LOWEST_SEQ\n        }).then(function () {\n          return LOWEST_SEQ;\n        }, function (err) {\n          if (isForbiddenError(err)) {\n            self.opts.writeSourceCheckpoint = false;\n            return targetDoc.last_seq;\n          }\n          /* istanbul ignore next */\n          return LOWEST_SEQ;\n        });\n      }\n      throw err;\n    });\n  }).catch(function (err) {\n    if (err.status !== 404) {\n      throw err;\n    }\n    return LOWEST_SEQ;\n  });\n};\n// This checkpoint comparison is ported from CouchDBs source\n// they come from here:\n// https://github.com/apache/couchdb-couch-replicator/blob/master/src/couch_replicator.erl#L863-L906\n\nfunction compareReplicationLogs(srcDoc, tgtDoc) {\n  if (srcDoc.session_id === tgtDoc.session_id) {\n    return {\n      last_seq: srcDoc.last_seq,\n      history: srcDoc.history\n    };\n  }\n\n  return compareReplicationHistory(srcDoc.history, tgtDoc.history);\n}\n\nfunction compareReplicationHistory(sourceHistory, targetHistory) {\n  // the erlang loop via function arguments is not so easy to repeat in JS\n  // therefore, doing this as recursion\n  var S = sourceHistory[0];\n  var sourceRest = sourceHistory.slice(1);\n  var T = targetHistory[0];\n  var targetRest = targetHistory.slice(1);\n\n  if (!S || targetHistory.length === 0) {\n    return {\n      last_seq: LOWEST_SEQ,\n      history: []\n    };\n  }\n\n  var sourceId = S.session_id;\n  /* istanbul ignore if */\n  if (hasSessionId(sourceId, targetHistory)) {\n    return {\n      last_seq: S.last_seq,\n      history: sourceHistory\n    };\n  }\n\n  var targetId = T.session_id;\n  if (hasSessionId(targetId, sourceRest)) {\n    return {\n      last_seq: T.last_seq,\n      history: targetRest\n    };\n  }\n\n  return compareReplicationHistory(sourceRest, targetRest);\n}\n\nfunction hasSessionId(sessionId, history) {\n  var props = history[0];\n  var rest = history.slice(1);\n\n  if (!sessionId || history.length === 0) {\n    return false;\n  }\n\n  if (sessionId === props.session_id) {\n    return true;\n  }\n\n  return hasSessionId(sessionId, rest);\n}\n\nfunction isForbiddenError(err) {\n  return typeof err.status === 'number' && Math.floor(err.status / 100) === 4;\n}\n\nvar STARTING_BACK_OFF = 0;\n\nfunction backOff(opts, returnValue, error, callback) {\n  if (opts.retry === false) {\n    returnValue.emit('error', error);\n    returnValue.removeAllListeners();\n    return;\n  }\n  /* istanbul ignore if */\n  if (typeof opts.back_off_function !== 'function') {\n    opts.back_off_function = defaultBackOff;\n  }\n  returnValue.emit('requestError', error);\n  if (returnValue.state === 'active' || returnValue.state === 'pending') {\n    returnValue.emit('paused', error);\n    returnValue.state = 'stopped';\n    var backOffSet = function backoffTimeSet() {\n      opts.current_back_off = STARTING_BACK_OFF;\n    };\n    var removeBackOffSetter = function removeBackOffTimeSet() {\n      returnValue.removeListener('active', backOffSet);\n    };\n    returnValue.once('paused', removeBackOffSetter);\n    returnValue.once('active', backOffSet);\n  }\n\n  opts.current_back_off = opts.current_back_off || STARTING_BACK_OFF;\n  opts.current_back_off = opts.back_off_function(opts.current_back_off);\n  setTimeout(callback, opts.current_back_off);\n}\n\nfunction sortObjectPropertiesByKey(queryParams) {\n  return Object.keys(queryParams).sort(collate).reduce(function (result, key) {\n    result[key] = queryParams[key];\n    return result;\n  }, {});\n}\n\n// Generate a unique id particular to this replication.\n// Not guaranteed to align perfectly with CouchDB's rep ids.\nfunction generateReplicationId(src, target, opts) {\n  var docIds = opts.doc_ids ? opts.doc_ids.sort(collate) : '';\n  var filterFun = opts.filter ? opts.filter.toString() : '';\n  var queryParams = '';\n  var filterViewName =  '';\n  var selector = '';\n\n  // possibility for checkpoints to be lost here as behaviour of\n  // JSON.stringify is not stable (see #6226)\n  /* istanbul ignore if */\n  if (opts.selector) {\n    selector = JSON.stringify(opts.selector);\n  }\n\n  if (opts.filter && opts.query_params) {\n    queryParams = JSON.stringify(sortObjectPropertiesByKey(opts.query_params));\n  }\n\n  if (opts.filter && opts.filter === '_view') {\n    filterViewName = opts.view.toString();\n  }\n\n  return Promise.all([src.id(), target.id()]).then(function (res) {\n    var queryData = res[0] + res[1] + filterFun + filterViewName +\n      queryParams + docIds + selector;\n    return new Promise(function (resolve) {\n      binaryMd5(queryData, resolve);\n    });\n  }).then(function (md5sum) {\n    // can't use straight-up md5 alphabet, because\n    // the char '/' is interpreted as being for attachments,\n    // and + is also not url-safe\n    md5sum = md5sum.replace(/\\//g, '.').replace(/\\+/g, '_');\n    return '_local/' + md5sum;\n  });\n}\n\nfunction replicate(src, target, opts, returnValue, result) {\n  var batches = [];               // list of batches to be processed\n  var currentBatch;               // the batch currently being processed\n  var pendingBatch = {\n    seq: 0,\n    changes: [],\n    docs: []\n  }; // next batch, not yet ready to be processed\n  var writingCheckpoint = false;  // true while checkpoint is being written\n  var changesCompleted = false;   // true when all changes received\n  var replicationCompleted = false; // true when replication has completed\n  var last_seq = 0;\n  var continuous = opts.continuous || opts.live || false;\n  var batch_size = opts.batch_size || 100;\n  var batches_limit = opts.batches_limit || 10;\n  var changesPending = false;     // true while src.changes is running\n  var doc_ids = opts.doc_ids;\n  var selector = opts.selector;\n  var repId;\n  var checkpointer;\n  var changedDocs = [];\n  // Like couchdb, every replication gets a unique session id\n  var session = uuid();\n\n  result = result || {\n    ok: true,\n    start_time: new Date().toISOString(),\n    docs_read: 0,\n    docs_written: 0,\n    doc_write_failures: 0,\n    errors: []\n  };\n\n  var changesOpts = {};\n  returnValue.ready(src, target);\n\n  function initCheckpointer() {\n    if (checkpointer) {\n      return Promise.resolve();\n    }\n    return generateReplicationId(src, target, opts).then(function (res) {\n      repId = res;\n\n      var checkpointOpts = {};\n      if (opts.checkpoint === false) {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'source') {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'target') {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: true };\n      } else {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: true };\n      }\n\n      checkpointer = new Checkpointer(src, target, repId, returnValue, checkpointOpts);\n    });\n  }\n\n  function writeDocs() {\n    changedDocs = [];\n\n    if (currentBatch.docs.length === 0) {\n      return;\n    }\n    var docs = currentBatch.docs;\n    var bulkOpts = {timeout: opts.timeout};\n    return target.bulkDocs({docs: docs, new_edits: false}, bulkOpts).then(function (res) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n\n      // `res` doesn't include full documents (which live in `docs`), so we create a map of \n      // (id -> error), and check for errors while iterating over `docs`\n      var errorsById = Object.create(null);\n      res.forEach(function (res) {\n        if (res.error) {\n          errorsById[res.id] = res;\n        }\n      });\n\n      var errorsNo = Object.keys(errorsById).length;\n      result.doc_write_failures += errorsNo;\n      result.docs_written += docs.length - errorsNo;\n\n      docs.forEach(function (doc) {\n        var error = errorsById[doc._id];\n        if (error) {\n          result.errors.push(error);\n          // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n          var errorName = (error.name || '').toLowerCase();\n          if (errorName === 'unauthorized' || errorName === 'forbidden') {\n            returnValue.emit('denied', clone(error));\n          } else {\n            throw error;\n          }\n        } else {\n          changedDocs.push(doc);\n        }\n      });\n\n    }, function (err) {\n      result.doc_write_failures += docs.length;\n      throw err;\n    });\n  }\n\n  function finishBatch() {\n    if (currentBatch.error) {\n      throw new Error('There was a problem getting docs.');\n    }\n    result.last_seq = last_seq = currentBatch.seq;\n    var outResult = clone(result);\n    if (changedDocs.length) {\n      outResult.docs = changedDocs;\n      // Attach 'pending' property if server supports it (CouchDB 2.0+)\n      /* istanbul ignore if */\n      if (typeof currentBatch.pending === 'number') {\n        outResult.pending = currentBatch.pending;\n        delete currentBatch.pending;\n      }\n      returnValue.emit('change', outResult);\n    }\n    writingCheckpoint = true;\n    return checkpointer.writeCheckpoint(currentBatch.seq,\n        session).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      currentBatch = undefined;\n      getChanges();\n    }).catch(function (err) {\n      onCheckpointError(err);\n      throw err;\n    });\n  }\n\n  function getDiffs() {\n    var diff = {};\n    currentBatch.changes.forEach(function (change) {\n      // Couchbase Sync Gateway emits these, but we can ignore them\n      /* istanbul ignore if */\n      if (change.id === \"_user/\") {\n        return;\n      }\n      diff[change.id] = change.changes.map(function (x) {\n        return x.rev;\n      });\n    });\n    return target.revsDiff(diff).then(function (diffs) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      // currentBatch.diffs elements are deleted as the documents are written\n      currentBatch.diffs = diffs;\n    });\n  }\n\n  function getBatchDocs() {\n    return getDocs(src, target, currentBatch.diffs, returnValue).then(function (got) {\n      currentBatch.error = !got.ok;\n      got.docs.forEach(function (doc) {\n        delete currentBatch.diffs[doc._id];\n        result.docs_read++;\n        currentBatch.docs.push(doc);\n      });\n    });\n  }\n\n  function startNextBatch() {\n    if (returnValue.cancelled || currentBatch) {\n      return;\n    }\n    if (batches.length === 0) {\n      processPendingBatch(true);\n      return;\n    }\n    currentBatch = batches.shift();\n    getDiffs()\n      .then(getBatchDocs)\n      .then(writeDocs)\n      .then(finishBatch)\n      .then(startNextBatch)\n      .catch(function (err) {\n        abortReplication('batch processing terminated with error', err);\n      });\n  }\n\n\n  function processPendingBatch(immediate) {\n    if (pendingBatch.changes.length === 0) {\n      if (batches.length === 0 && !currentBatch) {\n        if ((continuous && changesOpts.live) || changesCompleted) {\n          returnValue.state = 'pending';\n          returnValue.emit('paused');\n        }\n        if (changesCompleted) {\n          completeReplication();\n        }\n      }\n      return;\n    }\n    if (\n      immediate ||\n      changesCompleted ||\n      pendingBatch.changes.length >= batch_size\n    ) {\n      batches.push(pendingBatch);\n      pendingBatch = {\n        seq: 0,\n        changes: [],\n        docs: []\n      };\n      if (returnValue.state === 'pending' || returnValue.state === 'stopped') {\n        returnValue.state = 'active';\n        returnValue.emit('active');\n      }\n      startNextBatch();\n    }\n  }\n\n\n  function abortReplication(reason, err) {\n    if (replicationCompleted) {\n      return;\n    }\n    if (!err.message) {\n      err.message = reason;\n    }\n    result.ok = false;\n    result.status = 'aborting';\n    batches = [];\n    pendingBatch = {\n      seq: 0,\n      changes: [],\n      docs: []\n    };\n    completeReplication(err);\n  }\n\n\n  function completeReplication(fatalError) {\n    if (replicationCompleted) {\n      return;\n    }\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      result.status = 'cancelled';\n      if (writingCheckpoint) {\n        return;\n      }\n    }\n    result.status = result.status || 'complete';\n    result.end_time = new Date().toISOString();\n    result.last_seq = last_seq;\n    replicationCompleted = true;\n\n    if (fatalError) {\n      // need to extend the error because Firefox considers \".result\" read-only\n      fatalError = createError(fatalError);\n      fatalError.result = result;\n\n      // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n      var errorName = (fatalError.name || '').toLowerCase();\n      if (errorName === 'unauthorized' || errorName === 'forbidden') {\n        returnValue.emit('error', fatalError);\n        returnValue.removeAllListeners();\n      } else {\n        backOff(opts, returnValue, fatalError, function () {\n          replicate(src, target, opts, returnValue);\n        });\n      }\n    } else {\n      returnValue.emit('complete', result);\n      returnValue.removeAllListeners();\n    }\n  }\n\n\n  function onChange(change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    // Attach 'pending' property if server supports it (CouchDB 2.0+)\n    /* istanbul ignore if */\n    if (typeof pending === 'number') {\n      pendingBatch.pending = pending;\n    }\n\n    var filter = filterChange(opts)(change);\n    if (!filter) {\n      return;\n    }\n    pendingBatch.seq = change.seq || lastSeq;\n    pendingBatch.changes.push(change);\n    nextTick(function () {\n      processPendingBatch(batches.length === 0 && changesOpts.live);\n    });\n  }\n\n\n  function onChangesComplete(changes) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n\n    // if no results were returned then we're done,\n    // else fetch more\n    if (changes.results.length > 0) {\n      changesOpts.since = changes.results[changes.results.length - 1].seq;\n      getChanges();\n      processPendingBatch(true);\n    } else {\n\n      var complete = function () {\n        if (continuous) {\n          changesOpts.live = true;\n          getChanges();\n        } else {\n          changesCompleted = true;\n        }\n        processPendingBatch(true);\n      };\n\n      // update the checkpoint so we start from the right seq next time\n      if (!currentBatch && changes.results.length === 0) {\n        writingCheckpoint = true;\n        checkpointer.writeCheckpoint(changes.last_seq,\n            session).then(function () {\n          writingCheckpoint = false;\n          result.last_seq = last_seq = changes.last_seq;\n          complete();\n        })\n        .catch(onCheckpointError);\n      } else {\n        complete();\n      }\n    }\n  }\n\n\n  function onChangesError(err) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    abortReplication('changes rejected', err);\n  }\n\n\n  function getChanges() {\n    if (!(\n      !changesPending &&\n      !changesCompleted &&\n      batches.length < batches_limit\n      )) {\n      return;\n    }\n    changesPending = true;\n    function abortChanges() {\n      changes.cancel();\n    }\n    function removeListener() {\n      returnValue.removeListener('cancel', abortChanges);\n    }\n\n    if (returnValue._changes) { // remove old changes() and listeners\n      returnValue.removeListener('cancel', returnValue._abortChanges);\n      returnValue._changes.cancel();\n    }\n    returnValue.once('cancel', abortChanges);\n\n    var changes = src.changes(changesOpts)\n      .on('change', onChange);\n    changes.then(removeListener, removeListener);\n    changes.then(onChangesComplete)\n      .catch(onChangesError);\n\n    if (opts.retry) {\n      // save for later so we can cancel if necessary\n      returnValue._changes = changes;\n      returnValue._abortChanges = abortChanges;\n    }\n  }\n\n\n  function startChanges() {\n    initCheckpointer().then(function () {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      return checkpointer.getCheckpoint().then(function (checkpoint) {\n        last_seq = checkpoint;\n        changesOpts = {\n          since: last_seq,\n          limit: batch_size,\n          batch_size: batch_size,\n          style: 'all_docs',\n          doc_ids: doc_ids,\n          selector: selector,\n          return_docs: true // required so we know when we're done\n        };\n        if (opts.filter) {\n          if (typeof opts.filter !== 'string') {\n            // required for the client-side filter in onChange\n            changesOpts.include_docs = true;\n          } else { // ddoc filter\n            changesOpts.filter = opts.filter;\n          }\n        }\n        if ('heartbeat' in opts) {\n          changesOpts.heartbeat = opts.heartbeat;\n        }\n        if ('timeout' in opts) {\n          changesOpts.timeout = opts.timeout;\n        }\n        if (opts.query_params) {\n          changesOpts.query_params = opts.query_params;\n        }\n        if (opts.view) {\n          changesOpts.view = opts.view;\n        }\n        getChanges();\n      });\n    }).catch(function (err) {\n      abortReplication('getCheckpoint rejected with ', err);\n    });\n  }\n\n  /* istanbul ignore next */\n  function onCheckpointError(err) {\n    writingCheckpoint = false;\n    abortReplication('writeCheckpoint completed with error', err);\n  }\n\n  /* istanbul ignore if */\n  if (returnValue.cancelled) { // cancelled immediately\n    completeReplication();\n    return;\n  }\n\n  if (!returnValue._addedListeners) {\n    returnValue.once('cancel', completeReplication);\n\n    if (typeof opts.complete === 'function') {\n      returnValue.once('error', opts.complete);\n      returnValue.once('complete', function (result) {\n        opts.complete(null, result);\n      });\n    }\n    returnValue._addedListeners = true;\n  }\n\n  if (typeof opts.since === 'undefined') {\n    startChanges();\n  } else {\n    initCheckpointer().then(function () {\n      writingCheckpoint = true;\n      return checkpointer.writeCheckpoint(opts.since, session);\n    }).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      last_seq = opts.since;\n      startChanges();\n    }).catch(onCheckpointError);\n  }\n}\n\n// We create a basic promise so the caller can cancel the replication possibly\n// before we have actually started listening to changes etc\ninherits(Replication, EventEmitter);\nfunction Replication() {\n  EventEmitter.call(this);\n  this.cancelled = false;\n  this.state = 'pending';\n  var self = this;\n  var promise = new Promise(function (fulfill, reject) {\n    self.once('complete', fulfill);\n    self.once('error', reject);\n  });\n  self.then = function (resolve, reject) {\n    return promise.then(resolve, reject);\n  };\n  self.catch = function (reject) {\n    return promise.catch(reject);\n  };\n  // As we allow error handling via \"error\" event as well,\n  // put a stub in here so that rejecting never throws UnhandledError.\n  self.catch(function () {});\n}\n\nReplication.prototype.cancel = function () {\n  this.cancelled = true;\n  this.state = 'cancelled';\n  this.emit('cancel');\n};\n\nReplication.prototype.ready = function (src, target) {\n  var self = this;\n  if (self._readyCalled) {\n    return;\n  }\n  self._readyCalled = true;\n\n  function onDestroy() {\n    self.cancel();\n  }\n  src.once('destroyed', onDestroy);\n  target.once('destroyed', onDestroy);\n  function cleanup() {\n    src.removeListener('destroyed', onDestroy);\n    target.removeListener('destroyed', onDestroy);\n  }\n  self.once('complete', cleanup);\n};\n\nfunction toPouch(db, opts) {\n  var PouchConstructor = opts.PouchConstructor;\n  if (typeof db === 'string') {\n    return new PouchConstructor(db, opts);\n  } else {\n    return db;\n  }\n}\n\nfunction replicateWrapper(src, target, opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n\n  if (opts.doc_ids && !Array.isArray(opts.doc_ids)) {\n    throw createError(BAD_REQUEST,\n                       \"`doc_ids` filter parameter is not a list.\");\n  }\n\n  opts.complete = callback;\n  opts = clone(opts);\n  opts.continuous = opts.continuous || opts.live;\n  opts.retry = ('retry' in opts) ? opts.retry : false;\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  var replicateRet = new Replication(opts);\n  var srcPouch = toPouch(src, opts);\n  var targetPouch = toPouch(target, opts);\n  replicate(srcPouch, targetPouch, opts, replicateRet);\n  return replicateRet;\n}\n\ninherits(Sync, EventEmitter);\nfunction sync(src, target, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n  opts = clone(opts);\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  src = toPouch(src, opts);\n  target = toPouch(target, opts);\n  return new Sync(src, target, opts, callback);\n}\n\nfunction Sync(src, target, opts, callback) {\n  var self = this;\n  this.canceled = false;\n\n  var optsPush = opts.push ? $inject_Object_assign({}, opts, opts.push) : opts;\n  var optsPull = opts.pull ? $inject_Object_assign({}, opts, opts.pull) : opts;\n\n  this.push = replicateWrapper(src, target, optsPush);\n  this.pull = replicateWrapper(target, src, optsPull);\n\n  this.pushPaused = true;\n  this.pullPaused = true;\n\n  function pullChange(change) {\n    self.emit('change', {\n      direction: 'pull',\n      change: change\n    });\n  }\n  function pushChange(change) {\n    self.emit('change', {\n      direction: 'push',\n      change: change\n    });\n  }\n  function pushDenied(doc) {\n    self.emit('denied', {\n      direction: 'push',\n      doc: doc\n    });\n  }\n  function pullDenied(doc) {\n    self.emit('denied', {\n      direction: 'pull',\n      doc: doc\n    });\n  }\n  function pushPaused() {\n    self.pushPaused = true;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('paused');\n    }\n  }\n  function pullPaused() {\n    self.pullPaused = true;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('paused');\n    }\n  }\n  function pushActive() {\n    self.pushPaused = false;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('active', {\n        direction: 'push'\n      });\n    }\n  }\n  function pullActive() {\n    self.pullPaused = false;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('active', {\n        direction: 'pull'\n      });\n    }\n  }\n\n  var removed = {};\n\n  function removeAll(type) { // type is 'push' or 'pull'\n    return function (event, func) {\n      var isChange = event === 'change' &&\n        (func === pullChange || func === pushChange);\n      var isDenied = event === 'denied' &&\n        (func === pullDenied || func === pushDenied);\n      var isPaused = event === 'paused' &&\n        (func === pullPaused || func === pushPaused);\n      var isActive = event === 'active' &&\n        (func === pullActive || func === pushActive);\n\n      if (isChange || isDenied || isPaused || isActive) {\n        if (!(event in removed)) {\n          removed[event] = {};\n        }\n        removed[event][type] = true;\n        if (Object.keys(removed[event]).length === 2) {\n          // both push and pull have asked to be removed\n          self.removeAllListeners(event);\n        }\n      }\n    };\n  }\n\n  if (opts.live) {\n    this.push.on('complete', self.pull.cancel.bind(self.pull));\n    this.pull.on('complete', self.push.cancel.bind(self.push));\n  }\n\n  function addOneListener(ee, event, listener) {\n    if (ee.listeners(event).indexOf(listener) == -1) {\n      ee.on(event, listener);\n    }\n  }\n\n  this.on('newListener', function (event) {\n    if (event === 'change') {\n      addOneListener(self.pull, 'change', pullChange);\n      addOneListener(self.push, 'change', pushChange);\n    } else if (event === 'denied') {\n      addOneListener(self.pull, 'denied', pullDenied);\n      addOneListener(self.push, 'denied', pushDenied);\n    } else if (event === 'active') {\n      addOneListener(self.pull, 'active', pullActive);\n      addOneListener(self.push, 'active', pushActive);\n    } else if (event === 'paused') {\n      addOneListener(self.pull, 'paused', pullPaused);\n      addOneListener(self.push, 'paused', pushPaused);\n    }\n  });\n\n  this.on('removeListener', function (event) {\n    if (event === 'change') {\n      self.pull.removeListener('change', pullChange);\n      self.push.removeListener('change', pushChange);\n    } else if (event === 'denied') {\n      self.pull.removeListener('denied', pullDenied);\n      self.push.removeListener('denied', pushDenied);\n    } else if (event === 'active') {\n      self.pull.removeListener('active', pullActive);\n      self.push.removeListener('active', pushActive);\n    } else if (event === 'paused') {\n      self.pull.removeListener('paused', pullPaused);\n      self.push.removeListener('paused', pushPaused);\n    }\n  });\n\n  this.pull.on('removeListener', removeAll('pull'));\n  this.push.on('removeListener', removeAll('push'));\n\n  var promise = Promise.all([\n    this.push,\n    this.pull\n  ]).then(function (resp) {\n    var out = {\n      push: resp[0],\n      pull: resp[1]\n    };\n    self.emit('complete', out);\n    if (callback) {\n      callback(null, out);\n    }\n    self.removeAllListeners();\n    return out;\n  }, function (err) {\n    self.cancel();\n    if (callback) {\n      // if there's a callback, then the callback can receive\n      // the error event\n      callback(err);\n    } else {\n      // if there's no callback, then we're safe to emit an error\n      // event, which would otherwise throw an unhandled error\n      // due to 'error' being a special event in EventEmitters\n      self.emit('error', err);\n    }\n    self.removeAllListeners();\n    if (callback) {\n      // no sense throwing if we're already emitting an 'error' event\n      throw err;\n    }\n  });\n\n  this.then = function (success, err) {\n    return promise.then(success, err);\n  };\n\n  this.catch = function (err) {\n    return promise.catch(err);\n  };\n}\n\nSync.prototype.cancel = function () {\n  if (!this.canceled) {\n    this.canceled = true;\n    this.push.cancel();\n    this.pull.cancel();\n  }\n};\n\nfunction replication(PouchDB) {\n  PouchDB.replicate = replicateWrapper;\n  PouchDB.sync = sync;\n\n  Object.defineProperty(PouchDB.prototype, 'replicate', {\n    get: function () {\n      var self = this;\n      if (typeof this.replicateMethods === 'undefined') {\n        this.replicateMethods = {\n          from: function (other, opts, callback) {\n            return self.constructor.replicate(other, self, opts, callback);\n          },\n          to: function (other, opts, callback) {\n            return self.constructor.replicate(self, other, opts, callback);\n          }\n        };\n      }\n      return this.replicateMethods;\n    }\n  });\n\n  PouchDB.prototype.sync = function (dbName, opts, callback) {\n    return this.constructor.sync(this, dbName, opts, callback);\n  };\n}\n\nPouchDB.plugin(IDBPouch)\n  .plugin(HttpPouch$1)\n  .plugin(mapreduce)\n  .plugin(replication);\n\nexport default PouchDB;\n","function mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nexport { ExportedSet as Set, ExportedMap as Map };\n","import inherits from 'inherits';\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nexport { UNAUTHORIZED, MISSING_BULK_DOCS, MISSING_DOC, REV_CONFLICT, INVALID_ID, MISSING_ID, RESERVED_ID, NOT_OPEN, UNKNOWN_ERROR, BAD_ARG, INVALID_REQUEST, QUERY_PARSE_ERROR, DOC_VALIDATION, BAD_REQUEST, NOT_AN_OBJECT, DB_MISSING, WSQ_ERROR, LDB_ERROR, FORBIDDEN, INVALID_REV, FILE_EXISTS, MISSING_STUB, IDB_ERROR, INVALID_URL, createError, generateErrorFromResponse };\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && msCrypto.getRandomValues.bind(msCrypto));\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","var thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\nfunction typedBuffer() {\n}\n\nexport { thisAtob as atob, thisBtoa as btoa, b64ToBluffer as base64StringToBlobOrBuffer, binaryStringToArrayBuffer, binStringToBluffer as binaryStringToBlobOrBuffer, createBlob as blob, blobToBase64 as blobOrBufferToBase64, blobToBinaryString as blobOrBufferToBinaryString, readAsArrayBuffer, readAsBinaryString, typedBuffer };\n","import { btoa, readAsArrayBuffer } from 'pouchdb-binary-utils';\nimport Md5 from 'spark-md5';\n\nvar setImmediateShim = global.setImmediate || global.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return btoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nexport { binaryMd5, stringMd5 };\n","import getArguments from 'argsarray';\nimport { Map } from 'pouchdb-collections';\nimport immediate from 'immediate';\nimport { EventEmitter } from 'events';\nimport inherits from 'inherits';\nimport { createError, BAD_REQUEST, INVALID_ID, MISSING_ID, RESERVED_ID } from 'pouchdb-errors';\nimport uuidV4 from 'uuid';\nimport { stringMd5 } from 'pouchdb-md5';\nimport { clone } from 'pouchdb-utils';\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone$1(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone$1(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone$1(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone$1(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new Map();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar assign$1 = assign;\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n// for browsers that don't support it like IE\n\n/* istanbul ignore next */\nfunction f() {}\n\nvar hasName = f.name;\nvar res;\n\n// We dont run coverage in IE\n/* istanbul ignore else */\nif (hasName) {\n  res = function (fun) {\n    return fun.name;\n  };\n} else {\n  res = function (fun) {\n    var match = fun.toString().match(/^\\s*function\\s*(?:(\\S+)\\s*)?\\(/);\n    if (match && match[1]) {\n      return match[1];\n    }\n    else {\n      return '';\n    }\n  };\n}\n\nvar res$1 = res;\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\nexport { adapterFun, assign$1 as assign, bulkGet as bulkGetShim, Changes as changesHandler, clone$1 as clone, defaultBackOff, explainError, filterChange, flatten, res$1 as functionName, guardedConsole, hasLocalStorage, invalidIdError, isRemote, listenerCount, immediate as nextTick, normalizeDesignDocFunctionName as normalizeDdocFunctionName, once, parseDesignDocFunctionName as parseDdocFunctionName, parseUri, pick, rev, scopeEval, toPromise, upsert, uuid };\n","// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f = fetch;\nvar h = Headers;\n\nexport { f as fetch, h as Headers, a as AbortController };\n","function pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\nexport { collate, normalizeKey, toIndexableString, parseIndexableString };\n","import { clone } from 'pouchdb-utils';\nimport { collate } from 'pouchdb-collate';\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction setFieldInDoc(doc, parsedField, value) {\n  for (var i = 0, len = parsedField.length; i < len-1; i++) {\n    var elem = parsedField[i];\n    doc = doc[elem] = {};\n  }\n  doc[parsedField[len-1]] = value;\n}\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n  if ('$and' in result) {\n    result = mergeAndedSelectors(result['$and']);\n    wasAnded = true;\n  }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  return Object.keys(matcher).every(function (userOperator) {\n    var userValue = matcher[userOperator];\n    return match(userOperator, doc, userValue, parsedField, docFieldValue);\n  });\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nexport { massageSelector, matchesSelector, filterInMemoryFields, createFieldSorter, rowFilter, isCombinationalField, getKey, getValue, getFieldFromDoc, setFieldInDoc, compare, parseField };\n","function mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nexport { ExportedSet as Set, ExportedMap as Map };\n","import inherits from 'inherits';\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nexport { UNAUTHORIZED, MISSING_BULK_DOCS, MISSING_DOC, REV_CONFLICT, INVALID_ID, MISSING_ID, RESERVED_ID, NOT_OPEN, UNKNOWN_ERROR, BAD_ARG, INVALID_REQUEST, QUERY_PARSE_ERROR, DOC_VALIDATION, BAD_REQUEST, NOT_AN_OBJECT, DB_MISSING, WSQ_ERROR, LDB_ERROR, FORBIDDEN, INVALID_REV, FILE_EXISTS, MISSING_STUB, IDB_ERROR, INVALID_URL, createError, generateErrorFromResponse };\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && msCrypto.getRandomValues.bind(msCrypto));\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","import getArguments from 'argsarray';\nimport { Map } from 'pouchdb-collections';\nimport immediate from 'immediate';\nimport { EventEmitter } from 'events';\nimport inherits from 'inherits';\nimport { createError, BAD_REQUEST, INVALID_ID, MISSING_ID, RESERVED_ID } from 'pouchdb-errors';\nimport uuidV4 from 'uuid';\nimport { stringMd5 } from 'pouchdb-md5';\nimport { clone } from 'pouchdb-utils';\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone$1(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone$1(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone$1(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone$1(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new Map();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar assign$1 = assign;\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n// for browsers that don't support it like IE\n\n/* istanbul ignore next */\nfunction f() {}\n\nvar hasName = f.name;\nvar res;\n\n// We dont run coverage in IE\n/* istanbul ignore else */\nif (hasName) {\n  res = function (fun) {\n    return fun.name;\n  };\n} else {\n  res = function (fun) {\n    var match = fun.toString().match(/^\\s*function\\s*(?:(\\S+)\\s*)?\\(/);\n    if (match && match[1]) {\n      return match[1];\n    }\n    else {\n      return '';\n    }\n  };\n}\n\nvar res$1 = res;\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\nexport { adapterFun, assign$1 as assign, bulkGet as bulkGetShim, Changes as changesHandler, clone$1 as clone, defaultBackOff, explainError, filterChange, flatten, res$1 as functionName, guardedConsole, hasLocalStorage, invalidIdError, isRemote, listenerCount, immediate as nextTick, normalizeDesignDocFunctionName as normalizeDdocFunctionName, once, parseDesignDocFunctionName as parseDdocFunctionName, parseUri, pick, rev, scopeEval, toPromise, upsert, uuid };\n","function pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\nexport { collate, normalizeKey, toIndexableString, parseIndexableString };\n","function mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nexport { ExportedSet as Set, ExportedMap as Map };\n","import inherits from 'inherits';\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nexport { UNAUTHORIZED, MISSING_BULK_DOCS, MISSING_DOC, REV_CONFLICT, INVALID_ID, MISSING_ID, RESERVED_ID, NOT_OPEN, UNKNOWN_ERROR, BAD_ARG, INVALID_REQUEST, QUERY_PARSE_ERROR, DOC_VALIDATION, BAD_REQUEST, NOT_AN_OBJECT, DB_MISSING, WSQ_ERROR, LDB_ERROR, FORBIDDEN, INVALID_REV, FILE_EXISTS, MISSING_STUB, IDB_ERROR, INVALID_URL, createError, generateErrorFromResponse };\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && msCrypto.getRandomValues.bind(msCrypto));\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","import getArguments from 'argsarray';\nimport { Map } from 'pouchdb-collections';\nimport immediate from 'immediate';\nimport { EventEmitter } from 'events';\nimport inherits from 'inherits';\nimport { createError, BAD_REQUEST, INVALID_ID, MISSING_ID, RESERVED_ID } from 'pouchdb-errors';\nimport uuidV4 from 'uuid';\nimport { stringMd5 } from 'pouchdb-md5';\nimport { clone } from 'pouchdb-utils';\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone$1(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone$1(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone$1(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone$1(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new Map();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        immediate(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar assign$1 = assign;\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n// for browsers that don't support it like IE\n\n/* istanbul ignore next */\nfunction f() {}\n\nvar hasName = f.name;\nvar res;\n\n// We dont run coverage in IE\n/* istanbul ignore else */\nif (hasName) {\n  res = function (fun) {\n    return fun.name;\n  };\n} else {\n  res = function (fun) {\n    var match = fun.toString().match(/^\\s*function\\s*(?:(\\S+)\\s*)?\\(/);\n    if (match && match[1]) {\n      return match[1];\n    }\n    else {\n      return '';\n    }\n  };\n}\n\nvar res$1 = res;\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\nexport { adapterFun, assign$1 as assign, bulkGet as bulkGetShim, Changes as changesHandler, clone$1 as clone, defaultBackOff, explainError, filterChange, flatten, res$1 as functionName, guardedConsole, hasLocalStorage, invalidIdError, isRemote, listenerCount, immediate as nextTick, normalizeDesignDocFunctionName as normalizeDdocFunctionName, once, parseDesignDocFunctionName as parseDdocFunctionName, parseUri, pick, rev, scopeEval, toPromise, upsert, uuid };\n","import inherits from 'inherits';\nimport { Set } from 'pouchdb-collections';\nimport argsarray from 'argsarray';\nimport { nextTick } from 'pouchdb-utils';\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      nextTick(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      nextTick(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return argsarray(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new Set(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nexport { uniq, sequentialize, fin, callbackify, promisedCallback, mapToKeysArray, QueryParseError, NotFoundError, BuiltInError };\n","import { upsert, flatten, guardedConsole, nextTick, isRemote } from 'pouchdb-utils';\nimport { stringMd5 } from 'pouchdb-md5';\nimport { Set, Map } from 'pouchdb-collections';\nimport { base64StringToBlobOrBuffer } from 'pouchdb-binary-utils';\nimport { collate, toIndexableString, normalizeKey, parseIndexableString } from 'pouchdb-collate';\nimport { generateErrorFromResponse } from 'pouchdb-errors';\nimport { Headers } from 'pouchdb-fetch';\nimport { callbackify, sequentialize, uniq, fin, promisedCallback, mapToKeysArray, QueryParseError, NotFoundError, BuiltInError } from 'pouchdb-mapreduce-utils';\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue();\nvar CHANGES_BATCH_SIZE = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = base64StringToBlobOrBuffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new Headers({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new Headers({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new Set();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new Map();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new Map();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new Map();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new Headers({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new Map();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new Set();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              nextTick(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nexport default createAbstractMapReduce;\n","import { clone, assign, nextTick, upsert, toPromise, isRemote } from 'pouchdb-utils';\nimport { generateErrorFromResponse } from 'pouchdb-errors';\nimport { Headers } from 'pouchdb-fetch';\nimport { getFieldFromDoc, setFieldInDoc, parseField, getKey, getValue, compare, massageSelector, filterInMemoryFields } from 'pouchdb-selector-core';\nimport abstractMapReduce from 'pouchdb-abstract-mapreduce';\nimport { collate } from 'pouchdb-collate';\nimport { stringMd5 } from 'pouchdb-md5';\n\n// we restucture the supplied JSON considerably, because the official\n// Mango API is very particular about a lot of this stuff, but we like\n// to be liberal with what we accept in order to prevent mental\n// breakdowns in our users\nfunction massageCreateIndexRequest(requestDef) {\n  requestDef = clone(requestDef);\n\n  if (!requestDef.index) {\n    requestDef.index = {};\n  }\n\n  ['type', 'name', 'ddoc'].forEach(function (key) {\n    if (requestDef.index[key]) {\n      requestDef[key] = requestDef.index[key];\n      delete requestDef.index[key];\n    }\n  });\n\n  if (requestDef.fields) {\n    requestDef.index.fields = requestDef.fields;\n    delete requestDef.fields;\n  }\n\n  if (!requestDef.type) {\n    requestDef.type = 'json';\n  }\n  return requestDef;\n}\n\nfunction dbFetch(db, path, opts, callback) {\n  var status, ok;\n  opts.headers = new Headers({'Content-type': 'application/json'});\n  db.fetch(path, opts).then(function (response) {\n    status = response.status;\n    ok = response.ok;\n    return response.json();\n  }).then(function (json) {\n    if (!ok) {\n      json.status = status;\n      var err = generateErrorFromResponse(json);\n      callback(err);\n    } else {\n      callback(null, json);\n    }\n  }).catch(callback);\n}\n\nfunction createIndex(db, requestDef, callback) {\n  requestDef = massageCreateIndexRequest(requestDef);\n  dbFetch(db, '_index', {\n    method: 'POST',\n    body: JSON.stringify(requestDef)\n  }, callback);\n}\n\nfunction find(db, requestDef, callback) {\n  dbFetch(db, '_find', {\n    method: 'POST',\n    body: JSON.stringify(requestDef)\n  }, callback);\n}\n\nfunction explain(db, requestDef, callback) {\n  dbFetch(db, '_explain', {\n    method: 'POST',\n    body: JSON.stringify(requestDef)\n  }, callback);\n}\n\nfunction getIndexes(db, callback) {\n  dbFetch(db, '_index', {\n    method: 'GET'\n  }, callback);\n}\n\nfunction deleteIndex(db, indexDef, callback) {\n\n\n  var ddoc = indexDef.ddoc;\n  var type = indexDef.type || 'json';\n  var name = indexDef.name;\n\n  if (!ddoc) {\n    return callback(new Error('you must provide an index\\'s ddoc'));\n  }\n\n  if (!name) {\n    return callback(new Error('you must provide an index\\'s name'));\n  }\n\n  var url = '_index/' + [ddoc, type, name].map(encodeURIComponent).join('/');\n\n  dbFetch(db, url, {method: 'DELETE'}, callback);\n}\n\nfunction getArguments(fun) {\n  return function () {\n    var len = arguments.length;\n    var args = new Array(len);\n    var i = -1;\n    while (++i < len) {\n      args[i] = arguments[i];\n    }\n    return fun.call(this, args);\n  };\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    promisedCallback(promise, cb);\n    return promise;\n  });\n}\n\nfunction promisedCallback(promise, callback) {\n  promise.then(function (res) {\n    nextTick(function () {\n      callback(null, res);\n    });\n  }, function (reason) {\n    nextTick(function () {\n      callback(reason);\n    });\n  });\n  return promise;\n}\n\nvar flatten = getArguments(function (args) {\n  var res = [];\n  for (var i = 0, len = args.length; i < len; i++) {\n    var subArr = args[i];\n    if (Array.isArray(subArr)) {\n      res = res.concat(flatten.apply(null, subArr));\n    } else {\n      res.push(subArr);\n    }\n  }\n  return res;\n});\n\nfunction mergeObjects(arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    res = assign(res, arr[i]);\n  }\n  return res;\n}\n\n// Selects a list of fields defined in dot notation from one doc\n// and copies them to a new doc. Like underscore _.pick but supports nesting.\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var parsedField = parseField(arr[i]);\n    var value = getFieldFromDoc(obj, parsedField);\n    if (typeof value !== 'undefined') {\n      setFieldInDoc(res, parsedField, value);\n    }\n  }\n  return res;\n}\n\n// e.g. ['a'], ['a', 'b'] is true, but ['b'], ['a', 'b'] is false\nfunction oneArrayIsSubArrayOfOther(left, right) {\n\n  for (var i = 0, len = Math.min(left.length, right.length); i < len; i++) {\n    if (left[i] !== right[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n// e.g.['a', 'b', 'c'], ['a', 'b'] is false\nfunction oneArrayIsStrictSubArrayOfOther(left, right) {\n\n  if (left.length > right.length) {\n    return false;\n  }\n\n  return oneArrayIsSubArrayOfOther(left, right);\n}\n\n// same as above, but treat the left array as an unordered set\n// e.g. ['b', 'a'], ['a', 'b', 'c'] is true, but ['c'], ['a', 'b', 'c'] is false\nfunction oneSetIsSubArrayOfOther(left, right) {\n  left = left.slice();\n  for (var i = 0, len = right.length; i < len; i++) {\n    var field = right[i];\n    if (!left.length) {\n      break;\n    }\n    var leftIdx = left.indexOf(field);\n    if (leftIdx === -1) {\n      return false;\n    } else {\n      left.splice(leftIdx, 1);\n    }\n  }\n  return true;\n}\n\nfunction arrayToObject(arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    res[arr[i]] = true;\n  }\n  return res;\n}\n\nfunction max(arr, fun) {\n  var max = null;\n  var maxScore = -1;\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var element = arr[i];\n    var score = fun(element);\n    if (score > maxScore) {\n      maxScore = score;\n      max = element;\n    }\n  }\n  return max;\n}\n\nfunction arrayEquals(arr1, arr2) {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  for (var i = 0, len = arr1.length; i < len; i++) {\n    if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction uniq(arr) {\n  var obj = {};\n  for (var i = 0; i < arr.length; i++) {\n    obj['$' + arr[i]] = true;\n  }\n  return Object.keys(obj).map(function (key) {\n    return key.substring(1);\n  });\n}\n\n//\n// One thing about these mappers:\n//\n// Per the advice of John-David Dalton (http://youtu.be/NthmeLEhDDM),\n// what you want to do in this case is optimize for the smallest possible\n// function, since that's the thing that gets run over and over again.\n//\n// This code would be a lot simpler if all the if/elses were inside\n// the function, but it would also be a lot less performant.\n//\n\n\nfunction createDeepMultiMapper(fields, emit) {\n  return function (doc) {\n    var toEmit = [];\n    for (var i = 0, iLen = fields.length; i < iLen; i++) {\n      var parsedField = parseField(fields[i]);\n      var value = doc;\n      for (var j = 0, jLen = parsedField.length; j < jLen; j++) {\n        var key = parsedField[j];\n        value = value[key];\n        if (typeof value === 'undefined') {\n          return; // don't emit\n        }\n      }\n      toEmit.push(value);\n    }\n    emit(toEmit);\n  };\n}\n\nfunction createDeepSingleMapper(field, emit) {\n  var parsedField = parseField(field);\n  return function (doc) {\n    var value = doc;\n    for (var i = 0, len = parsedField.length; i < len; i++) {\n      var key = parsedField[i];\n      value = value[key];\n      if (typeof value === 'undefined') {\n        return; // do nothing\n      }\n    }\n    emit(value);\n  };\n}\n\nfunction createShallowSingleMapper(field, emit) {\n  return function (doc) {\n    emit(doc[field]);\n  };\n}\n\nfunction createShallowMultiMapper(fields, emit) {\n  return function (doc) {\n    var toEmit = [];\n    for (var i = 0, len = fields.length; i < len; i++) {\n      toEmit.push(doc[fields[i]]);\n    }\n    emit(toEmit);\n  };\n}\n\nfunction checkShallow(fields) {\n  for (var i = 0, len = fields.length; i < len; i++) {\n    var field = fields[i];\n    if (field.indexOf('.') !== -1) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction createMapper(fields, emit) {\n  var isShallow = checkShallow(fields);\n  var isSingle = fields.length === 1;\n\n  // notice we try to optimize for the most common case,\n  // i.e. single shallow indexes\n  if (isShallow) {\n    if (isSingle) {\n      return createShallowSingleMapper(fields[0], emit);\n    } else { // multi\n      return createShallowMultiMapper(fields, emit);\n    }\n  } else { // deep\n    if (isSingle) {\n      return createDeepSingleMapper(fields[0], emit);\n    } else { // multi\n      return createDeepMultiMapper(fields, emit);\n    }\n  }\n}\n\nfunction mapper(mapFunDef, emit) {\n  // mapFunDef is a list of fields\n\n  var fields = Object.keys(mapFunDef.fields);\n\n  return createMapper(fields, emit);\n}\n\n/* istanbul ignore next */\nfunction reducer(/*reduceFunDef*/) {\n  throw new Error('reduce not supported');\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var view = ddoc.views[viewName];\n  // This doesn't actually need to be here apparently, but\n  // I feel safer keeping it.\n  /* istanbul ignore if */\n  if (!view.map || !view.map.fields) {\n    throw new Error('ddoc ' + ddoc._id +' with view ' + viewName +\n      ' doesn\\'t have map.fields defined. ' +\n      'maybe it wasn\\'t created by this plugin?');\n  }\n}\n\nvar abstractMapper = abstractMapReduce(\n  /* localDocName */ 'indexes',\n  mapper,\n  reducer,\n  ddocValidator\n);\n\n// normalize the \"sort\" value\nfunction massageSort(sort) {\n  if (!Array.isArray(sort)) {\n    throw new Error('invalid sort json - should be an array');\n  }\n  return sort.map(function (sorting) {\n    if (typeof sorting === 'string') {\n      var obj = {};\n      obj[sorting] = 'asc';\n      return obj;\n    } else {\n      return sorting;\n    }\n  });\n}\n\nfunction massageUseIndex(useIndex) {\n  var cleanedUseIndex = [];\n  if (typeof useIndex === 'string') {\n    cleanedUseIndex.push(useIndex);\n  } else {\n    cleanedUseIndex = useIndex;\n  }\n\n  return cleanedUseIndex.map(function (name) {\n    return name.replace('_design/', '');\n  });\n}\n\nfunction massageIndexDef(indexDef) {\n  indexDef.fields = indexDef.fields.map(function (field) {\n    if (typeof field === 'string') {\n      var obj = {};\n      obj[field] = 'asc';\n      return obj;\n    }\n    return field;\n  });\n  return indexDef;\n}\n\nfunction getKeyFromDoc(doc, index) {\n  var res = [];\n  for (var i = 0; i < index.def.fields.length; i++) {\n    var field = getKey(index.def.fields[i]);\n    res.push(doc[field]);\n  }\n  return res;\n}\n\n// have to do this manually because REASONS. I don't know why\n// CouchDB didn't implement inclusive_start\nfunction filterInclusiveStart(rows, targetValue, index) {\n  var indexFields = index.def.fields;\n  for (var i = 0, len = rows.length; i < len; i++) {\n    var row = rows[i];\n\n    // shave off any docs at the beginning that are <= the\n    // target value\n\n    var docKey = getKeyFromDoc(row.doc, index);\n    if (indexFields.length === 1) {\n      docKey = docKey[0]; // only one field, not multi-field\n    } else { // more than one field in index\n      // in the case where e.g. the user is searching {$gt: {a: 1}}\n      // but the index is [a, b], then we need to shorten the doc key\n      while (docKey.length > targetValue.length) {\n        docKey.pop();\n      }\n    }\n    //ABS as we just looking for values that don't match\n    if (Math.abs(collate(docKey, targetValue)) > 0) {\n      // no need to filter any further; we're past the key\n      break;\n    }\n  }\n  return i > 0 ? rows.slice(i) : rows;\n}\n\nfunction reverseOptions(opts) {\n  var newOpts = clone(opts);\n  delete newOpts.startkey;\n  delete newOpts.endkey;\n  delete newOpts.inclusive_start;\n  delete newOpts.inclusive_end;\n\n  if ('endkey' in opts) {\n    newOpts.startkey = opts.endkey;\n  }\n  if ('startkey' in opts) {\n    newOpts.endkey = opts.startkey;\n  }\n  if ('inclusive_start' in opts) {\n    newOpts.inclusive_end = opts.inclusive_start;\n  }\n  if ('inclusive_end' in opts) {\n    newOpts.inclusive_start = opts.inclusive_end;\n  }\n  return newOpts;\n}\n\nfunction validateIndex(index) {\n  var ascFields = index.fields.filter(function (field) {\n    return getValue(field) === 'asc';\n  });\n  if (ascFields.length !== 0 && ascFields.length !== index.fields.length) {\n    throw new Error('unsupported mixed sorting');\n  }\n}\n\nfunction validateSort(requestDef, index) {\n  if (index.defaultUsed && requestDef.sort) {\n    var noneIdSorts = requestDef.sort.filter(function (sortItem) {\n      return Object.keys(sortItem)[0] !== '_id';\n    }).map(function (sortItem) {\n      return Object.keys(sortItem)[0];\n    });\n\n    if (noneIdSorts.length > 0) {\n      throw new Error('Cannot sort on field(s) \"' + noneIdSorts.join(',') +\n      '\" when using the default index');\n    }\n  }\n\n  if (index.defaultUsed) {\n    return;\n  }\n}\n\nfunction validateFindRequest(requestDef) {\n  if (typeof requestDef.selector !== 'object') {\n    throw new Error('you must provide a selector when you find()');\n  }\n\n  /*var selectors = requestDef.selector['$and'] || [requestDef.selector];\n  for (var i = 0; i < selectors.length; i++) {\n    var selector = selectors[i];\n    var keys = Object.keys(selector);\n    if (keys.length === 0) {\n      throw new Error('invalid empty selector');\n    }\n    //var selection = selector[keys[0]];\n    /*if (Object.keys(selection).length !== 1) {\n      throw new Error('invalid selector: ' + JSON.stringify(selection) +\n        ' - it must have exactly one key/value');\n    }\n  }*/\n}\n\n// determine the maximum number of fields\n// we're going to need to query, e.g. if the user\n// has selection ['a'] and sorting ['a', 'b'], then we\n// need to use the longer of the two: ['a', 'b']\nfunction getUserFields(selector, sort) {\n  var selectorFields = Object.keys(selector);\n  var sortFields = sort? sort.map(getKey) : [];\n  var userFields;\n  if (selectorFields.length >= sortFields.length) {\n    userFields = selectorFields;\n  } else {\n    userFields = sortFields;\n  }\n\n  if (sortFields.length === 0) {\n    return {\n      fields: userFields\n    };\n  }\n\n  // sort according to the user's preferred sorting\n  userFields = userFields.sort(function (left, right) {\n    var leftIdx = sortFields.indexOf(left);\n    if (leftIdx === -1) {\n      leftIdx = Number.MAX_VALUE;\n    }\n    var rightIdx = sortFields.indexOf(right);\n    if (rightIdx === -1) {\n      rightIdx = Number.MAX_VALUE;\n    }\n    return leftIdx < rightIdx ? -1 : leftIdx > rightIdx ? 1 : 0;\n  });\n\n  return {\n    fields: userFields,\n    sortOrder: sort.map(getKey)\n  };\n}\n\nfunction createIndex$1(db, requestDef) {\n  requestDef = massageCreateIndexRequest(requestDef);\n  var originalIndexDef = clone(requestDef.index);\n  requestDef.index = massageIndexDef(requestDef.index);\n\n  validateIndex(requestDef.index);\n\n  // calculating md5 is expensive - memoize and only\n  // run if required\n  var md5;\n  function getMd5() {\n    return md5 || (md5 = stringMd5(JSON.stringify(requestDef)));\n  }\n\n  var viewName = requestDef.name || ('idx-' + getMd5());\n\n  var ddocName = requestDef.ddoc || ('idx-' + getMd5());\n  var ddocId = '_design/' + ddocName;\n\n  var hasInvalidLanguage = false;\n  var viewExists = false;\n\n  function updateDdoc(doc) {\n    if (doc._rev && doc.language !== 'query') {\n      hasInvalidLanguage = true;\n    }\n    doc.language = 'query';\n    doc.views = doc.views || {};\n\n    viewExists = !!doc.views[viewName];\n\n    if (viewExists) {\n      return false;\n    }\n\n    doc.views[viewName] = {\n      map: {\n        fields: mergeObjects(requestDef.index.fields)\n      },\n      reduce: '_count',\n      options: {\n        def: originalIndexDef\n      }\n    };\n\n    return doc;\n  }\n\n  db.constructor.emit('debug', ['find', 'creating index', ddocId]);\n\n  return upsert(db, ddocId, updateDdoc).then(function () {\n    if (hasInvalidLanguage) {\n      throw new Error('invalid language for ddoc with id \"' +\n      ddocId +\n      '\" (should be \"query\")');\n    }\n  }).then(function () {\n    // kick off a build\n    // TODO: abstract-pouchdb-mapreduce should support auto-updating\n    // TODO: should also use update_after, but pouchdb/pouchdb#3415 blocks me\n    var signature = ddocName + '/' + viewName;\n    return abstractMapper.query.call(db, signature, {\n      limit: 0,\n      reduce: false\n    }).then(function () {\n      return {\n        id: ddocId,\n        name: viewName,\n        result: viewExists ? 'exists' : 'created'\n      };\n    });\n  });\n}\n\nfunction getIndexes$1(db) {\n  // just search through all the design docs and filter in-memory.\n  // hopefully there aren't that many ddocs.\n  return db.allDocs({\n    startkey: '_design/',\n    endkey: '_design/\\uffff',\n    include_docs: true\n  }).then(function (allDocsRes) {\n    var res = {\n      indexes: [{\n        ddoc: null,\n        name: '_all_docs',\n        type: 'special',\n        def: {\n          fields: [{_id: 'asc'}]\n        }\n      }]\n    };\n\n    res.indexes = flatten(res.indexes, allDocsRes.rows.filter(function (row) {\n      return row.doc.language === 'query';\n    }).map(function (row) {\n      var viewNames = row.doc.views !== undefined ? Object.keys(row.doc.views) : [];\n\n      return viewNames.map(function (viewName) {\n        var view = row.doc.views[viewName];\n        return {\n          ddoc: row.id,\n          name: viewName,\n          type: 'json',\n          def: massageIndexDef(view.options.def)\n        };\n      });\n    }));\n\n    // these are sorted by view name for some reason\n    res.indexes.sort(function (left, right) {\n      return compare(left.name, right.name);\n    });\n    res.total_rows = res.indexes.length;\n    return res;\n  });\n}\n\n// couchdb lowest collation value\nvar COLLATE_LO = null;\n\n// couchdb highest collation value (TODO: well not really, but close enough amirite)\nvar COLLATE_HI = {\"\\uffff\": {}};\n\n// couchdb second-lowest collation value\n\nfunction checkFieldInIndex(index, field) {\n  var indexFields = index.def.fields.map(getKey);\n  for (var i = 0, len = indexFields.length; i < len; i++) {\n    var indexField = indexFields[i];\n    if (field === indexField) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// so when you do e.g. $eq/$eq, we can do it entirely in the database.\n// but when you do e.g. $gt/$eq, the first part can be done\n// in the database, but the second part has to be done in-memory,\n// because $gt has forced us to lose precision.\n// so that's what this determines\nfunction userOperatorLosesPrecision(selector, field) {\n  var matcher = selector[field];\n  var userOperator = getKey(matcher);\n\n  return userOperator !== '$eq';\n}\n\n// sort the user fields by their position in the index,\n// if they're in the index\nfunction sortFieldsByIndex(userFields, index) {\n  var indexFields = index.def.fields.map(getKey);\n\n  return userFields.slice().sort(function (a, b) {\n    var aIdx = indexFields.indexOf(a);\n    var bIdx = indexFields.indexOf(b);\n    if (aIdx === -1) {\n      aIdx = Number.MAX_VALUE;\n    }\n    if (bIdx === -1) {\n      bIdx = Number.MAX_VALUE;\n    }\n    return compare(aIdx, bIdx);\n  });\n}\n\n// first pass to try to find fields that will need to be sorted in-memory\nfunction getBasicInMemoryFields(index, selector, userFields) {\n\n  userFields = sortFieldsByIndex(userFields, index);\n\n  // check if any of the user selectors lose precision\n  var needToFilterInMemory = false;\n  for (var i = 0, len = userFields.length; i < len; i++) {\n    var field = userFields[i];\n    if (needToFilterInMemory || !checkFieldInIndex(index, field)) {\n      return userFields.slice(i);\n    }\n    if (i < len - 1 && userOperatorLosesPrecision(selector, field)) {\n      needToFilterInMemory = true;\n    }\n  }\n  return [];\n}\n\nfunction getInMemoryFieldsFromNe(selector) {\n  var fields = [];\n  Object.keys(selector).forEach(function (field) {\n    var matcher = selector[field];\n    Object.keys(matcher).forEach(function (operator) {\n      if (operator === '$ne') {\n        fields.push(field);\n      }\n    });\n  });\n  return fields;\n}\n\nfunction getInMemoryFields(coreInMemoryFields, index, selector, userFields) {\n  var result = flatten(\n    // in-memory fields reported as necessary by the query planner\n    coreInMemoryFields,\n    // combine with another pass that checks for any we may have missed\n    getBasicInMemoryFields(index, selector, userFields),\n    // combine with another pass that checks for $ne's\n    getInMemoryFieldsFromNe(selector)\n  );\n\n  return sortFieldsByIndex(uniq(result), index);\n}\n\n// check that at least one field in the user's query is represented\n// in the index. order matters in the case of sorts\nfunction checkIndexFieldsMatch(indexFields, sortOrder, fields) {\n  if (sortOrder) {\n    // array has to be a strict subarray of index array. furthermore,\n    // the sortOrder fields need to all be represented in the index\n    var sortMatches = oneArrayIsStrictSubArrayOfOther(sortOrder, indexFields);\n    var selectorMatches = oneArrayIsSubArrayOfOther(fields, indexFields);\n\n    return sortMatches && selectorMatches;\n  }\n\n  // all of the user's specified fields still need to be\n  // on the left side of the index array, although the order\n  // doesn't matter\n  return oneSetIsSubArrayOfOther(fields, indexFields);\n}\n\nvar logicalMatchers = ['$eq', '$gt', '$gte', '$lt', '$lte'];\nfunction isNonLogicalMatcher(matcher) {\n  return logicalMatchers.indexOf(matcher) === -1;\n}\n\n// check all the index fields for usages of '$ne'\n// e.g. if the user queries {foo: {$ne: 'foo'}, bar: {$eq: 'bar'}},\n// then we can neither use an index on ['foo'] nor an index on\n// ['foo', 'bar'], but we can use an index on ['bar'] or ['bar', 'foo']\nfunction checkFieldsLogicallySound(indexFields, selector) {\n  var firstField = indexFields[0];\n  var matcher = selector[firstField];\n\n  if (typeof matcher === 'undefined') {\n    /* istanbul ignore next */\n    return true;\n  }\n\n  var hasLogicalOperator = Object.keys(matcher).some(function (matcherKey) {\n    return !(isNonLogicalMatcher(matcherKey));\n  });\n\n  if (!hasLogicalOperator) {\n    return false;\n  }\n\n  var isInvalidNe = Object.keys(matcher).length === 1 &&\n    getKey(matcher) === '$ne';\n\n  return !isInvalidNe;\n}\n\nfunction checkIndexMatches(index, sortOrder, fields, selector) {\n\n  var indexFields = index.def.fields.map(getKey);\n\n  var fieldsMatch = checkIndexFieldsMatch(indexFields, sortOrder, fields);\n\n  if (!fieldsMatch) {\n    return false;\n  }\n\n  return checkFieldsLogicallySound(indexFields, selector);\n}\n\n//\n// the algorithm is very simple:\n// take all the fields the user supplies, and if those fields\n// are a strict subset of the fields in some index,\n// then use that index\n//\n//\nfunction findMatchingIndexes(selector, userFields, sortOrder, indexes) {\n\n  return indexes.reduce(function (res, index) {\n    var indexMatches = checkIndexMatches(index, sortOrder, userFields, selector);\n    if (indexMatches) {\n      res.push(index);\n    }\n    return res;\n  }, []);\n}\n\n// find the best index, i.e. the one that matches the most fields\n// in the user's query\nfunction findBestMatchingIndex(selector, userFields, sortOrder, indexes, useIndex) {\n\n  var matchingIndexes = findMatchingIndexes(selector, userFields, sortOrder, indexes);\n\n  if (matchingIndexes.length === 0) {\n    if (useIndex) {\n      throw {\n        error: \"no_usable_index\",\n        message: \"There is no index available for this selector.\"\n      };\n    }\n    //return `all_docs` as a default index;\n    //I'm assuming that _all_docs is always first\n    var defaultIndex = indexes[0];\n    defaultIndex.defaultUsed = true;\n    return defaultIndex;\n  }\n  if (matchingIndexes.length === 1 && !useIndex) {\n    return matchingIndexes[0];\n  }\n\n  var userFieldsMap = arrayToObject(userFields);\n\n  function scoreIndex(index) {\n    var indexFields = index.def.fields.map(getKey);\n    var score = 0;\n    for (var i = 0, len = indexFields.length; i < len; i++) {\n      var indexField = indexFields[i];\n      if (userFieldsMap[indexField]) {\n        score++;\n      }\n    }\n    return score;\n  }\n\n  if (useIndex) {\n    var useIndexDdoc = '_design/' + useIndex[0];\n    var useIndexName = useIndex.length === 2 ? useIndex[1] : false;\n    var index = matchingIndexes.find(function (index) {\n      if (useIndexName && index.ddoc === useIndexDdoc && useIndexName === index.name) {\n        return true;\n      }\n\n      if (index.ddoc === useIndexDdoc) {\n        /* istanbul ignore next */\n        return true;\n      }\n\n      return false;\n    });\n\n    if (!index) {\n      throw {\n        error: \"unknown_error\",\n        message: \"Could not find that index or could not use that index for the query\"\n      };\n    }\n    return index;\n  }\n\n  return max(matchingIndexes, scoreIndex);\n}\n\nfunction getSingleFieldQueryOptsFor(userOperator, userValue) {\n  switch (userOperator) {\n    case '$eq':\n      return {key: userValue};\n    case '$lte':\n      return {endkey: userValue};\n    case '$gte':\n      return {startkey: userValue};\n    case '$lt':\n      return {\n        endkey: userValue,\n        inclusive_end: false\n      };\n    case '$gt':\n      return {\n        startkey: userValue,\n        inclusive_start: false\n      };\n  }\n}\n\nfunction getSingleFieldCoreQueryPlan(selector, index) {\n  var field = getKey(index.def.fields[0]);\n  //ignoring this because the test to exercise the branch is skipped at the moment\n  /* istanbul ignore next */\n  var matcher = selector[field] || {};\n  var inMemoryFields = [];\n\n  var userOperators = Object.keys(matcher);\n\n  var combinedOpts;\n\n  userOperators.forEach(function (userOperator) {\n\n    if (isNonLogicalMatcher(userOperator)) {\n      inMemoryFields.push(field);\n      return;\n    }\n\n    var userValue = matcher[userOperator];\n\n    var newQueryOpts = getSingleFieldQueryOptsFor(userOperator, userValue);\n\n    if (combinedOpts) {\n      combinedOpts = mergeObjects([combinedOpts, newQueryOpts]);\n    } else {\n      combinedOpts = newQueryOpts;\n    }\n  });\n\n  return {\n    queryOpts: combinedOpts,\n    inMemoryFields: inMemoryFields\n  };\n}\n\nfunction getMultiFieldCoreQueryPlan(userOperator, userValue) {\n  switch (userOperator) {\n    case '$eq':\n      return {\n        startkey: userValue,\n        endkey: userValue\n      };\n    case '$lte':\n      return {\n        endkey: userValue\n      };\n    case '$gte':\n      return {\n        startkey: userValue\n      };\n    case '$lt':\n      return {\n        endkey: userValue,\n        inclusive_end: false\n      };\n    case '$gt':\n      return {\n        startkey: userValue,\n        inclusive_start: false\n      };\n  }\n}\n\nfunction getMultiFieldQueryOpts(selector, index) {\n\n  var indexFields = index.def.fields.map(getKey);\n\n  var inMemoryFields = [];\n  var startkey = [];\n  var endkey = [];\n  var inclusiveStart;\n  var inclusiveEnd;\n\n\n  function finish(i) {\n\n    if (inclusiveStart !== false) {\n      startkey.push(COLLATE_LO);\n    }\n    if (inclusiveEnd !== false) {\n      endkey.push(COLLATE_HI);\n    }\n    // keep track of the fields where we lost specificity,\n    // and therefore need to filter in-memory\n    inMemoryFields = indexFields.slice(i);\n  }\n\n  for (var i = 0, len = indexFields.length; i < len; i++) {\n    var indexField = indexFields[i];\n\n    var matcher = selector[indexField];\n\n    if (!matcher || !Object.keys(matcher).length) { // fewer fields in user query than in index\n      finish(i);\n      break;\n    } else if (i > 0) {\n      if (Object.keys(matcher).some(isNonLogicalMatcher)) { // non-logical are ignored\n        finish(i);\n        break;\n      }\n      var usingGtlt = (\n        '$gt' in matcher || '$gte' in matcher ||\n        '$lt' in matcher || '$lte' in matcher);\n      var previousKeys = Object.keys(selector[indexFields[i - 1]]);\n      var previousWasEq = arrayEquals(previousKeys, ['$eq']);\n      var previousWasSame = arrayEquals(previousKeys, Object.keys(matcher));\n      var gtltLostSpecificity = usingGtlt && !previousWasEq && !previousWasSame;\n      if (gtltLostSpecificity) {\n        finish(i);\n        break;\n      }\n    }\n\n    var userOperators = Object.keys(matcher);\n\n    var combinedOpts = null;\n\n    for (var j = 0; j < userOperators.length; j++) {\n      var userOperator = userOperators[j];\n      var userValue = matcher[userOperator];\n\n      var newOpts = getMultiFieldCoreQueryPlan(userOperator, userValue);\n\n      if (combinedOpts) {\n        combinedOpts = mergeObjects([combinedOpts, newOpts]);\n      } else {\n        combinedOpts = newOpts;\n      }\n    }\n\n    startkey.push('startkey' in combinedOpts ? combinedOpts.startkey : COLLATE_LO);\n    endkey.push('endkey' in combinedOpts ? combinedOpts.endkey : COLLATE_HI);\n    if ('inclusive_start' in combinedOpts) {\n      inclusiveStart = combinedOpts.inclusive_start;\n    }\n    if ('inclusive_end' in combinedOpts) {\n      inclusiveEnd = combinedOpts.inclusive_end;\n    }\n  }\n\n  var res = {\n    startkey: startkey,\n    endkey: endkey\n  };\n\n  if (typeof inclusiveStart !== 'undefined') {\n    res.inclusive_start = inclusiveStart;\n  }\n  if (typeof inclusiveEnd !== 'undefined') {\n    res.inclusive_end = inclusiveEnd;\n  }\n\n  return {\n    queryOpts: res,\n    inMemoryFields: inMemoryFields\n  };\n}\n\nfunction getDefaultQueryPlan(selector) {\n  //using default index, so all fields need to be done in memory\n  return {\n    queryOpts: {startkey: null},\n    inMemoryFields: [Object.keys(selector)]\n  };\n}\n\nfunction getCoreQueryPlan(selector, index) {\n  if (index.defaultUsed) {\n    return getDefaultQueryPlan(selector, index);\n  }\n\n  if (index.def.fields.length === 1) {\n    // one field in index, so the value was indexed as a singleton\n    return getSingleFieldCoreQueryPlan(selector, index);\n  }\n  // else index has multiple fields, so the value was indexed as an array\n  return getMultiFieldQueryOpts(selector, index);\n}\n\nfunction planQuery(request, indexes) {\n\n  var selector = request.selector;\n  var sort = request.sort;\n\n  var userFieldsRes = getUserFields(selector, sort);\n\n  var userFields = userFieldsRes.fields;\n  var sortOrder = userFieldsRes.sortOrder;\n  var index = findBestMatchingIndex(selector, userFields, sortOrder, indexes, request.use_index);\n\n  var coreQueryPlan = getCoreQueryPlan(selector, index);\n  var queryOpts = coreQueryPlan.queryOpts;\n  var coreInMemoryFields = coreQueryPlan.inMemoryFields;\n\n  var inMemoryFields = getInMemoryFields(coreInMemoryFields, index, selector, userFields);\n\n  var res = {\n    queryOpts: queryOpts,\n    index: index,\n    inMemoryFields: inMemoryFields\n  };\n  return res;\n}\n\nfunction indexToSignature(index) {\n  // remove '_design/'\n  return index.ddoc.substring(8) + '/' + index.name;\n}\n\nfunction doAllDocs(db, originalOpts) {\n  var opts = clone(originalOpts);\n\n  // CouchDB responds in weird ways when you provide a non-string to _id;\n  // we mimic the behavior for consistency. See issue66 tests for details.\n\n  if (opts.descending) {\n    if ('endkey' in opts && typeof opts.endkey !== 'string') {\n      opts.endkey = '';\n    }\n    if ('startkey' in opts && typeof opts.startkey !== 'string') {\n      opts.limit = 0;\n    }\n  } else {\n    if ('startkey' in opts && typeof opts.startkey !== 'string') {\n      opts.startkey = '';\n    }\n    if ('endkey' in opts && typeof opts.endkey !== 'string') {\n      opts.limit = 0;\n    }\n  }\n  if ('key' in opts && typeof opts.key !== 'string') {\n    opts.limit = 0;\n  }\n\n  return db.allDocs(opts)\n  .then(function (res) {\n    // filter out any design docs that _all_docs might return\n    res.rows = res.rows.filter(function (row) {\n      return !/^_design\\//.test(row.id);\n    });\n    return res;\n  });\n}\n\nfunction find$1(db, requestDef, explain) {\n  if (requestDef.selector) {\n    requestDef.selector = massageSelector(requestDef.selector);\n  }\n\n  if (requestDef.sort) {\n    requestDef.sort = massageSort(requestDef.sort);\n  }\n\n  if (requestDef.use_index) {\n    requestDef.use_index = massageUseIndex(requestDef.use_index);\n  }\n\n  validateFindRequest(requestDef);\n\n  return getIndexes$1(db).then(function (getIndexesRes) {\n\n    db.constructor.emit('debug', ['find', 'planning query', requestDef]);\n    var queryPlan = planQuery(requestDef, getIndexesRes.indexes);\n    db.constructor.emit('debug', ['find', 'query plan', queryPlan]);\n\n    var indexToUse = queryPlan.index;\n\n    validateSort(requestDef, indexToUse);\n\n    var opts = assign({\n      include_docs: true,\n      reduce: false\n    }, queryPlan.queryOpts);\n\n    if ('startkey' in opts && 'endkey' in opts &&\n        collate(opts.startkey, opts.endkey) > 0) {\n      // can't possibly return any results, startkey > endkey\n      /* istanbul ignore next */\n      return {docs: []};\n    }\n\n    var isDescending = requestDef.sort &&\n      typeof requestDef.sort[0] !== 'string' &&\n      getValue(requestDef.sort[0]) === 'desc';\n\n    if (isDescending) {\n      // either all descending or all ascending\n      opts.descending = true;\n      opts = reverseOptions(opts);\n    }\n\n    if (!queryPlan.inMemoryFields.length) {\n      // no in-memory filtering necessary, so we can let the\n      // database do the limit/skip for us\n      if ('limit' in requestDef) {\n        opts.limit = requestDef.limit;\n      }\n      if ('skip' in requestDef) {\n        opts.skip = requestDef.skip;\n      }\n    }\n\n    if (explain) {\n      return Promise.resolve(queryPlan, opts);\n    }\n\n    return Promise.resolve().then(function () {\n      if (indexToUse.name === '_all_docs') {\n        return doAllDocs(db, opts);\n      } else {\n        var signature = indexToSignature(indexToUse);\n        return abstractMapper.query.call(db, signature, opts);\n      }\n    }).then(function (res) {\n      if (opts.inclusive_start === false) {\n        // may have to manually filter the first one,\n        // since couchdb has no true inclusive_start option\n        res.rows = filterInclusiveStart(res.rows, opts.startkey, indexToUse);\n      }\n\n      if (queryPlan.inMemoryFields.length) {\n        // need to filter some stuff in-memory\n        res.rows = filterInMemoryFields(res.rows, requestDef, queryPlan.inMemoryFields);\n      }\n\n      var resp = {\n        docs: res.rows.map(function (row) {\n          var doc = row.doc;\n          if (requestDef.fields) {\n            return pick(doc, requestDef.fields);\n          }\n          return doc;\n        })\n      };\n\n      if (indexToUse.defaultUsed) {\n        resp.warning = 'no matching index found, create an index to optimize query time';\n      }\n\n      return resp;\n    });\n  });\n}\n\nfunction explain$1(db, requestDef) {\n  return find$1(db, requestDef, true)\n  .then(function (queryPlan) {\n    return {\n      dbname: db.name,\n      index: queryPlan.index,\n      selector: requestDef.selector,\n      range: {\n        start_key: queryPlan.queryOpts.startkey,\n        end_key: queryPlan.queryOpts.endkey,\n      },\n      opts: {\n        use_index: requestDef.use_index || [],\n        bookmark: \"nil\", //hardcoded to match CouchDB since its not supported,\n        limit: requestDef.limit,\n        skip: requestDef.skip,\n        sort: requestDef.sort || {},\n        fields: requestDef.fields,\n        conflicts: false, //hardcoded to match CouchDB since its not supported,\n        r: [49], // hardcoded to match CouchDB since its not support\n      },\n      limit: requestDef.limit,\n      skip: requestDef.skip || 0,\n      fields: requestDef.fields,\n    };\n  });\n}\n\nfunction deleteIndex$1(db, index) {\n\n  if (!index.ddoc) {\n    throw new Error('you must supply an index.ddoc when deleting');\n  }\n\n  if (!index.name) {\n    throw new Error('you must supply an index.name when deleting');\n  }\n\n  var docId = index.ddoc;\n  var viewName = index.name;\n\n  function deltaFun(doc) {\n    if (Object.keys(doc.views).length === 1 && doc.views[viewName]) {\n      // only one view in this ddoc, delete the whole ddoc\n      return {_id: docId, _deleted: true};\n    }\n    // more than one view here, just remove the view\n    delete doc.views[viewName];\n    return doc;\n  }\n\n  return upsert(db, docId, deltaFun).then(function () {\n    return abstractMapper.viewCleanup.apply(db);\n  }).then(function () {\n    return {ok: true};\n  });\n}\n\nvar createIndexAsCallback = callbackify(createIndex$1);\nvar findAsCallback = callbackify(find$1);\nvar explainAsCallback = callbackify(explain$1);\nvar getIndexesAsCallback = callbackify(getIndexes$1);\nvar deleteIndexAsCallback = callbackify(deleteIndex$1);\n\nvar plugin = {};\nplugin.createIndex = toPromise(function (requestDef, callback) {\n\n  if (typeof requestDef !== 'object') {\n    return callback(new Error('you must provide an index to create'));\n  }\n\n  var createIndex$$1 = isRemote(this) ?\n    createIndex : createIndexAsCallback;\n  createIndex$$1(this, requestDef, callback);\n});\n\nplugin.find = toPromise(function (requestDef, callback) {\n\n  if (typeof callback === 'undefined') {\n    callback = requestDef;\n    requestDef = undefined;\n  }\n\n  if (typeof requestDef !== 'object') {\n    return callback(new Error('you must provide search parameters to find()'));\n  }\n\n  var find$$1 = isRemote(this) ? find : findAsCallback;\n  find$$1(this, requestDef, callback);\n});\n\nplugin.explain = toPromise(function (requestDef, callback) {\n\n  if (typeof callback === 'undefined') {\n    callback = requestDef;\n    requestDef = undefined;\n  }\n\n  if (typeof requestDef !== 'object') {\n    return callback(new Error('you must provide search parameters to explain()'));\n  }\n\n  var find$$1 = isRemote(this) ? explain : explainAsCallback;\n  find$$1(this, requestDef, callback);\n});\n\nplugin.getIndexes = toPromise(function (callback) {\n\n  var getIndexes$$1 = isRemote(this) ? getIndexes : getIndexesAsCallback;\n  getIndexes$$1(this, callback);\n});\n\nplugin.deleteIndex = toPromise(function (indexDef, callback) {\n\n  if (typeof indexDef !== 'object') {\n    return callback(new Error('you must provide an index to delete'));\n  }\n\n  var deleteIndex$$1 = isRemote(this) ?\n    deleteIndex : deleteIndexAsCallback;\n  deleteIndex$$1(this, indexDef, callback);\n});\n\nexport default plugin;\n","/**\n * Module dependencies.\n */\n\ntry {\n  var EventEmitter = require('events').EventEmitter;\n  if (!EventEmitter) throw new Error();\n} catch (err) {\n  var Emitter = require('emitter');\n}\n\n/**\n * Defer.\n */\n\nvar defer = typeof process !== 'undefined' && process && typeof process.nextTick === 'function'\n  ? process.nextTick\n  : function(fn){ setTimeout(fn); };\n\n/**\n * Noop.\n */\n\nfunction noop(){}\n\n/**\n * Expose `Batch`.\n */\n\nmodule.exports = Batch;\n\n/**\n * Create a new Batch.\n */\n\nfunction Batch() {\n  if (!(this instanceof Batch)) return new Batch;\n  this.fns = [];\n  this.concurrency(Infinity);\n  this.throws(true);\n  for (var i = 0, len = arguments.length; i < len; ++i) {\n    this.push(arguments[i]);\n  }\n}\n\n/**\n * Inherit from `EventEmitter.prototype`.\n */\n\nif (EventEmitter) {\n  Batch.prototype.__proto__ = EventEmitter.prototype;\n} else {\n  Emitter(Batch.prototype);\n}\n\n/**\n * Set concurrency to `n`.\n *\n * @param {Number} n\n * @return {Batch}\n * @api public\n */\n\nBatch.prototype.concurrency = function(n){\n  this.n = n;\n  return this;\n};\n\n/**\n * Queue a function.\n *\n * @param {Function} fn\n * @return {Batch}\n * @api public\n */\n\nBatch.prototype.push = function(fn){\n  this.fns.push(fn);\n  return this;\n};\n\n/**\n * Set wether Batch will or will not throw up.\n *\n * @param  {Boolean} throws\n * @return {Batch}\n * @api public\n */\nBatch.prototype.throws = function(throws) {\n  this.e = !!throws;\n  return this;\n};\n\n/**\n * Execute all queued functions in parallel,\n * executing `cb(err, results)`.\n *\n * @param {Function} cb\n * @return {Batch}\n * @api public\n */\n\nBatch.prototype.end = function(cb){\n  var self = this\n    , total = this.fns.length\n    , pending = total\n    , results = []\n    , errors = []\n    , cb = cb || noop\n    , fns = this.fns\n    , max = this.n\n    , throws = this.e\n    , index = 0\n    , done;\n\n  // empty\n  if (!fns.length) return defer(function(){\n    cb(null, results);\n  });\n\n  // process\n  function next() {\n    var i = index++;\n    var fn = fns[i];\n    if (!fn) return;\n    var start = new Date;\n\n    try {\n      fn(callback);\n    } catch (err) {\n      callback(err);\n    }\n\n    function callback(err, res){\n      if (done) return;\n      if (err && throws) return done = true, defer(function(){\n        cb(err);\n      });\n      var complete = total - pending + 1;\n      var end = new Date;\n\n      results[i] = res;\n      errors[i] = err;\n\n      self.emit('progress', {\n        index: i,\n        value: res,\n        error: err,\n        pending: pending,\n        total: total,\n        complete: complete,\n        percent: complete / total * 100 | 0,\n        start: start,\n        end: end,\n        duration: end - start\n      });\n\n      if (--pending) next();\n      else defer(function(){\n        if(!throws) cb(errors, results);\n        else cb(null, results);\n      });\n    }\n  }\n\n  // concurrency\n  for (var i = 0; i < fns.length; i++) {\n    if (i == max) break;\n    next();\n  }\n\n  return this;\n};\n","import PouchDB from \"pouchdb-browser\";\nimport find from \"pouchdb-find\";\nPouchDB.plugin(find);\n\nimport Batch from \"batch\";\n\nimport { upsert } from \"../utils/db\";\n\nconst getOptions = dbName => {\n  const OPTIONS = {\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"Ocp-Apim-Subscription-Key\": dbName\n    }\n  };\n\n  return OPTIONS;\n};\n\nself.addEventListener(\"message\", async e => {\n  if (!e) return;\n\n  const { action, dbName, url } = e.data;\n\n  const db = new PouchDB(dbName);\n\n  const messages = await db.find({\n    selector: {\n      type: \"message\",\n      status: {\n        $nin: [\"FAILED\", \"NOTSENT\"]\n      },\n      retrieved: {\n        $ne: true\n      }\n    }\n  });\n\n  const batch = new Batch();\n  batch.concurrency(1);\n  batch.on(\"progress\", e => {});\n\n  messages.docs.forEach(entry => {\n    batch.push(async done => {\n      const { id, fiscal_code } = entry.message;\n      const path = `messages/${fiscal_code}/${id}`;\n      const message = await fetch(`${url}/${path}`, {\n        ...getOptions(dbName),\n        method: \"GET\"\n      }).then(response => response.json());\n\n      if (message.statusCode) {\n        // API returned an error\n        console.error(id);\n      } else {\n        const operation = await upsert(db, entry._id, {\n          ...entry,\n          ...message,\n          retrieved: true\n        });\n      }\n\n      done();\n    });\n  });\n\n  // Actually startes the batch\n  batch.end((err, data) => {\n    if (!err) {\n      postMessage({\n        ...e.data,\n        completed: true\n      });\n    }\n  });\n});\n\n/*\n  The status of a notification (one for each channel).\n  \"SENT\": the notification was succesfully sent to the channel (ie. email or push notification)\n  \"THROTTLED\": a temporary failure caused a retry during the notification processing;\n    the notification associated with this channel will be delayed for a maximum of 7 days or until the message expires\n  \"EXPIRED\": the message expired before the notification could be sent;\n    this means that the maximum message time to live was reached; no notification will be sent to this channel\n  \"FAILED\": a permanent failure caused the process to exit with an error, no notification will be sent to this channel\n*/\n"]}