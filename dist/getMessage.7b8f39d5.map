{"version":3,"sources":["node_modules\\argsarray\\index.js","node_modules\\immediate\\lib\\index.js","node_modules\\spark-md5\\spark-md5.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\randombytes\\browser.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\hash-base\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\md5.js\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\ripemd160\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\sha.js\\hash.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\sha.js\\sha.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\sha.js\\sha1.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\sha.js\\sha256.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\sha.js\\sha224.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\sha.js\\sha512.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\sha.js\\sha384.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\sha.js\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\cipher-base\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\create-hash\\browser.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\create-hmac\\legacy.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\create-hash\\md5.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\create-hmac\\browser.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-sign\\algos.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\pbkdf2\\lib\\precondition.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\pbkdf2\\lib\\default-encoding.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\pbkdf2\\lib\\sync.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\pbkdf2\\lib\\async.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\pbkdf2\\browser.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\des.js\\lib\\des\\utils.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\minimalistic-assert\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\des.js\\lib\\des\\cipher.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\des.js\\lib\\des\\des.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\des.js\\lib\\des\\cbc.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\des.js\\lib\\des\\ede.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\des.js\\lib\\des.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-des\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\modes\\ecb.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\buffer-xor\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\modes\\cbc.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\modes\\cfb.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\modes\\cfb8.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\modes\\cfb1.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\modes\\ofb.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\incr32.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\modes\\ctr.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\modes\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\aes.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\ghash.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\authCipher.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\streamCipher.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\evp_bytestokey\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\encrypter.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\decrypter.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-aes\\browser.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-des\\modes.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-cipher\\browser.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\bn.js\\lib\\bn.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\brorand\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\miller-rabin\\lib\\mr.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\diffie-hellman\\lib\\generatePrime.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\diffie-hellman\\lib\\dh.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\diffie-hellman\\browser.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-rsa\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\minimalistic-crypto-utils\\lib\\utils.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\elliptic\\lib\\elliptic\\utils.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\elliptic\\lib\\elliptic\\curve\\base.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\elliptic\\lib\\elliptic\\curve\\short.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\elliptic\\lib\\elliptic\\curve\\mont.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\elliptic\\lib\\elliptic\\curve\\edwards.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\elliptic\\lib\\elliptic\\curve\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\hash.js\\lib\\hash\\utils.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\hash.js\\lib\\hash\\common.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\hash.js\\lib\\hash\\sha\\common.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\hash.js\\lib\\hash\\sha\\1.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\hash.js\\lib\\hash\\sha\\256.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\hash.js\\lib\\hash\\sha\\224.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\hash.js\\lib\\hash\\sha\\512.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\hash.js\\lib\\hash\\sha\\384.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\hash.js\\lib\\hash\\sha.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\hash.js\\lib\\hash\\ripemd.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\hash.js\\lib\\hash\\hmac.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\hash.js\\lib\\hash.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\elliptic\\lib\\elliptic\\precomputed\\secp256k1.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\elliptic\\lib\\elliptic\\curves.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\hmac-drbg\\lib\\hmac-drbg.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\elliptic\\lib\\elliptic\\ec\\key.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\elliptic\\lib\\elliptic\\ec\\signature.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\elliptic\\lib\\elliptic\\ec\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\elliptic\\lib\\elliptic\\eddsa\\key.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\elliptic\\lib\\elliptic\\eddsa\\signature.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\elliptic\\lib\\elliptic\\eddsa\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\elliptic\\lib\\elliptic.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\indexof\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\vm-browserify\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\asn1.js\\lib\\asn1\\api.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\asn1.js\\lib\\asn1\\base\\reporter.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\asn1.js\\lib\\asn1\\base\\buffer.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\asn1.js\\lib\\asn1\\base\\node.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\asn1.js\\lib\\asn1\\base\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\asn1.js\\lib\\asn1\\constants\\der.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\asn1.js\\lib\\asn1\\constants\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\asn1.js\\lib\\asn1\\decoders\\der.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\asn1.js\\lib\\asn1\\decoders\\pem.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\asn1.js\\lib\\asn1\\decoders\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\asn1.js\\lib\\asn1\\encoders\\der.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\asn1.js\\lib\\asn1\\encoders\\pem.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\asn1.js\\lib\\asn1\\encoders\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\asn1.js\\lib\\asn1.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\parse-asn1\\certificate.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\parse-asn1\\asn1.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\parse-asn1\\fixProc.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\parse-asn1\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-sign\\browser\\sign.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-sign\\browser\\verify.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\browserify-sign\\browser\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\create-ecdh\\browser.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\public-encrypt\\mgf.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\public-encrypt\\xor.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\public-encrypt\\withPublic.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\public-encrypt\\publicEncrypt.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\public-encrypt\\privateDecrypt.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\public-encrypt\\browser.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\randomfill\\browser.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\crypto-browserify\\index.js","node_modules\\uuid\\lib\\rng.js","node_modules\\uuid\\lib\\bytesToUuid.js","node_modules\\uuid\\v1.js","node_modules\\uuid\\v4.js","node_modules\\uuid\\index.js","node_modules\\vuvuzela\\index.js","node_modules\\pouchdb-browser\\lib\\index.es.js","node_modules\\clone-buffer\\index.js","node_modules\\pouchdb-find\\node_modules\\pouchdb-collections\\lib\\index.es.js","node_modules\\pouchdb-errors\\lib\\index.es.js","node_modules\\pouchdb-md5\\lib\\index.es.js","node_modules\\pouchdb-find\\node_modules\\pouchdb-utils\\lib\\index.es.js","node_modules\\node-fetch\\browser.js","node_modules\\es6-denodeify\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\punycode\\punycode.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\url\\util.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\querystring-es3\\decode.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\querystring-es3\\encode.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\querystring-es3\\index.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\url\\url.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\util\\support\\isBuffer.js","..\\..\\AppData\\Roaming\\npm-cache\\_npx\\9788\\node_modules\\parcel\\node_modules\\util\\util.js","node_modules\\psl\\index.js","node_modules\\tough-cookie\\lib\\pubsuffix-psl.js","node_modules\\tough-cookie\\lib\\store.js","node_modules\\tough-cookie\\lib\\permuteDomain.js","node_modules\\tough-cookie\\lib\\pathMatch.js","node_modules\\tough-cookie\\lib\\memstore.js","node_modules\\tough-cookie\\lib\\cookie.js","node_modules\\fetch-cookie\\index.js","node_modules\\pouchdb-fetch\\lib\\index.es.js","node_modules\\pouchdb-find\\node_modules\\pouchdb-collate\\lib\\index.es.js","node_modules\\pouchdb-find\\node_modules\\pouchdb-selector-core\\lib\\index.es.js","node_modules\\pouchdb-abstract-mapreduce\\node_modules\\pouchdb-collections\\lib\\index.es.js","node_modules\\pouchdb-abstract-mapreduce\\node_modules\\pouchdb-utils\\lib\\index.es.js","node_modules\\buffer-from\\index.js","node_modules\\pouchdb-abstract-mapreduce\\node_modules\\pouchdb-binary-utils\\lib\\index.es.js","node_modules\\pouchdb-abstract-mapreduce\\node_modules\\pouchdb-collate\\lib\\index.es.js","node_modules\\pouchdb-mapreduce-utils\\node_modules\\pouchdb-collections\\lib\\index.es.js","node_modules\\pouchdb-mapreduce-utils\\node_modules\\pouchdb-utils\\lib\\index.es.js","node_modules\\pouchdb-mapreduce-utils\\lib\\index.es.js","node_modules\\pouchdb-abstract-mapreduce\\lib\\index.es.js","node_modules\\pouchdb-find\\lib\\index.es.js","node_modules\\batch\\index.js","src\\workers\\getMessage.js"],"names":["Buffer","require","Transform","inherits","throwIfNotStringOrBuffer","val","prefix","isBuffer","TypeError","HashBase","blockSize","call","_block","allocUnsafe","_blockSize","_blockOffset","_length","_finalized","prototype","_transform","chunk","encoding","callback","error","update","err","_flush","push","digest","data","Error","from","block","offset","length","i","_update","j","carry","_digest","undefined","toString","fill","module","exports","MAX_ALLOC","Math","pow","checkBuffer","buf","name","password","salt","iterations","keylen","defaultEncoding","process","browser","pVersionMajor","parseInt","version","split","slice","sizes","md5","sha1","sha224","sha256","sha384","sha512","rmd160","ripemd160","createHmac","checkParameters","pbkdf2","DK","block1","copy","destPos","hLen","l","ceil","writeUInt32BE","T","U","k","sync","ZERO_BUF","subtle","global","crypto","toBrowser","checks","checkNative","algo","Promise","resolve","importKey","deriveBits","alloc","prom","browserPbkdf2","then","catch","key","hash","res","resolvePromise","promise","out","nextTick","e","toLowerCase","resp","pbkdf2Sync","isBinaryObject","object","ArrayBuffer","Blob","cloneArrayBuffer","buff","target","byteLength","targetArray","Uint8Array","sourceArray","set","cloneBinaryObject","size","type","webkitSlice","funcToString","Function","objectCtorString","Object","isPlainObject","value","proto","getPrototypeOf","Ctor","constructor","clone","newObject","len","Array","isArray","Date","toISOString","hasOwnProperty","once","fun","called","args","apply","toPromise","func","self","usedCB","pop","fulfill","reject","mesg","result","logApiCall","listeners","logArgs","emit","origCallback","responseArgs","concat","adapterFun","_closed","_destroyed","taskqueue","isReady","addTask","failed","mangle","unmangle","substring","Map$1","_store","get","mangled","has","delete","forEach","cb","keys","defineProperty","Set$1","array","add","supportsMapAndSet","Symbol","Map","Set","prop","getOwnPropertyDescriptor","species","ExportedSet","ExportedMap","pick","obj","arr","MAX_NUM_CONCURRENT_REQUESTS","identityFunction","x","formatResultForOpenRevsGet","ok","bulkGet","db","opts","requests","docs","requestsById","request","id","numDocs","numDone","perDocResults","collapseResultsAndFinish","results","info","checkDone","gotResult","docIndex","allRequests","nextBatch","upTo","min","batch","processBatch","docId","docIdx","docRequests","docOpts","open_revs","map","rev","filter","formatResult","param","hasLocal","localStorage","setItem","getItem","hasLocalStorage","Changes","EventEmitter","attachBrowserEvents","addEventListener","_listeners","addListener","dbName","inprogress","eventFunction","changesOpts","onError","changes","on","c","seq","since","cancelled","onChange","removeListener","notifyLocalWindows","notify","guardedConsole","method","console","arguments","randomNumber","max","maxTimeout","ratio","random","range","defaultBackOff","explainError","status","str","assign","to","index","nextSource","nextKey","$inject_Object_assign","PouchError","reason","message","JSON","stringify","UNAUTHORIZED","MISSING_BULK_DOCS","MISSING_DOC","REV_CONFLICT","INVALID_ID","MISSING_ID","RESERVED_ID","NOT_OPEN","UNKNOWN_ERROR","BAD_ARG","INVALID_REQUEST","QUERY_PARSE_ERROR","DOC_VALIDATION","BAD_REQUEST","NOT_AN_OBJECT","DB_MISSING","IDB_ERROR","WSQ_ERROR","LDB_ERROR","FORBIDDEN","INVALID_REV","FILE_EXISTS","MISSING_STUB","INVALID_URL","createError","CustomPouchError","p","generateErrorFromResponse","tryFilter","doc","req","msg","filterChange","hasFilter","query","query_params","change","filterReturn","include_docs","attachments","att","_attachments","stub","flatten","arrs","invalidIdError","test","isRemote","_remote","listenerCount","ee","parseDesignDocFunctionName","s","parts","normalizeDesignDocFunctionName","normalized","join","qName","qParser","parser","parseUri","m","exec","uri","encoded","indexOf","decodeURIComponent","replace","$0","$1","$2","scopeEval","source","scope","values","upsert","diffFun","docRev","_rev","newDoc","updated","_id","tryAndPut","put","thisAtob","atob","thisBtoa","btoa","createBlob","properties","Builder","BlobBuilder","MSBlobBuilder","MozBlobBuilder","WebKitBlobBuilder","builder","append","getBlob","binaryStringToArrayBuffer","bin","charCodeAt","binStringToBluffer","binString","b64ToBluffer","b64","arrayBufferToBinaryString","buffer","binary","bytes","String","fromCharCode","readAsBinaryString","blob","reader","FileReader","hasBinaryString","onloadend","readAsArrayBuffer","blobToBinaryString","blobOrBuffer","blobToBase64","base64","setImmediateShim","setImmediate","setTimeout","MD5_CHUNK_SIZE","rawToBase64","raw","sliceBlob","start","end","appendBlob","arrayBuffer","appendString","string","appendBinary","binaryMd5","inputIsString","chunkSize","chunks","currentChunk","Md5","next","loadNextChunk","done","destroy","stringMd5","rev$$1","deterministic_revs","clonedDoc","uuidV4","v4","_rev_tree","uuid","winningRev","metadata","winningId","winningPos","winningDeleted","toVisit","rev_tree","node","tree","ids","branches","pos","deleted","traverseRevTree","revs","newCtx","ctx","sortByPos","a","b","collectLeaves","leaves","isLeaf","acc","sort","reverse","collectConflicts","win","conflicts","leaf","compactTree","revHash","rootToLeaf","paths","history","sortByPos$1","binarySearch","item","comparator","low","high","mid","insertSorted","idx","splice","pathToTree","path","numStemmed","root","currentLeaf","compareTree","mergeTree","in_tree1","in_tree2","queue","tree1","tree2","merged","doMerge","dontExpand","restree","branch","t1","t2","diff","candidateParents","trees","parent","parentIdx","elements","elementsLen","el","stem","depth","stemmedRevs","stemmed","merge","newTree","revExists","splitRev","targetPos","targetId","getTrees","isDeleted","isLocalId","latest","historyNode","historyRev","Changes$1","tryCatchInChangeListener","pending","lastSeq","complete","removeAllListeners","onDestroy","cancel","isCancelled","bind","validateChanges","processChange","changeList","style","_conflicts","PouchDB","_changesFilterPlugin","validate","doChanges","continuous","live","update_seq","normalize","shouldFilter","descending","limit","newPromise","_changes","compare","left","right","yankError","cleanDocs","_deleted","atts","compareByIdThenRev","idCompare","aStart","_revisions","bStart","computeHeight","height","edges","prnt","edge","allDocsKeysParse","skip","doNextCompaction","task","_compactionQueue","last_seq","_compact","shift","attachmentNameError","charAt","AbstractPouchDB","post","bulkDocs","_putLocal","_removeLocal","force","transformForceOptionToNewEditsOption","putDoc","oldRevId","oldRevNum","newRevNum","newRevId","new_edits","_put","putAttachment","attachmentId","api","createAttachment","prevrevpos","content_type","revpos","removeAttachment","remove","docOrId","optsOrRev","was_delete","revsDiff","count","missing","addToMissing","revId","processDoc","missingForId","_getRevisionTree","missingObj","compactDocument","maxHeight","revTree","candidates","_doCompaction","compact","return_docs","promises","row","onComplete","all","deltaFunc","_getLocal","finishOpenRevs","existing","_get","revs_info","splittedRev","revNo","currentPath","hashIndex","hashFoundAtRevPos","indexOfRev","howMany","_revs_info","_getAttachment","getAttachment","allDocs","start_key","startkey","end_key","endkey","incompatibleOpt","_allDocs","close","_close","_info","db_name","auto_compaction","adapter","_type","attachmentError","_bulkDocs","registerDependentDatabase","dependentDb","depDB","__opts","dependentDbs","usePrefix","use_prefix","destroyDb","_destroy","localDoc","deletedMap","trueName","RegExp","TaskQueue","execute","fail","ready","parseAdapter","match","adapters","preferredAdapters","adapterName","prepareForDestruction","onDestroyed","from_constructor","onClosed","prefixedName","backend","_adapter","valid","AbortController","abort","f$1","fetch","h","Headers","eventEmitter","setUpEventEmitter","Pouch","destructListeners","_destructionListeners","onConstructorRef","onConstructorUnref","dbList","onConstructorDestroyed","addToPreferredAdapters","plugin","__defaults","defaults","defaultOpts","PouchAlt","url","getFieldFromDoc","parsedField","compare$1","parseField","fieldName","fields","current","ch","combinationFields","isCombinationalField","field","getKey","getValue","mergeAndedSelectors","selectors","selector","matcher","$eq","fieldMatchers","operator","mergeGtGte","mergeLtLte","mergeNe","mergeEq","$gte","$gt","$lte","$lt","$ne","massageSelector","input","wasAnded","orOrNor","subSelector","pad","padWith","upToLength","padding","targetLength","padLeft","MIN_MAGNITUDE","MAGNITUDE_DIGITS","SEP","collate","normalizeKey","ai","collationIndex","bi","stringCollate","arrayCollate","objectCollate","Infinity","isNaN","origKey","toJSON","indexify","numToIndexableString","toIndexableString","objKey","zero","parseNumber","originalIdx","num","neg","numAsString","magAsString","magnitude","parseFloat","stack","metaStack","lastMetaElement","element","lastElementIndex","parseIndexableString","parsedNum","parsedStr","arrayElement","objElement","ak","bk","expFormat","toExponential","magForComparison","magString","factor","abs","factorStr","toFixed","createFieldSorter","getFieldValuesAsArray","sorting","docFieldValue","aRow","bRow","aFieldValues","bFieldValues","collation","filterInMemoryFields","rows","requestDef","inMemoryFields","rowFilter","fieldSorter","every","matchCominationalSelector","matchSelector","userOperator","userValue","some","orMatchers","find","matchers","fieldExists","fieldIsNotUndefined","modField","divisor","mod","arrayContainsValue","arrayContainsAllValues","arraySize","regexMatch","re","typeMatch","neValue","matchesSelector","rowsMatched","evalFilter","evalView","code","filterName","view","changesHandler","doc_ids","viewName","ddoc","mapFun","views","filterFun","filters","applyChangesFilterPlugin","toObject","reduce","reservedWords","dataWords","parseRevisionInfo","makeRevTreeFromRevisions","revisions","revisionIds","parseDoc","newEdits","dbOpts","nRevNum","revInfo","specialKey","parseBase64","preprocessString","blobType","asBinary","preprocessBlob","preprocessAttachment","preprocessAttachments","docInfos","docv","overallErr","docInfo","recv","processedAttachment","updateDoc","revLimit","prev","writeDoc","previousWinningRev","previouslyDeleted","isRoot","inConflict","newRev","rev_map","winningRev$$1","winningRevIsDeleted","delta","newRevIsDeleted","rootIsMissing","processDocs","fetchedDocs","tx","overallCallback","insertDoc","resultsIdx","idsToDocs","docsDone","docsToDo","checkAllDocsDone","currentDoc","docWritten","nextDoc","ADAPTER_VERSION","DOC_STORE","BY_SEQ_STORE","ATTACH_STORE","ATTACH_AND_SEQ_STORE","META_STORE","LOCAL_STORE","DETECT_BLOB_SUPPORT_STORE","safeJsonParse","parse","vuvuzela","safeJsonStringify","json","idbError","evt","encodeMetadata","deletedOrLocal","decodeMetadata","storedObject","decodeDoc","_doc_id_rev","lastIndexOf","readBlobData","body","asBlob","fetchAttachmentsIfNecessary","txn","fetchAttachment","attObj","objectStore","onsuccess","postProcessAttachments","attNames","compactRevs","possiblyOrphanedDigests","seqStore","attStore","attAndSeqStore","deleteOrphanedAttachments","countReq","IDBKeyRange","bound","cursor","openCursor","only","event","digestSeq","primaryKey","continue","openTransactionSafely","idb","stores","mode","transaction","idbBulkDocs","docStore","bySeqStore","attachStore","attachAndSeqStore","metaStore","docInfoError","metaDoc","allDocsProcessed","docCountDelta","preconditionErrored","_meta","blobSupport","startTransaction","txnResult","onabort","ontimeout","oncomplete","updateDocCountIfReady","verifyAttachments","fetchExistingDocs","onAllDocsProcessed","idbProcessDocs","revs_limit","docCount","numFetched","readMetadata","verifyAttachment","finish","digests","filename","attErr","isUpdate","hasAttachments","writeAttachments","finishDoc","afterPutDoc","revsToDelete","metadataToStore","metaDataReq","afterPutMetadata","afterPutDocError","preventDefault","stopPropagation","getKeyReq","putReq","insertAttachmentMappings","onerror","collectResults","attachmentSaved","saveAttachment","attsAdded","attsToAdd","newAtt","runBatchedCursor","keyRange","batchSize","onBatch","useGetAll","getAll","getAllKeys","keysBatch","valuesBatch","pseudoCursor","onGetAll","onGetAllKeys","continuePseudoCursor","lastKey","newKeyRange","upper","upperOpen","lowerBound","onCursor","onSuccess","allDocsKeys","createKeyRange","inclusiveEnd","upperBound","idbAllDocs","inclusive_end","keyRangeError","onTxnComplete","docIdRevIndex","updateSeq","getMaxUpdateSeq","maxKey","fetchDocAsynchronously","onGetDoc","allDocsInner","batchValues","batchValue","batchKeys","onResultsReady","returnVal","total_rows","checkBlobSupport","blob$$1","matchedChrome","navigator","userAgent","matchedEdge","countDocs","running","tryCode","applyNext","enqueueTask","action","runAction","runCallback","runNext","docIds","numResults","docIdsToMetadata","winningDocs","metadatas","processMetadataAndWinningDoc","winningDoc","filtered","onBatchDone","fetchWinningDocAndMetadata","onGetMetadata","docIdRev","objectStores","cachedDBs","blobSupportPromise","openReqList","IdbPouch","thisCallback","init","createSchema","createObjectStore","keyPath","autoIncrement","createIndex","unique","addDeletedOrLocalIndex","createLocalStoreSchema","migrateLocalStore","localStore","local","seqCursor","addAttachAndSeqStore","migrateAttsAndSeqs","digestMap","migrateMetadata","decodeMetadataCompat","fetchMetadataSeq","metadataSeq","onGetMetadataSeq","instanceId","idb_bulkDocs","reqOpts","idb_get","attachId","attachment","blobData","idb_info","doc_count","idb_attachment_format","idb_allDocs","idbChanges","oldRev","ret","oStore","oldDoc","openReq","indexedDB","deleteDatabase","cached","open","onupgradeneeded","oldVersion","currentTarget","migrations","migration","onversionchange","storedMetaDoc","completeSetup","storeMetaDocIfReady","instanceKey","IDBPouch","pool","promiseFactories","doNext","runNextBatch","thisErr","CHANGES_BATCH_SIZE","MAX_SIMULTANEOUS_REVS","CHANGES_TIMEOUT_BUFFER","DEFAULT_HEARTBEAT","supportsBulkGetMap","readAttachmentsAsBlobOrBuffer","encodeDocId","encodeURIComponent","preprocessAttachments$1","hasUrlPrefix","protocol","getHost","substr","user","auth","username","genDBUrl","genUrl","pathDel","host","port","paramsToStr","params","shouldCacheBust","ua","isIE","isTrident","isEdge","isGET","HttpPouch","dbUrl","ourFetch","options","headers","nAuth","token","unescape","now","fetchFun","adapterFun$$1","setup","fetchJSON","response","v","setupPromise","skip_setup","uuid$$1","ping","compact_running","interval","doBulkGet","doBulkGetShim","numBatches","onResult","batchNum","subOpts","supportsBulkGet","fetchAttachments","filenames","fetchData","encodeAttachmentId","fetchAllAttachments","docOrDocs","contentType","paramStr","batch_size","heartbeat","requestTimeout","timeout","leftToFetch","feed","seq_interval","param_name","controller","lastFetchedSeq","aborted","fetchOpts","signal","fetched","raw_results_length","finished","HttpPouch$1","QueryParseError","captureStackTrace","NotFoundError","BuiltInError","promisedCallback","callbackify","fin","finalPromiseFactory","sequentialize","promiseFactory","that","uniq","theSet","mapToKeysArray","createBuiltInError","sum","jLen","jNum","log","evalFunctionWithEval","TaskQueue$1","createViewSignature","reduceFun","createView","sourceDB","temporary","localDocName","viewSignature","cachedViews","_cachedViews","promiseForView","depDbName","diffFunction","fullViewName","depDbs","lastSeqDoc","persistentQueues","tempViewQueue","CHANGES_BATCH_SIZE$1","parseViewName","isGenOne","emitError","createAbstractMapReduce","mapper","reducer","ddocValidator","tryMap","tryReduce","rereduce","output","sortByKeyThenValue","y","keyCompare","sliceResults","rowToDocId","postprocessAttachments","addHttpParam","paramName","asJson","coerceInteger","integerCandidate","asNumber","Number","coerceOptions","group_level","checkPositiveInteger","number","checkQueryParseError","startkeyName","endkeyName","group","optionName","httpQuery","MAX_URL_LENGTH","keysAsString","customQuery","_query","customViewCleanup","_viewCleanup","defaultsTo","getDocsToPersist","docIdsToChangesAndEmits","metaDocId","defaultMetaDoc","docData","indexableKeysToKeyValues","getMetaDoc","getKeyValueDocs","processKeyValueDocs","kvDocsRes","kvDocs","oldKeys","keyValue","newKeys","kvDoc","saveKeyValues","seqDocId","listOfDocsToPersist","docsToPersist","getQueue","updateView","updateViewInQueue","mapResults","currentSeq","processNextBatch","createDocIdsToChangesAndEmits","createIndexableKeysToKeyValues","emittedKeyValue","complexKey","reduceView","shouldGroup","groups","lvl","POSITIVE_INFINITY","last","groupKey","reduceTry","queryView","queryViewInQueue","totalRows","shouldReduce","fetchFromView","viewOpts","expectedKeys","parsedKeyAndDocId","onMapResultsReady","finalResults","allDocsRes","docIdsToDocs","fetchPromises","keyStart","keyEnd","httpViewCleanup","localViewCleanup","docsToViews","designDocName","viewsToStatus","ddocName","viewDBNames","statusIsGood","viewDBName","dbsToDelete","destroyPromises","queryPromised","createViewPromise","stale","abstractQuery","abstractViewCleanup","viewCleanup","builtInReduce","_sum","_count","_stats","sumsqr","_sumsqr","getBuiltIn","reduceFunString","origMap","builtIn","abstract","mapreduce","isGenOne$1","fileHasChanged","remoteDoc","getDocAttachments","getDocAttachmentsFromTargetOrSource","src","doCheckForLocalAttachments","createBulkGetOpts","diffs","missingRevs","missingRev","getDocs","state","resultDocs","getAllDocs","bulkGetOpts","bulkGetResponse","bulkGetInfo","Boolean","hasConflicts","fetchRevisionOneDocs","getRevisionOneDocs","returnResult","CHECKPOINT_VERSION","REPLICATOR","CHECKPOINT_HISTORY_SIZE","LOWEST_SEQ","updateCheckpoint","checkpoint","session","returnValue","session_id","replicator","unshift","Checkpointer","writeCheckpoint","updateTarget","updateSource","writeTargetCheckpoint","writeSourceCheckpoint","isForbiddenError","comparisons","targetDoc","sourceDoc","compareReplicationLogs","getCheckpoint","srcDoc","tgtDoc","compareReplicationHistory","sourceHistory","targetHistory","S","sourceRest","targetRest","sourceId","hasSessionId","sessionId","props","rest","floor","STARTING_BACK_OFF","backOff","retry","back_off_function","backOffSet","backoffTimeSet","current_back_off","removeBackOffSetter","removeBackOffTimeSet","sortObjectPropertiesByKey","queryParams","generateReplicationId","filterViewName","queryData","md5sum","replicate","batches","currentBatch","pendingBatch","writingCheckpoint","changesCompleted","replicationCompleted","batches_limit","changesPending","repId","checkpointer","changedDocs","start_time","docs_read","docs_written","doc_write_failures","errors","initCheckpointer","checkpointOpts","writeDocs","bulkOpts","completeReplication","errorsById","create","errorsNo","errorName","finishBatch","outResult","getChanges","onCheckpointError","getDiffs","getBatchDocs","got","startNextBatch","processPendingBatch","abortReplication","immediate","fatalError","end_time","onChangesComplete","onChangesError","abortChanges","_abortChanges","startChanges","_addedListeners","Replication","_readyCalled","cleanup","toPouch","PouchConstructor","replicateWrapper","replicateRet","srcPouch","targetPouch","Sync","canceled","optsPush","optsPull","pull","pushPaused","pullPaused","pullChange","direction","pushChange","pushDenied","pullDenied","pushActive","pullActive","removed","removeAll","isChange","isDenied","isPaused","isActive","addOneListener","listener","success","replication","replicateMethods","other","hasFrom","cloneBuffer","createHash","clone$1","fn","assign$1","f","hasName","res$1","res$2","bulkGetShim","functionName","normalizeDdocFunctionName","parseDdocFunctionName","default","Request","Response","qs","sep","eq","regexp","maxKeys","kstr","vstr","xs","stringifyPrimitive","isFinite","objectKeys","ks","decode","encode","formatRegExp","format","isString","objects","inspect","_","isNull","isObject","deprecate","isUndefined","noDeprecation","warned","deprecated","throwDeprecation","traceDeprecation","trace","debugs","debugEnviron","debuglog","toUpperCase","pid","seen","stylize","stylizeNoColor","colors","isBoolean","showHidden","_extend","customInspect","stylizeWithColor","formatValue","styles","styleType","arrayToHash","recurseTimes","isFunction","primitive","formatPrimitive","visibleKeys","getOwnPropertyNames","isError","formatError","isRegExp","isDate","base","braces","n","toUTCString","formatArray","formatProperty","reduceToSingleString","simple","isNumber","desc","line","numLinesEst","cur","ar","arg","isNullOrUndefined","isSymbol","objectToString","d","isPrimitive","o","months","timestamp","time","getHours","getMinutes","getSeconds","getDate","getMonth","origin","psl","getPublicSuffix","domain","Store","synchronous","findCookie","findCookies","putCookie","cookie","updateCookie","oldCookie","newCookie","removeCookie","removeCookies","getAllCookies","pubsuffix","permuteDomain","pubSuf","permutations","pathMatch","reqPath","cookiePath","util","MemoryCookieStore","custom","pathMatcher","matchAll","domainIndex","curPath","pathIndex","matchRFC","domains","curDomain","cookies","creationIndex","net","urlParse","VERSION","punycode","warn","COOKIE_OCTETS","CONTROL_CHARS","TERMINATORS","PATH_VALUE","DATE_DELIM","MONTH_TO_NUM","jan","feb","mar","apr","may","jun","jul","aug","oct","nov","dec","NUM_TO_MONTH","NUM_TO_DAY","MAX_TIME","MIN_TIME","parseDigits","minDigits","maxDigits","trailingOK","parseTime","parseMonth","parseDate","tokens","hour","minute","second","dayOfMonth","month","year","trim","UTC","formatDate","date","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCDay","getUTCMonth","getUTCFullYear","canonicalDomain","toASCII","domainMatch","domStr","canonicalize","isIP","defaultPath","rightSlash","trimTerminator","t","terminatorIdx","parseCookiePair","cookiePair","looseMode","firstEq","cookieName","cookieValue","Cookie","firstSemi","loose","unparsed","cookie_avs","av","av_sep","av_key","av_value","exp","expires","setMaxAge","secure","httpOnly","extensions","jsonParse","fromJSON","serializableProperties","cookieCompare","cmp","aPathLen","bPathLen","aTime","creation","getTime","bTime","permutePath","lindex","getCookieContext","decodeURI","configurable","enumerable","writable","cookiesCreated","maxAge","hostOnly","pathIsDefault","lastAccessed","cdomain","suffix","setExpires","age","cookieString","ext","TTL","expiryTime","relativeTo","expiryDate","millisec","isPersistent","canonicalizedDomain","CookieJar","store","rejectPublicSuffixes","enableLooseMode","CAN_BE_SYNC","setCookie","context","hostname","ignoreError","pathname","http","withCookie","getCookies","expireCheck","expire","allPaths","matchingCookie","getCookieString","getSetCookieStrings","serialize","serialized","storeType","serializeSync","_importCookies","jar","putNext","deserialize","strOrObj","deserializeSync","_importCookiesSync","newStore","syncWrap","syncErr","syncResult","syncCb","nodeFetch","setFieldInDoc","elem","typedBuffer","buffType","blobToBase64$1","base64StringToBlobOrBuffer","binaryStringToBlobOrBuffer","blobOrBufferToBase64","blobOrBufferToBinaryString","massageCreateIndexRequest","dbFetch","explain","getIndexes","deleteIndex","indexDef","getArguments","subArr","mergeObjects","oneArrayIsSubArrayOfOther","oneArrayIsStrictSubArrayOfOther","oneSetIsSubArrayOfOther","leftIdx","arrayToObject","maxScore","score","arrayEquals","arr1","arr2","createDeepMultiMapper","toEmit","iLen","createDeepSingleMapper","createShallowSingleMapper","createShallowMultiMapper","checkShallow","createMapper","isShallow","isSingle","mapFunDef","abstractMapper","massageSort","massageUseIndex","useIndex","cleanedUseIndex","massageIndexDef","getKeyFromDoc","def","filterInclusiveStart","targetValue","indexFields","docKey","reverseOptions","newOpts","inclusive_start","validateIndex","ascFields","validateSort","defaultUsed","noneIdSorts","sortItem","validateFindRequest","getUserFields","selectorFields","sortFields","userFields","MAX_VALUE","rightIdx","sortOrder","createIndex$1","originalIndexDef","getMd5","ddocId","hasInvalidLanguage","viewExists","updateDdoc","language","signature","getIndexes$1","indexes","viewNames","COLLATE_LO","COLLATE_HI","checkFieldInIndex","indexField","userOperatorLosesPrecision","sortFieldsByIndex","aIdx","bIdx","getBasicInMemoryFields","needToFilterInMemory","getInMemoryFieldsFromNe","getInMemoryFields","coreInMemoryFields","checkIndexFieldsMatch","sortMatches","selectorMatches","logicalMatchers","isNonLogicalMatcher","checkFieldsLogicallySound","firstField","hasLogicalOperator","matcherKey","isInvalidNe","checkIndexMatches","fieldsMatch","findMatchingIndexes","indexMatches","findBestMatchingIndex","matchingIndexes","defaultIndex","userFieldsMap","scoreIndex","useIndexDdoc","useIndexName","getSingleFieldQueryOptsFor","getSingleFieldCoreQueryPlan","userOperators","combinedOpts","newQueryOpts","queryOpts","getMultiFieldCoreQueryPlan","getMultiFieldQueryOpts","inclusiveStart","usingGtlt","previousKeys","previousWasEq","previousWasSame","gtltLostSpecificity","getDefaultQueryPlan","getCoreQueryPlan","planQuery","userFieldsRes","use_index","coreQueryPlan","indexToSignature","doAllDocs","originalOpts","find$1","getIndexesRes","queryPlan","indexToUse","isDescending","warning","explain$1","dbname","bookmark","r","deleteIndex$1","deltaFun","createIndexAsCallback","findAsCallback","explainAsCallback","getIndexesAsCallback","deleteIndexAsCallback","createIndex$$1","find$$1","getIndexes$$1","deleteIndex$$1","$nin","retrieved","messages","Batch","concurrency","entry","fiscal_code","statusCode","operation","postMessage","completed"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/uBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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C,QAAM,IAAIN,KAAJ,CAAU,4BAAV,CAAN;AACD,CAFD;;AAIArB,SAASS,SAAT,CAAmBU,MAAnB,GAA4B,UAAUP,QAAV,EAAoB;AAC9C,MAAI,KAAKJ,UAAT,EAAqB,MAAM,IAAIa,KAAJ,CAAU,uBAAV,CAAN;AACrB,OAAKb,UAAL,GAAkB,IAAlB;;AAEA,MAAIW,SAAS,KAAKW,OAAL,EAAb;AACA,MAAIlB,aAAamB,SAAjB,EAA4BZ,SAASA,OAAOa,QAAP,CAAgBpB,QAAhB,CAAT;;AAE5B;AACA,OAAKT,MAAL,CAAY8B,IAAZ,CAAiB,CAAjB;AACA,OAAK3B,YAAL,GAAoB,CAApB;AACA,OAAK,IAAIoB,IAAI,CAAb,EAAgBA,IAAI,CAApB,EAAuB,EAAEA,CAAzB,EAA4B,KAAKnB,OAAL,CAAamB,CAAb,IAAkB,CAAlB;;AAE5B,SAAOP,MAAP;AACD,CAbD;;AAeAnB,SAASS,SAAT,CAAmBqB,OAAnB,GAA6B,YAAY;AACvC,QAAM,IAAIT,KAAJ,CAAU,4BAAV,CAAN;AACD,CAFD;;AAIAa,OAAOC,OAAP,GAAiBnC,QAAjB;;;AC9FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACjJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACnKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACjFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC9FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACnGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACvIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACrDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACpQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9CA;AACA;AACA;AACA;AACA;AACA;;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAC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AAqBC,UAArB,EAAiCC,MAAjC,EAAyC1B,MAAzC,CAAP;AACD,GAJc,CAAf,EAIIN,QAJJ;AAKD,CA/BD;;ACpEAsB,QAAQ8B,MAAR,GAAiBzE,QAAQ,aAAR,CAAjB;AACA2C,QAAQsE,UAAR,GAAqBjH,QAAQ,YAAR,CAArB;;ACDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACpOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACzFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACrHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC7CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AClHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACnEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACn2GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACpKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACz6BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1UA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5wBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACzHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1nBA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACpUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjDA;AACA;AACA;AACA;AACA;;;ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrBA;AACA;AACA;AACA;AACA;;ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;AC1HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC1GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACjJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACnFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC3FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC5HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC9FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AC7KA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,SAASkH,cAAT,CAAwBC,MAAxB,EAAgC;AAC9B,SAAQ,OAAOC,WAAP,KAAuB,WAAvB,IAAsCD,kB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Qo/C,OAAR,GAAkBp4C,KAAKkiB,KAAL,CAAW7J,IAAX,CAAgBrY,IAAhB,CAAlB;;AAEAhH,QAAQopB,OAAR,GAAkBpiB,KAAKoiB,OAAvB;AACAppB,QAAQq/C,OAAR,GAAkBr4C,KAAKq4C,OAAvB;AACAr/C,QAAQs/C,QAAR,GAAmBt4C,KAAKs4C,QAAxB;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrhBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AACA,SAAS94C,cAAT,CAAwBuD,GAAxB,EAA6BN,IAA7B,EAAmC;AACjC,SAAO/D,OAAOpH,SAAP,CAAiBkI,cAAjB,CAAgCzI,IAAhC,CAAqCgM,GAArC,EAA0CN,IAA1C,CAAP;AACD;;AAED1J,OAAOC,OAAP,GAAiB,UAASu/C,EAAT,EAAaC,GAAb,EAAkBC,EAAlB,EAAsBjY,OAAtB,EAA+B;AAC9CgY,QAAMA,OAAO,GAAb;AACAC,OAAKA,MAAM,GAAX;AACA,MAAI11C,MAAM,EAAV;;AAEA,MAAI,OAAOw1C,EAAP,KAAc,QAAd,IAA0BA,GAAGjgD,MAAH,KAAc,CAA5C,EAA+C;AAC7C,WAAOyK,GAAP;AACD;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ACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC5tBA;AACA;AACA;AACA;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAIgjD,eAAe,UAAnB;AACArgD,QAAQsgD,MAAR,GAAiB,UA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A;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7QA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA;;AACA,IAAIs7C,MAAM1nD,QAAQ,KAAR,CAAV;;AAEA,SAAS2nD,eAAT,CAAyBC,MAAzB,EAAiC;AAC/B,SAAOF,IAAIr8C,GAAJ,CAAQu8C,MAAR,CAAP;AACD;;AAEDjlD,QAAQglD,eAAR,GAA0BA,eAA1B;;ACrCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA;AACA;;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AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7KA;;;;AACA;;;;AAGA;;;;AAEA;;AACA;;;;AALApK,yBAAQoK,MAAR,CAAeoH,qBAAf;;AAOAnqB,KAAK+F,gBAAL,CAAsB,SAAtB;AAAA,sFAAiC,kBAAM5I,CAAN;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,gBAC1BA,CAD0B;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA,sBAGCA,EAAElF,IAHH,EAGvBuhC,MAHuB,WAGvBA,MAHuB,EAGftzB,MAHe,WAGfA,MAHe,EAGPkd,GAHO,WAGPA,GAHO;AAKzB7f,cALyB,GAKpB,IAAIoV,wBAAJ,CAAYzS,MAAZ,CALoB;AAAA;AAAA,mBAOR3C,GAAG4mB,IAAH,CAAQ;AAC7B/F,wBAAU;AACR/lB,sBAAM,SADE;AAERwJ,wBAAQ;AACN8rD,wBAAM,CAAC,QAAD,EAAW,SAAX;AADA,iBAFA;AAKRC,2BAAW;AACT3uC,uBAAK;AADI;AALH;AADmB,aAAR,CAPQ;;AAAA;AAOzB4uC,oBAPyB;AAmBzBlvD,iBAnByB,GAmBjB,IAAImvD,eAAJ,EAnBiB;;AAoB/BnvD,kBAAMovD,WAAN,CAAkB,CAAlB;AACApvD,kBAAM6B,EAAN,CAAS,UAAT,EAAqB,aAAK,CAAE,CAA5B;;AAEAqtD,qBAASnwD,IAAT,CAAc5B,OAAd,CAAsB,iBAAS;AAC7B6C,oBAAM5M,IAAN;AAAA,qGAAW,iBAAM2Z,IAAN;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,2CACmBsiD,MAAMzrD,OADzB,EACD1E,EADC,kBACDA,EADC,EACGowD,WADH,kBACGA,WADH;AAEH/+C,8BAFG,iBAEgB++C,WAFhB,SAE+BpwD,EAF/B;AAAA;AAAA,iCAGa,cAAI,EAAEqC,cAAF,EAAUkd,QAAV,EAAelO,UAAf,EAAJ,CAHb;;AAAA;AAGH3M,iCAHG;;AAAA,+BAKLA,QAAQ2rD,UALH;AAAA;AAAA;AAAA;;AAMP;AACA/sD,kCAAQxP,KAAR,CAAckM,EAAd;AAPO;AAAA;;AAAA;AAAA;AAAA,iCASiB,gBAAON,EAAP,EAAWywD,MAAMrmD,GAAjB,6BACnBqmD,KADmB,EAEnBzrD,OAFmB;AAGtBqrD,uCAAW;AAHW,6BATjB;;AAAA;AASDO,mCATC;;AAAA;;AAgBTziD;;AAhBS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAX;;AAAA;AAAA;AAAA;AAAA;AAkBD,aAnBD;;AAqBA;AACA/M,kBAAMiM,GAAN,CAAU,UAAC/Y,GAAD,EAAMI,IAAN,EAAe;AACvB,kBAAI,CAACJ,GAAL,EAAU;AACRu8D,uDACKj3D,EAAElF,IADP;AAEEo8D,6BAAW;AAFb;AAID;AACF,aAPD;;AA7C+B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAjC;;AAAA;AAAA;AAAA;AAAA","file":"getMessage.7b8f39d5.map","sourceRoot":"..","sourcesContent":["'use strict';\n\nmodule.exports = argsArray;\n\nfunction argsArray(fun) {\n  return function () {\n    var len = arguments.length;\n    if (len) {\n      var args = [];\n      var i = -1;\n      while (++i < len) {\n        args[i] = arguments[i];\n      }\n      return fun.call(this, args);\n    } else {\n      return fun.call(this, []);\n    }\n  };\n}","'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\nif (process.browser) {\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n} else {\n  scheduleDrain = function () {\n    process.nextTick(nextTick);\n  };\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n","(function (factory) {\n    if (typeof exports === 'object') {\n        // Node/CommonJS\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD\n        define(factory);\n    } else {\n        // Browser globals (with support for web workers)\n        var glob;\n\n        try {\n            glob = window;\n        } catch (e) {\n            glob = self;\n        }\n\n        glob.SparkMD5 = factory();\n    }\n}(function (undefined) {\n\n    'use strict';\n\n    /*\n     * Fastest md5 implementation around (JKM md5).\n     * Credits: Joseph Myers\n     *\n     * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n     * @see http://jsperf.com/md5-shootout/7\n     */\n\n    /* this function is much faster,\n      so if possible we use it. Some IEs\n      are the only ones I know of that\n      need the idiotic second function,\n      generated by an if clause.  */\n    var add32 = function (a, b) {\n        return (a + b) & 0xFFFFFFFF;\n    },\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];\n\n\n    function cmn(q, a, b, x, s, t) {\n        a = add32(add32(a, q), add32(x, t));\n        return add32((a << s) | (a >>> (32 - s)), b);\n    }\n\n    function md5cycle(x, k) {\n        var a = x[0],\n            b = x[1],\n            c = x[2],\n            d = x[3];\n\n        a += (b & c | ~b & d) + k[0] - 680876936 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[1] - 389564586 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[2] + 606105819 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[3] - 1044525330 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[4] - 176418897 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[5] + 1200080426 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[6] - 1473231341 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[7] - 45705983 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[8] + 1770035416 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[9] - 1958414417 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[10] - 42063 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[11] - 1990404162 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n        a += (b & c | ~b & d) + k[12] + 1804603682 | 0;\n        a  = (a << 7 | a >>> 25) + b | 0;\n        d += (a & b | ~a & c) + k[13] - 40341101 | 0;\n        d  = (d << 12 | d >>> 20) + a | 0;\n        c += (d & a | ~d & b) + k[14] - 1502002290 | 0;\n        c  = (c << 17 | c >>> 15) + d | 0;\n        b += (c & d | ~c & a) + k[15] + 1236535329 | 0;\n        b  = (b << 22 | b >>> 10) + c | 0;\n\n        a += (b & d | c & ~d) + k[1] - 165796510 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[6] - 1069501632 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[11] + 643717713 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[0] - 373897302 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[5] - 701558691 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[10] + 38016083 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[15] - 660478335 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[4] - 405537848 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[9] + 568446438 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[14] - 1019803690 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[3] - 187363961 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[8] + 1163531501 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n        a += (b & d | c & ~d) + k[13] - 1444681467 | 0;\n        a  = (a << 5 | a >>> 27) + b | 0;\n        d += (a & c | b & ~c) + k[2] - 51403784 | 0;\n        d  = (d << 9 | d >>> 23) + a | 0;\n        c += (d & b | a & ~b) + k[7] + 1735328473 | 0;\n        c  = (c << 14 | c >>> 18) + d | 0;\n        b += (c & a | d & ~a) + k[12] - 1926607734 | 0;\n        b  = (b << 20 | b >>> 12) + c | 0;\n\n        a += (b ^ c ^ d) + k[5] - 378558 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[8] - 2022574463 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[11] + 1839030562 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[14] - 35309556 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[1] - 1530992060 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[4] + 1272893353 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[7] - 155497632 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[10] - 1094730640 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[13] + 681279174 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[0] - 358537222 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[3] - 722521979 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[6] + 76029189 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n        a += (b ^ c ^ d) + k[9] - 640364487 | 0;\n        a  = (a << 4 | a >>> 28) + b | 0;\n        d += (a ^ b ^ c) + k[12] - 421815835 | 0;\n        d  = (d << 11 | d >>> 21) + a | 0;\n        c += (d ^ a ^ b) + k[15] + 530742520 | 0;\n        c  = (c << 16 | c >>> 16) + d | 0;\n        b += (c ^ d ^ a) + k[2] - 995338651 | 0;\n        b  = (b << 23 | b >>> 9) + c | 0;\n\n        a += (c ^ (b | ~d)) + k[0] - 198630844 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[7] + 1126891415 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[14] - 1416354905 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[5] - 57434055 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[12] + 1700485571 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[3] - 1894986606 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[10] - 1051523 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[1] - 2054922799 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[8] + 1873313359 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[15] - 30611744 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[6] - 1560198380 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[13] + 1309151649 | 0;\n        b  = (b << 21 |b >>> 11) + c | 0;\n        a += (c ^ (b | ~d)) + k[4] - 145523070 | 0;\n        a  = (a << 6 | a >>> 26) + b | 0;\n        d += (b ^ (a | ~c)) + k[11] - 1120210379 | 0;\n        d  = (d << 10 | d >>> 22) + a | 0;\n        c += (a ^ (d | ~b)) + k[2] + 718787259 | 0;\n        c  = (c << 15 | c >>> 17) + d | 0;\n        b += (d ^ (c | ~a)) + k[9] - 343485551 | 0;\n        b  = (b << 21 | b >>> 11) + c | 0;\n\n        x[0] = a + x[0] | 0;\n        x[1] = b + x[1] | 0;\n        x[2] = c + x[2] | 0;\n        x[3] = d + x[3] | 0;\n    }\n\n    function md5blk(s) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n        }\n        return md5blks;\n    }\n\n    function md5blk_array(a) {\n        var md5blks = [],\n            i; /* Andy King said do it this way. */\n\n        for (i = 0; i < 64; i += 4) {\n            md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n        }\n        return md5blks;\n    }\n\n    function md51(s) {\n        var n = s.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk(s.substring(i - 64, i)));\n        }\n        s = s.substring(i - 64);\n        length = s.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n        }\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n        return state;\n    }\n\n    function md51_array(a) {\n        var n = a.length,\n            state = [1732584193, -271733879, -1732584194, 271733878],\n            i,\n            length,\n            tail,\n            tmp,\n            lo,\n            hi;\n\n        for (i = 64; i <= n; i += 64) {\n            md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n        }\n\n        // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n        // containing the last element of the parent array if the sub array specified starts\n        // beyond the length of the parent array - weird.\n        // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n        a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n        length = a.length;\n        tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= a[i] << ((i % 4) << 3);\n        }\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(state, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Beware that the final length might not fit in 32 bits so we take care of that\n        tmp = n * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n\n        md5cycle(state, tail);\n\n        return state;\n    }\n\n    function rhex(n) {\n        var s = '',\n            j;\n        for (j = 0; j < 4; j += 1) {\n            s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n        }\n        return s;\n    }\n\n    function hex(x) {\n        var i;\n        for (i = 0; i < x.length; i += 1) {\n            x[i] = rhex(x[i]);\n        }\n        return x.join('');\n    }\n\n    // In some cases the fast add32 function cannot be used..\n    if (hex(md51('hello')) !== '5d41402abc4b2a76b9719d911017c592') {\n        add32 = function (x, y) {\n            var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n            return (msw << 16) | (lsw & 0xFFFF);\n        };\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * ArrayBuffer slice polyfill.\n     *\n     * @see https://github.com/ttaubert/node-arraybuffer-slice\n     */\n\n    if (typeof ArrayBuffer !== 'undefined' && !ArrayBuffer.prototype.slice) {\n        (function () {\n            function clamp(val, length) {\n                val = (val | 0) || 0;\n\n                if (val < 0) {\n                    return Math.max(val + length, 0);\n                }\n\n                return Math.min(val, length);\n            }\n\n            ArrayBuffer.prototype.slice = function (from, to) {\n                var length = this.byteLength,\n                    begin = clamp(from, length),\n                    end = length,\n                    num,\n                    target,\n                    targetArray,\n                    sourceArray;\n\n                if (to !== undefined) {\n                    end = clamp(to, length);\n                }\n\n                if (begin > end) {\n                    return new ArrayBuffer(0);\n                }\n\n                num = end - begin;\n                target = new ArrayBuffer(num);\n                targetArray = new Uint8Array(target);\n\n                sourceArray = new Uint8Array(this, begin, num);\n                targetArray.set(sourceArray);\n\n                return target;\n            };\n        })();\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * Helpers.\n     */\n\n    function toUtf8(str) {\n        if (/[\\u0080-\\uFFFF]/.test(str)) {\n            str = unescape(encodeURIComponent(str));\n        }\n\n        return str;\n    }\n\n    function utf8Str2ArrayBuffer(str, returnUInt8Array) {\n        var length = str.length,\n           buff = new ArrayBuffer(length),\n           arr = new Uint8Array(buff),\n           i;\n\n        for (i = 0; i < length; i += 1) {\n            arr[i] = str.charCodeAt(i);\n        }\n\n        return returnUInt8Array ? arr : buff;\n    }\n\n    function arrayBuffer2Utf8Str(buff) {\n        return String.fromCharCode.apply(null, new Uint8Array(buff));\n    }\n\n    function concatenateArrayBuffers(first, second, returnUInt8Array) {\n        var result = new Uint8Array(first.byteLength + second.byteLength);\n\n        result.set(new Uint8Array(first));\n        result.set(new Uint8Array(second), first.byteLength);\n\n        return returnUInt8Array ? result : result.buffer;\n    }\n\n    function hexToBinaryString(hex) {\n        var bytes = [],\n            length = hex.length,\n            x;\n\n        for (x = 0; x < length - 1; x += 2) {\n            bytes.push(parseInt(hex.substr(x, 2), 16));\n        }\n\n        return String.fromCharCode.apply(String, bytes);\n    }\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation.\n     *\n     * Use this class to perform an incremental md5, otherwise use the\n     * static methods instead.\n     */\n\n    function SparkMD5() {\n        // call reset to init the instance\n        this.reset();\n    }\n\n    /**\n     * Appends a string.\n     * A conversion will be applied if an utf8 string is detected.\n     *\n     * @param {String} str The string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.append = function (str) {\n        // Converts the string to utf8 bytes if necessary\n        // Then append as binary\n        this.appendBinary(toUtf8(str));\n\n        return this;\n    };\n\n    /**\n     * Appends a binary string.\n     *\n     * @param {String} contents The binary string to be appended\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.appendBinary = function (contents) {\n        this._buff += contents;\n        this._length += contents.length;\n\n        var length = this._buff.length,\n            i;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk(this._buff.substring(i - 64, i)));\n        }\n\n        this._buff = this._buff.substring(i - 64);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            i,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.reset = function () {\n        this._buff = '';\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.prototype.getState = function () {\n        return {\n            buff: this._buff,\n            length: this._length,\n            hash: this._hash\n        };\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5} The instance itself\n     */\n    SparkMD5.prototype.setState = function (state) {\n        this._buff = state.buff;\n        this._length = state.length;\n        this._hash = state.hash;\n\n        return this;\n    };\n\n    /**\n     * Releases memory used by the incremental buffer and other additional\n     * resources. If you plan to use the instance again, use reset instead.\n     */\n    SparkMD5.prototype.destroy = function () {\n        delete this._hash;\n        delete this._buff;\n        delete this._length;\n    };\n\n    /**\n     * Finish the final calculation based on the tail.\n     *\n     * @param {Array}  tail   The tail (will be modified)\n     * @param {Number} length The length of the remaining buffer\n     */\n    SparkMD5.prototype._finish = function (tail, length) {\n        var i = length,\n            tmp,\n            lo,\n            hi;\n\n        tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n        if (i > 55) {\n            md5cycle(this._hash, tail);\n            for (i = 0; i < 16; i += 1) {\n                tail[i] = 0;\n            }\n        }\n\n        // Do the final computation based on the tail and length\n        // Beware that the final length may not fit in 32 bits so we take care of that\n        tmp = this._length * 8;\n        tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n        lo = parseInt(tmp[2], 16);\n        hi = parseInt(tmp[1], 16) || 0;\n\n        tail[14] = lo;\n        tail[15] = hi;\n        md5cycle(this._hash, tail);\n    };\n\n    /**\n     * Performs the md5 hash on a string.\n     * A conversion will be applied if utf8 string is detected.\n     *\n     * @param {String}  str The string\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hash = function (str, raw) {\n        // Converts the string to utf8 bytes if necessary\n        // Then compute it using the binary function\n        return SparkMD5.hashBinary(toUtf8(str), raw);\n    };\n\n    /**\n     * Performs the md5 hash on a binary string.\n     *\n     * @param {String}  content The binary string\n     * @param {Boolean} raw     True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.hashBinary = function (content, raw) {\n        var hash = md51(content),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    // ---------------------------------------------------\n\n    /**\n     * SparkMD5 OOP implementation for array buffers.\n     *\n     * Use this class to perform an incremental md5 ONLY for array buffers.\n     */\n    SparkMD5.ArrayBuffer = function () {\n        // call reset to init the instance\n        this.reset();\n    };\n\n    /**\n     * Appends an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array to be appended\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n        var buff = concatenateArrayBuffers(this._buff.buffer, arr, true),\n            length = buff.length,\n            i;\n\n        this._length += arr.byteLength;\n\n        for (i = 64; i <= length; i += 64) {\n            md5cycle(this._hash, md5blk_array(buff.subarray(i - 64, i)));\n        }\n\n        this._buff = (i - 64) < length ? new Uint8Array(buff.buffer.slice(i - 64)) : new Uint8Array(0);\n\n        return this;\n    };\n\n    /**\n     * Finishes the incremental computation, reseting the internal state and\n     * returning the result.\n     *\n     * @param {Boolean} raw True to get the raw string, false to get the hex string\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n        var buff = this._buff,\n            length = buff.length,\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n            i,\n            ret;\n\n        for (i = 0; i < length; i += 1) {\n            tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n        }\n\n        this._finish(tail, length);\n        ret = hex(this._hash);\n\n        if (raw) {\n            ret = hexToBinaryString(ret);\n        }\n\n        this.reset();\n\n        return ret;\n    };\n\n    /**\n     * Resets the internal state of the computation.\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.reset = function () {\n        this._buff = new Uint8Array(0);\n        this._length = 0;\n        this._hash = [1732584193, -271733879, -1732584194, 271733878];\n\n        return this;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @return {Object} The state\n     */\n    SparkMD5.ArrayBuffer.prototype.getState = function () {\n        var state = SparkMD5.prototype.getState.call(this);\n\n        // Convert buffer to a string\n        state.buff = arrayBuffer2Utf8Str(state.buff);\n\n        return state;\n    };\n\n    /**\n     * Gets the internal state of the computation.\n     *\n     * @param {Object} state The state\n     *\n     * @return {SparkMD5.ArrayBuffer} The instance itself\n     */\n    SparkMD5.ArrayBuffer.prototype.setState = function (state) {\n        // Convert string to buffer\n        state.buff = utf8Str2ArrayBuffer(state.buff, true);\n\n        return SparkMD5.prototype.setState.call(this, state);\n    };\n\n    SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n    SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n    /**\n     * Performs the md5 hash on an array buffer.\n     *\n     * @param {ArrayBuffer} arr The array buffer\n     * @param {Boolean}     raw True to get the raw string, false to get the hex one\n     *\n     * @return {String} The result\n     */\n    SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n        var hash = md51_array(new Uint8Array(arr)),\n            ret = hex(hash);\n\n        return raw ? hexToBinaryString(ret) : ret;\n    };\n\n    return SparkMD5;\n}));\n","'use strict'\n\nfunction oldBrowser () {\n  throw new Error('Secure random number generation is not supported by this browser.\\nUse Chrome, Firefox or Internet Explorer 11')\n}\n\nvar Buffer = require('safe-buffer').Buffer\nvar crypto = global.crypto || global.msCrypto\n\nif (crypto && crypto.getRandomValues) {\n  module.exports = randomBytes\n} else {\n  module.exports = oldBrowser\n}\n\nfunction randomBytes (size, cb) {\n  // phantomjs needs to throw\n  if (size > 65536) throw new Error('requested too many random bytes')\n  // in case browserify  isn't using the Uint8Array version\n  var rawBytes = new global.Uint8Array(size)\n\n  // This will not work in older browsers.\n  // See https://developer.mozilla.org/en-US/docs/Web/API/window.crypto.getRandomValues\n  if (size > 0) {  // getRandomValues fails on IE if size == 0\n    crypto.getRandomValues(rawBytes)\n  }\n\n  // XXX: phantomjs doesn't like a buffer being passed here\n  var bytes = Buffer.from(rawBytes.buffer)\n\n  if (typeof cb === 'function') {\n    return process.nextTick(function () {\n      cb(null, bytes)\n    })\n  }\n\n  return bytes\n}\n","'use strict'\nvar Buffer = require('safe-buffer').Buffer\nvar Transform = require('stream').Transform\nvar inherits = require('inherits')\n\nfunction throwIfNotStringOrBuffer (val, prefix) {\n  if (!Buffer.isBuffer(val) && typeof val !== 'string') {\n    throw new TypeError(prefix + ' must be a string or a buffer')\n  }\n}\n\nfunction HashBase (blockSize) {\n  Transform.call(this)\n\n  this._block = Buffer.allocUnsafe(blockSize)\n  this._blockSize = blockSize\n  this._blockOffset = 0\n  this._length = [0, 0, 0, 0]\n\n  this._finalized = false\n}\n\ninherits(HashBase, Transform)\n\nHashBase.prototype._transform = function (chunk, encoding, callback) {\n  var error = null\n  try {\n    this.update(chunk, encoding)\n  } catch (err) {\n    error = err\n  }\n\n  callback(error)\n}\n\nHashBase.prototype._flush = function (callback) {\n  var error = null\n  try {\n    this.push(this.digest())\n  } catch (err) {\n    error = err\n  }\n\n  callback(error)\n}\n\nHashBase.prototype.update = function (data, encoding) {\n  throwIfNotStringOrBuffer(data, 'Data')\n  if (this._finalized) throw new Error('Digest already called')\n  if (!Buffer.isBuffer(data)) data = Buffer.from(data, encoding)\n\n  // consume data\n  var block = this._block\n  var offset = 0\n  while (this._blockOffset + data.length - offset >= this._blockSize) {\n    for (var i = this._blockOffset; i < this._blockSize;) block[i++] = data[offset++]\n    this._update()\n    this._blockOffset = 0\n  }\n  while (offset < data.length) block[this._blockOffset++] = data[offset++]\n\n  // update length\n  for (var j = 0, carry = data.length * 8; carry > 0; ++j) {\n    this._length[j] += carry\n    carry = (this._length[j] / 0x0100000000) | 0\n    if (carry > 0) this._length[j] -= 0x0100000000 * carry\n  }\n\n  return this\n}\n\nHashBase.prototype._update = function () {\n  throw new Error('_update is not implemented')\n}\n\nHashBase.prototype.digest = function (encoding) {\n  if (this._finalized) throw new Error('Digest already called')\n  this._finalized = true\n\n  var digest = this._digest()\n  if (encoding !== undefined) digest = digest.toString(encoding)\n\n  // reset state\n  this._block.fill(0)\n  this._blockOffset = 0\n  for (var i = 0; i < 4; ++i) this._length[i] = 0\n\n  return digest\n}\n\nHashBase.prototype._digest = function () {\n  throw new Error('_digest is not implemented')\n}\n\nmodule.exports = HashBase\n","'use strict'\nvar inherits = require('inherits')\nvar HashBase = require('hash-base')\n\nvar ARRAY16 = new Array(16)\n\nfunction MD5 () {\n  HashBase.call(this, 64)\n\n  // state\n  this._a = 0x67452301\n  this._b = 0xefcdab89\n  this._c = 0x98badcfe\n  this._d = 0x10325476\n}\n\ninherits(MD5, HashBase)\n\nMD5.prototype._update = function () {\n  var M = ARRAY16\n  for (var i = 0; i < 16; ++i) M[i] = this._block.readInt32LE(i * 4)\n\n  var a = this._a\n  var b = this._b\n  var c = this._c\n  var d = this._d\n\n  a = fnF(a, b, c, d, M[0], 0xd76aa478, 7)\n  d = fnF(d, a, b, c, M[1], 0xe8c7b756, 12)\n  c = fnF(c, d, a, b, M[2], 0x242070db, 17)\n  b = fnF(b, c, d, a, M[3], 0xc1bdceee, 22)\n  a = fnF(a, b, c, d, M[4], 0xf57c0faf, 7)\n  d = fnF(d, a, b, c, M[5], 0x4787c62a, 12)\n  c = fnF(c, d, a, b, M[6], 0xa8304613, 17)\n  b = fnF(b, c, d, a, M[7], 0xfd469501, 22)\n  a = fnF(a, b, c, d, M[8], 0x698098d8, 7)\n  d = fnF(d, a, b, c, M[9], 0x8b44f7af, 12)\n  c = fnF(c, d, a, b, M[10], 0xffff5bb1, 17)\n  b = fnF(b, c, d, a, M[11], 0x895cd7be, 22)\n  a = fnF(a, b, c, d, M[12], 0x6b901122, 7)\n  d = fnF(d, a, b, c, M[13], 0xfd987193, 12)\n  c = fnF(c, d, a, b, M[14], 0xa679438e, 17)\n  b = fnF(b, c, d, a, M[15], 0x49b40821, 22)\n\n  a = fnG(a, b, c, d, M[1], 0xf61e2562, 5)\n  d = fnG(d, a, b, c, M[6], 0xc040b340, 9)\n  c = fnG(c, d, a, b, M[11], 0x265e5a51, 14)\n  b = fnG(b, c, d, a, M[0], 0xe9b6c7aa, 20)\n  a = fnG(a, b, c, d, M[5], 0xd62f105d, 5)\n  d = fnG(d, a, b, c, M[10], 0x02441453, 9)\n  c = fnG(c, d, a, b, M[15], 0xd8a1e681, 14)\n  b = fnG(b, c, d, a, M[4], 0xe7d3fbc8, 20)\n  a = fnG(a, b, c, d, M[9], 0x21e1cde6, 5)\n  d = fnG(d, a, b, c, M[14], 0xc33707d6, 9)\n  c = fnG(c, d, a, b, M[3], 0xf4d50d87, 14)\n  b = fnG(b, c, d, a, M[8], 0x455a14ed, 20)\n  a = fnG(a, b, c, d, M[13], 0xa9e3e905, 5)\n  d = fnG(d, a, b, c, M[2], 0xfcefa3f8, 9)\n  c = fnG(c, d, a, b, M[7], 0x676f02d9, 14)\n  b = fnG(b, c, d, a, M[12], 0x8d2a4c8a, 20)\n\n  a = fnH(a, b, c, d, M[5], 0xfffa3942, 4)\n  d = fnH(d, a, b, c, M[8], 0x8771f681, 11)\n  c = fnH(c, d, a, b, M[11], 0x6d9d6122, 16)\n  b = fnH(b, c, d, a, M[14], 0xfde5380c, 23)\n  a = fnH(a, b, c, d, M[1], 0xa4beea44, 4)\n  d = fnH(d, a, b, c, M[4], 0x4bdecfa9, 11)\n  c = fnH(c, d, a, b, M[7], 0xf6bb4b60, 16)\n  b = fnH(b, c, d, a, M[10], 0xbebfbc70, 23)\n  a = fnH(a, b, c, d, M[13], 0x289b7ec6, 4)\n  d = fnH(d, a, b, c, M[0], 0xeaa127fa, 11)\n  c = fnH(c, d, a, b, M[3], 0xd4ef3085, 16)\n  b = fnH(b, c, d, a, M[6], 0x04881d05, 23)\n  a = fnH(a, b, c, d, M[9], 0xd9d4d039, 4)\n  d = fnH(d, a, b, c, M[12], 0xe6db99e5, 11)\n  c = fnH(c, d, a, b, M[15], 0x1fa27cf8, 16)\n  b = fnH(b, c, d, a, M[2], 0xc4ac5665, 23)\n\n  a = fnI(a, b, c, d, M[0], 0xf4292244, 6)\n  d = fnI(d, a, b, c, M[7], 0x432aff97, 10)\n  c = fnI(c, d, a, b, M[14], 0xab9423a7, 15)\n  b = fnI(b, c, d, a, M[5], 0xfc93a039, 21)\n  a = fnI(a, b, c, d, M[12], 0x655b59c3, 6)\n  d = fnI(d, a, b, c, M[3], 0x8f0ccc92, 10)\n  c = fnI(c, d, a, b, M[10], 0xffeff47d, 15)\n  b = fnI(b, c, d, a, M[1], 0x85845dd1, 21)\n  a = fnI(a, b, c, d, M[8], 0x6fa87e4f, 6)\n  d = fnI(d, a, b, c, M[15], 0xfe2ce6e0, 10)\n  c = fnI(c, d, a, b, M[6], 0xa3014314, 15)\n  b = fnI(b, c, d, a, M[13], 0x4e0811a1, 21)\n  a = fnI(a, b, c, d, M[4], 0xf7537e82, 6)\n  d = fnI(d, a, b, c, M[11], 0xbd3af235, 10)\n  c = fnI(c, d, a, b, M[2], 0x2ad7d2bb, 15)\n  b = fnI(b, c, d, a, M[9], 0xeb86d391, 21)\n\n  this._a = (this._a + a) | 0\n  this._b = (this._b + b) | 0\n  this._c = (this._c + c) | 0\n  this._d = (this._d + d) | 0\n}\n\nMD5.prototype._digest = function () {\n  // create padding and handle blocks\n  this._block[this._blockOffset++] = 0x80\n  if (this._blockOffset > 56) {\n    this._block.fill(0, this._blockOffset, 64)\n    this._update()\n    this._blockOffset = 0\n  }\n\n  this._block.fill(0, this._blockOffset, 56)\n  this._block.writeUInt32LE(this._length[0], 56)\n  this._block.writeUInt32LE(this._length[1], 60)\n  this._update()\n\n  // produce result\n  var buffer = new Buffer(16)\n  buffer.writeInt32LE(this._a, 0)\n  buffer.writeInt32LE(this._b, 4)\n  buffer.writeInt32LE(this._c, 8)\n  buffer.writeInt32LE(this._d, 12)\n  return buffer\n}\n\nfunction rotl (x, n) {\n  return (x << n) | (x >>> (32 - n))\n}\n\nfunction fnF (a, b, c, d, m, k, s) {\n  return (rotl((a + ((b & c) | ((~b) & d)) + m + k) | 0, s) + b) | 0\n}\n\nfunction fnG (a, b, c, d, m, k, s) {\n  return (rotl((a + ((b & d) | (c & (~d))) + m + k) | 0, s) + b) | 0\n}\n\nfunction fnH (a, b, c, d, m, k, s) {\n  return (rotl((a + (b ^ c ^ d) + m + k) | 0, s) + b) | 0\n}\n\nfunction fnI (a, b, c, d, m, k, s) {\n  return (rotl((a + ((c ^ (b | (~d)))) + m + k) | 0, s) + b) | 0\n}\n\nmodule.exports = MD5\n","'use strict'\nvar Buffer = require('buffer').Buffer\nvar inherits = require('inherits')\nvar HashBase = require('hash-base')\n\nvar ARRAY16 = new Array(16)\n\nvar zl = [\n  0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,\n  7, 4, 13, 1, 10, 6, 15, 3, 12, 0, 9, 5, 2, 14, 11, 8,\n  3, 10, 14, 4, 9, 15, 8, 1, 2, 7, 0, 6, 13, 11, 5, 12,\n  1, 9, 11, 10, 0, 8, 12, 4, 13, 3, 7, 15, 14, 5, 6, 2,\n  4, 0, 5, 9, 7, 12, 2, 10, 14, 1, 3, 8, 11, 6, 15, 13\n]\n\nvar zr = [\n  5, 14, 7, 0, 9, 2, 11, 4, 13, 6, 15, 8, 1, 10, 3, 12,\n  6, 11, 3, 7, 0, 13, 5, 10, 14, 15, 8, 12, 4, 9, 1, 2,\n  15, 5, 1, 3, 7, 14, 6, 9, 11, 8, 12, 2, 10, 0, 4, 13,\n  8, 6, 4, 1, 3, 11, 15, 0, 5, 12, 2, 13, 9, 7, 10, 14,\n  12, 15, 10, 4, 1, 5, 8, 7, 6, 2, 13, 14, 0, 3, 9, 11\n]\n\nvar sl = [\n  11, 14, 15, 12, 5, 8, 7, 9, 11, 13, 14, 15, 6, 7, 9, 8,\n  7, 6, 8, 13, 11, 9, 7, 15, 7, 12, 15, 9, 11, 7, 13, 12,\n  11, 13, 6, 7, 14, 9, 13, 15, 14, 8, 13, 6, 5, 12, 7, 5,\n  11, 12, 14, 15, 14, 15, 9, 8, 9, 14, 5, 6, 8, 6, 5, 12,\n  9, 15, 5, 11, 6, 8, 13, 12, 5, 12, 13, 14, 11, 8, 5, 6\n]\n\nvar sr = [\n  8, 9, 9, 11, 13, 15, 15, 5, 7, 7, 8, 11, 14, 14, 12, 6,\n  9, 13, 15, 7, 12, 8, 9, 11, 7, 7, 12, 7, 6, 15, 13, 11,\n  9, 7, 15, 11, 8, 6, 6, 14, 12, 13, 5, 14, 13, 13, 7, 5,\n  15, 5, 8, 11, 14, 14, 6, 14, 6, 9, 12, 9, 12, 5, 15, 8,\n  8, 5, 12, 9, 12, 5, 14, 6, 8, 13, 6, 5, 15, 13, 11, 11\n]\n\nvar hl = [0x00000000, 0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xa953fd4e]\nvar hr = [0x50a28be6, 0x5c4dd124, 0x6d703ef3, 0x7a6d76e9, 0x00000000]\n\nfunction RIPEMD160 () {\n  HashBase.call(this, 64)\n\n  // state\n  this._a = 0x67452301\n  this._b = 0xefcdab89\n  this._c = 0x98badcfe\n  this._d = 0x10325476\n  this._e = 0xc3d2e1f0\n}\n\ninherits(RIPEMD160, HashBase)\n\nRIPEMD160.prototype._update = function () {\n  var words = ARRAY16\n  for (var j = 0; j < 16; ++j) words[j] = this._block.readInt32LE(j * 4)\n\n  var al = this._a | 0\n  var bl = this._b | 0\n  var cl = this._c | 0\n  var dl = this._d | 0\n  var el = this._e | 0\n\n  var ar = this._a | 0\n  var br = this._b | 0\n  var cr = this._c | 0\n  var dr = this._d | 0\n  var er = this._e | 0\n\n  // computation\n  for (var i = 0; i < 80; i += 1) {\n    var tl\n    var tr\n    if (i < 16) {\n      tl = fn1(al, bl, cl, dl, el, words[zl[i]], hl[0], sl[i])\n      tr = fn5(ar, br, cr, dr, er, words[zr[i]], hr[0], sr[i])\n    } else if (i < 32) {\n      tl = fn2(al, bl, cl, dl, el, words[zl[i]], hl[1], sl[i])\n      tr = fn4(ar, br, cr, dr, er, words[zr[i]], hr[1], sr[i])\n    } else if (i < 48) {\n      tl = fn3(al, bl, cl, dl, el, words[zl[i]], hl[2], sl[i])\n      tr = fn3(ar, br, cr, dr, er, words[zr[i]], hr[2], sr[i])\n    } else if (i < 64) {\n      tl = fn4(al, bl, cl, dl, el, words[zl[i]], hl[3], sl[i])\n      tr = fn2(ar, br, cr, dr, er, words[zr[i]], hr[3], sr[i])\n    } else { // if (i<80) {\n      tl = fn5(al, bl, cl, dl, el, words[zl[i]], hl[4], sl[i])\n      tr = fn1(ar, br, cr, dr, er, words[zr[i]], hr[4], sr[i])\n    }\n\n    al = el\n    el = dl\n    dl = rotl(cl, 10)\n    cl = bl\n    bl = tl\n\n    ar = er\n    er = dr\n    dr = rotl(cr, 10)\n    cr = br\n    br = tr\n  }\n\n  // update state\n  var t = (this._b + cl + dr) | 0\n  this._b = (this._c + dl + er) | 0\n  this._c = (this._d + el + ar) | 0\n  this._d = (this._e + al + br) | 0\n  this._e = (this._a + bl + cr) | 0\n  this._a = t\n}\n\nRIPEMD160.prototype._digest = function () {\n  // create padding and handle blocks\n  this._block[this._blockOffset++] = 0x80\n  if (this._blockOffset > 56) {\n    this._block.fill(0, this._blockOffset, 64)\n    this._update()\n    this._blockOffset = 0\n  }\n\n  this._block.fill(0, this._blockOffset, 56)\n  this._block.writeUInt32LE(this._length[0], 56)\n  this._block.writeUInt32LE(this._length[1], 60)\n  this._update()\n\n  // produce result\n  var buffer = Buffer.alloc ? Buffer.alloc(20) : new Buffer(20)\n  buffer.writeInt32LE(this._a, 0)\n  buffer.writeInt32LE(this._b, 4)\n  buffer.writeInt32LE(this._c, 8)\n  buffer.writeInt32LE(this._d, 12)\n  buffer.writeInt32LE(this._e, 16)\n  return buffer\n}\n\nfunction rotl (x, n) {\n  return (x << n) | (x >>> (32 - n))\n}\n\nfunction fn1 (a, b, c, d, e, m, k, s) {\n  return (rotl((a + (b ^ c ^ d) + m + k) | 0, s) + e) | 0\n}\n\nfunction fn2 (a, b, c, d, e, m, k, s) {\n  return (rotl((a + ((b & c) | ((~b) & d)) + m + k) | 0, s) + e) | 0\n}\n\nfunction fn3 (a, b, c, d, e, m, k, s) {\n  return (rotl((a + ((b | (~c)) ^ d) + m + k) | 0, s) + e) | 0\n}\n\nfunction fn4 (a, b, c, d, e, m, k, s) {\n  return (rotl((a + ((b & d) | (c & (~d))) + m + k) | 0, s) + e) | 0\n}\n\nfunction fn5 (a, b, c, d, e, m, k, s) {\n  return (rotl((a + (b ^ (c | (~d))) + m + k) | 0, s) + e) | 0\n}\n\nmodule.exports = RIPEMD160\n","var Buffer = require('safe-buffer').Buffer\n\n// prototype class for hash functions\nfunction Hash (blockSize, finalSize) {\n  this._block = Buffer.alloc(blockSize)\n  this._finalSize = finalSize\n  this._blockSize = blockSize\n  this._len = 0\n}\n\nHash.prototype.update = function (data, enc) {\n  if (typeof data === 'string') {\n    enc = enc || 'utf8'\n    data = Buffer.from(data, enc)\n  }\n\n  var block = this._block\n  var blockSize = this._blockSize\n  var length = data.length\n  var accum = this._len\n\n  for (var offset = 0; offset < length;) {\n    var assigned = accum % blockSize\n    var remainder = Math.min(length - offset, blockSize - assigned)\n\n    for (var i = 0; i < remainder; i++) {\n      block[assigned + i] = data[offset + i]\n    }\n\n    accum += remainder\n    offset += remainder\n\n    if ((accum % blockSize) === 0) {\n      this._update(block)\n    }\n  }\n\n  this._len += length\n  return this\n}\n\nHash.prototype.digest = function (enc) {\n  var rem = this._len % this._blockSize\n\n  this._block[rem] = 0x80\n\n  // zero (rem + 1) trailing bits, where (rem + 1) is the smallest\n  // non-negative solution to the equation (length + 1 + (rem + 1)) === finalSize mod blockSize\n  this._block.fill(0, rem + 1)\n\n  if (rem >= this._finalSize) {\n    this._update(this._block)\n    this._block.fill(0)\n  }\n\n  var bits = this._len * 8\n\n  // uint32\n  if (bits <= 0xffffffff) {\n    this._block.writeUInt32BE(bits, this._blockSize - 4)\n\n  // uint64\n  } else {\n    var lowBits = (bits & 0xffffffff) >>> 0\n    var highBits = (bits - lowBits) / 0x100000000\n\n    this._block.writeUInt32BE(highBits, this._blockSize - 8)\n    this._block.writeUInt32BE(lowBits, this._blockSize - 4)\n  }\n\n  this._update(this._block)\n  var hash = this._hash()\n\n  return enc ? hash.toString(enc) : hash\n}\n\nHash.prototype._update = function () {\n  throw new Error('_update must be implemented by subclass')\n}\n\nmodule.exports = Hash\n","/*\n * A JavaScript implementation of the Secure Hash Algorithm, SHA-0, as defined\n * in FIPS PUB 180-1\n * This source code is derived from sha1.js of the same repository.\n * The difference between SHA-0 and SHA-1 is just a bitwise rotate left\n * operation was added.\n */\n\nvar inherits = require('inherits')\nvar Hash = require('./hash')\nvar Buffer = require('safe-buffer').Buffer\n\nvar K = [\n  0x5a827999, 0x6ed9eba1, 0x8f1bbcdc | 0, 0xca62c1d6 | 0\n]\n\nvar W = new Array(80)\n\nfunction Sha () {\n  this.init()\n  this._w = W\n\n  Hash.call(this, 64, 56)\n}\n\ninherits(Sha, Hash)\n\nSha.prototype.init = function () {\n  this._a = 0x67452301\n  this._b = 0xefcdab89\n  this._c = 0x98badcfe\n  this._d = 0x10325476\n  this._e = 0xc3d2e1f0\n\n  return this\n}\n\nfunction rotl5 (num) {\n  return (num << 5) | (num >>> 27)\n}\n\nfunction rotl30 (num) {\n  return (num << 30) | (num >>> 2)\n}\n\nfunction ft (s, b, c, d) {\n  if (s === 0) return (b & c) | ((~b) & d)\n  if (s === 2) return (b & c) | (b & d) | (c & d)\n  return b ^ c ^ d\n}\n\nSha.prototype._update = function (M) {\n  var W = this._w\n\n  var a = this._a | 0\n  var b = this._b | 0\n  var c = this._c | 0\n  var d = this._d | 0\n  var e = this._e | 0\n\n  for (var i = 0; i < 16; ++i) W[i] = M.readInt32BE(i * 4)\n  for (; i < 80; ++i) W[i] = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16]\n\n  for (var j = 0; j < 80; ++j) {\n    var s = ~~(j / 20)\n    var t = (rotl5(a) + ft(s, b, c, d) + e + W[j] + K[s]) | 0\n\n    e = d\n    d = c\n    c = rotl30(b)\n    b = a\n    a = t\n  }\n\n  this._a = (a + this._a) | 0\n  this._b = (b + this._b) | 0\n  this._c = (c + this._c) | 0\n  this._d = (d + this._d) | 0\n  this._e = (e + this._e) | 0\n}\n\nSha.prototype._hash = function () {\n  var H = Buffer.allocUnsafe(20)\n\n  H.writeInt32BE(this._a | 0, 0)\n  H.writeInt32BE(this._b | 0, 4)\n  H.writeInt32BE(this._c | 0, 8)\n  H.writeInt32BE(this._d | 0, 12)\n  H.writeInt32BE(this._e | 0, 16)\n\n  return H\n}\n\nmodule.exports = Sha\n","/*\n * A JavaScript implementation of the Secure Hash Algorithm, SHA-1, as defined\n * in FIPS PUB 180-1\n * Version 2.1a Copyright Paul Johnston 2000 - 2002.\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n * Distributed under the BSD License\n * See http://pajhome.org.uk/crypt/md5 for details.\n */\n\nvar inherits = require('inherits')\nvar Hash = require('./hash')\nvar Buffer = require('safe-buffer').Buffer\n\nvar K = [\n  0x5a827999, 0x6ed9eba1, 0x8f1bbcdc | 0, 0xca62c1d6 | 0\n]\n\nvar W = new Array(80)\n\nfunction Sha1 () {\n  this.init()\n  this._w = W\n\n  Hash.call(this, 64, 56)\n}\n\ninherits(Sha1, Hash)\n\nSha1.prototype.init = function () {\n  this._a = 0x67452301\n  this._b = 0xefcdab89\n  this._c = 0x98badcfe\n  this._d = 0x10325476\n  this._e = 0xc3d2e1f0\n\n  return this\n}\n\nfunction rotl1 (num) {\n  return (num << 1) | (num >>> 31)\n}\n\nfunction rotl5 (num) {\n  return (num << 5) | (num >>> 27)\n}\n\nfunction rotl30 (num) {\n  return (num << 30) | (num >>> 2)\n}\n\nfunction ft (s, b, c, d) {\n  if (s === 0) return (b & c) | ((~b) & d)\n  if (s === 2) return (b & c) | (b & d) | (c & d)\n  return b ^ c ^ d\n}\n\nSha1.prototype._update = function (M) {\n  var W = this._w\n\n  var a = this._a | 0\n  var b = this._b | 0\n  var c = this._c | 0\n  var d = this._d | 0\n  var e = this._e | 0\n\n  for (var i = 0; i < 16; ++i) W[i] = M.readInt32BE(i * 4)\n  for (; i < 80; ++i) W[i] = rotl1(W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16])\n\n  for (var j = 0; j < 80; ++j) {\n    var s = ~~(j / 20)\n    var t = (rotl5(a) + ft(s, b, c, d) + e + W[j] + K[s]) | 0\n\n    e = d\n    d = c\n    c = rotl30(b)\n    b = a\n    a = t\n  }\n\n  this._a = (a + this._a) | 0\n  this._b = (b + this._b) | 0\n  this._c = (c + this._c) | 0\n  this._d = (d + this._d) | 0\n  this._e = (e + this._e) | 0\n}\n\nSha1.prototype._hash = function () {\n  var H = Buffer.allocUnsafe(20)\n\n  H.writeInt32BE(this._a | 0, 0)\n  H.writeInt32BE(this._b | 0, 4)\n  H.writeInt32BE(this._c | 0, 8)\n  H.writeInt32BE(this._d | 0, 12)\n  H.writeInt32BE(this._e | 0, 16)\n\n  return H\n}\n\nmodule.exports = Sha1\n","/**\n * A JavaScript implementation of the Secure Hash Algorithm, SHA-256, as defined\n * in FIPS 180-2\n * Version 2.2-beta Copyright Angel Marin, Paul Johnston 2000 - 2009.\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n *\n */\n\nvar inherits = require('inherits')\nvar Hash = require('./hash')\nvar Buffer = require('safe-buffer').Buffer\n\nvar K = [\n  0x428A2F98, 0x71374491, 0xB5C0FBCF, 0xE9B5DBA5,\n  0x3956C25B, 0x59F111F1, 0x923F82A4, 0xAB1C5ED5,\n  0xD807AA98, 0x12835B01, 0x243185BE, 0x550C7DC3,\n  0x72BE5D74, 0x80DEB1FE, 0x9BDC06A7, 0xC19BF174,\n  0xE49B69C1, 0xEFBE4786, 0x0FC19DC6, 0x240CA1CC,\n  0x2DE92C6F, 0x4A7484AA, 0x5CB0A9DC, 0x76F988DA,\n  0x983E5152, 0xA831C66D, 0xB00327C8, 0xBF597FC7,\n  0xC6E00BF3, 0xD5A79147, 0x06CA6351, 0x14292967,\n  0x27B70A85, 0x2E1B2138, 0x4D2C6DFC, 0x53380D13,\n  0x650A7354, 0x766A0ABB, 0x81C2C92E, 0x92722C85,\n  0xA2BFE8A1, 0xA81A664B, 0xC24B8B70, 0xC76C51A3,\n  0xD192E819, 0xD6990624, 0xF40E3585, 0x106AA070,\n  0x19A4C116, 0x1E376C08, 0x2748774C, 0x34B0BCB5,\n  0x391C0CB3, 0x4ED8AA4A, 0x5B9CCA4F, 0x682E6FF3,\n  0x748F82EE, 0x78A5636F, 0x84C87814, 0x8CC70208,\n  0x90BEFFFA, 0xA4506CEB, 0xBEF9A3F7, 0xC67178F2\n]\n\nvar W = new Array(64)\n\nfunction Sha256 () {\n  this.init()\n\n  this._w = W // new Array(64)\n\n  Hash.call(this, 64, 56)\n}\n\ninherits(Sha256, Hash)\n\nSha256.prototype.init = function () {\n  this._a = 0x6a09e667\n  this._b = 0xbb67ae85\n  this._c = 0x3c6ef372\n  this._d = 0xa54ff53a\n  this._e = 0x510e527f\n  this._f = 0x9b05688c\n  this._g = 0x1f83d9ab\n  this._h = 0x5be0cd19\n\n  return this\n}\n\nfunction ch (x, y, z) {\n  return z ^ (x & (y ^ z))\n}\n\nfunction maj (x, y, z) {\n  return (x & y) | (z & (x | y))\n}\n\nfunction sigma0 (x) {\n  return (x >>> 2 | x << 30) ^ (x >>> 13 | x << 19) ^ (x >>> 22 | x << 10)\n}\n\nfunction sigma1 (x) {\n  return (x >>> 6 | x << 26) ^ (x >>> 11 | x << 21) ^ (x >>> 25 | x << 7)\n}\n\nfunction gamma0 (x) {\n  return (x >>> 7 | x << 25) ^ (x >>> 18 | x << 14) ^ (x >>> 3)\n}\n\nfunction gamma1 (x) {\n  return (x >>> 17 | x << 15) ^ (x >>> 19 | x << 13) ^ (x >>> 10)\n}\n\nSha256.prototype._update = function (M) {\n  var W = this._w\n\n  var a = this._a | 0\n  var b = this._b | 0\n  var c = this._c | 0\n  var d = this._d | 0\n  var e = this._e | 0\n  var f = this._f | 0\n  var g = this._g | 0\n  var h = this._h | 0\n\n  for (var i = 0; i < 16; ++i) W[i] = M.readInt32BE(i * 4)\n  for (; i < 64; ++i) W[i] = (gamma1(W[i - 2]) + W[i - 7] + gamma0(W[i - 15]) + W[i - 16]) | 0\n\n  for (var j = 0; j < 64; ++j) {\n    var T1 = (h + sigma1(e) + ch(e, f, g) + K[j] + W[j]) | 0\n    var T2 = (sigma0(a) + maj(a, b, c)) | 0\n\n    h = g\n    g = f\n    f = e\n    e = (d + T1) | 0\n    d = c\n    c = b\n    b = a\n    a = (T1 + T2) | 0\n  }\n\n  this._a = (a + this._a) | 0\n  this._b = (b + this._b) | 0\n  this._c = (c + this._c) | 0\n  this._d = (d + this._d) | 0\n  this._e = (e + this._e) | 0\n  this._f = (f + this._f) | 0\n  this._g = (g + this._g) | 0\n  this._h = (h + this._h) | 0\n}\n\nSha256.prototype._hash = function () {\n  var H = Buffer.allocUnsafe(32)\n\n  H.writeInt32BE(this._a, 0)\n  H.writeInt32BE(this._b, 4)\n  H.writeInt32BE(this._c, 8)\n  H.writeInt32BE(this._d, 12)\n  H.writeInt32BE(this._e, 16)\n  H.writeInt32BE(this._f, 20)\n  H.writeInt32BE(this._g, 24)\n  H.writeInt32BE(this._h, 28)\n\n  return H\n}\n\nmodule.exports = Sha256\n","/**\n * A JavaScript implementation of the Secure Hash Algorithm, SHA-256, as defined\n * in FIPS 180-2\n * Version 2.2-beta Copyright Angel Marin, Paul Johnston 2000 - 2009.\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n *\n */\n\nvar inherits = require('inherits')\nvar Sha256 = require('./sha256')\nvar Hash = require('./hash')\nvar Buffer = require('safe-buffer').Buffer\n\nvar W = new Array(64)\n\nfunction Sha224 () {\n  this.init()\n\n  this._w = W // new Array(64)\n\n  Hash.call(this, 64, 56)\n}\n\ninherits(Sha224, Sha256)\n\nSha224.prototype.init = function () {\n  this._a = 0xc1059ed8\n  this._b = 0x367cd507\n  this._c = 0x3070dd17\n  this._d = 0xf70e5939\n  this._e = 0xffc00b31\n  this._f = 0x68581511\n  this._g = 0x64f98fa7\n  this._h = 0xbefa4fa4\n\n  return this\n}\n\nSha224.prototype._hash = function () {\n  var H = Buffer.allocUnsafe(28)\n\n  H.writeInt32BE(this._a, 0)\n  H.writeInt32BE(this._b, 4)\n  H.writeInt32BE(this._c, 8)\n  H.writeInt32BE(this._d, 12)\n  H.writeInt32BE(this._e, 16)\n  H.writeInt32BE(this._f, 20)\n  H.writeInt32BE(this._g, 24)\n\n  return H\n}\n\nmodule.exports = Sha224\n","var inherits = require('inherits')\nvar Hash = require('./hash')\nvar Buffer = require('safe-buffer').Buffer\n\nvar K = [\n  0x428a2f98, 0xd728ae22, 0x71374491, 0x23ef65cd,\n  0xb5c0fbcf, 0xec4d3b2f, 0xe9b5dba5, 0x8189dbbc,\n  0x3956c25b, 0xf348b538, 0x59f111f1, 0xb605d019,\n  0x923f82a4, 0xaf194f9b, 0xab1c5ed5, 0xda6d8118,\n  0xd807aa98, 0xa3030242, 0x12835b01, 0x45706fbe,\n  0x243185be, 0x4ee4b28c, 0x550c7dc3, 0xd5ffb4e2,\n  0x72be5d74, 0xf27b896f, 0x80deb1fe, 0x3b1696b1,\n  0x9bdc06a7, 0x25c71235, 0xc19bf174, 0xcf692694,\n  0xe49b69c1, 0x9ef14ad2, 0xefbe4786, 0x384f25e3,\n  0x0fc19dc6, 0x8b8cd5b5, 0x240ca1cc, 0x77ac9c65,\n  0x2de92c6f, 0x592b0275, 0x4a7484aa, 0x6ea6e483,\n  0x5cb0a9dc, 0xbd41fbd4, 0x76f988da, 0x831153b5,\n  0x983e5152, 0xee66dfab, 0xa831c66d, 0x2db43210,\n  0xb00327c8, 0x98fb213f, 0xbf597fc7, 0xbeef0ee4,\n  0xc6e00bf3, 0x3da88fc2, 0xd5a79147, 0x930aa725,\n  0x06ca6351, 0xe003826f, 0x14292967, 0x0a0e6e70,\n  0x27b70a85, 0x46d22ffc, 0x2e1b2138, 0x5c26c926,\n  0x4d2c6dfc, 0x5ac42aed, 0x53380d13, 0x9d95b3df,\n  0x650a7354, 0x8baf63de, 0x766a0abb, 0x3c77b2a8,\n  0x81c2c92e, 0x47edaee6, 0x92722c85, 0x1482353b,\n  0xa2bfe8a1, 0x4cf10364, 0xa81a664b, 0xbc423001,\n  0xc24b8b70, 0xd0f89791, 0xc76c51a3, 0x0654be30,\n  0xd192e819, 0xd6ef5218, 0xd6990624, 0x5565a910,\n  0xf40e3585, 0x5771202a, 0x106aa070, 0x32bbd1b8,\n  0x19a4c116, 0xb8d2d0c8, 0x1e376c08, 0x5141ab53,\n  0x2748774c, 0xdf8eeb99, 0x34b0bcb5, 0xe19b48a8,\n  0x391c0cb3, 0xc5c95a63, 0x4ed8aa4a, 0xe3418acb,\n  0x5b9cca4f, 0x7763e373, 0x682e6ff3, 0xd6b2b8a3,\n  0x748f82ee, 0x5defb2fc, 0x78a5636f, 0x43172f60,\n  0x84c87814, 0xa1f0ab72, 0x8cc70208, 0x1a6439ec,\n  0x90befffa, 0x23631e28, 0xa4506ceb, 0xde82bde9,\n  0xbef9a3f7, 0xb2c67915, 0xc67178f2, 0xe372532b,\n  0xca273ece, 0xea26619c, 0xd186b8c7, 0x21c0c207,\n  0xeada7dd6, 0xcde0eb1e, 0xf57d4f7f, 0xee6ed178,\n  0x06f067aa, 0x72176fba, 0x0a637dc5, 0xa2c898a6,\n  0x113f9804, 0xbef90dae, 0x1b710b35, 0x131c471b,\n  0x28db77f5, 0x23047d84, 0x32caab7b, 0x40c72493,\n  0x3c9ebe0a, 0x15c9bebc, 0x431d67c4, 0x9c100d4c,\n  0x4cc5d4be, 0xcb3e42b6, 0x597f299c, 0xfc657e2a,\n  0x5fcb6fab, 0x3ad6faec, 0x6c44198c, 0x4a475817\n]\n\nvar W = new Array(160)\n\nfunction Sha512 () {\n  this.init()\n  this._w = W\n\n  Hash.call(this, 128, 112)\n}\n\ninherits(Sha512, Hash)\n\nSha512.prototype.init = function () {\n  this._ah = 0x6a09e667\n  this._bh = 0xbb67ae85\n  this._ch = 0x3c6ef372\n  this._dh = 0xa54ff53a\n  this._eh = 0x510e527f\n  this._fh = 0x9b05688c\n  this._gh = 0x1f83d9ab\n  this._hh = 0x5be0cd19\n\n  this._al = 0xf3bcc908\n  this._bl = 0x84caa73b\n  this._cl = 0xfe94f82b\n  this._dl = 0x5f1d36f1\n  this._el = 0xade682d1\n  this._fl = 0x2b3e6c1f\n  this._gl = 0xfb41bd6b\n  this._hl = 0x137e2179\n\n  return this\n}\n\nfunction Ch (x, y, z) {\n  return z ^ (x & (y ^ z))\n}\n\nfunction maj (x, y, z) {\n  return (x & y) | (z & (x | y))\n}\n\nfunction sigma0 (x, xl) {\n  return (x >>> 28 | xl << 4) ^ (xl >>> 2 | x << 30) ^ (xl >>> 7 | x << 25)\n}\n\nfunction sigma1 (x, xl) {\n  return (x >>> 14 | xl << 18) ^ (x >>> 18 | xl << 14) ^ (xl >>> 9 | x << 23)\n}\n\nfunction Gamma0 (x, xl) {\n  return (x >>> 1 | xl << 31) ^ (x >>> 8 | xl << 24) ^ (x >>> 7)\n}\n\nfunction Gamma0l (x, xl) {\n  return (x >>> 1 | xl << 31) ^ (x >>> 8 | xl << 24) ^ (x >>> 7 | xl << 25)\n}\n\nfunction Gamma1 (x, xl) {\n  return (x >>> 19 | xl << 13) ^ (xl >>> 29 | x << 3) ^ (x >>> 6)\n}\n\nfunction Gamma1l (x, xl) {\n  return (x >>> 19 | xl << 13) ^ (xl >>> 29 | x << 3) ^ (x >>> 6 | xl << 26)\n}\n\nfunction getCarry (a, b) {\n  return (a >>> 0) < (b >>> 0) ? 1 : 0\n}\n\nSha512.prototype._update = function (M) {\n  var W = this._w\n\n  var ah = this._ah | 0\n  var bh = this._bh | 0\n  var ch = this._ch | 0\n  var dh = this._dh | 0\n  var eh = this._eh | 0\n  var fh = this._fh | 0\n  var gh = this._gh | 0\n  var hh = this._hh | 0\n\n  var al = this._al | 0\n  var bl = this._bl | 0\n  var cl = this._cl | 0\n  var dl = this._dl | 0\n  var el = this._el | 0\n  var fl = this._fl | 0\n  var gl = this._gl | 0\n  var hl = this._hl | 0\n\n  for (var i = 0; i < 32; i += 2) {\n    W[i] = M.readInt32BE(i * 4)\n    W[i + 1] = M.readInt32BE(i * 4 + 4)\n  }\n  for (; i < 160; i += 2) {\n    var xh = W[i - 15 * 2]\n    var xl = W[i - 15 * 2 + 1]\n    var gamma0 = Gamma0(xh, xl)\n    var gamma0l = Gamma0l(xl, xh)\n\n    xh = W[i - 2 * 2]\n    xl = W[i - 2 * 2 + 1]\n    var gamma1 = Gamma1(xh, xl)\n    var gamma1l = Gamma1l(xl, xh)\n\n    // W[i] = gamma0 + W[i - 7] + gamma1 + W[i - 16]\n    var Wi7h = W[i - 7 * 2]\n    var Wi7l = W[i - 7 * 2 + 1]\n\n    var Wi16h = W[i - 16 * 2]\n    var Wi16l = W[i - 16 * 2 + 1]\n\n    var Wil = (gamma0l + Wi7l) | 0\n    var Wih = (gamma0 + Wi7h + getCarry(Wil, gamma0l)) | 0\n    Wil = (Wil + gamma1l) | 0\n    Wih = (Wih + gamma1 + getCarry(Wil, gamma1l)) | 0\n    Wil = (Wil + Wi16l) | 0\n    Wih = (Wih + Wi16h + getCarry(Wil, Wi16l)) | 0\n\n    W[i] = Wih\n    W[i + 1] = Wil\n  }\n\n  for (var j = 0; j < 160; j += 2) {\n    Wih = W[j]\n    Wil = W[j + 1]\n\n    var majh = maj(ah, bh, ch)\n    var majl = maj(al, bl, cl)\n\n    var sigma0h = sigma0(ah, al)\n    var sigma0l = sigma0(al, ah)\n    var sigma1h = sigma1(eh, el)\n    var sigma1l = sigma1(el, eh)\n\n    // t1 = h + sigma1 + ch + K[j] + W[j]\n    var Kih = K[j]\n    var Kil = K[j + 1]\n\n    var chh = Ch(eh, fh, gh)\n    var chl = Ch(el, fl, gl)\n\n    var t1l = (hl + sigma1l) | 0\n    var t1h = (hh + sigma1h + getCarry(t1l, hl)) | 0\n    t1l = (t1l + chl) | 0\n    t1h = (t1h + chh + getCarry(t1l, chl)) | 0\n    t1l = (t1l + Kil) | 0\n    t1h = (t1h + Kih + getCarry(t1l, Kil)) | 0\n    t1l = (t1l + Wil) | 0\n    t1h = (t1h + Wih + getCarry(t1l, Wil)) | 0\n\n    // t2 = sigma0 + maj\n    var t2l = (sigma0l + majl) | 0\n    var t2h = (sigma0h + majh + getCarry(t2l, sigma0l)) | 0\n\n    hh = gh\n    hl = gl\n    gh = fh\n    gl = fl\n    fh = eh\n    fl = el\n    el = (dl + t1l) | 0\n    eh = (dh + t1h + getCarry(el, dl)) | 0\n    dh = ch\n    dl = cl\n    ch = bh\n    cl = bl\n    bh = ah\n    bl = al\n    al = (t1l + t2l) | 0\n    ah = (t1h + t2h + getCarry(al, t1l)) | 0\n  }\n\n  this._al = (this._al + al) | 0\n  this._bl = (this._bl + bl) | 0\n  this._cl = (this._cl + cl) | 0\n  this._dl = (this._dl + dl) | 0\n  this._el = (this._el + el) | 0\n  this._fl = (this._fl + fl) | 0\n  this._gl = (this._gl + gl) | 0\n  this._hl = (this._hl + hl) | 0\n\n  this._ah = (this._ah + ah + getCarry(this._al, al)) | 0\n  this._bh = (this._bh + bh + getCarry(this._bl, bl)) | 0\n  this._ch = (this._ch + ch + getCarry(this._cl, cl)) | 0\n  this._dh = (this._dh + dh + getCarry(this._dl, dl)) | 0\n  this._eh = (this._eh + eh + getCarry(this._el, el)) | 0\n  this._fh = (this._fh + fh + getCarry(this._fl, fl)) | 0\n  this._gh = (this._gh + gh + getCarry(this._gl, gl)) | 0\n  this._hh = (this._hh + hh + getCarry(this._hl, hl)) | 0\n}\n\nSha512.prototype._hash = function () {\n  var H = Buffer.allocUnsafe(64)\n\n  function writeInt64BE (h, l, offset) {\n    H.writeInt32BE(h, offset)\n    H.writeInt32BE(l, offset + 4)\n  }\n\n  writeInt64BE(this._ah, this._al, 0)\n  writeInt64BE(this._bh, this._bl, 8)\n  writeInt64BE(this._ch, this._cl, 16)\n  writeInt64BE(this._dh, this._dl, 24)\n  writeInt64BE(this._eh, this._el, 32)\n  writeInt64BE(this._fh, this._fl, 40)\n  writeInt64BE(this._gh, this._gl, 48)\n  writeInt64BE(this._hh, this._hl, 56)\n\n  return H\n}\n\nmodule.exports = Sha512\n","var inherits = require('inherits')\nvar SHA512 = require('./sha512')\nvar Hash = require('./hash')\nvar Buffer = require('safe-buffer').Buffer\n\nvar W = new Array(160)\n\nfunction Sha384 () {\n  this.init()\n  this._w = W\n\n  Hash.call(this, 128, 112)\n}\n\ninherits(Sha384, SHA512)\n\nSha384.prototype.init = function () {\n  this._ah = 0xcbbb9d5d\n  this._bh = 0x629a292a\n  this._ch = 0x9159015a\n  this._dh = 0x152fecd8\n  this._eh = 0x67332667\n  this._fh = 0x8eb44a87\n  this._gh = 0xdb0c2e0d\n  this._hh = 0x47b5481d\n\n  this._al = 0xc1059ed8\n  this._bl = 0x367cd507\n  this._cl = 0x3070dd17\n  this._dl = 0xf70e5939\n  this._el = 0xffc00b31\n  this._fl = 0x68581511\n  this._gl = 0x64f98fa7\n  this._hl = 0xbefa4fa4\n\n  return this\n}\n\nSha384.prototype._hash = function () {\n  var H = Buffer.allocUnsafe(48)\n\n  function writeInt64BE (h, l, offset) {\n    H.writeInt32BE(h, offset)\n    H.writeInt32BE(l, offset + 4)\n  }\n\n  writeInt64BE(this._ah, this._al, 0)\n  writeInt64BE(this._bh, this._bl, 8)\n  writeInt64BE(this._ch, this._cl, 16)\n  writeInt64BE(this._dh, this._dl, 24)\n  writeInt64BE(this._eh, this._el, 32)\n  writeInt64BE(this._fh, this._fl, 40)\n\n  return H\n}\n\nmodule.exports = Sha384\n","var exports = module.exports = function SHA (algorithm) {\n  algorithm = algorithm.toLowerCase()\n\n  var Algorithm = exports[algorithm]\n  if (!Algorithm) throw new Error(algorithm + ' is not supported (we accept pull requests)')\n\n  return new Algorithm()\n}\n\nexports.sha = require('./sha')\nexports.sha1 = require('./sha1')\nexports.sha224 = require('./sha224')\nexports.sha256 = require('./sha256')\nexports.sha384 = require('./sha384')\nexports.sha512 = require('./sha512')\n","var Buffer = require('safe-buffer').Buffer\nvar Transform = require('stream').Transform\nvar StringDecoder = require('string_decoder').StringDecoder\nvar inherits = require('inherits')\n\nfunction CipherBase (hashMode) {\n  Transform.call(this)\n  this.hashMode = typeof hashMode === 'string'\n  if (this.hashMode) {\n    this[hashMode] = this._finalOrDigest\n  } else {\n    this.final = this._finalOrDigest\n  }\n  if (this._final) {\n    this.__final = this._final\n    this._final = null\n  }\n  this._decoder = null\n  this._encoding = null\n}\ninherits(CipherBase, Transform)\n\nCipherBase.prototype.update = function (data, inputEnc, outputEnc) {\n  if (typeof data === 'string') {\n    data = Buffer.from(data, inputEnc)\n  }\n\n  var outData = this._update(data)\n  if (this.hashMode) return this\n\n  if (outputEnc) {\n    outData = this._toString(outData, outputEnc)\n  }\n\n  return outData\n}\n\nCipherBase.prototype.setAutoPadding = function () {}\nCipherBase.prototype.getAuthTag = function () {\n  throw new Error('trying to get auth tag in unsupported state')\n}\n\nCipherBase.prototype.setAuthTag = function () {\n  throw new Error('trying to set auth tag in unsupported state')\n}\n\nCipherBase.prototype.setAAD = function () {\n  throw new Error('trying to set aad in unsupported state')\n}\n\nCipherBase.prototype._transform = function (data, _, next) {\n  var err\n  try {\n    if (this.hashMode) {\n      this._update(data)\n    } else {\n      this.push(this._update(data))\n    }\n  } catch (e) {\n    err = e\n  } finally {\n    next(err)\n  }\n}\nCipherBase.prototype._flush = function (done) {\n  var err\n  try {\n    this.push(this.__final())\n  } catch (e) {\n    err = e\n  }\n\n  done(err)\n}\nCipherBase.prototype._finalOrDigest = function (outputEnc) {\n  var outData = this.__final() || Buffer.alloc(0)\n  if (outputEnc) {\n    outData = this._toString(outData, outputEnc, true)\n  }\n  return outData\n}\n\nCipherBase.prototype._toString = function (value, enc, fin) {\n  if (!this._decoder) {\n    this._decoder = new StringDecoder(enc)\n    this._encoding = enc\n  }\n\n  if (this._encoding !== enc) throw new Error('can\\'t switch encodings')\n\n  var out = this._decoder.write(value)\n  if (fin) {\n    out += this._decoder.end()\n  }\n\n  return out\n}\n\nmodule.exports = CipherBase\n","'use strict'\nvar inherits = require('inherits')\nvar MD5 = require('md5.js')\nvar RIPEMD160 = require('ripemd160')\nvar sha = require('sha.js')\nvar Base = require('cipher-base')\n\nfunction Hash (hash) {\n  Base.call(this, 'digest')\n\n  this._hash = hash\n}\n\ninherits(Hash, Base)\n\nHash.prototype._update = function (data) {\n  this._hash.update(data)\n}\n\nHash.prototype._final = function () {\n  return this._hash.digest()\n}\n\nmodule.exports = function createHash (alg) {\n  alg = alg.toLowerCase()\n  if (alg === 'md5') return new MD5()\n  if (alg === 'rmd160' || alg === 'ripemd160') return new RIPEMD160()\n\n  return new Hash(sha(alg))\n}\n","'use strict'\nvar inherits = require('inherits')\nvar Buffer = require('safe-buffer').Buffer\n\nvar Base = require('cipher-base')\n\nvar ZEROS = Buffer.alloc(128)\nvar blocksize = 64\n\nfunction Hmac (alg, key) {\n  Base.call(this, 'digest')\n  if (typeof key === 'string') {\n    key = Buffer.from(key)\n  }\n\n  this._alg = alg\n  this._key = key\n\n  if (key.length > blocksize) {\n    key = alg(key)\n  } else if (key.length < blocksize) {\n    key = Buffer.concat([key, ZEROS], blocksize)\n  }\n\n  var ipad = this._ipad = Buffer.allocUnsafe(blocksize)\n  var opad = this._opad = Buffer.allocUnsafe(blocksize)\n\n  for (var i = 0; i < blocksize; i++) {\n    ipad[i] = key[i] ^ 0x36\n    opad[i] = key[i] ^ 0x5C\n  }\n\n  this._hash = [ipad]\n}\n\ninherits(Hmac, Base)\n\nHmac.prototype._update = function (data) {\n  this._hash.push(data)\n}\n\nHmac.prototype._final = function () {\n  var h = this._alg(Buffer.concat(this._hash))\n  return this._alg(Buffer.concat([this._opad, h]))\n}\nmodule.exports = Hmac\n","var MD5 = require('md5.js')\n\nmodule.exports = function (buffer) {\n  return new MD5().update(buffer).digest()\n}\n","'use strict'\nvar inherits = require('inherits')\nvar Legacy = require('./legacy')\nvar Base = require('cipher-base')\nvar Buffer = require('safe-buffer').Buffer\nvar md5 = require('create-hash/md5')\nvar RIPEMD160 = require('ripemd160')\n\nvar sha = require('sha.js')\n\nvar ZEROS = Buffer.alloc(128)\n\nfunction Hmac (alg, key) {\n  Base.call(this, 'digest')\n  if (typeof key === 'string') {\n    key = Buffer.from(key)\n  }\n\n  var blocksize = (alg === 'sha512' || alg === 'sha384') ? 128 : 64\n\n  this._alg = alg\n  this._key = key\n  if (key.length > blocksize) {\n    var hash = alg === 'rmd160' ? new RIPEMD160() : sha(alg)\n    key = hash.update(key).digest()\n  } else if (key.length < blocksize) {\n    key = Buffer.concat([key, ZEROS], blocksize)\n  }\n\n  var ipad = this._ipad = Buffer.allocUnsafe(blocksize)\n  var opad = this._opad = Buffer.allocUnsafe(blocksize)\n\n  for (var i = 0; i < blocksize; i++) {\n    ipad[i] = key[i] ^ 0x36\n    opad[i] = key[i] ^ 0x5C\n  }\n  this._hash = alg === 'rmd160' ? new RIPEMD160() : sha(alg)\n  this._hash.update(ipad)\n}\n\ninherits(Hmac, Base)\n\nHmac.prototype._update = function (data) {\n  this._hash.update(data)\n}\n\nHmac.prototype._final = function () {\n  var h = this._hash.digest()\n  var hash = this._alg === 'rmd160' ? new RIPEMD160() : sha(this._alg)\n  return hash.update(this._opad).update(h).digest()\n}\n\nmodule.exports = function createHmac (alg, key) {\n  alg = alg.toLowerCase()\n  if (alg === 'rmd160' || alg === 'ripemd160') {\n    return new Hmac('rmd160', key)\n  }\n  if (alg === 'md5') {\n    return new Legacy(md5, key)\n  }\n  return new Hmac(alg, key)\n}\n","module.exports = require('./browser/algorithms.json')\n","var MAX_ALLOC = Math.pow(2, 30) - 1 // default in iojs\n\nfunction checkBuffer (buf, name) {\n  if (typeof buf !== 'string' && !Buffer.isBuffer(buf)) {\n    throw new TypeError(name + ' must be a buffer or string')\n  }\n}\n\nmodule.exports = function (password, salt, iterations, keylen) {\n  checkBuffer(password, 'Password')\n  checkBuffer(salt, 'Salt')\n\n  if (typeof iterations !== 'number') {\n    throw new TypeError('Iterations not a number')\n  }\n\n  if (iterations < 0) {\n    throw new TypeError('Bad iterations')\n  }\n\n  if (typeof keylen !== 'number') {\n    throw new TypeError('Key length not a number')\n  }\n\n  if (keylen < 0 || keylen > MAX_ALLOC || keylen !== keylen) { /* eslint no-self-compare: 0 */\n    throw new TypeError('Bad key length')\n  }\n}\n","var defaultEncoding\n/* istanbul ignore next */\nif (process.browser) {\n  defaultEncoding = 'utf-8'\n} else {\n  var pVersionMajor = parseInt(process.version.split('.')[0].slice(1), 10)\n\n  defaultEncoding = pVersionMajor >= 6 ? 'utf-8' : 'binary'\n}\nmodule.exports = defaultEncoding\n","var sizes = {\n  md5: 16,\n  sha1: 20,\n  sha224: 28,\n  sha256: 32,\n  sha384: 48,\n  sha512: 64,\n  rmd160: 20,\n  ripemd160: 20\n}\n\nvar createHmac = require('create-hmac')\nvar checkParameters = require('../lib/precondition')\nvar defaultEncoding = require('../lib/default-encoding')\nvar Buffer = require('safe-buffer').Buffer\n\nfunction pbkdf2 (password, salt, iterations, keylen, digest) {\n  checkParameters(password, salt, iterations, keylen)\n\n  if (!Buffer.isBuffer(password)) password = Buffer.from(password, defaultEncoding)\n  if (!Buffer.isBuffer(salt)) salt = Buffer.from(salt, defaultEncoding)\n\n  digest = digest || 'sha1'\n\n  var DK = Buffer.allocUnsafe(keylen)\n  var block1 = Buffer.allocUnsafe(salt.length + 4)\n  salt.copy(block1, 0, 0, salt.length)\n\n  var destPos = 0\n  var hLen = sizes[digest]\n  var l = Math.ceil(keylen / hLen)\n\n  for (var i = 1; i <= l; i++) {\n    block1.writeUInt32BE(i, salt.length)\n\n    var T = createHmac(digest, password).update(block1).digest()\n    var U = T\n\n    for (var j = 1; j < iterations; j++) {\n      U = createHmac(digest, password).update(U).digest()\n      for (var k = 0; k < hLen; k++) T[k] ^= U[k]\n    }\n\n    T.copy(DK, destPos)\n    destPos += hLen\n  }\n\n  return DK\n}\n\nmodule.exports = pbkdf2\n","var checkParameters = require('./precondition')\nvar defaultEncoding = require('./default-encoding')\nvar sync = require('./sync')\nvar Buffer = require('safe-buffer').Buffer\n\nvar ZERO_BUF\nvar subtle = global.crypto && global.crypto.subtle\nvar toBrowser = {\n  'sha': 'SHA-1',\n  'sha-1': 'SHA-1',\n  'sha1': 'SHA-1',\n  'sha256': 'SHA-256',\n  'sha-256': 'SHA-256',\n  'sha384': 'SHA-384',\n  'sha-384': 'SHA-384',\n  'sha-512': 'SHA-512',\n  'sha512': 'SHA-512'\n}\nvar checks = []\nfunction checkNative (algo) {\n  if (global.process && !global.process.browser) {\n    return Promise.resolve(false)\n  }\n  if (!subtle || !subtle.importKey || !subtle.deriveBits) {\n    return Promise.resolve(false)\n  }\n  if (checks[algo] !== undefined) {\n    return checks[algo]\n  }\n  ZERO_BUF = ZERO_BUF || Buffer.alloc(8)\n  var prom = browserPbkdf2(ZERO_BUF, ZERO_BUF, 10, 128, algo)\n    .then(function () {\n      return true\n    }).catch(function () {\n      return false\n    })\n  checks[algo] = prom\n  return prom\n}\n\nfunction browserPbkdf2 (password, salt, iterations, length, algo) {\n  return subtle.importKey(\n    'raw', password, {name: 'PBKDF2'}, false, ['deriveBits']\n  ).then(function (key) {\n    return subtle.deriveBits({\n      name: 'PBKDF2',\n      salt: salt,\n      iterations: iterations,\n      hash: {\n        name: algo\n      }\n    }, key, length << 3)\n  }).then(function (res) {\n    return Buffer.from(res)\n  })\n}\n\nfunction resolvePromise (promise, callback) {\n  promise.then(function (out) {\n    process.nextTick(function () {\n      callback(null, out)\n    })\n  }, function (e) {\n    process.nextTick(function () {\n      callback(e)\n    })\n  })\n}\nmodule.exports = function (password, salt, iterations, keylen, digest, callback) {\n  if (typeof digest === 'function') {\n    callback = digest\n    digest = undefined\n  }\n\n  digest = digest || 'sha1'\n  var algo = toBrowser[digest.toLowerCase()]\n\n  if (!algo || typeof global.Promise !== 'function') {\n    return process.nextTick(function () {\n      var out\n      try {\n        out = sync(password, salt, iterations, keylen, digest)\n      } catch (e) {\n        return callback(e)\n      }\n      callback(null, out)\n    })\n  }\n\n  checkParameters(password, salt, iterations, keylen)\n  if (typeof callback !== 'function') throw new Error('No callback provided to pbkdf2')\n  if (!Buffer.isBuffer(password)) password = Buffer.from(password, defaultEncoding)\n  if (!Buffer.isBuffer(salt)) salt = Buffer.from(salt, defaultEncoding)\n\n  resolvePromise(checkNative(algo).then(function (resp) {\n    if (resp) return browserPbkdf2(password, salt, iterations, keylen, algo)\n\n    return sync(password, salt, iterations, keylen, digest)\n  }), callback)\n}\n","exports.pbkdf2 = require('./lib/async')\nexports.pbkdf2Sync = require('./lib/sync')\n","'use strict';\n\nexports.readUInt32BE = function readUInt32BE(bytes, off) {\n  var res =  (bytes[0 + off] << 24) |\n             (bytes[1 + off] << 16) |\n             (bytes[2 + off] << 8) |\n             bytes[3 + off];\n  return res >>> 0;\n};\n\nexports.writeUInt32BE = function writeUInt32BE(bytes, value, off) {\n  bytes[0 + off] = value >>> 24;\n  bytes[1 + off] = (value >>> 16) & 0xff;\n  bytes[2 + off] = (value >>> 8) & 0xff;\n  bytes[3 + off] = value & 0xff;\n};\n\nexports.ip = function ip(inL, inR, out, off) {\n  var outL = 0;\n  var outR = 0;\n\n  for (var i = 6; i >= 0; i -= 2) {\n    for (var j = 0; j <= 24; j += 8) {\n      outL <<= 1;\n      outL |= (inR >>> (j + i)) & 1;\n    }\n    for (var j = 0; j <= 24; j += 8) {\n      outL <<= 1;\n      outL |= (inL >>> (j + i)) & 1;\n    }\n  }\n\n  for (var i = 6; i >= 0; i -= 2) {\n    for (var j = 1; j <= 25; j += 8) {\n      outR <<= 1;\n      outR |= (inR >>> (j + i)) & 1;\n    }\n    for (var j = 1; j <= 25; j += 8) {\n      outR <<= 1;\n      outR |= (inL >>> (j + i)) & 1;\n    }\n  }\n\n  out[off + 0] = outL >>> 0;\n  out[off + 1] = outR >>> 0;\n};\n\nexports.rip = function rip(inL, inR, out, off) {\n  var outL = 0;\n  var outR = 0;\n\n  for (var i = 0; i < 4; i++) {\n    for (var j = 24; j >= 0; j -= 8) {\n      outL <<= 1;\n      outL |= (inR >>> (j + i)) & 1;\n      outL <<= 1;\n      outL |= (inL >>> (j + i)) & 1;\n    }\n  }\n  for (var i = 4; i < 8; i++) {\n    for (var j = 24; j >= 0; j -= 8) {\n      outR <<= 1;\n      outR |= (inR >>> (j + i)) & 1;\n      outR <<= 1;\n      outR |= (inL >>> (j + i)) & 1;\n    }\n  }\n\n  out[off + 0] = outL >>> 0;\n  out[off + 1] = outR >>> 0;\n};\n\nexports.pc1 = function pc1(inL, inR, out, off) {\n  var outL = 0;\n  var outR = 0;\n\n  // 7, 15, 23, 31, 39, 47, 55, 63\n  // 6, 14, 22, 30, 39, 47, 55, 63\n  // 5, 13, 21, 29, 39, 47, 55, 63\n  // 4, 12, 20, 28\n  for (var i = 7; i >= 5; i--) {\n    for (var j = 0; j <= 24; j += 8) {\n      outL <<= 1;\n      outL |= (inR >> (j + i)) & 1;\n    }\n    for (var j = 0; j <= 24; j += 8) {\n      outL <<= 1;\n      outL |= (inL >> (j + i)) & 1;\n    }\n  }\n  for (var j = 0; j <= 24; j += 8) {\n    outL <<= 1;\n    outL |= (inR >> (j + i)) & 1;\n  }\n\n  // 1, 9, 17, 25, 33, 41, 49, 57\n  // 2, 10, 18, 26, 34, 42, 50, 58\n  // 3, 11, 19, 27, 35, 43, 51, 59\n  // 36, 44, 52, 60\n  for (var i = 1; i <= 3; i++) {\n    for (var j = 0; j <= 24; j += 8) {\n      outR <<= 1;\n      outR |= (inR >> (j + i)) & 1;\n    }\n    for (var j = 0; j <= 24; j += 8) {\n      outR <<= 1;\n      outR |= (inL >> (j + i)) & 1;\n    }\n  }\n  for (var j = 0; j <= 24; j += 8) {\n    outR <<= 1;\n    outR |= (inL >> (j + i)) & 1;\n  }\n\n  out[off + 0] = outL >>> 0;\n  out[off + 1] = outR >>> 0;\n};\n\nexports.r28shl = function r28shl(num, shift) {\n  return ((num << shift) & 0xfffffff) | (num >>> (28 - shift));\n};\n\nvar pc2table = [\n  // inL => outL\n  14, 11, 17, 4, 27, 23, 25, 0,\n  13, 22, 7, 18, 5, 9, 16, 24,\n  2, 20, 12, 21, 1, 8, 15, 26,\n\n  // inR => outR\n  15, 4, 25, 19, 9, 1, 26, 16,\n  5, 11, 23, 8, 12, 7, 17, 0,\n  22, 3, 10, 14, 6, 20, 27, 24\n];\n\nexports.pc2 = function pc2(inL, inR, out, off) {\n  var outL = 0;\n  var outR = 0;\n\n  var len = pc2table.length >>> 1;\n  for (var i = 0; i < len; i++) {\n    outL <<= 1;\n    outL |= (inL >>> pc2table[i]) & 0x1;\n  }\n  for (var i = len; i < pc2table.length; i++) {\n    outR <<= 1;\n    outR |= (inR >>> pc2table[i]) & 0x1;\n  }\n\n  out[off + 0] = outL >>> 0;\n  out[off + 1] = outR >>> 0;\n};\n\nexports.expand = function expand(r, out, off) {\n  var outL = 0;\n  var outR = 0;\n\n  outL = ((r & 1) << 5) | (r >>> 27);\n  for (var i = 23; i >= 15; i -= 4) {\n    outL <<= 6;\n    outL |= (r >>> i) & 0x3f;\n  }\n  for (var i = 11; i >= 3; i -= 4) {\n    outR |= (r >>> i) & 0x3f;\n    outR <<= 6;\n  }\n  outR |= ((r & 0x1f) << 1) | (r >>> 31);\n\n  out[off + 0] = outL >>> 0;\n  out[off + 1] = outR >>> 0;\n};\n\nvar sTable = [\n  14, 0, 4, 15, 13, 7, 1, 4, 2, 14, 15, 2, 11, 13, 8, 1,\n  3, 10, 10, 6, 6, 12, 12, 11, 5, 9, 9, 5, 0, 3, 7, 8,\n  4, 15, 1, 12, 14, 8, 8, 2, 13, 4, 6, 9, 2, 1, 11, 7,\n  15, 5, 12, 11, 9, 3, 7, 14, 3, 10, 10, 0, 5, 6, 0, 13,\n\n  15, 3, 1, 13, 8, 4, 14, 7, 6, 15, 11, 2, 3, 8, 4, 14,\n  9, 12, 7, 0, 2, 1, 13, 10, 12, 6, 0, 9, 5, 11, 10, 5,\n  0, 13, 14, 8, 7, 10, 11, 1, 10, 3, 4, 15, 13, 4, 1, 2,\n  5, 11, 8, 6, 12, 7, 6, 12, 9, 0, 3, 5, 2, 14, 15, 9,\n\n  10, 13, 0, 7, 9, 0, 14, 9, 6, 3, 3, 4, 15, 6, 5, 10,\n  1, 2, 13, 8, 12, 5, 7, 14, 11, 12, 4, 11, 2, 15, 8, 1,\n  13, 1, 6, 10, 4, 13, 9, 0, 8, 6, 15, 9, 3, 8, 0, 7,\n  11, 4, 1, 15, 2, 14, 12, 3, 5, 11, 10, 5, 14, 2, 7, 12,\n\n  7, 13, 13, 8, 14, 11, 3, 5, 0, 6, 6, 15, 9, 0, 10, 3,\n  1, 4, 2, 7, 8, 2, 5, 12, 11, 1, 12, 10, 4, 14, 15, 9,\n  10, 3, 6, 15, 9, 0, 0, 6, 12, 10, 11, 1, 7, 13, 13, 8,\n  15, 9, 1, 4, 3, 5, 14, 11, 5, 12, 2, 7, 8, 2, 4, 14,\n\n  2, 14, 12, 11, 4, 2, 1, 12, 7, 4, 10, 7, 11, 13, 6, 1,\n  8, 5, 5, 0, 3, 15, 15, 10, 13, 3, 0, 9, 14, 8, 9, 6,\n  4, 11, 2, 8, 1, 12, 11, 7, 10, 1, 13, 14, 7, 2, 8, 13,\n  15, 6, 9, 15, 12, 0, 5, 9, 6, 10, 3, 4, 0, 5, 14, 3,\n\n  12, 10, 1, 15, 10, 4, 15, 2, 9, 7, 2, 12, 6, 9, 8, 5,\n  0, 6, 13, 1, 3, 13, 4, 14, 14, 0, 7, 11, 5, 3, 11, 8,\n  9, 4, 14, 3, 15, 2, 5, 12, 2, 9, 8, 5, 12, 15, 3, 10,\n  7, 11, 0, 14, 4, 1, 10, 7, 1, 6, 13, 0, 11, 8, 6, 13,\n\n  4, 13, 11, 0, 2, 11, 14, 7, 15, 4, 0, 9, 8, 1, 13, 10,\n  3, 14, 12, 3, 9, 5, 7, 12, 5, 2, 10, 15, 6, 8, 1, 6,\n  1, 6, 4, 11, 11, 13, 13, 8, 12, 1, 3, 4, 7, 10, 14, 7,\n  10, 9, 15, 5, 6, 0, 8, 15, 0, 14, 5, 2, 9, 3, 2, 12,\n\n  13, 1, 2, 15, 8, 13, 4, 8, 6, 10, 15, 3, 11, 7, 1, 4,\n  10, 12, 9, 5, 3, 6, 14, 11, 5, 0, 0, 14, 12, 9, 7, 2,\n  7, 2, 11, 1, 4, 14, 1, 7, 9, 4, 12, 10, 14, 8, 2, 13,\n  0, 15, 6, 12, 10, 9, 13, 0, 15, 3, 3, 5, 5, 6, 8, 11\n];\n\nexports.substitute = function substitute(inL, inR) {\n  var out = 0;\n  for (var i = 0; i < 4; i++) {\n    var b = (inL >>> (18 - i * 6)) & 0x3f;\n    var sb = sTable[i * 0x40 + b];\n\n    out <<= 4;\n    out |= sb;\n  }\n  for (var i = 0; i < 4; i++) {\n    var b = (inR >>> (18 - i * 6)) & 0x3f;\n    var sb = sTable[4 * 0x40 + i * 0x40 + b];\n\n    out <<= 4;\n    out |= sb;\n  }\n  return out >>> 0;\n};\n\nvar permuteTable = [\n  16, 25, 12, 11, 3, 20, 4, 15, 31, 17, 9, 6, 27, 14, 1, 22,\n  30, 24, 8, 18, 0, 5, 29, 23, 13, 19, 2, 26, 10, 21, 28, 7\n];\n\nexports.permute = function permute(num) {\n  var out = 0;\n  for (var i = 0; i < permuteTable.length; i++) {\n    out <<= 1;\n    out |= (num >>> permuteTable[i]) & 0x1;\n  }\n  return out >>> 0;\n};\n\nexports.padSplit = function padSplit(num, size, group) {\n  var str = num.toString(2);\n  while (str.length < size)\n    str = '0' + str;\n\n  var out = [];\n  for (var i = 0; i < size; i += group)\n    out.push(str.slice(i, i + group));\n  return out.join(' ');\n};\n","module.exports = assert;\n\nfunction assert(val, msg) {\n  if (!val)\n    throw new Error(msg || 'Assertion failed');\n}\n\nassert.equal = function assertEqual(l, r, msg) {\n  if (l != r)\n    throw new Error(msg || ('Assertion failed: ' + l + ' != ' + r));\n};\n","'use strict';\n\nvar assert = require('minimalistic-assert');\n\nfunction Cipher(options) {\n  this.options = options;\n\n  this.type = this.options.type;\n  this.blockSize = 8;\n  this._init();\n\n  this.buffer = new Array(this.blockSize);\n  this.bufferOff = 0;\n}\nmodule.exports = Cipher;\n\nCipher.prototype._init = function _init() {\n  // Might be overrided\n};\n\nCipher.prototype.update = function update(data) {\n  if (data.length === 0)\n    return [];\n\n  if (this.type === 'decrypt')\n    return this._updateDecrypt(data);\n  else\n    return this._updateEncrypt(data);\n};\n\nCipher.prototype._buffer = function _buffer(data, off) {\n  // Append data to buffer\n  var min = Math.min(this.buffer.length - this.bufferOff, data.length - off);\n  for (var i = 0; i < min; i++)\n    this.buffer[this.bufferOff + i] = data[off + i];\n  this.bufferOff += min;\n\n  // Shift next\n  return min;\n};\n\nCipher.prototype._flushBuffer = function _flushBuffer(out, off) {\n  this._update(this.buffer, 0, out, off);\n  this.bufferOff = 0;\n  return this.blockSize;\n};\n\nCipher.prototype._updateEncrypt = function _updateEncrypt(data) {\n  var inputOff = 0;\n  var outputOff = 0;\n\n  var count = ((this.bufferOff + data.length) / this.blockSize) | 0;\n  var out = new Array(count * this.blockSize);\n\n  if (this.bufferOff !== 0) {\n    inputOff += this._buffer(data, inputOff);\n\n    if (this.bufferOff === this.buffer.length)\n      outputOff += this._flushBuffer(out, outputOff);\n  }\n\n  // Write blocks\n  var max = data.length - ((data.length - inputOff) % this.blockSize);\n  for (; inputOff < max; inputOff += this.blockSize) {\n    this._update(data, inputOff, out, outputOff);\n    outputOff += this.blockSize;\n  }\n\n  // Queue rest\n  for (; inputOff < data.length; inputOff++, this.bufferOff++)\n    this.buffer[this.bufferOff] = data[inputOff];\n\n  return out;\n};\n\nCipher.prototype._updateDecrypt = function _updateDecrypt(data) {\n  var inputOff = 0;\n  var outputOff = 0;\n\n  var count = Math.ceil((this.bufferOff + data.length) / this.blockSize) - 1;\n  var out = new Array(count * this.blockSize);\n\n  // TODO(indutny): optimize it, this is far from optimal\n  for (; count > 0; count--) {\n    inputOff += this._buffer(data, inputOff);\n    outputOff += this._flushBuffer(out, outputOff);\n  }\n\n  // Buffer rest of the input\n  inputOff += this._buffer(data, inputOff);\n\n  return out;\n};\n\nCipher.prototype.final = function final(buffer) {\n  var first;\n  if (buffer)\n    first = this.update(buffer);\n\n  var last;\n  if (this.type === 'encrypt')\n    last = this._finalEncrypt();\n  else\n    last = this._finalDecrypt();\n\n  if (first)\n    return first.concat(last);\n  else\n    return last;\n};\n\nCipher.prototype._pad = function _pad(buffer, off) {\n  if (off === 0)\n    return false;\n\n  while (off < buffer.length)\n    buffer[off++] = 0;\n\n  return true;\n};\n\nCipher.prototype._finalEncrypt = function _finalEncrypt() {\n  if (!this._pad(this.buffer, this.bufferOff))\n    return [];\n\n  var out = new Array(this.blockSize);\n  this._update(this.buffer, 0, out, 0);\n  return out;\n};\n\nCipher.prototype._unpad = function _unpad(buffer) {\n  return buffer;\n};\n\nCipher.prototype._finalDecrypt = function _finalDecrypt() {\n  assert.equal(this.bufferOff, this.blockSize, 'Not enough data to decrypt');\n  var out = new Array(this.blockSize);\n  this._flushBuffer(out, 0);\n\n  return this._unpad(out);\n};\n","'use strict';\n\nvar assert = require('minimalistic-assert');\nvar inherits = require('inherits');\n\nvar des = require('../des');\nvar utils = des.utils;\nvar Cipher = des.Cipher;\n\nfunction DESState() {\n  this.tmp = new Array(2);\n  this.keys = null;\n}\n\nfunction DES(options) {\n  Cipher.call(this, options);\n\n  var state = new DESState();\n  this._desState = state;\n\n  this.deriveKeys(state, options.key);\n}\ninherits(DES, Cipher);\nmodule.exports = DES;\n\nDES.create = function create(options) {\n  return new DES(options);\n};\n\nvar shiftTable = [\n  1, 1, 2, 2, 2, 2, 2, 2,\n  1, 2, 2, 2, 2, 2, 2, 1\n];\n\nDES.prototype.deriveKeys = function deriveKeys(state, key) {\n  state.keys = new Array(16 * 2);\n\n  assert.equal(key.length, this.blockSize, 'Invalid key length');\n\n  var kL = utils.readUInt32BE(key, 0);\n  var kR = utils.readUInt32BE(key, 4);\n\n  utils.pc1(kL, kR, state.tmp, 0);\n  kL = state.tmp[0];\n  kR = state.tmp[1];\n  for (var i = 0; i < state.keys.length; i += 2) {\n    var shift = shiftTable[i >>> 1];\n    kL = utils.r28shl(kL, shift);\n    kR = utils.r28shl(kR, shift);\n    utils.pc2(kL, kR, state.keys, i);\n  }\n};\n\nDES.prototype._update = function _update(inp, inOff, out, outOff) {\n  var state = this._desState;\n\n  var l = utils.readUInt32BE(inp, inOff);\n  var r = utils.readUInt32BE(inp, inOff + 4);\n\n  // Initial Permutation\n  utils.ip(l, r, state.tmp, 0);\n  l = state.tmp[0];\n  r = state.tmp[1];\n\n  if (this.type === 'encrypt')\n    this._encrypt(state, l, r, state.tmp, 0);\n  else\n    this._decrypt(state, l, r, state.tmp, 0);\n\n  l = state.tmp[0];\n  r = state.tmp[1];\n\n  utils.writeUInt32BE(out, l, outOff);\n  utils.writeUInt32BE(out, r, outOff + 4);\n};\n\nDES.prototype._pad = function _pad(buffer, off) {\n  var value = buffer.length - off;\n  for (var i = off; i < buffer.length; i++)\n    buffer[i] = value;\n\n  return true;\n};\n\nDES.prototype._unpad = function _unpad(buffer) {\n  var pad = buffer[buffer.length - 1];\n  for (var i = buffer.length - pad; i < buffer.length; i++)\n    assert.equal(buffer[i], pad);\n\n  return buffer.slice(0, buffer.length - pad);\n};\n\nDES.prototype._encrypt = function _encrypt(state, lStart, rStart, out, off) {\n  var l = lStart;\n  var r = rStart;\n\n  // Apply f() x16 times\n  for (var i = 0; i < state.keys.length; i += 2) {\n    var keyL = state.keys[i];\n    var keyR = state.keys[i + 1];\n\n    // f(r, k)\n    utils.expand(r, state.tmp, 0);\n\n    keyL ^= state.tmp[0];\n    keyR ^= state.tmp[1];\n    var s = utils.substitute(keyL, keyR);\n    var f = utils.permute(s);\n\n    var t = r;\n    r = (l ^ f) >>> 0;\n    l = t;\n  }\n\n  // Reverse Initial Permutation\n  utils.rip(r, l, out, off);\n};\n\nDES.prototype._decrypt = function _decrypt(state, lStart, rStart, out, off) {\n  var l = rStart;\n  var r = lStart;\n\n  // Apply f() x16 times\n  for (var i = state.keys.length - 2; i >= 0; i -= 2) {\n    var keyL = state.keys[i];\n    var keyR = state.keys[i + 1];\n\n    // f(r, k)\n    utils.expand(l, state.tmp, 0);\n\n    keyL ^= state.tmp[0];\n    keyR ^= state.tmp[1];\n    var s = utils.substitute(keyL, keyR);\n    var f = utils.permute(s);\n\n    var t = l;\n    l = (r ^ f) >>> 0;\n    r = t;\n  }\n\n  // Reverse Initial Permutation\n  utils.rip(l, r, out, off);\n};\n","'use strict';\n\nvar assert = require('minimalistic-assert');\nvar inherits = require('inherits');\n\nvar proto = {};\n\nfunction CBCState(iv) {\n  assert.equal(iv.length, 8, 'Invalid IV length');\n\n  this.iv = new Array(8);\n  for (var i = 0; i < this.iv.length; i++)\n    this.iv[i] = iv[i];\n}\n\nfunction instantiate(Base) {\n  function CBC(options) {\n    Base.call(this, options);\n    this._cbcInit();\n  }\n  inherits(CBC, Base);\n\n  var keys = Object.keys(proto);\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    CBC.prototype[key] = proto[key];\n  }\n\n  CBC.create = function create(options) {\n    return new CBC(options);\n  };\n\n  return CBC;\n}\n\nexports.instantiate = instantiate;\n\nproto._cbcInit = function _cbcInit() {\n  var state = new CBCState(this.options.iv);\n  this._cbcState = state;\n};\n\nproto._update = function _update(inp, inOff, out, outOff) {\n  var state = this._cbcState;\n  var superProto = this.constructor.super_.prototype;\n\n  var iv = state.iv;\n  if (this.type === 'encrypt') {\n    for (var i = 0; i < this.blockSize; i++)\n      iv[i] ^= inp[inOff + i];\n\n    superProto._update.call(this, iv, 0, out, outOff);\n\n    for (var i = 0; i < this.blockSize; i++)\n      iv[i] = out[outOff + i];\n  } else {\n    superProto._update.call(this, inp, inOff, out, outOff);\n\n    for (var i = 0; i < this.blockSize; i++)\n      out[outOff + i] ^= iv[i];\n\n    for (var i = 0; i < this.blockSize; i++)\n      iv[i] = inp[inOff + i];\n  }\n};\n","'use strict';\n\nvar assert = require('minimalistic-assert');\nvar inherits = require('inherits');\n\nvar des = require('../des');\nvar Cipher = des.Cipher;\nvar DES = des.DES;\n\nfunction EDEState(type, key) {\n  assert.equal(key.length, 24, 'Invalid key length');\n\n  var k1 = key.slice(0, 8);\n  var k2 = key.slice(8, 16);\n  var k3 = key.slice(16, 24);\n\n  if (type === 'encrypt') {\n    this.ciphers = [\n      DES.create({ type: 'encrypt', key: k1 }),\n      DES.create({ type: 'decrypt', key: k2 }),\n      DES.create({ type: 'encrypt', key: k3 })\n    ];\n  } else {\n    this.ciphers = [\n      DES.create({ type: 'decrypt', key: k3 }),\n      DES.create({ type: 'encrypt', key: k2 }),\n      DES.create({ type: 'decrypt', key: k1 })\n    ];\n  }\n}\n\nfunction EDE(options) {\n  Cipher.call(this, options);\n\n  var state = new EDEState(this.type, this.options.key);\n  this._edeState = state;\n}\ninherits(EDE, Cipher);\n\nmodule.exports = EDE;\n\nEDE.create = function create(options) {\n  return new EDE(options);\n};\n\nEDE.prototype._update = function _update(inp, inOff, out, outOff) {\n  var state = this._edeState;\n\n  state.ciphers[0]._update(inp, inOff, out, outOff);\n  state.ciphers[1]._update(out, outOff, out, outOff);\n  state.ciphers[2]._update(out, outOff, out, outOff);\n};\n\nEDE.prototype._pad = DES.prototype._pad;\nEDE.prototype._unpad = DES.prototype._unpad;\n","'use strict';\n\nexports.utils = require('./des/utils');\nexports.Cipher = require('./des/cipher');\nexports.DES = require('./des/des');\nexports.CBC = require('./des/cbc');\nexports.EDE = require('./des/ede');\n","var CipherBase = require('cipher-base')\nvar des = require('des.js')\nvar inherits = require('inherits')\nvar Buffer = require('safe-buffer').Buffer\n\nvar modes = {\n  'des-ede3-cbc': des.CBC.instantiate(des.EDE),\n  'des-ede3': des.EDE,\n  'des-ede-cbc': des.CBC.instantiate(des.EDE),\n  'des-ede': des.EDE,\n  'des-cbc': des.CBC.instantiate(des.DES),\n  'des-ecb': des.DES\n}\nmodes.des = modes['des-cbc']\nmodes.des3 = modes['des-ede3-cbc']\nmodule.exports = DES\ninherits(DES, CipherBase)\nfunction DES (opts) {\n  CipherBase.call(this)\n  var modeName = opts.mode.toLowerCase()\n  var mode = modes[modeName]\n  var type\n  if (opts.decrypt) {\n    type = 'decrypt'\n  } else {\n    type = 'encrypt'\n  }\n  var key = opts.key\n  if (!Buffer.isBuffer(key)) {\n    key = Buffer.from(key)\n  }\n  if (modeName === 'des-ede' || modeName === 'des-ede-cbc') {\n    key = Buffer.concat([key, key.slice(0, 8)])\n  }\n  var iv = opts.iv\n  if (!Buffer.isBuffer(iv)) {\n    iv = Buffer.from(iv)\n  }\n  this._des = mode.create({\n    key: key,\n    iv: iv,\n    type: type\n  })\n}\nDES.prototype._update = function (data) {\n  return Buffer.from(this._des.update(data))\n}\nDES.prototype._final = function () {\n  return Buffer.from(this._des.final())\n}\n","exports.encrypt = function (self, block) {\n  return self._cipher.encryptBlock(block)\n}\n\nexports.decrypt = function (self, block) {\n  return self._cipher.decryptBlock(block)\n}\n","module.exports = function xor (a, b) {\n  var length = Math.min(a.length, b.length)\n  var buffer = new Buffer(length)\n\n  for (var i = 0; i < length; ++i) {\n    buffer[i] = a[i] ^ b[i]\n  }\n\n  return buffer\n}\n","var xor = require('buffer-xor')\n\nexports.encrypt = function (self, block) {\n  var data = xor(block, self._prev)\n\n  self._prev = self._cipher.encryptBlock(data)\n  return self._prev\n}\n\nexports.decrypt = function (self, block) {\n  var pad = self._prev\n\n  self._prev = block\n  var out = self._cipher.decryptBlock(block)\n\n  return xor(out, pad)\n}\n","var Buffer = require('safe-buffer').Buffer\nvar xor = require('buffer-xor')\n\nfunction encryptStart (self, data, decrypt) {\n  var len = data.length\n  var out = xor(data, self._cache)\n  self._cache = self._cache.slice(len)\n  self._prev = Buffer.concat([self._prev, decrypt ? data : out])\n  return out\n}\n\nexports.encrypt = function (self, data, decrypt) {\n  var out = Buffer.allocUnsafe(0)\n  var len\n\n  while (data.length) {\n    if (self._cache.length === 0) {\n      self._cache = self._cipher.encryptBlock(self._prev)\n      self._prev = Buffer.allocUnsafe(0)\n    }\n\n    if (self._cache.length <= data.length) {\n      len = self._cache.length\n      out = Buffer.concat([out, encryptStart(self, data.slice(0, len), decrypt)])\n      data = data.slice(len)\n    } else {\n      out = Buffer.concat([out, encryptStart(self, data, decrypt)])\n      break\n    }\n  }\n\n  return out\n}\n","var Buffer = require('safe-buffer').Buffer\n\nfunction encryptByte (self, byteParam, decrypt) {\n  var pad = self._cipher.encryptBlock(self._prev)\n  var out = pad[0] ^ byteParam\n\n  self._prev = Buffer.concat([\n    self._prev.slice(1),\n    Buffer.from([decrypt ? byteParam : out])\n  ])\n\n  return out\n}\n\nexports.encrypt = function (self, chunk, decrypt) {\n  var len = chunk.length\n  var out = Buffer.allocUnsafe(len)\n  var i = -1\n\n  while (++i < len) {\n    out[i] = encryptByte(self, chunk[i], decrypt)\n  }\n\n  return out\n}\n","var Buffer = require('safe-buffer').Buffer\n\nfunction encryptByte (self, byteParam, decrypt) {\n  var pad\n  var i = -1\n  var len = 8\n  var out = 0\n  var bit, value\n  while (++i < len) {\n    pad = self._cipher.encryptBlock(self._prev)\n    bit = (byteParam & (1 << (7 - i))) ? 0x80 : 0\n    value = pad[0] ^ bit\n    out += ((value & 0x80) >> (i % 8))\n    self._prev = shiftIn(self._prev, decrypt ? bit : value)\n  }\n  return out\n}\n\nfunction shiftIn (buffer, value) {\n  var len = buffer.length\n  var i = -1\n  var out = Buffer.allocUnsafe(buffer.length)\n  buffer = Buffer.concat([buffer, Buffer.from([value])])\n\n  while (++i < len) {\n    out[i] = buffer[i] << 1 | buffer[i + 1] >> (7)\n  }\n\n  return out\n}\n\nexports.encrypt = function (self, chunk, decrypt) {\n  var len = chunk.length\n  var out = Buffer.allocUnsafe(len)\n  var i = -1\n\n  while (++i < len) {\n    out[i] = encryptByte(self, chunk[i], decrypt)\n  }\n\n  return out\n}\n","var xor = require('buffer-xor')\n\nfunction getBlock (self) {\n  self._prev = self._cipher.encryptBlock(self._prev)\n  return self._prev\n}\n\nexports.encrypt = function (self, chunk) {\n  while (self._cache.length < chunk.length) {\n    self._cache = Buffer.concat([self._cache, getBlock(self)])\n  }\n\n  var pad = self._cache.slice(0, chunk.length)\n  self._cache = self._cache.slice(chunk.length)\n  return xor(chunk, pad)\n}\n","function incr32 (iv) {\n  var len = iv.length\n  var item\n  while (len--) {\n    item = iv.readUInt8(len)\n    if (item === 255) {\n      iv.writeUInt8(0, len)\n    } else {\n      item++\n      iv.writeUInt8(item, len)\n      break\n    }\n  }\n}\nmodule.exports = incr32\n","var xor = require('buffer-xor')\nvar Buffer = require('safe-buffer').Buffer\nvar incr32 = require('../incr32')\n\nfunction getBlock (self) {\n  var out = self._cipher.encryptBlockRaw(self._prev)\n  incr32(self._prev)\n  return out\n}\n\nvar blockSize = 16\nexports.encrypt = function (self, chunk) {\n  var chunkNum = Math.ceil(chunk.length / blockSize)\n  var start = self._cache.length\n  self._cache = Buffer.concat([\n    self._cache,\n    Buffer.allocUnsafe(chunkNum * blockSize)\n  ])\n  for (var i = 0; i < chunkNum; i++) {\n    var out = getBlock(self)\n    var offset = start + i * blockSize\n    self._cache.writeUInt32BE(out[0], offset + 0)\n    self._cache.writeUInt32BE(out[1], offset + 4)\n    self._cache.writeUInt32BE(out[2], offset + 8)\n    self._cache.writeUInt32BE(out[3], offset + 12)\n  }\n  var pad = self._cache.slice(0, chunk.length)\n  self._cache = self._cache.slice(chunk.length)\n  return xor(chunk, pad)\n}\n","var modeModules = {\n  ECB: require('./ecb'),\n  CBC: require('./cbc'),\n  CFB: require('./cfb'),\n  CFB8: require('./cfb8'),\n  CFB1: require('./cfb1'),\n  OFB: require('./ofb'),\n  CTR: require('./ctr'),\n  GCM: require('./ctr')\n}\n\nvar modes = require('./list.json')\n\nfor (var key in modes) {\n  modes[key].module = modeModules[modes[key].mode]\n}\n\nmodule.exports = modes\n","// based on the aes implimentation in triple sec\n// https://github.com/keybase/triplesec\n// which is in turn based on the one from crypto-js\n// https://code.google.com/p/crypto-js/\n\nvar Buffer = require('safe-buffer').Buffer\n\nfunction asUInt32Array (buf) {\n  if (!Buffer.isBuffer(buf)) buf = Buffer.from(buf)\n\n  var len = (buf.length / 4) | 0\n  var out = new Array(len)\n\n  for (var i = 0; i < len; i++) {\n    out[i] = buf.readUInt32BE(i * 4)\n  }\n\n  return out\n}\n\nfunction scrubVec (v) {\n  for (var i = 0; i < v.length; v++) {\n    v[i] = 0\n  }\n}\n\nfunction cryptBlock (M, keySchedule, SUB_MIX, SBOX, nRounds) {\n  var SUB_MIX0 = SUB_MIX[0]\n  var SUB_MIX1 = SUB_MIX[1]\n  var SUB_MIX2 = SUB_MIX[2]\n  var SUB_MIX3 = SUB_MIX[3]\n\n  var s0 = M[0] ^ keySchedule[0]\n  var s1 = M[1] ^ keySchedule[1]\n  var s2 = M[2] ^ keySchedule[2]\n  var s3 = M[3] ^ keySchedule[3]\n  var t0, t1, t2, t3\n  var ksRow = 4\n\n  for (var round = 1; round < nRounds; round++) {\n    t0 = SUB_MIX0[s0 >>> 24] ^ SUB_MIX1[(s1 >>> 16) & 0xff] ^ SUB_MIX2[(s2 >>> 8) & 0xff] ^ SUB_MIX3[s3 & 0xff] ^ keySchedule[ksRow++]\n    t1 = SUB_MIX0[s1 >>> 24] ^ SUB_MIX1[(s2 >>> 16) & 0xff] ^ SUB_MIX2[(s3 >>> 8) & 0xff] ^ SUB_MIX3[s0 & 0xff] ^ keySchedule[ksRow++]\n    t2 = SUB_MIX0[s2 >>> 24] ^ SUB_MIX1[(s3 >>> 16) & 0xff] ^ SUB_MIX2[(s0 >>> 8) & 0xff] ^ SUB_MIX3[s1 & 0xff] ^ keySchedule[ksRow++]\n    t3 = SUB_MIX0[s3 >>> 24] ^ SUB_MIX1[(s0 >>> 16) & 0xff] ^ SUB_MIX2[(s1 >>> 8) & 0xff] ^ SUB_MIX3[s2 & 0xff] ^ keySchedule[ksRow++]\n    s0 = t0\n    s1 = t1\n    s2 = t2\n    s3 = t3\n  }\n\n  t0 = ((SBOX[s0 >>> 24] << 24) | (SBOX[(s1 >>> 16) & 0xff] << 16) | (SBOX[(s2 >>> 8) & 0xff] << 8) | SBOX[s3 & 0xff]) ^ keySchedule[ksRow++]\n  t1 = ((SBOX[s1 >>> 24] << 24) | (SBOX[(s2 >>> 16) & 0xff] << 16) | (SBOX[(s3 >>> 8) & 0xff] << 8) | SBOX[s0 & 0xff]) ^ keySchedule[ksRow++]\n  t2 = ((SBOX[s2 >>> 24] << 24) | (SBOX[(s3 >>> 16) & 0xff] << 16) | (SBOX[(s0 >>> 8) & 0xff] << 8) | SBOX[s1 & 0xff]) ^ keySchedule[ksRow++]\n  t3 = ((SBOX[s3 >>> 24] << 24) | (SBOX[(s0 >>> 16) & 0xff] << 16) | (SBOX[(s1 >>> 8) & 0xff] << 8) | SBOX[s2 & 0xff]) ^ keySchedule[ksRow++]\n  t0 = t0 >>> 0\n  t1 = t1 >>> 0\n  t2 = t2 >>> 0\n  t3 = t3 >>> 0\n\n  return [t0, t1, t2, t3]\n}\n\n// AES constants\nvar RCON = [0x00, 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1b, 0x36]\nvar G = (function () {\n  // Compute double table\n  var d = new Array(256)\n  for (var j = 0; j < 256; j++) {\n    if (j < 128) {\n      d[j] = j << 1\n    } else {\n      d[j] = (j << 1) ^ 0x11b\n    }\n  }\n\n  var SBOX = []\n  var INV_SBOX = []\n  var SUB_MIX = [[], [], [], []]\n  var INV_SUB_MIX = [[], [], [], []]\n\n  // Walk GF(2^8)\n  var x = 0\n  var xi = 0\n  for (var i = 0; i < 256; ++i) {\n    // Compute sbox\n    var sx = xi ^ (xi << 1) ^ (xi << 2) ^ (xi << 3) ^ (xi << 4)\n    sx = (sx >>> 8) ^ (sx & 0xff) ^ 0x63\n    SBOX[x] = sx\n    INV_SBOX[sx] = x\n\n    // Compute multiplication\n    var x2 = d[x]\n    var x4 = d[x2]\n    var x8 = d[x4]\n\n    // Compute sub bytes, mix columns tables\n    var t = (d[sx] * 0x101) ^ (sx * 0x1010100)\n    SUB_MIX[0][x] = (t << 24) | (t >>> 8)\n    SUB_MIX[1][x] = (t << 16) | (t >>> 16)\n    SUB_MIX[2][x] = (t << 8) | (t >>> 24)\n    SUB_MIX[3][x] = t\n\n    // Compute inv sub bytes, inv mix columns tables\n    t = (x8 * 0x1010101) ^ (x4 * 0x10001) ^ (x2 * 0x101) ^ (x * 0x1010100)\n    INV_SUB_MIX[0][sx] = (t << 24) | (t >>> 8)\n    INV_SUB_MIX[1][sx] = (t << 16) | (t >>> 16)\n    INV_SUB_MIX[2][sx] = (t << 8) | (t >>> 24)\n    INV_SUB_MIX[3][sx] = t\n\n    if (x === 0) {\n      x = xi = 1\n    } else {\n      x = x2 ^ d[d[d[x8 ^ x2]]]\n      xi ^= d[d[xi]]\n    }\n  }\n\n  return {\n    SBOX: SBOX,\n    INV_SBOX: INV_SBOX,\n    SUB_MIX: SUB_MIX,\n    INV_SUB_MIX: INV_SUB_MIX\n  }\n})()\n\nfunction AES (key) {\n  this._key = asUInt32Array(key)\n  this._reset()\n}\n\nAES.blockSize = 4 * 4\nAES.keySize = 256 / 8\nAES.prototype.blockSize = AES.blockSize\nAES.prototype.keySize = AES.keySize\nAES.prototype._reset = function () {\n  var keyWords = this._key\n  var keySize = keyWords.length\n  var nRounds = keySize + 6\n  var ksRows = (nRounds + 1) * 4\n\n  var keySchedule = []\n  for (var k = 0; k < keySize; k++) {\n    keySchedule[k] = keyWords[k]\n  }\n\n  for (k = keySize; k < ksRows; k++) {\n    var t = keySchedule[k - 1]\n\n    if (k % keySize === 0) {\n      t = (t << 8) | (t >>> 24)\n      t =\n        (G.SBOX[t >>> 24] << 24) |\n        (G.SBOX[(t >>> 16) & 0xff] << 16) |\n        (G.SBOX[(t >>> 8) & 0xff] << 8) |\n        (G.SBOX[t & 0xff])\n\n      t ^= RCON[(k / keySize) | 0] << 24\n    } else if (keySize > 6 && k % keySize === 4) {\n      t =\n        (G.SBOX[t >>> 24] << 24) |\n        (G.SBOX[(t >>> 16) & 0xff] << 16) |\n        (G.SBOX[(t >>> 8) & 0xff] << 8) |\n        (G.SBOX[t & 0xff])\n    }\n\n    keySchedule[k] = keySchedule[k - keySize] ^ t\n  }\n\n  var invKeySchedule = []\n  for (var ik = 0; ik < ksRows; ik++) {\n    var ksR = ksRows - ik\n    var tt = keySchedule[ksR - (ik % 4 ? 0 : 4)]\n\n    if (ik < 4 || ksR <= 4) {\n      invKeySchedule[ik] = tt\n    } else {\n      invKeySchedule[ik] =\n        G.INV_SUB_MIX[0][G.SBOX[tt >>> 24]] ^\n        G.INV_SUB_MIX[1][G.SBOX[(tt >>> 16) & 0xff]] ^\n        G.INV_SUB_MIX[2][G.SBOX[(tt >>> 8) & 0xff]] ^\n        G.INV_SUB_MIX[3][G.SBOX[tt & 0xff]]\n    }\n  }\n\n  this._nRounds = nRounds\n  this._keySchedule = keySchedule\n  this._invKeySchedule = invKeySchedule\n}\n\nAES.prototype.encryptBlockRaw = function (M) {\n  M = asUInt32Array(M)\n  return cryptBlock(M, this._keySchedule, G.SUB_MIX, G.SBOX, this._nRounds)\n}\n\nAES.prototype.encryptBlock = function (M) {\n  var out = this.encryptBlockRaw(M)\n  var buf = Buffer.allocUnsafe(16)\n  buf.writeUInt32BE(out[0], 0)\n  buf.writeUInt32BE(out[1], 4)\n  buf.writeUInt32BE(out[2], 8)\n  buf.writeUInt32BE(out[3], 12)\n  return buf\n}\n\nAES.prototype.decryptBlock = function (M) {\n  M = asUInt32Array(M)\n\n  // swap\n  var m1 = M[1]\n  M[1] = M[3]\n  M[3] = m1\n\n  var out = cryptBlock(M, this._invKeySchedule, G.INV_SUB_MIX, G.INV_SBOX, this._nRounds)\n  var buf = Buffer.allocUnsafe(16)\n  buf.writeUInt32BE(out[0], 0)\n  buf.writeUInt32BE(out[3], 4)\n  buf.writeUInt32BE(out[2], 8)\n  buf.writeUInt32BE(out[1], 12)\n  return buf\n}\n\nAES.prototype.scrub = function () {\n  scrubVec(this._keySchedule)\n  scrubVec(this._invKeySchedule)\n  scrubVec(this._key)\n}\n\nmodule.exports.AES = AES\n","var Buffer = require('safe-buffer').Buffer\nvar ZEROES = Buffer.alloc(16, 0)\n\nfunction toArray (buf) {\n  return [\n    buf.readUInt32BE(0),\n    buf.readUInt32BE(4),\n    buf.readUInt32BE(8),\n    buf.readUInt32BE(12)\n  ]\n}\n\nfunction fromArray (out) {\n  var buf = Buffer.allocUnsafe(16)\n  buf.writeUInt32BE(out[0] >>> 0, 0)\n  buf.writeUInt32BE(out[1] >>> 0, 4)\n  buf.writeUInt32BE(out[2] >>> 0, 8)\n  buf.writeUInt32BE(out[3] >>> 0, 12)\n  return buf\n}\n\nfunction GHASH (key) {\n  this.h = key\n  this.state = Buffer.alloc(16, 0)\n  this.cache = Buffer.allocUnsafe(0)\n}\n\n// from http://bitwiseshiftleft.github.io/sjcl/doc/symbols/src/core_gcm.js.html\n// by Juho Vähä-Herttua\nGHASH.prototype.ghash = function (block) {\n  var i = -1\n  while (++i < block.length) {\n    this.state[i] ^= block[i]\n  }\n  this._multiply()\n}\n\nGHASH.prototype._multiply = function () {\n  var Vi = toArray(this.h)\n  var Zi = [0, 0, 0, 0]\n  var j, xi, lsbVi\n  var i = -1\n  while (++i < 128) {\n    xi = (this.state[~~(i / 8)] & (1 << (7 - (i % 8)))) !== 0\n    if (xi) {\n      // Z_i+1 = Z_i ^ V_i\n      Zi[0] ^= Vi[0]\n      Zi[1] ^= Vi[1]\n      Zi[2] ^= Vi[2]\n      Zi[3] ^= Vi[3]\n    }\n\n    // Store the value of LSB(V_i)\n    lsbVi = (Vi[3] & 1) !== 0\n\n    // V_i+1 = V_i >> 1\n    for (j = 3; j > 0; j--) {\n      Vi[j] = (Vi[j] >>> 1) | ((Vi[j - 1] & 1) << 31)\n    }\n    Vi[0] = Vi[0] >>> 1\n\n    // If LSB(V_i) is 1, V_i+1 = (V_i >> 1) ^ R\n    if (lsbVi) {\n      Vi[0] = Vi[0] ^ (0xe1 << 24)\n    }\n  }\n  this.state = fromArray(Zi)\n}\n\nGHASH.prototype.update = function (buf) {\n  this.cache = Buffer.concat([this.cache, buf])\n  var chunk\n  while (this.cache.length >= 16) {\n    chunk = this.cache.slice(0, 16)\n    this.cache = this.cache.slice(16)\n    this.ghash(chunk)\n  }\n}\n\nGHASH.prototype.final = function (abl, bl) {\n  if (this.cache.length) {\n    this.ghash(Buffer.concat([this.cache, ZEROES], 16))\n  }\n\n  this.ghash(fromArray([0, abl, 0, bl]))\n  return this.state\n}\n\nmodule.exports = GHASH\n","var aes = require('./aes')\nvar Buffer = require('safe-buffer').Buffer\nvar Transform = require('cipher-base')\nvar inherits = require('inherits')\nvar GHASH = require('./ghash')\nvar xor = require('buffer-xor')\nvar incr32 = require('./incr32')\n\nfunction xorTest (a, b) {\n  var out = 0\n  if (a.length !== b.length) out++\n\n  var len = Math.min(a.length, b.length)\n  for (var i = 0; i < len; ++i) {\n    out += (a[i] ^ b[i])\n  }\n\n  return out\n}\n\nfunction calcIv (self, iv, ck) {\n  if (iv.length === 12) {\n    self._finID = Buffer.concat([iv, Buffer.from([0, 0, 0, 1])])\n    return Buffer.concat([iv, Buffer.from([0, 0, 0, 2])])\n  }\n  var ghash = new GHASH(ck)\n  var len = iv.length\n  var toPad = len % 16\n  ghash.update(iv)\n  if (toPad) {\n    toPad = 16 - toPad\n    ghash.update(Buffer.alloc(toPad, 0))\n  }\n  ghash.update(Buffer.alloc(8, 0))\n  var ivBits = len * 8\n  var tail = Buffer.alloc(8)\n  tail.writeUIntBE(ivBits, 0, 8)\n  ghash.update(tail)\n  self._finID = ghash.state\n  var out = Buffer.from(self._finID)\n  incr32(out)\n  return out\n}\nfunction StreamCipher (mode, key, iv, decrypt) {\n  Transform.call(this)\n\n  var h = Buffer.alloc(4, 0)\n\n  this._cipher = new aes.AES(key)\n  var ck = this._cipher.encryptBlock(h)\n  this._ghash = new GHASH(ck)\n  iv = calcIv(this, iv, ck)\n\n  this._prev = Buffer.from(iv)\n  this._cache = Buffer.allocUnsafe(0)\n  this._secCache = Buffer.allocUnsafe(0)\n  this._decrypt = decrypt\n  this._alen = 0\n  this._len = 0\n  this._mode = mode\n\n  this._authTag = null\n  this._called = false\n}\n\ninherits(StreamCipher, Transform)\n\nStreamCipher.prototype._update = function (chunk) {\n  if (!this._called && this._alen) {\n    var rump = 16 - (this._alen % 16)\n    if (rump < 16) {\n      rump = Buffer.alloc(rump, 0)\n      this._ghash.update(rump)\n    }\n  }\n\n  this._called = true\n  var out = this._mode.encrypt(this, chunk)\n  if (this._decrypt) {\n    this._ghash.update(chunk)\n  } else {\n    this._ghash.update(out)\n  }\n  this._len += chunk.length\n  return out\n}\n\nStreamCipher.prototype._final = function () {\n  if (this._decrypt && !this._authTag) throw new Error('Unsupported state or unable to authenticate data')\n\n  var tag = xor(this._ghash.final(this._alen * 8, this._len * 8), this._cipher.encryptBlock(this._finID))\n  if (this._decrypt && xorTest(tag, this._authTag)) throw new Error('Unsupported state or unable to authenticate data')\n\n  this._authTag = tag\n  this._cipher.scrub()\n}\n\nStreamCipher.prototype.getAuthTag = function getAuthTag () {\n  if (this._decrypt || !Buffer.isBuffer(this._authTag)) throw new Error('Attempting to get auth tag in unsupported state')\n\n  return this._authTag\n}\n\nStreamCipher.prototype.setAuthTag = function setAuthTag (tag) {\n  if (!this._decrypt) throw new Error('Attempting to set auth tag in unsupported state')\n\n  this._authTag = tag\n}\n\nStreamCipher.prototype.setAAD = function setAAD (buf) {\n  if (this._called) throw new Error('Attempting to set AAD in unsupported state')\n\n  this._ghash.update(buf)\n  this._alen += buf.length\n}\n\nmodule.exports = StreamCipher\n","var aes = require('./aes')\nvar Buffer = require('safe-buffer').Buffer\nvar Transform = require('cipher-base')\nvar inherits = require('inherits')\n\nfunction StreamCipher (mode, key, iv, decrypt) {\n  Transform.call(this)\n\n  this._cipher = new aes.AES(key)\n  this._prev = Buffer.from(iv)\n  this._cache = Buffer.allocUnsafe(0)\n  this._secCache = Buffer.allocUnsafe(0)\n  this._decrypt = decrypt\n  this._mode = mode\n}\n\ninherits(StreamCipher, Transform)\n\nStreamCipher.prototype._update = function (chunk) {\n  return this._mode.encrypt(this, chunk, this._decrypt)\n}\n\nStreamCipher.prototype._final = function () {\n  this._cipher.scrub()\n}\n\nmodule.exports = StreamCipher\n","var Buffer = require('safe-buffer').Buffer\nvar MD5 = require('md5.js')\n\n/* eslint-disable camelcase */\nfunction EVP_BytesToKey (password, salt, keyBits, ivLen) {\n  if (!Buffer.isBuffer(password)) password = Buffer.from(password, 'binary')\n  if (salt) {\n    if (!Buffer.isBuffer(salt)) salt = Buffer.from(salt, 'binary')\n    if (salt.length !== 8) throw new RangeError('salt should be Buffer with 8 byte length')\n  }\n\n  var keyLen = keyBits / 8\n  var key = Buffer.alloc(keyLen)\n  var iv = Buffer.alloc(ivLen || 0)\n  var tmp = Buffer.alloc(0)\n\n  while (keyLen > 0 || ivLen > 0) {\n    var hash = new MD5()\n    hash.update(tmp)\n    hash.update(password)\n    if (salt) hash.update(salt)\n    tmp = hash.digest()\n\n    var used = 0\n\n    if (keyLen > 0) {\n      var keyStart = key.length - keyLen\n      used = Math.min(keyLen, tmp.length)\n      tmp.copy(key, keyStart, 0, used)\n      keyLen -= used\n    }\n\n    if (used < tmp.length && ivLen > 0) {\n      var ivStart = iv.length - ivLen\n      var length = Math.min(ivLen, tmp.length - used)\n      tmp.copy(iv, ivStart, used, used + length)\n      ivLen -= length\n    }\n  }\n\n  tmp.fill(0)\n  return { key: key, iv: iv }\n}\n\nmodule.exports = EVP_BytesToKey\n","var MODES = require('./modes')\nvar AuthCipher = require('./authCipher')\nvar Buffer = require('safe-buffer').Buffer\nvar StreamCipher = require('./streamCipher')\nvar Transform = require('cipher-base')\nvar aes = require('./aes')\nvar ebtk = require('evp_bytestokey')\nvar inherits = require('inherits')\n\nfunction Cipher (mode, key, iv) {\n  Transform.call(this)\n\n  this._cache = new Splitter()\n  this._cipher = new aes.AES(key)\n  this._prev = Buffer.from(iv)\n  this._mode = mode\n  this._autopadding = true\n}\n\ninherits(Cipher, Transform)\n\nCipher.prototype._update = function (data) {\n  this._cache.add(data)\n  var chunk\n  var thing\n  var out = []\n\n  while ((chunk = this._cache.get())) {\n    thing = this._mode.encrypt(this, chunk)\n    out.push(thing)\n  }\n\n  return Buffer.concat(out)\n}\n\nvar PADDING = Buffer.alloc(16, 0x10)\n\nCipher.prototype._final = function () {\n  var chunk = this._cache.flush()\n  if (this._autopadding) {\n    chunk = this._mode.encrypt(this, chunk)\n    this._cipher.scrub()\n    return chunk\n  }\n\n  if (!chunk.equals(PADDING)) {\n    this._cipher.scrub()\n    throw new Error('data not multiple of block length')\n  }\n}\n\nCipher.prototype.setAutoPadding = function (setTo) {\n  this._autopadding = !!setTo\n  return this\n}\n\nfunction Splitter () {\n  this.cache = Buffer.allocUnsafe(0)\n}\n\nSplitter.prototype.add = function (data) {\n  this.cache = Buffer.concat([this.cache, data])\n}\n\nSplitter.prototype.get = function () {\n  if (this.cache.length > 15) {\n    var out = this.cache.slice(0, 16)\n    this.cache = this.cache.slice(16)\n    return out\n  }\n  return null\n}\n\nSplitter.prototype.flush = function () {\n  var len = 16 - this.cache.length\n  var padBuff = Buffer.allocUnsafe(len)\n\n  var i = -1\n  while (++i < len) {\n    padBuff.writeUInt8(len, i)\n  }\n\n  return Buffer.concat([this.cache, padBuff])\n}\n\nfunction createCipheriv (suite, password, iv) {\n  var config = MODES[suite.toLowerCase()]\n  if (!config) throw new TypeError('invalid suite type')\n\n  if (typeof password === 'string') password = Buffer.from(password)\n  if (password.length !== config.key / 8) throw new TypeError('invalid key length ' + password.length)\n\n  if (typeof iv === 'string') iv = Buffer.from(iv)\n  if (config.mode !== 'GCM' && iv.length !== config.iv) throw new TypeError('invalid iv length ' + iv.length)\n\n  if (config.type === 'stream') {\n    return new StreamCipher(config.module, password, iv)\n  } else if (config.type === 'auth') {\n    return new AuthCipher(config.module, password, iv)\n  }\n\n  return new Cipher(config.module, password, iv)\n}\n\nfunction createCipher (suite, password) {\n  var config = MODES[suite.toLowerCase()]\n  if (!config) throw new TypeError('invalid suite type')\n\n  var keys = ebtk(password, false, config.key, config.iv)\n  return createCipheriv(suite, keys.key, keys.iv)\n}\n\nexports.createCipheriv = createCipheriv\nexports.createCipher = createCipher\n","var AuthCipher = require('./authCipher')\nvar Buffer = require('safe-buffer').Buffer\nvar MODES = require('./modes')\nvar StreamCipher = require('./streamCipher')\nvar Transform = require('cipher-base')\nvar aes = require('./aes')\nvar ebtk = require('evp_bytestokey')\nvar inherits = require('inherits')\n\nfunction Decipher (mode, key, iv) {\n  Transform.call(this)\n\n  this._cache = new Splitter()\n  this._last = void 0\n  this._cipher = new aes.AES(key)\n  this._prev = Buffer.from(iv)\n  this._mode = mode\n  this._autopadding = true\n}\n\ninherits(Decipher, Transform)\n\nDecipher.prototype._update = function (data) {\n  this._cache.add(data)\n  var chunk\n  var thing\n  var out = []\n  while ((chunk = this._cache.get(this._autopadding))) {\n    thing = this._mode.decrypt(this, chunk)\n    out.push(thing)\n  }\n  return Buffer.concat(out)\n}\n\nDecipher.prototype._final = function () {\n  var chunk = this._cache.flush()\n  if (this._autopadding) {\n    return unpad(this._mode.decrypt(this, chunk))\n  } else if (chunk) {\n    throw new Error('data not multiple of block length')\n  }\n}\n\nDecipher.prototype.setAutoPadding = function (setTo) {\n  this._autopadding = !!setTo\n  return this\n}\n\nfunction Splitter () {\n  this.cache = Buffer.allocUnsafe(0)\n}\n\nSplitter.prototype.add = function (data) {\n  this.cache = Buffer.concat([this.cache, data])\n}\n\nSplitter.prototype.get = function (autoPadding) {\n  var out\n  if (autoPadding) {\n    if (this.cache.length > 16) {\n      out = this.cache.slice(0, 16)\n      this.cache = this.cache.slice(16)\n      return out\n    }\n  } else {\n    if (this.cache.length >= 16) {\n      out = this.cache.slice(0, 16)\n      this.cache = this.cache.slice(16)\n      return out\n    }\n  }\n\n  return null\n}\n\nSplitter.prototype.flush = function () {\n  if (this.cache.length) return this.cache\n}\n\nfunction unpad (last) {\n  var padded = last[15]\n  if (padded < 1 || padded > 16) {\n    throw new Error('unable to decrypt data')\n  }\n  var i = -1\n  while (++i < padded) {\n    if (last[(i + (16 - padded))] !== padded) {\n      throw new Error('unable to decrypt data')\n    }\n  }\n  if (padded === 16) return\n\n  return last.slice(0, 16 - padded)\n}\n\nfunction createDecipheriv (suite, password, iv) {\n  var config = MODES[suite.toLowerCase()]\n  if (!config) throw new TypeError('invalid suite type')\n\n  if (typeof iv === 'string') iv = Buffer.from(iv)\n  if (config.mode !== 'GCM' && iv.length !== config.iv) throw new TypeError('invalid iv length ' + iv.length)\n\n  if (typeof password === 'string') password = Buffer.from(password)\n  if (password.length !== config.key / 8) throw new TypeError('invalid key length ' + password.length)\n\n  if (config.type === 'stream') {\n    return new StreamCipher(config.module, password, iv, true)\n  } else if (config.type === 'auth') {\n    return new AuthCipher(config.module, password, iv, true)\n  }\n\n  return new Decipher(config.module, password, iv)\n}\n\nfunction createDecipher (suite, password) {\n  var config = MODES[suite.toLowerCase()]\n  if (!config) throw new TypeError('invalid suite type')\n\n  var keys = ebtk(password, false, config.key, config.iv)\n  return createDecipheriv(suite, keys.key, keys.iv)\n}\n\nexports.createDecipher = createDecipher\nexports.createDecipheriv = createDecipheriv\n","var ciphers = require('./encrypter')\nvar deciphers = require('./decrypter')\nvar modes = require('./modes/list.json')\n\nfunction getCiphers () {\n  return Object.keys(modes)\n}\n\nexports.createCipher = exports.Cipher = ciphers.createCipher\nexports.createCipheriv = exports.Cipheriv = ciphers.createCipheriv\nexports.createDecipher = exports.Decipher = deciphers.createDecipher\nexports.createDecipheriv = exports.Decipheriv = deciphers.createDecipheriv\nexports.listCiphers = exports.getCiphers = getCiphers\n","exports['des-ecb'] = {\n  key: 8,\n  iv: 0\n}\nexports['des-cbc'] = exports.des = {\n  key: 8,\n  iv: 8\n}\nexports['des-ede3-cbc'] = exports.des3 = {\n  key: 24,\n  iv: 8\n}\nexports['des-ede3'] = {\n  key: 24,\n  iv: 0\n}\nexports['des-ede-cbc'] = {\n  key: 16,\n  iv: 8\n}\nexports['des-ede'] = {\n  key: 16,\n  iv: 0\n}\n","var DES = require('browserify-des')\nvar aes = require('browserify-aes/browser')\nvar aesModes = require('browserify-aes/modes')\nvar desModes = require('browserify-des/modes')\nvar ebtk = require('evp_bytestokey')\n\nfunction createCipher (suite, password) {\n  suite = suite.toLowerCase()\n\n  var keyLen, ivLen\n  if (aesModes[suite]) {\n    keyLen = aesModes[suite].key\n    ivLen = aesModes[suite].iv\n  } else if (desModes[suite]) {\n    keyLen = desModes[suite].key * 8\n    ivLen = desModes[suite].iv\n  } else {\n    throw new TypeError('invalid suite type')\n  }\n\n  var keys = ebtk(password, false, keyLen, ivLen)\n  return createCipheriv(suite, keys.key, keys.iv)\n}\n\nfunction createDecipher (suite, password) {\n  suite = suite.toLowerCase()\n\n  var keyLen, ivLen\n  if (aesModes[suite]) {\n    keyLen = aesModes[suite].key\n    ivLen = aesModes[suite].iv\n  } else if (desModes[suite]) {\n    keyLen = desModes[suite].key * 8\n    ivLen = desModes[suite].iv\n  } else {\n    throw new TypeError('invalid suite type')\n  }\n\n  var keys = ebtk(password, false, keyLen, ivLen)\n  return createDecipheriv(suite, keys.key, keys.iv)\n}\n\nfunction createCipheriv (suite, key, iv) {\n  suite = suite.toLowerCase()\n  if (aesModes[suite]) return aes.createCipheriv(suite, key, iv)\n  if (desModes[suite]) return new DES({ key: key, iv: iv, mode: suite })\n\n  throw new TypeError('invalid suite type')\n}\n\nfunction createDecipheriv (suite, key, iv) {\n  suite = suite.toLowerCase()\n  if (aesModes[suite]) return aes.createDecipheriv(suite, key, iv)\n  if (desModes[suite]) return new DES({ key: key, iv: iv, mode: suite, decrypt: true })\n\n  throw new TypeError('invalid suite type')\n}\n\nfunction getCiphers () {\n  return Object.keys(desModes).concat(aes.getCiphers())\n}\n\nexports.createCipher = exports.Cipher = createCipher\nexports.createCipheriv = exports.Cipheriv = createCipheriv\nexports.createDecipher = exports.Decipher = createDecipher\nexports.createDecipheriv = exports.Decipheriv = createDecipheriv\nexports.listCiphers = exports.getCiphers = getCiphers\n","(function (module, exports) {\n  'use strict';\n\n  // Utils\n  function assert (val, msg) {\n    if (!val) throw new Error(msg || 'Assertion failed');\n  }\n\n  // Could use `inherits` module, but don't want to move from single file\n  // architecture yet.\n  function inherits (ctor, superCtor) {\n    ctor.super_ = superCtor;\n    var TempCtor = function () {};\n    TempCtor.prototype = superCtor.prototype;\n    ctor.prototype = new TempCtor();\n    ctor.prototype.constructor = ctor;\n  }\n\n  // BN\n\n  function BN (number, base, endian) {\n    if (BN.isBN(number)) {\n      return number;\n    }\n\n    this.negative = 0;\n    this.words = null;\n    this.length = 0;\n\n    // Reduction context\n    this.red = null;\n\n    if (number !== null) {\n      if (base === 'le' || base === 'be') {\n        endian = base;\n        base = 10;\n      }\n\n      this._init(number || 0, base || 10, endian || 'be');\n    }\n  }\n  if (typeof module === 'object') {\n    module.exports = BN;\n  } else {\n    exports.BN = BN;\n  }\n\n  BN.BN = BN;\n  BN.wordSize = 26;\n\n  var Buffer;\n  try {\n    Buffer = require('buffer').Buffer;\n  } catch (e) {\n  }\n\n  BN.isBN = function isBN (num) {\n    if (num instanceof BN) {\n      return true;\n    }\n\n    return num !== null && typeof num === 'object' &&\n      num.constructor.wordSize === BN.wordSize && Array.isArray(num.words);\n  };\n\n  BN.max = function max (left, right) {\n    if (left.cmp(right) > 0) return left;\n    return right;\n  };\n\n  BN.min = function min (left, right) {\n    if (left.cmp(right) < 0) return left;\n    return right;\n  };\n\n  BN.prototype._init = function init (number, base, endian) {\n    if (typeof number === 'number') {\n      return this._initNumber(number, base, endian);\n    }\n\n    if (typeof number === 'object') {\n      return this._initArray(number, base, endian);\n    }\n\n    if (base === 'hex') {\n      base = 16;\n    }\n    assert(base === (base | 0) && base >= 2 && base <= 36);\n\n    number = number.toString().replace(/\\s+/g, '');\n    var start = 0;\n    if (number[0] === '-') {\n      start++;\n    }\n\n    if (base === 16) {\n      this._parseHex(number, start);\n    } else {\n      this._parseBase(number, base, start);\n    }\n\n    if (number[0] === '-') {\n      this.negative = 1;\n    }\n\n    this.strip();\n\n    if (endian !== 'le') return;\n\n    this._initArray(this.toArray(), base, endian);\n  };\n\n  BN.prototype._initNumber = function _initNumber (number, base, endian) {\n    if (number < 0) {\n      this.negative = 1;\n      number = -number;\n    }\n    if (number < 0x4000000) {\n      this.words = [ number & 0x3ffffff ];\n      this.length = 1;\n    } else if (number < 0x10000000000000) {\n      this.words = [\n        number & 0x3ffffff,\n        (number / 0x4000000) & 0x3ffffff\n      ];\n      this.length = 2;\n    } else {\n      assert(number < 0x20000000000000); // 2 ^ 53 (unsafe)\n      this.words = [\n        number & 0x3ffffff,\n        (number / 0x4000000) & 0x3ffffff,\n        1\n      ];\n      this.length = 3;\n    }\n\n    if (endian !== 'le') return;\n\n    // Reverse the bytes\n    this._initArray(this.toArray(), base, endian);\n  };\n\n  BN.prototype._initArray = function _initArray (number, base, endian) {\n    // Perhaps a Uint8Array\n    assert(typeof number.length === 'number');\n    if (number.length <= 0) {\n      this.words = [ 0 ];\n      this.length = 1;\n      return this;\n    }\n\n    this.length = Math.ceil(number.length / 3);\n    this.words = new Array(this.length);\n    for (var i = 0; i < this.length; i++) {\n      this.words[i] = 0;\n    }\n\n    var j, w;\n    var off = 0;\n    if (endian === 'be') {\n      for (i = number.length - 1, j = 0; i >= 0; i -= 3) {\n        w = number[i] | (number[i - 1] << 8) | (number[i - 2] << 16);\n        this.words[j] |= (w << off) & 0x3ffffff;\n        this.words[j + 1] = (w >>> (26 - off)) & 0x3ffffff;\n        off += 24;\n        if (off >= 26) {\n          off -= 26;\n          j++;\n        }\n      }\n    } else if (endian === 'le') {\n      for (i = 0, j = 0; i < number.length; i += 3) {\n        w = number[i] | (number[i + 1] << 8) | (number[i + 2] << 16);\n        this.words[j] |= (w << off) & 0x3ffffff;\n        this.words[j + 1] = (w >>> (26 - off)) & 0x3ffffff;\n        off += 24;\n        if (off >= 26) {\n          off -= 26;\n          j++;\n        }\n      }\n    }\n    return this.strip();\n  };\n\n  function parseHex (str, start, end) {\n    var r = 0;\n    var len = Math.min(str.length, end);\n    for (var i = start; i < len; i++) {\n      var c = str.charCodeAt(i) - 48;\n\n      r <<= 4;\n\n      // 'a' - 'f'\n      if (c >= 49 && c <= 54) {\n        r |= c - 49 + 0xa;\n\n      // 'A' - 'F'\n      } else if (c >= 17 && c <= 22) {\n        r |= c - 17 + 0xa;\n\n      // '0' - '9'\n      } else {\n        r |= c & 0xf;\n      }\n    }\n    return r;\n  }\n\n  BN.prototype._parseHex = function _parseHex (number, start) {\n    // Create possibly bigger array to ensure that it fits the number\n    this.length = Math.ceil((number.length - start) / 6);\n    this.words = new Array(this.length);\n    for (var i = 0; i < this.length; i++) {\n      this.words[i] = 0;\n    }\n\n    var j, w;\n    // Scan 24-bit chunks and add them to the number\n    var off = 0;\n    for (i = number.length - 6, j = 0; i >= start; i -= 6) {\n      w = parseHex(number, i, i + 6);\n      this.words[j] |= (w << off) & 0x3ffffff;\n      // NOTE: `0x3fffff` is intentional here, 26bits max shift + 24bit hex limb\n      this.words[j + 1] |= w >>> (26 - off) & 0x3fffff;\n      off += 24;\n      if (off >= 26) {\n        off -= 26;\n        j++;\n      }\n    }\n    if (i + 6 !== start) {\n      w = parseHex(number, start, i + 6);\n      this.words[j] |= (w << off) & 0x3ffffff;\n      this.words[j + 1] |= w >>> (26 - off) & 0x3fffff;\n    }\n    this.strip();\n  };\n\n  function parseBase (str, start, end, mul) {\n    var r = 0;\n    var len = Math.min(str.length, end);\n    for (var i = start; i < len; i++) {\n      var c = str.charCodeAt(i) - 48;\n\n      r *= mul;\n\n      // 'a'\n      if (c >= 49) {\n        r += c - 49 + 0xa;\n\n      // 'A'\n      } else if (c >= 17) {\n        r += c - 17 + 0xa;\n\n      // '0' - '9'\n      } else {\n        r += c;\n      }\n    }\n    return r;\n  }\n\n  BN.prototype._parseBase = function _parseBase (number, base, start) {\n    // Initialize as zero\n    this.words = [ 0 ];\n    this.length = 1;\n\n    // Find length of limb in base\n    for (var limbLen = 0, limbPow = 1; limbPow <= 0x3ffffff; limbPow *= base) {\n      limbLen++;\n    }\n    limbLen--;\n    limbPow = (limbPow / base) | 0;\n\n    var total = number.length - start;\n    var mod = total % limbLen;\n    var end = Math.min(total, total - mod) + start;\n\n    var word = 0;\n    for (var i = start; i < end; i += limbLen) {\n      word = parseBase(number, i, i + limbLen, base);\n\n      this.imuln(limbPow);\n      if (this.words[0] + word < 0x4000000) {\n        this.words[0] += word;\n      } else {\n        this._iaddn(word);\n      }\n    }\n\n    if (mod !== 0) {\n      var pow = 1;\n      word = parseBase(number, i, number.length, base);\n\n      for (i = 0; i < mod; i++) {\n        pow *= base;\n      }\n\n      this.imuln(pow);\n      if (this.words[0] + word < 0x4000000) {\n        this.words[0] += word;\n      } else {\n        this._iaddn(word);\n      }\n    }\n  };\n\n  BN.prototype.copy = function copy (dest) {\n    dest.words = new Array(this.length);\n    for (var i = 0; i < this.length; i++) {\n      dest.words[i] = this.words[i];\n    }\n    dest.length = this.length;\n    dest.negative = this.negative;\n    dest.red = this.red;\n  };\n\n  BN.prototype.clone = function clone () {\n    var r = new BN(null);\n    this.copy(r);\n    return r;\n  };\n\n  BN.prototype._expand = function _expand (size) {\n    while (this.length < size) {\n      this.words[this.length++] = 0;\n    }\n    return this;\n  };\n\n  // Remove leading `0` from `this`\n  BN.prototype.strip = function strip () {\n    while (this.length > 1 && this.words[this.length - 1] === 0) {\n      this.length--;\n    }\n    return this._normSign();\n  };\n\n  BN.prototype._normSign = function _normSign () {\n    // -0 = 0\n    if (this.length === 1 && this.words[0] === 0) {\n      this.negative = 0;\n    }\n    return this;\n  };\n\n  BN.prototype.inspect = function inspect () {\n    return (this.red ? '<BN-R: ' : '<BN: ') + this.toString(16) + '>';\n  };\n\n  /*\n\n  var zeros = [];\n  var groupSizes = [];\n  var groupBases = [];\n\n  var s = '';\n  var i = -1;\n  while (++i < BN.wordSize) {\n    zeros[i] = s;\n    s += '0';\n  }\n  groupSizes[0] = 0;\n  groupSizes[1] = 0;\n  groupBases[0] = 0;\n  groupBases[1] = 0;\n  var base = 2 - 1;\n  while (++base < 36 + 1) {\n    var groupSize = 0;\n    var groupBase = 1;\n    while (groupBase < (1 << BN.wordSize) / base) {\n      groupBase *= base;\n      groupSize += 1;\n    }\n    groupSizes[base] = groupSize;\n    groupBases[base] = groupBase;\n  }\n\n  */\n\n  var zeros = [\n    '',\n    '0',\n    '00',\n    '000',\n    '0000',\n    '00000',\n    '000000',\n    '0000000',\n    '00000000',\n    '000000000',\n    '0000000000',\n    '00000000000',\n    '000000000000',\n    '0000000000000',\n    '00000000000000',\n    '000000000000000',\n    '0000000000000000',\n    '00000000000000000',\n    '000000000000000000',\n    '0000000000000000000',\n    '00000000000000000000',\n    '000000000000000000000',\n    '0000000000000000000000',\n    '00000000000000000000000',\n    '000000000000000000000000',\n    '0000000000000000000000000'\n  ];\n\n  var groupSizes = [\n    0, 0,\n    25, 16, 12, 11, 10, 9, 8,\n    8, 7, 7, 7, 7, 6, 6,\n    6, 6, 6, 6, 6, 5, 5,\n    5, 5, 5, 5, 5, 5, 5,\n    5, 5, 5, 5, 5, 5, 5\n  ];\n\n  var groupBases = [\n    0, 0,\n    33554432, 43046721, 16777216, 48828125, 60466176, 40353607, 16777216,\n    43046721, 10000000, 19487171, 35831808, 62748517, 7529536, 11390625,\n    16777216, 24137569, 34012224, 47045881, 64000000, 4084101, 5153632,\n    6436343, 7962624, 9765625, 11881376, 14348907, 17210368, 20511149,\n    24300000, 28629151, 33554432, 39135393, 45435424, 52521875, 60466176\n  ];\n\n  BN.prototype.toString = function toString (base, padding) {\n    base = base || 10;\n    padding = padding | 0 || 1;\n\n    var out;\n    if (base === 16 || base === 'hex') {\n      out = '';\n      var off = 0;\n      var carry = 0;\n      for (var i = 0; i < this.length; i++) {\n        var w = this.words[i];\n        var word = (((w << off) | carry) & 0xffffff).toString(16);\n        carry = (w >>> (24 - off)) & 0xffffff;\n        if (carry !== 0 || i !== this.length - 1) {\n          out = zeros[6 - word.length] + word + out;\n        } else {\n          out = word + out;\n        }\n        off += 2;\n        if (off >= 26) {\n          off -= 26;\n          i--;\n        }\n      }\n      if (carry !== 0) {\n        out = carry.toString(16) + out;\n      }\n      while (out.length % padding !== 0) {\n        out = '0' + out;\n      }\n      if (this.negative !== 0) {\n        out = '-' + out;\n      }\n      return out;\n    }\n\n    if (base === (base | 0) && base >= 2 && base <= 36) {\n      // var groupSize = Math.floor(BN.wordSize * Math.LN2 / Math.log(base));\n      var groupSize = groupSizes[base];\n      // var groupBase = Math.pow(base, groupSize);\n      var groupBase = groupBases[base];\n      out = '';\n      var c = this.clone();\n      c.negative = 0;\n      while (!c.isZero()) {\n        var r = c.modn(groupBase).toString(base);\n        c = c.idivn(groupBase);\n\n        if (!c.isZero()) {\n          out = zeros[groupSize - r.length] + r + out;\n        } else {\n          out = r + out;\n        }\n      }\n      if (this.isZero()) {\n        out = '0' + out;\n      }\n      while (out.length % padding !== 0) {\n        out = '0' + out;\n      }\n      if (this.negative !== 0) {\n        out = '-' + out;\n      }\n      return out;\n    }\n\n    assert(false, 'Base should be between 2 and 36');\n  };\n\n  BN.prototype.toNumber = function toNumber () {\n    var ret = this.words[0];\n    if (this.length === 2) {\n      ret += this.words[1] * 0x4000000;\n    } else if (this.length === 3 && this.words[2] === 0x01) {\n      // NOTE: at this stage it is known that the top bit is set\n      ret += 0x10000000000000 + (this.words[1] * 0x4000000);\n    } else if (this.length > 2) {\n      assert(false, 'Number can only safely store up to 53 bits');\n    }\n    return (this.negative !== 0) ? -ret : ret;\n  };\n\n  BN.prototype.toJSON = function toJSON () {\n    return this.toString(16);\n  };\n\n  BN.prototype.toBuffer = function toBuffer (endian, length) {\n    assert(typeof Buffer !== 'undefined');\n    return this.toArrayLike(Buffer, endian, length);\n  };\n\n  BN.prototype.toArray = function toArray (endian, length) {\n    return this.toArrayLike(Array, endian, length);\n  };\n\n  BN.prototype.toArrayLike = function toArrayLike (ArrayType, endian, length) {\n    var byteLength = this.byteLength();\n    var reqLength = length || Math.max(1, byteLength);\n    assert(byteLength <= reqLength, 'byte array longer than desired length');\n    assert(reqLength > 0, 'Requested array length <= 0');\n\n    this.strip();\n    var littleEndian = endian === 'le';\n    var res = new ArrayType(reqLength);\n\n    var b, i;\n    var q = this.clone();\n    if (!littleEndian) {\n      // Assume big-endian\n      for (i = 0; i < reqLength - byteLength; i++) {\n        res[i] = 0;\n      }\n\n      for (i = 0; !q.isZero(); i++) {\n        b = q.andln(0xff);\n        q.iushrn(8);\n\n        res[reqLength - i - 1] = b;\n      }\n    } else {\n      for (i = 0; !q.isZero(); i++) {\n        b = q.andln(0xff);\n        q.iushrn(8);\n\n        res[i] = b;\n      }\n\n      for (; i < reqLength; i++) {\n        res[i] = 0;\n      }\n    }\n\n    return res;\n  };\n\n  if (Math.clz32) {\n    BN.prototype._countBits = function _countBits (w) {\n      return 32 - Math.clz32(w);\n    };\n  } else {\n    BN.prototype._countBits = function _countBits (w) {\n      var t = w;\n      var r = 0;\n      if (t >= 0x1000) {\n        r += 13;\n        t >>>= 13;\n      }\n      if (t >= 0x40) {\n        r += 7;\n        t >>>= 7;\n      }\n      if (t >= 0x8) {\n        r += 4;\n        t >>>= 4;\n      }\n      if (t >= 0x02) {\n        r += 2;\n        t >>>= 2;\n      }\n      return r + t;\n    };\n  }\n\n  BN.prototype._zeroBits = function _zeroBits (w) {\n    // Short-cut\n    if (w === 0) return 26;\n\n    var t = w;\n    var r = 0;\n    if ((t & 0x1fff) === 0) {\n      r += 13;\n      t >>>= 13;\n    }\n    if ((t & 0x7f) === 0) {\n      r += 7;\n      t >>>= 7;\n    }\n    if ((t & 0xf) === 0) {\n      r += 4;\n      t >>>= 4;\n    }\n    if ((t & 0x3) === 0) {\n      r += 2;\n      t >>>= 2;\n    }\n    if ((t & 0x1) === 0) {\n      r++;\n    }\n    return r;\n  };\n\n  // Return number of used bits in a BN\n  BN.prototype.bitLength = function bitLength () {\n    var w = this.words[this.length - 1];\n    var hi = this._countBits(w);\n    return (this.length - 1) * 26 + hi;\n  };\n\n  function toBitArray (num) {\n    var w = new Array(num.bitLength());\n\n    for (var bit = 0; bit < w.length; bit++) {\n      var off = (bit / 26) | 0;\n      var wbit = bit % 26;\n\n      w[bit] = (num.words[off] & (1 << wbit)) >>> wbit;\n    }\n\n    return w;\n  }\n\n  // Number of trailing zero bits\n  BN.prototype.zeroBits = function zeroBits () {\n    if (this.isZero()) return 0;\n\n    var r = 0;\n    for (var i = 0; i < this.length; i++) {\n      var b = this._zeroBits(this.words[i]);\n      r += b;\n      if (b !== 26) break;\n    }\n    return r;\n  };\n\n  BN.prototype.byteLength = function byteLength () {\n    return Math.ceil(this.bitLength() / 8);\n  };\n\n  BN.prototype.toTwos = function toTwos (width) {\n    if (this.negative !== 0) {\n      return this.abs().inotn(width).iaddn(1);\n    }\n    return this.clone();\n  };\n\n  BN.prototype.fromTwos = function fromTwos (width) {\n    if (this.testn(width - 1)) {\n      return this.notn(width).iaddn(1).ineg();\n    }\n    return this.clone();\n  };\n\n  BN.prototype.isNeg = function isNeg () {\n    return this.negative !== 0;\n  };\n\n  // Return negative clone of `this`\n  BN.prototype.neg = function neg () {\n    return this.clone().ineg();\n  };\n\n  BN.prototype.ineg = function ineg () {\n    if (!this.isZero()) {\n      this.negative ^= 1;\n    }\n\n    return this;\n  };\n\n  // Or `num` with `this` in-place\n  BN.prototype.iuor = function iuor (num) {\n    while (this.length < num.length) {\n      this.words[this.length++] = 0;\n    }\n\n    for (var i = 0; i < num.length; i++) {\n      this.words[i] = this.words[i] | num.words[i];\n    }\n\n    return this.strip();\n  };\n\n  BN.prototype.ior = function ior (num) {\n    assert((this.negative | num.negative) === 0);\n    return this.iuor(num);\n  };\n\n  // Or `num` with `this`\n  BN.prototype.or = function or (num) {\n    if (this.length > num.length) return this.clone().ior(num);\n    return num.clone().ior(this);\n  };\n\n  BN.prototype.uor = function uor (num) {\n    if (this.length > num.length) return this.clone().iuor(num);\n    return num.clone().iuor(this);\n  };\n\n  // And `num` with `this` in-place\n  BN.prototype.iuand = function iuand (num) {\n    // b = min-length(num, this)\n    var b;\n    if (this.length > num.length) {\n      b = num;\n    } else {\n      b = this;\n    }\n\n    for (var i = 0; i < b.length; i++) {\n      this.words[i] = this.words[i] & num.words[i];\n    }\n\n    this.length = b.length;\n\n    return this.strip();\n  };\n\n  BN.prototype.iand = function iand (num) {\n    assert((this.negative | num.negative) === 0);\n    return this.iuand(num);\n  };\n\n  // And `num` with `this`\n  BN.prototype.and = function and (num) {\n    if (this.length > num.length) return this.clone().iand(num);\n    return num.clone().iand(this);\n  };\n\n  BN.prototype.uand = function uand (num) {\n    if (this.length > num.length) return this.clone().iuand(num);\n    return num.clone().iuand(this);\n  };\n\n  // Xor `num` with `this` in-place\n  BN.prototype.iuxor = function iuxor (num) {\n    // a.length > b.length\n    var a;\n    var b;\n    if (this.length > num.length) {\n      a = this;\n      b = num;\n    } else {\n      a = num;\n      b = this;\n    }\n\n    for (var i = 0; i < b.length; i++) {\n      this.words[i] = a.words[i] ^ b.words[i];\n    }\n\n    if (this !== a) {\n      for (; i < a.length; i++) {\n        this.words[i] = a.words[i];\n      }\n    }\n\n    this.length = a.length;\n\n    return this.strip();\n  };\n\n  BN.prototype.ixor = function ixor (num) {\n    assert((this.negative | num.negative) === 0);\n    return this.iuxor(num);\n  };\n\n  // Xor `num` with `this`\n  BN.prototype.xor = function xor (num) {\n    if (this.length > num.length) return this.clone().ixor(num);\n    return num.clone().ixor(this);\n  };\n\n  BN.prototype.uxor = function uxor (num) {\n    if (this.length > num.length) return this.clone().iuxor(num);\n    return num.clone().iuxor(this);\n  };\n\n  // Not ``this`` with ``width`` bitwidth\n  BN.prototype.inotn = function inotn (width) {\n    assert(typeof width === 'number' && width >= 0);\n\n    var bytesNeeded = Math.ceil(width / 26) | 0;\n    var bitsLeft = width % 26;\n\n    // Extend the buffer with leading zeroes\n    this._expand(bytesNeeded);\n\n    if (bitsLeft > 0) {\n      bytesNeeded--;\n    }\n\n    // Handle complete words\n    for (var i = 0; i < bytesNeeded; i++) {\n      this.words[i] = ~this.words[i] & 0x3ffffff;\n    }\n\n    // Handle the residue\n    if (bitsLeft > 0) {\n      this.words[i] = ~this.words[i] & (0x3ffffff >> (26 - bitsLeft));\n    }\n\n    // And remove leading zeroes\n    return this.strip();\n  };\n\n  BN.prototype.notn = function notn (width) {\n    return this.clone().inotn(width);\n  };\n\n  // Set `bit` of `this`\n  BN.prototype.setn = function setn (bit, val) {\n    assert(typeof bit === 'number' && bit >= 0);\n\n    var off = (bit / 26) | 0;\n    var wbit = bit % 26;\n\n    this._expand(off + 1);\n\n    if (val) {\n      this.words[off] = this.words[off] | (1 << wbit);\n    } else {\n      this.words[off] = this.words[off] & ~(1 << wbit);\n    }\n\n    return this.strip();\n  };\n\n  // Add `num` to `this` in-place\n  BN.prototype.iadd = function iadd (num) {\n    var r;\n\n    // negative + positive\n    if (this.negative !== 0 && num.negative === 0) {\n      this.negative = 0;\n      r = this.isub(num);\n      this.negative ^= 1;\n      return this._normSign();\n\n    // positive + negative\n    } else if (this.negative === 0 && num.negative !== 0) {\n      num.negative = 0;\n      r = this.isub(num);\n      num.negative = 1;\n      return r._normSign();\n    }\n\n    // a.length > b.length\n    var a, b;\n    if (this.length > num.length) {\n      a = this;\n      b = num;\n    } else {\n      a = num;\n      b = this;\n    }\n\n    var carry = 0;\n    for (var i = 0; i < b.length; i++) {\n      r = (a.words[i] | 0) + (b.words[i] | 0) + carry;\n      this.words[i] = r & 0x3ffffff;\n      carry = r >>> 26;\n    }\n    for (; carry !== 0 && i < a.length; i++) {\n      r = (a.words[i] | 0) + carry;\n      this.words[i] = r & 0x3ffffff;\n      carry = r >>> 26;\n    }\n\n    this.length = a.length;\n    if (carry !== 0) {\n      this.words[this.length] = carry;\n      this.length++;\n    // Copy the rest of the words\n    } else if (a !== this) {\n      for (; i < a.length; i++) {\n        this.words[i] = a.words[i];\n      }\n    }\n\n    return this;\n  };\n\n  // Add `num` to `this`\n  BN.prototype.add = function add (num) {\n    var res;\n    if (num.negative !== 0 && this.negative === 0) {\n      num.negative = 0;\n      res = this.sub(num);\n      num.negative ^= 1;\n      return res;\n    } else if (num.negative === 0 && this.negative !== 0) {\n      this.negative = 0;\n      res = num.sub(this);\n      this.negative = 1;\n      return res;\n    }\n\n    if (this.length > num.length) return this.clone().iadd(num);\n\n    return num.clone().iadd(this);\n  };\n\n  // Subtract `num` from `this` in-place\n  BN.prototype.isub = function isub (num) {\n    // this - (-num) = this + num\n    if (num.negative !== 0) {\n      num.negative = 0;\n      var r = this.iadd(num);\n      num.negative = 1;\n      return r._normSign();\n\n    // -this - num = -(this + num)\n    } else if (this.negative !== 0) {\n      this.negative = 0;\n      this.iadd(num);\n      this.negative = 1;\n      return this._normSign();\n    }\n\n    // At this point both numbers are positive\n    var cmp = this.cmp(num);\n\n    // Optimization - zeroify\n    if (cmp === 0) {\n      this.negative = 0;\n      this.length = 1;\n      this.words[0] = 0;\n      return this;\n    }\n\n    // a > b\n    var a, b;\n    if (cmp > 0) {\n      a = this;\n      b = num;\n    } else {\n      a = num;\n      b = this;\n    }\n\n    var carry = 0;\n    for (var i = 0; i < b.length; i++) {\n      r = (a.words[i] | 0) - (b.words[i] | 0) + carry;\n      carry = r >> 26;\n      this.words[i] = r & 0x3ffffff;\n    }\n    for (; carry !== 0 && i < a.length; i++) {\n      r = (a.words[i] | 0) + carry;\n      carry = r >> 26;\n      this.words[i] = r & 0x3ffffff;\n    }\n\n    // Copy rest of the words\n    if (carry === 0 && i < a.length && a !== this) {\n      for (; i < a.length; i++) {\n        this.words[i] = a.words[i];\n      }\n    }\n\n    this.length = Math.max(this.length, i);\n\n    if (a !== this) {\n      this.negative = 1;\n    }\n\n    return this.strip();\n  };\n\n  // Subtract `num` from `this`\n  BN.prototype.sub = function sub (num) {\n    return this.clone().isub(num);\n  };\n\n  function smallMulTo (self, num, out) {\n    out.negative = num.negative ^ self.negative;\n    var len = (self.length + num.length) | 0;\n    out.length = len;\n    len = (len - 1) | 0;\n\n    // Peel one iteration (compiler can't do it, because of code complexity)\n    var a = self.words[0] | 0;\n    var b = num.words[0] | 0;\n    var r = a * b;\n\n    var lo = r & 0x3ffffff;\n    var carry = (r / 0x4000000) | 0;\n    out.words[0] = lo;\n\n    for (var k = 1; k < len; k++) {\n      // Sum all words with the same `i + j = k` and accumulate `ncarry`,\n      // note that ncarry could be >= 0x3ffffff\n      var ncarry = carry >>> 26;\n      var rword = carry & 0x3ffffff;\n      var maxJ = Math.min(k, num.length - 1);\n      for (var j = Math.max(0, k - self.length + 1); j <= maxJ; j++) {\n        var i = (k - j) | 0;\n        a = self.words[i] | 0;\n        b = num.words[j] | 0;\n        r = a * b + rword;\n        ncarry += (r / 0x4000000) | 0;\n        rword = r & 0x3ffffff;\n      }\n      out.words[k] = rword | 0;\n      carry = ncarry | 0;\n    }\n    if (carry !== 0) {\n      out.words[k] = carry | 0;\n    } else {\n      out.length--;\n    }\n\n    return out.strip();\n  }\n\n  // TODO(indutny): it may be reasonable to omit it for users who don't need\n  // to work with 256-bit numbers, otherwise it gives 20% improvement for 256-bit\n  // multiplication (like elliptic secp256k1).\n  var comb10MulTo = function comb10MulTo (self, num, out) {\n    var a = self.words;\n    var b = num.words;\n    var o = out.words;\n    var c = 0;\n    var lo;\n    var mid;\n    var hi;\n    var a0 = a[0] | 0;\n    var al0 = a0 & 0x1fff;\n    var ah0 = a0 >>> 13;\n    var a1 = a[1] | 0;\n    var al1 = a1 & 0x1fff;\n    var ah1 = a1 >>> 13;\n    var a2 = a[2] | 0;\n    var al2 = a2 & 0x1fff;\n    var ah2 = a2 >>> 13;\n    var a3 = a[3] | 0;\n    var al3 = a3 & 0x1fff;\n    var ah3 = a3 >>> 13;\n    var a4 = a[4] | 0;\n    var al4 = a4 & 0x1fff;\n    var ah4 = a4 >>> 13;\n    var a5 = a[5] | 0;\n    var al5 = a5 & 0x1fff;\n    var ah5 = a5 >>> 13;\n    var a6 = a[6] | 0;\n    var al6 = a6 & 0x1fff;\n    var ah6 = a6 >>> 13;\n    var a7 = a[7] | 0;\n    var al7 = a7 & 0x1fff;\n    var ah7 = a7 >>> 13;\n    var a8 = a[8] | 0;\n    var al8 = a8 & 0x1fff;\n    var ah8 = a8 >>> 13;\n    var a9 = a[9] | 0;\n    var al9 = a9 & 0x1fff;\n    var ah9 = a9 >>> 13;\n    var b0 = b[0] | 0;\n    var bl0 = b0 & 0x1fff;\n    var bh0 = b0 >>> 13;\n    var b1 = b[1] | 0;\n    var bl1 = b1 & 0x1fff;\n    var bh1 = b1 >>> 13;\n    var b2 = b[2] | 0;\n    var bl2 = b2 & 0x1fff;\n    var bh2 = b2 >>> 13;\n    var b3 = b[3] | 0;\n    var bl3 = b3 & 0x1fff;\n    var bh3 = b3 >>> 13;\n    var b4 = b[4] | 0;\n    var bl4 = b4 & 0x1fff;\n    var bh4 = b4 >>> 13;\n    var b5 = b[5] | 0;\n    var bl5 = b5 & 0x1fff;\n    var bh5 = b5 >>> 13;\n    var b6 = b[6] | 0;\n    var bl6 = b6 & 0x1fff;\n    var bh6 = b6 >>> 13;\n    var b7 = b[7] | 0;\n    var bl7 = b7 & 0x1fff;\n    var bh7 = b7 >>> 13;\n    var b8 = b[8] | 0;\n    var bl8 = b8 & 0x1fff;\n    var bh8 = b8 >>> 13;\n    var b9 = b[9] | 0;\n    var bl9 = b9 & 0x1fff;\n    var bh9 = b9 >>> 13;\n\n    out.negative = self.negative ^ num.negative;\n    out.length = 19;\n    /* k = 0 */\n    lo = Math.imul(al0, bl0);\n    mid = Math.imul(al0, bh0);\n    mid = (mid + Math.imul(ah0, bl0)) | 0;\n    hi = Math.imul(ah0, bh0);\n    var w0 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w0 >>> 26)) | 0;\n    w0 &= 0x3ffffff;\n    /* k = 1 */\n    lo = Math.imul(al1, bl0);\n    mid = Math.imul(al1, bh0);\n    mid = (mid + Math.imul(ah1, bl0)) | 0;\n    hi = Math.imul(ah1, bh0);\n    lo = (lo + Math.imul(al0, bl1)) | 0;\n    mid = (mid + Math.imul(al0, bh1)) | 0;\n    mid = (mid + Math.imul(ah0, bl1)) | 0;\n    hi = (hi + Math.imul(ah0, bh1)) | 0;\n    var w1 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w1 >>> 26)) | 0;\n    w1 &= 0x3ffffff;\n    /* k = 2 */\n    lo = Math.imul(al2, bl0);\n    mid = Math.imul(al2, bh0);\n    mid = (mid + Math.imul(ah2, bl0)) | 0;\n    hi = Math.imul(ah2, bh0);\n    lo = (lo + Math.imul(al1, bl1)) | 0;\n    mid = (mid + Math.imul(al1, bh1)) | 0;\n    mid = (mid + Math.imul(ah1, bl1)) | 0;\n    hi = (hi + Math.imul(ah1, bh1)) | 0;\n    lo = (lo + Math.imul(al0, bl2)) | 0;\n    mid = (mid + Math.imul(al0, bh2)) | 0;\n    mid = (mid + Math.imul(ah0, bl2)) | 0;\n    hi = (hi + Math.imul(ah0, bh2)) | 0;\n    var w2 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w2 >>> 26)) | 0;\n    w2 &= 0x3ffffff;\n    /* k = 3 */\n    lo = Math.imul(al3, bl0);\n    mid = Math.imul(al3, bh0);\n    mid = (mid + Math.imul(ah3, bl0)) | 0;\n    hi = Math.imul(ah3, bh0);\n    lo = (lo + Math.imul(al2, bl1)) | 0;\n    mid = (mid + Math.imul(al2, bh1)) | 0;\n    mid = (mid + Math.imul(ah2, bl1)) | 0;\n    hi = (hi + Math.imul(ah2, bh1)) | 0;\n    lo = (lo + Math.imul(al1, bl2)) | 0;\n    mid = (mid + Math.imul(al1, bh2)) | 0;\n    mid = (mid + Math.imul(ah1, bl2)) | 0;\n    hi = (hi + Math.imul(ah1, bh2)) | 0;\n    lo = (lo + Math.imul(al0, bl3)) | 0;\n    mid = (mid + Math.imul(al0, bh3)) | 0;\n    mid = (mid + Math.imul(ah0, bl3)) | 0;\n    hi = (hi + Math.imul(ah0, bh3)) | 0;\n    var w3 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w3 >>> 26)) | 0;\n    w3 &= 0x3ffffff;\n    /* k = 4 */\n    lo = Math.imul(al4, bl0);\n    mid = Math.imul(al4, bh0);\n    mid = (mid + Math.imul(ah4, bl0)) | 0;\n    hi = Math.imul(ah4, bh0);\n    lo = (lo + Math.imul(al3, bl1)) | 0;\n    mid = (mid + Math.imul(al3, bh1)) | 0;\n    mid = (mid + Math.imul(ah3, bl1)) | 0;\n    hi = (hi + Math.imul(ah3, bh1)) | 0;\n    lo = (lo + Math.imul(al2, bl2)) | 0;\n    mid = (mid + Math.imul(al2, bh2)) | 0;\n    mid = (mid + Math.imul(ah2, bl2)) | 0;\n    hi = (hi + Math.imul(ah2, bh2)) | 0;\n    lo = (lo + Math.imul(al1, bl3)) | 0;\n    mid = (mid + Math.imul(al1, bh3)) | 0;\n    mid = (mid + Math.imul(ah1, bl3)) | 0;\n    hi = (hi + Math.imul(ah1, bh3)) | 0;\n    lo = (lo + Math.imul(al0, bl4)) | 0;\n    mid = (mid + Math.imul(al0, bh4)) | 0;\n    mid = (mid + Math.imul(ah0, bl4)) | 0;\n    hi = (hi + Math.imul(ah0, bh4)) | 0;\n    var w4 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w4 >>> 26)) | 0;\n    w4 &= 0x3ffffff;\n    /* k = 5 */\n    lo = Math.imul(al5, bl0);\n    mid = Math.imul(al5, bh0);\n    mid = (mid + Math.imul(ah5, bl0)) | 0;\n    hi = Math.imul(ah5, bh0);\n    lo = (lo + Math.imul(al4, bl1)) | 0;\n    mid = (mid + Math.imul(al4, bh1)) | 0;\n    mid = (mid + Math.imul(ah4, bl1)) | 0;\n    hi = (hi + Math.imul(ah4, bh1)) | 0;\n    lo = (lo + Math.imul(al3, bl2)) | 0;\n    mid = (mid + Math.imul(al3, bh2)) | 0;\n    mid = (mid + Math.imul(ah3, bl2)) | 0;\n    hi = (hi + Math.imul(ah3, bh2)) | 0;\n    lo = (lo + Math.imul(al2, bl3)) | 0;\n    mid = (mid + Math.imul(al2, bh3)) | 0;\n    mid = (mid + Math.imul(ah2, bl3)) | 0;\n    hi = (hi + Math.imul(ah2, bh3)) | 0;\n    lo = (lo + Math.imul(al1, bl4)) | 0;\n    mid = (mid + Math.imul(al1, bh4)) | 0;\n    mid = (mid + Math.imul(ah1, bl4)) | 0;\n    hi = (hi + Math.imul(ah1, bh4)) | 0;\n    lo = (lo + Math.imul(al0, bl5)) | 0;\n    mid = (mid + Math.imul(al0, bh5)) | 0;\n    mid = (mid + Math.imul(ah0, bl5)) | 0;\n    hi = (hi + Math.imul(ah0, bh5)) | 0;\n    var w5 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w5 >>> 26)) | 0;\n    w5 &= 0x3ffffff;\n    /* k = 6 */\n    lo = Math.imul(al6, bl0);\n    mid = Math.imul(al6, bh0);\n    mid = (mid + Math.imul(ah6, bl0)) | 0;\n    hi = Math.imul(ah6, bh0);\n    lo = (lo + Math.imul(al5, bl1)) | 0;\n    mid = (mid + Math.imul(al5, bh1)) | 0;\n    mid = (mid + Math.imul(ah5, bl1)) | 0;\n    hi = (hi + Math.imul(ah5, bh1)) | 0;\n    lo = (lo + Math.imul(al4, bl2)) | 0;\n    mid = (mid + Math.imul(al4, bh2)) | 0;\n    mid = (mid + Math.imul(ah4, bl2)) | 0;\n    hi = (hi + Math.imul(ah4, bh2)) | 0;\n    lo = (lo + Math.imul(al3, bl3)) | 0;\n    mid = (mid + Math.imul(al3, bh3)) | 0;\n    mid = (mid + Math.imul(ah3, bl3)) | 0;\n    hi = (hi + Math.imul(ah3, bh3)) | 0;\n    lo = (lo + Math.imul(al2, bl4)) | 0;\n    mid = (mid + Math.imul(al2, bh4)) | 0;\n    mid = (mid + Math.imul(ah2, bl4)) | 0;\n    hi = (hi + Math.imul(ah2, bh4)) | 0;\n    lo = (lo + Math.imul(al1, bl5)) | 0;\n    mid = (mid + Math.imul(al1, bh5)) | 0;\n    mid = (mid + Math.imul(ah1, bl5)) | 0;\n    hi = (hi + Math.imul(ah1, bh5)) | 0;\n    lo = (lo + Math.imul(al0, bl6)) | 0;\n    mid = (mid + Math.imul(al0, bh6)) | 0;\n    mid = (mid + Math.imul(ah0, bl6)) | 0;\n    hi = (hi + Math.imul(ah0, bh6)) | 0;\n    var w6 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w6 >>> 26)) | 0;\n    w6 &= 0x3ffffff;\n    /* k = 7 */\n    lo = Math.imul(al7, bl0);\n    mid = Math.imul(al7, bh0);\n    mid = (mid + Math.imul(ah7, bl0)) | 0;\n    hi = Math.imul(ah7, bh0);\n    lo = (lo + Math.imul(al6, bl1)) | 0;\n    mid = (mid + Math.imul(al6, bh1)) | 0;\n    mid = (mid + Math.imul(ah6, bl1)) | 0;\n    hi = (hi + Math.imul(ah6, bh1)) | 0;\n    lo = (lo + Math.imul(al5, bl2)) | 0;\n    mid = (mid + Math.imul(al5, bh2)) | 0;\n    mid = (mid + Math.imul(ah5, bl2)) | 0;\n    hi = (hi + Math.imul(ah5, bh2)) | 0;\n    lo = (lo + Math.imul(al4, bl3)) | 0;\n    mid = (mid + Math.imul(al4, bh3)) | 0;\n    mid = (mid + Math.imul(ah4, bl3)) | 0;\n    hi = (hi + Math.imul(ah4, bh3)) | 0;\n    lo = (lo + Math.imul(al3, bl4)) | 0;\n    mid = (mid + Math.imul(al3, bh4)) | 0;\n    mid = (mid + Math.imul(ah3, bl4)) | 0;\n    hi = (hi + Math.imul(ah3, bh4)) | 0;\n    lo = (lo + Math.imul(al2, bl5)) | 0;\n    mid = (mid + Math.imul(al2, bh5)) | 0;\n    mid = (mid + Math.imul(ah2, bl5)) | 0;\n    hi = (hi + Math.imul(ah2, bh5)) | 0;\n    lo = (lo + Math.imul(al1, bl6)) | 0;\n    mid = (mid + Math.imul(al1, bh6)) | 0;\n    mid = (mid + Math.imul(ah1, bl6)) | 0;\n    hi = (hi + Math.imul(ah1, bh6)) | 0;\n    lo = (lo + Math.imul(al0, bl7)) | 0;\n    mid = (mid + Math.imul(al0, bh7)) | 0;\n    mid = (mid + Math.imul(ah0, bl7)) | 0;\n    hi = (hi + Math.imul(ah0, bh7)) | 0;\n    var w7 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w7 >>> 26)) | 0;\n    w7 &= 0x3ffffff;\n    /* k = 8 */\n    lo = Math.imul(al8, bl0);\n    mid = Math.imul(al8, bh0);\n    mid = (mid + Math.imul(ah8, bl0)) | 0;\n    hi = Math.imul(ah8, bh0);\n    lo = (lo + Math.imul(al7, bl1)) | 0;\n    mid = (mid + Math.imul(al7, bh1)) | 0;\n    mid = (mid + Math.imul(ah7, bl1)) | 0;\n    hi = (hi + Math.imul(ah7, bh1)) | 0;\n    lo = (lo + Math.imul(al6, bl2)) | 0;\n    mid = (mid + Math.imul(al6, bh2)) | 0;\n    mid = (mid + Math.imul(ah6, bl2)) | 0;\n    hi = (hi + Math.imul(ah6, bh2)) | 0;\n    lo = (lo + Math.imul(al5, bl3)) | 0;\n    mid = (mid + Math.imul(al5, bh3)) | 0;\n    mid = (mid + Math.imul(ah5, bl3)) | 0;\n    hi = (hi + Math.imul(ah5, bh3)) | 0;\n    lo = (lo + Math.imul(al4, bl4)) | 0;\n    mid = (mid + Math.imul(al4, bh4)) | 0;\n    mid = (mid + Math.imul(ah4, bl4)) | 0;\n    hi = (hi + Math.imul(ah4, bh4)) | 0;\n    lo = (lo + Math.imul(al3, bl5)) | 0;\n    mid = (mid + Math.imul(al3, bh5)) | 0;\n    mid = (mid + Math.imul(ah3, bl5)) | 0;\n    hi = (hi + Math.imul(ah3, bh5)) | 0;\n    lo = (lo + Math.imul(al2, bl6)) | 0;\n    mid = (mid + Math.imul(al2, bh6)) | 0;\n    mid = (mid + Math.imul(ah2, bl6)) | 0;\n    hi = (hi + Math.imul(ah2, bh6)) | 0;\n    lo = (lo + Math.imul(al1, bl7)) | 0;\n    mid = (mid + Math.imul(al1, bh7)) | 0;\n    mid = (mid + Math.imul(ah1, bl7)) | 0;\n    hi = (hi + Math.imul(ah1, bh7)) | 0;\n    lo = (lo + Math.imul(al0, bl8)) | 0;\n    mid = (mid + Math.imul(al0, bh8)) | 0;\n    mid = (mid + Math.imul(ah0, bl8)) | 0;\n    hi = (hi + Math.imul(ah0, bh8)) | 0;\n    var w8 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w8 >>> 26)) | 0;\n    w8 &= 0x3ffffff;\n    /* k = 9 */\n    lo = Math.imul(al9, bl0);\n    mid = Math.imul(al9, bh0);\n    mid = (mid + Math.imul(ah9, bl0)) | 0;\n    hi = Math.imul(ah9, bh0);\n    lo = (lo + Math.imul(al8, bl1)) | 0;\n    mid = (mid + Math.imul(al8, bh1)) | 0;\n    mid = (mid + Math.imul(ah8, bl1)) | 0;\n    hi = (hi + Math.imul(ah8, bh1)) | 0;\n    lo = (lo + Math.imul(al7, bl2)) | 0;\n    mid = (mid + Math.imul(al7, bh2)) | 0;\n    mid = (mid + Math.imul(ah7, bl2)) | 0;\n    hi = (hi + Math.imul(ah7, bh2)) | 0;\n    lo = (lo + Math.imul(al6, bl3)) | 0;\n    mid = (mid + Math.imul(al6, bh3)) | 0;\n    mid = (mid + Math.imul(ah6, bl3)) | 0;\n    hi = (hi + Math.imul(ah6, bh3)) | 0;\n    lo = (lo + Math.imul(al5, bl4)) | 0;\n    mid = (mid + Math.imul(al5, bh4)) | 0;\n    mid = (mid + Math.imul(ah5, bl4)) | 0;\n    hi = (hi + Math.imul(ah5, bh4)) | 0;\n    lo = (lo + Math.imul(al4, bl5)) | 0;\n    mid = (mid + Math.imul(al4, bh5)) | 0;\n    mid = (mid + Math.imul(ah4, bl5)) | 0;\n    hi = (hi + Math.imul(ah4, bh5)) | 0;\n    lo = (lo + Math.imul(al3, bl6)) | 0;\n    mid = (mid + Math.imul(al3, bh6)) | 0;\n    mid = (mid + Math.imul(ah3, bl6)) | 0;\n    hi = (hi + Math.imul(ah3, bh6)) | 0;\n    lo = (lo + Math.imul(al2, bl7)) | 0;\n    mid = (mid + Math.imul(al2, bh7)) | 0;\n    mid = (mid + Math.imul(ah2, bl7)) | 0;\n    hi = (hi + Math.imul(ah2, bh7)) | 0;\n    lo = (lo + Math.imul(al1, bl8)) | 0;\n    mid = (mid + Math.imul(al1, bh8)) | 0;\n    mid = (mid + Math.imul(ah1, bl8)) | 0;\n    hi = (hi + Math.imul(ah1, bh8)) | 0;\n    lo = (lo + Math.imul(al0, bl9)) | 0;\n    mid = (mid + Math.imul(al0, bh9)) | 0;\n    mid = (mid + Math.imul(ah0, bl9)) | 0;\n    hi = (hi + Math.imul(ah0, bh9)) | 0;\n    var w9 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w9 >>> 26)) | 0;\n    w9 &= 0x3ffffff;\n    /* k = 10 */\n    lo = Math.imul(al9, bl1);\n    mid = Math.imul(al9, bh1);\n    mid = (mid + Math.imul(ah9, bl1)) | 0;\n    hi = Math.imul(ah9, bh1);\n    lo = (lo + Math.imul(al8, bl2)) | 0;\n    mid = (mid + Math.imul(al8, bh2)) | 0;\n    mid = (mid + Math.imul(ah8, bl2)) | 0;\n    hi = (hi + Math.imul(ah8, bh2)) | 0;\n    lo = (lo + Math.imul(al7, bl3)) | 0;\n    mid = (mid + Math.imul(al7, bh3)) | 0;\n    mid = (mid + Math.imul(ah7, bl3)) | 0;\n    hi = (hi + Math.imul(ah7, bh3)) | 0;\n    lo = (lo + Math.imul(al6, bl4)) | 0;\n    mid = (mid + Math.imul(al6, bh4)) | 0;\n    mid = (mid + Math.imul(ah6, bl4)) | 0;\n    hi = (hi + Math.imul(ah6, bh4)) | 0;\n    lo = (lo + Math.imul(al5, bl5)) | 0;\n    mid = (mid + Math.imul(al5, bh5)) | 0;\n    mid = (mid + Math.imul(ah5, bl5)) | 0;\n    hi = (hi + Math.imul(ah5, bh5)) | 0;\n    lo = (lo + Math.imul(al4, bl6)) | 0;\n    mid = (mid + Math.imul(al4, bh6)) | 0;\n    mid = (mid + Math.imul(ah4, bl6)) | 0;\n    hi = (hi + Math.imul(ah4, bh6)) | 0;\n    lo = (lo + Math.imul(al3, bl7)) | 0;\n    mid = (mid + Math.imul(al3, bh7)) | 0;\n    mid = (mid + Math.imul(ah3, bl7)) | 0;\n    hi = (hi + Math.imul(ah3, bh7)) | 0;\n    lo = (lo + Math.imul(al2, bl8)) | 0;\n    mid = (mid + Math.imul(al2, bh8)) | 0;\n    mid = (mid + Math.imul(ah2, bl8)) | 0;\n    hi = (hi + Math.imul(ah2, bh8)) | 0;\n    lo = (lo + Math.imul(al1, bl9)) | 0;\n    mid = (mid + Math.imul(al1, bh9)) | 0;\n    mid = (mid + Math.imul(ah1, bl9)) | 0;\n    hi = (hi + Math.imul(ah1, bh9)) | 0;\n    var w10 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w10 >>> 26)) | 0;\n    w10 &= 0x3ffffff;\n    /* k = 11 */\n    lo = Math.imul(al9, bl2);\n    mid = Math.imul(al9, bh2);\n    mid = (mid + Math.imul(ah9, bl2)) | 0;\n    hi = Math.imul(ah9, bh2);\n    lo = (lo + Math.imul(al8, bl3)) | 0;\n    mid = (mid + Math.imul(al8, bh3)) | 0;\n    mid = (mid + Math.imul(ah8, bl3)) | 0;\n    hi = (hi + Math.imul(ah8, bh3)) | 0;\n    lo = (lo + Math.imul(al7, bl4)) | 0;\n    mid = (mid + Math.imul(al7, bh4)) | 0;\n    mid = (mid + Math.imul(ah7, bl4)) | 0;\n    hi = (hi + Math.imul(ah7, bh4)) | 0;\n    lo = (lo + Math.imul(al6, bl5)) | 0;\n    mid = (mid + Math.imul(al6, bh5)) | 0;\n    mid = (mid + Math.imul(ah6, bl5)) | 0;\n    hi = (hi + Math.imul(ah6, bh5)) | 0;\n    lo = (lo + Math.imul(al5, bl6)) | 0;\n    mid = (mid + Math.imul(al5, bh6)) | 0;\n    mid = (mid + Math.imul(ah5, bl6)) | 0;\n    hi = (hi + Math.imul(ah5, bh6)) | 0;\n    lo = (lo + Math.imul(al4, bl7)) | 0;\n    mid = (mid + Math.imul(al4, bh7)) | 0;\n    mid = (mid + Math.imul(ah4, bl7)) | 0;\n    hi = (hi + Math.imul(ah4, bh7)) | 0;\n    lo = (lo + Math.imul(al3, bl8)) | 0;\n    mid = (mid + Math.imul(al3, bh8)) | 0;\n    mid = (mid + Math.imul(ah3, bl8)) | 0;\n    hi = (hi + Math.imul(ah3, bh8)) | 0;\n    lo = (lo + Math.imul(al2, bl9)) | 0;\n    mid = (mid + Math.imul(al2, bh9)) | 0;\n    mid = (mid + Math.imul(ah2, bl9)) | 0;\n    hi = (hi + Math.imul(ah2, bh9)) | 0;\n    var w11 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w11 >>> 26)) | 0;\n    w11 &= 0x3ffffff;\n    /* k = 12 */\n    lo = Math.imul(al9, bl3);\n    mid = Math.imul(al9, bh3);\n    mid = (mid + Math.imul(ah9, bl3)) | 0;\n    hi = Math.imul(ah9, bh3);\n    lo = (lo + Math.imul(al8, bl4)) | 0;\n    mid = (mid + Math.imul(al8, bh4)) | 0;\n    mid = (mid + Math.imul(ah8, bl4)) | 0;\n    hi = (hi + Math.imul(ah8, bh4)) | 0;\n    lo = (lo + Math.imul(al7, bl5)) | 0;\n    mid = (mid + Math.imul(al7, bh5)) | 0;\n    mid = (mid + Math.imul(ah7, bl5)) | 0;\n    hi = (hi + Math.imul(ah7, bh5)) | 0;\n    lo = (lo + Math.imul(al6, bl6)) | 0;\n    mid = (mid + Math.imul(al6, bh6)) | 0;\n    mid = (mid + Math.imul(ah6, bl6)) | 0;\n    hi = (hi + Math.imul(ah6, bh6)) | 0;\n    lo = (lo + Math.imul(al5, bl7)) | 0;\n    mid = (mid + Math.imul(al5, bh7)) | 0;\n    mid = (mid + Math.imul(ah5, bl7)) | 0;\n    hi = (hi + Math.imul(ah5, bh7)) | 0;\n    lo = (lo + Math.imul(al4, bl8)) | 0;\n    mid = (mid + Math.imul(al4, bh8)) | 0;\n    mid = (mid + Math.imul(ah4, bl8)) | 0;\n    hi = (hi + Math.imul(ah4, bh8)) | 0;\n    lo = (lo + Math.imul(al3, bl9)) | 0;\n    mid = (mid + Math.imul(al3, bh9)) | 0;\n    mid = (mid + Math.imul(ah3, bl9)) | 0;\n    hi = (hi + Math.imul(ah3, bh9)) | 0;\n    var w12 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w12 >>> 26)) | 0;\n    w12 &= 0x3ffffff;\n    /* k = 13 */\n    lo = Math.imul(al9, bl4);\n    mid = Math.imul(al9, bh4);\n    mid = (mid + Math.imul(ah9, bl4)) | 0;\n    hi = Math.imul(ah9, bh4);\n    lo = (lo + Math.imul(al8, bl5)) | 0;\n    mid = (mid + Math.imul(al8, bh5)) | 0;\n    mid = (mid + Math.imul(ah8, bl5)) | 0;\n    hi = (hi + Math.imul(ah8, bh5)) | 0;\n    lo = (lo + Math.imul(al7, bl6)) | 0;\n    mid = (mid + Math.imul(al7, bh6)) | 0;\n    mid = (mid + Math.imul(ah7, bl6)) | 0;\n    hi = (hi + Math.imul(ah7, bh6)) | 0;\n    lo = (lo + Math.imul(al6, bl7)) | 0;\n    mid = (mid + Math.imul(al6, bh7)) | 0;\n    mid = (mid + Math.imul(ah6, bl7)) | 0;\n    hi = (hi + Math.imul(ah6, bh7)) | 0;\n    lo = (lo + Math.imul(al5, bl8)) | 0;\n    mid = (mid + Math.imul(al5, bh8)) | 0;\n    mid = (mid + Math.imul(ah5, bl8)) | 0;\n    hi = (hi + Math.imul(ah5, bh8)) | 0;\n    lo = (lo + Math.imul(al4, bl9)) | 0;\n    mid = (mid + Math.imul(al4, bh9)) | 0;\n    mid = (mid + Math.imul(ah4, bl9)) | 0;\n    hi = (hi + Math.imul(ah4, bh9)) | 0;\n    var w13 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w13 >>> 26)) | 0;\n    w13 &= 0x3ffffff;\n    /* k = 14 */\n    lo = Math.imul(al9, bl5);\n    mid = Math.imul(al9, bh5);\n    mid = (mid + Math.imul(ah9, bl5)) | 0;\n    hi = Math.imul(ah9, bh5);\n    lo = (lo + Math.imul(al8, bl6)) | 0;\n    mid = (mid + Math.imul(al8, bh6)) | 0;\n    mid = (mid + Math.imul(ah8, bl6)) | 0;\n    hi = (hi + Math.imul(ah8, bh6)) | 0;\n    lo = (lo + Math.imul(al7, bl7)) | 0;\n    mid = (mid + Math.imul(al7, bh7)) | 0;\n    mid = (mid + Math.imul(ah7, bl7)) | 0;\n    hi = (hi + Math.imul(ah7, bh7)) | 0;\n    lo = (lo + Math.imul(al6, bl8)) | 0;\n    mid = (mid + Math.imul(al6, bh8)) | 0;\n    mid = (mid + Math.imul(ah6, bl8)) | 0;\n    hi = (hi + Math.imul(ah6, bh8)) | 0;\n    lo = (lo + Math.imul(al5, bl9)) | 0;\n    mid = (mid + Math.imul(al5, bh9)) | 0;\n    mid = (mid + Math.imul(ah5, bl9)) | 0;\n    hi = (hi + Math.imul(ah5, bh9)) | 0;\n    var w14 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w14 >>> 26)) | 0;\n    w14 &= 0x3ffffff;\n    /* k = 15 */\n    lo = Math.imul(al9, bl6);\n    mid = Math.imul(al9, bh6);\n    mid = (mid + Math.imul(ah9, bl6)) | 0;\n    hi = Math.imul(ah9, bh6);\n    lo = (lo + Math.imul(al8, bl7)) | 0;\n    mid = (mid + Math.imul(al8, bh7)) | 0;\n    mid = (mid + Math.imul(ah8, bl7)) | 0;\n    hi = (hi + Math.imul(ah8, bh7)) | 0;\n    lo = (lo + Math.imul(al7, bl8)) | 0;\n    mid = (mid + Math.imul(al7, bh8)) | 0;\n    mid = (mid + Math.imul(ah7, bl8)) | 0;\n    hi = (hi + Math.imul(ah7, bh8)) | 0;\n    lo = (lo + Math.imul(al6, bl9)) | 0;\n    mid = (mid + Math.imul(al6, bh9)) | 0;\n    mid = (mid + Math.imul(ah6, bl9)) | 0;\n    hi = (hi + Math.imul(ah6, bh9)) | 0;\n    var w15 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w15 >>> 26)) | 0;\n    w15 &= 0x3ffffff;\n    /* k = 16 */\n    lo = Math.imul(al9, bl7);\n    mid = Math.imul(al9, bh7);\n    mid = (mid + Math.imul(ah9, bl7)) | 0;\n    hi = Math.imul(ah9, bh7);\n    lo = (lo + Math.imul(al8, bl8)) | 0;\n    mid = (mid + Math.imul(al8, bh8)) | 0;\n    mid = (mid + Math.imul(ah8, bl8)) | 0;\n    hi = (hi + Math.imul(ah8, bh8)) | 0;\n    lo = (lo + Math.imul(al7, bl9)) | 0;\n    mid = (mid + Math.imul(al7, bh9)) | 0;\n    mid = (mid + Math.imul(ah7, bl9)) | 0;\n    hi = (hi + Math.imul(ah7, bh9)) | 0;\n    var w16 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w16 >>> 26)) | 0;\n    w16 &= 0x3ffffff;\n    /* k = 17 */\n    lo = Math.imul(al9, bl8);\n    mid = Math.imul(al9, bh8);\n    mid = (mid + Math.imul(ah9, bl8)) | 0;\n    hi = Math.imul(ah9, bh8);\n    lo = (lo + Math.imul(al8, bl9)) | 0;\n    mid = (mid + Math.imul(al8, bh9)) | 0;\n    mid = (mid + Math.imul(ah8, bl9)) | 0;\n    hi = (hi + Math.imul(ah8, bh9)) | 0;\n    var w17 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w17 >>> 26)) | 0;\n    w17 &= 0x3ffffff;\n    /* k = 18 */\n    lo = Math.imul(al9, bl9);\n    mid = Math.imul(al9, bh9);\n    mid = (mid + Math.imul(ah9, bl9)) | 0;\n    hi = Math.imul(ah9, bh9);\n    var w18 = (((c + lo) | 0) + ((mid & 0x1fff) << 13)) | 0;\n    c = (((hi + (mid >>> 13)) | 0) + (w18 >>> 26)) | 0;\n    w18 &= 0x3ffffff;\n    o[0] = w0;\n    o[1] = w1;\n    o[2] = w2;\n    o[3] = w3;\n    o[4] = w4;\n    o[5] = w5;\n    o[6] = w6;\n    o[7] = w7;\n    o[8] = w8;\n    o[9] = w9;\n    o[10] = w10;\n    o[11] = w11;\n    o[12] = w12;\n    o[13] = w13;\n    o[14] = w14;\n    o[15] = w15;\n    o[16] = w16;\n    o[17] = w17;\n    o[18] = w18;\n    if (c !== 0) {\n      o[19] = c;\n      out.length++;\n    }\n    return out;\n  };\n\n  // Polyfill comb\n  if (!Math.imul) {\n    comb10MulTo = smallMulTo;\n  }\n\n  function bigMulTo (self, num, out) {\n    out.negative = num.negative ^ self.negative;\n    out.length = self.length + num.length;\n\n    var carry = 0;\n    var hncarry = 0;\n    for (var k = 0; k < out.length - 1; k++) {\n      // Sum all words with the same `i + j = k` and accumulate `ncarry`,\n      // note that ncarry could be >= 0x3ffffff\n      var ncarry = hncarry;\n      hncarry = 0;\n      var rword = carry & 0x3ffffff;\n      var maxJ = Math.min(k, num.length - 1);\n      for (var j = Math.max(0, k - self.length + 1); j <= maxJ; j++) {\n        var i = k - j;\n        var a = self.words[i] | 0;\n        var b = num.words[j] | 0;\n        var r = a * b;\n\n        var lo = r & 0x3ffffff;\n        ncarry = (ncarry + ((r / 0x4000000) | 0)) | 0;\n        lo = (lo + rword) | 0;\n        rword = lo & 0x3ffffff;\n        ncarry = (ncarry + (lo >>> 26)) | 0;\n\n        hncarry += ncarry >>> 26;\n        ncarry &= 0x3ffffff;\n      }\n      out.words[k] = rword;\n      carry = ncarry;\n      ncarry = hncarry;\n    }\n    if (carry !== 0) {\n      out.words[k] = carry;\n    } else {\n      out.length--;\n    }\n\n    return out.strip();\n  }\n\n  function jumboMulTo (self, num, out) {\n    var fftm = new FFTM();\n    return fftm.mulp(self, num, out);\n  }\n\n  BN.prototype.mulTo = function mulTo (num, out) {\n    var res;\n    var len = this.length + num.length;\n    if (this.length === 10 && num.length === 10) {\n      res = comb10MulTo(this, num, out);\n    } else if (len < 63) {\n      res = smallMulTo(this, num, out);\n    } else if (len < 1024) {\n      res = bigMulTo(this, num, out);\n    } else {\n      res = jumboMulTo(this, num, out);\n    }\n\n    return res;\n  };\n\n  // Cooley-Tukey algorithm for FFT\n  // slightly revisited to rely on looping instead of recursion\n\n  function FFTM (x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  FFTM.prototype.makeRBT = function makeRBT (N) {\n    var t = new Array(N);\n    var l = BN.prototype._countBits(N) - 1;\n    for (var i = 0; i < N; i++) {\n      t[i] = this.revBin(i, l, N);\n    }\n\n    return t;\n  };\n\n  // Returns binary-reversed representation of `x`\n  FFTM.prototype.revBin = function revBin (x, l, N) {\n    if (x === 0 || x === N - 1) return x;\n\n    var rb = 0;\n    for (var i = 0; i < l; i++) {\n      rb |= (x & 1) << (l - i - 1);\n      x >>= 1;\n    }\n\n    return rb;\n  };\n\n  // Performs \"tweedling\" phase, therefore 'emulating'\n  // behaviour of the recursive algorithm\n  FFTM.prototype.permute = function permute (rbt, rws, iws, rtws, itws, N) {\n    for (var i = 0; i < N; i++) {\n      rtws[i] = rws[rbt[i]];\n      itws[i] = iws[rbt[i]];\n    }\n  };\n\n  FFTM.prototype.transform = function transform (rws, iws, rtws, itws, N, rbt) {\n    this.permute(rbt, rws, iws, rtws, itws, N);\n\n    for (var s = 1; s < N; s <<= 1) {\n      var l = s << 1;\n\n      var rtwdf = Math.cos(2 * Math.PI / l);\n      var itwdf = Math.sin(2 * Math.PI / l);\n\n      for (var p = 0; p < N; p += l) {\n        var rtwdf_ = rtwdf;\n        var itwdf_ = itwdf;\n\n        for (var j = 0; j < s; j++) {\n          var re = rtws[p + j];\n          var ie = itws[p + j];\n\n          var ro = rtws[p + j + s];\n          var io = itws[p + j + s];\n\n          var rx = rtwdf_ * ro - itwdf_ * io;\n\n          io = rtwdf_ * io + itwdf_ * ro;\n          ro = rx;\n\n          rtws[p + j] = re + ro;\n          itws[p + j] = ie + io;\n\n          rtws[p + j + s] = re - ro;\n          itws[p + j + s] = ie - io;\n\n          /* jshint maxdepth : false */\n          if (j !== l) {\n            rx = rtwdf * rtwdf_ - itwdf * itwdf_;\n\n            itwdf_ = rtwdf * itwdf_ + itwdf * rtwdf_;\n            rtwdf_ = rx;\n          }\n        }\n      }\n    }\n  };\n\n  FFTM.prototype.guessLen13b = function guessLen13b (n, m) {\n    var N = Math.max(m, n) | 1;\n    var odd = N & 1;\n    var i = 0;\n    for (N = N / 2 | 0; N; N = N >>> 1) {\n      i++;\n    }\n\n    return 1 << i + 1 + odd;\n  };\n\n  FFTM.prototype.conjugate = function conjugate (rws, iws, N) {\n    if (N <= 1) return;\n\n    for (var i = 0; i < N / 2; i++) {\n      var t = rws[i];\n\n      rws[i] = rws[N - i - 1];\n      rws[N - i - 1] = t;\n\n      t = iws[i];\n\n      iws[i] = -iws[N - i - 1];\n      iws[N - i - 1] = -t;\n    }\n  };\n\n  FFTM.prototype.normalize13b = function normalize13b (ws, N) {\n    var carry = 0;\n    for (var i = 0; i < N / 2; i++) {\n      var w = Math.round(ws[2 * i + 1] / N) * 0x2000 +\n        Math.round(ws[2 * i] / N) +\n        carry;\n\n      ws[i] = w & 0x3ffffff;\n\n      if (w < 0x4000000) {\n        carry = 0;\n      } else {\n        carry = w / 0x4000000 | 0;\n      }\n    }\n\n    return ws;\n  };\n\n  FFTM.prototype.convert13b = function convert13b (ws, len, rws, N) {\n    var carry = 0;\n    for (var i = 0; i < len; i++) {\n      carry = carry + (ws[i] | 0);\n\n      rws[2 * i] = carry & 0x1fff; carry = carry >>> 13;\n      rws[2 * i + 1] = carry & 0x1fff; carry = carry >>> 13;\n    }\n\n    // Pad with zeroes\n    for (i = 2 * len; i < N; ++i) {\n      rws[i] = 0;\n    }\n\n    assert(carry === 0);\n    assert((carry & ~0x1fff) === 0);\n  };\n\n  FFTM.prototype.stub = function stub (N) {\n    var ph = new Array(N);\n    for (var i = 0; i < N; i++) {\n      ph[i] = 0;\n    }\n\n    return ph;\n  };\n\n  FFTM.prototype.mulp = function mulp (x, y, out) {\n    var N = 2 * this.guessLen13b(x.length, y.length);\n\n    var rbt = this.makeRBT(N);\n\n    var _ = this.stub(N);\n\n    var rws = new Array(N);\n    var rwst = new Array(N);\n    var iwst = new Array(N);\n\n    var nrws = new Array(N);\n    var nrwst = new Array(N);\n    var niwst = new Array(N);\n\n    var rmws = out.words;\n    rmws.length = N;\n\n    this.convert13b(x.words, x.length, rws, N);\n    this.convert13b(y.words, y.length, nrws, N);\n\n    this.transform(rws, _, rwst, iwst, N, rbt);\n    this.transform(nrws, _, nrwst, niwst, N, rbt);\n\n    for (var i = 0; i < N; i++) {\n      var rx = rwst[i] * nrwst[i] - iwst[i] * niwst[i];\n      iwst[i] = rwst[i] * niwst[i] + iwst[i] * nrwst[i];\n      rwst[i] = rx;\n    }\n\n    this.conjugate(rwst, iwst, N);\n    this.transform(rwst, iwst, rmws, _, N, rbt);\n    this.conjugate(rmws, _, N);\n    this.normalize13b(rmws, N);\n\n    out.negative = x.negative ^ y.negative;\n    out.length = x.length + y.length;\n    return out.strip();\n  };\n\n  // Multiply `this` by `num`\n  BN.prototype.mul = function mul (num) {\n    var out = new BN(null);\n    out.words = new Array(this.length + num.length);\n    return this.mulTo(num, out);\n  };\n\n  // Multiply employing FFT\n  BN.prototype.mulf = function mulf (num) {\n    var out = new BN(null);\n    out.words = new Array(this.length + num.length);\n    return jumboMulTo(this, num, out);\n  };\n\n  // In-place Multiplication\n  BN.prototype.imul = function imul (num) {\n    return this.clone().mulTo(num, this);\n  };\n\n  BN.prototype.imuln = function imuln (num) {\n    assert(typeof num === 'number');\n    assert(num < 0x4000000);\n\n    // Carry\n    var carry = 0;\n    for (var i = 0; i < this.length; i++) {\n      var w = (this.words[i] | 0) * num;\n      var lo = (w & 0x3ffffff) + (carry & 0x3ffffff);\n      carry >>= 26;\n      carry += (w / 0x4000000) | 0;\n      // NOTE: lo is 27bit maximum\n      carry += lo >>> 26;\n      this.words[i] = lo & 0x3ffffff;\n    }\n\n    if (carry !== 0) {\n      this.words[i] = carry;\n      this.length++;\n    }\n\n    return this;\n  };\n\n  BN.prototype.muln = function muln (num) {\n    return this.clone().imuln(num);\n  };\n\n  // `this` * `this`\n  BN.prototype.sqr = function sqr () {\n    return this.mul(this);\n  };\n\n  // `this` * `this` in-place\n  BN.prototype.isqr = function isqr () {\n    return this.imul(this.clone());\n  };\n\n  // Math.pow(`this`, `num`)\n  BN.prototype.pow = function pow (num) {\n    var w = toBitArray(num);\n    if (w.length === 0) return new BN(1);\n\n    // Skip leading zeroes\n    var res = this;\n    for (var i = 0; i < w.length; i++, res = res.sqr()) {\n      if (w[i] !== 0) break;\n    }\n\n    if (++i < w.length) {\n      for (var q = res.sqr(); i < w.length; i++, q = q.sqr()) {\n        if (w[i] === 0) continue;\n\n        res = res.mul(q);\n      }\n    }\n\n    return res;\n  };\n\n  // Shift-left in-place\n  BN.prototype.iushln = function iushln (bits) {\n    assert(typeof bits === 'number' && bits >= 0);\n    var r = bits % 26;\n    var s = (bits - r) / 26;\n    var carryMask = (0x3ffffff >>> (26 - r)) << (26 - r);\n    var i;\n\n    if (r !== 0) {\n      var carry = 0;\n\n      for (i = 0; i < this.length; i++) {\n        var newCarry = this.words[i] & carryMask;\n        var c = ((this.words[i] | 0) - newCarry) << r;\n        this.words[i] = c | carry;\n        carry = newCarry >>> (26 - r);\n      }\n\n      if (carry) {\n        this.words[i] = carry;\n        this.length++;\n      }\n    }\n\n    if (s !== 0) {\n      for (i = this.length - 1; i >= 0; i--) {\n        this.words[i + s] = this.words[i];\n      }\n\n      for (i = 0; i < s; i++) {\n        this.words[i] = 0;\n      }\n\n      this.length += s;\n    }\n\n    return this.strip();\n  };\n\n  BN.prototype.ishln = function ishln (bits) {\n    // TODO(indutny): implement me\n    assert(this.negative === 0);\n    return this.iushln(bits);\n  };\n\n  // Shift-right in-place\n  // NOTE: `hint` is a lowest bit before trailing zeroes\n  // NOTE: if `extended` is present - it will be filled with destroyed bits\n  BN.prototype.iushrn = function iushrn (bits, hint, extended) {\n    assert(typeof bits === 'number' && bits >= 0);\n    var h;\n    if (hint) {\n      h = (hint - (hint % 26)) / 26;\n    } else {\n      h = 0;\n    }\n\n    var r = bits % 26;\n    var s = Math.min((bits - r) / 26, this.length);\n    var mask = 0x3ffffff ^ ((0x3ffffff >>> r) << r);\n    var maskedWords = extended;\n\n    h -= s;\n    h = Math.max(0, h);\n\n    // Extended mode, copy masked part\n    if (maskedWords) {\n      for (var i = 0; i < s; i++) {\n        maskedWords.words[i] = this.words[i];\n      }\n      maskedWords.length = s;\n    }\n\n    if (s === 0) {\n      // No-op, we should not move anything at all\n    } else if (this.length > s) {\n      this.length -= s;\n      for (i = 0; i < this.length; i++) {\n        this.words[i] = this.words[i + s];\n      }\n    } else {\n      this.words[0] = 0;\n      this.length = 1;\n    }\n\n    var carry = 0;\n    for (i = this.length - 1; i >= 0 && (carry !== 0 || i >= h); i--) {\n      var word = this.words[i] | 0;\n      this.words[i] = (carry << (26 - r)) | (word >>> r);\n      carry = word & mask;\n    }\n\n    // Push carried bits as a mask\n    if (maskedWords && carry !== 0) {\n      maskedWords.words[maskedWords.length++] = carry;\n    }\n\n    if (this.length === 0) {\n      this.words[0] = 0;\n      this.length = 1;\n    }\n\n    return this.strip();\n  };\n\n  BN.prototype.ishrn = function ishrn (bits, hint, extended) {\n    // TODO(indutny): implement me\n    assert(this.negative === 0);\n    return this.iushrn(bits, hint, extended);\n  };\n\n  // Shift-left\n  BN.prototype.shln = function shln (bits) {\n    return this.clone().ishln(bits);\n  };\n\n  BN.prototype.ushln = function ushln (bits) {\n    return this.clone().iushln(bits);\n  };\n\n  // Shift-right\n  BN.prototype.shrn = function shrn (bits) {\n    return this.clone().ishrn(bits);\n  };\n\n  BN.prototype.ushrn = function ushrn (bits) {\n    return this.clone().iushrn(bits);\n  };\n\n  // Test if n bit is set\n  BN.prototype.testn = function testn (bit) {\n    assert(typeof bit === 'number' && bit >= 0);\n    var r = bit % 26;\n    var s = (bit - r) / 26;\n    var q = 1 << r;\n\n    // Fast case: bit is much higher than all existing words\n    if (this.length <= s) return false;\n\n    // Check bit and return\n    var w = this.words[s];\n\n    return !!(w & q);\n  };\n\n  // Return only lowers bits of number (in-place)\n  BN.prototype.imaskn = function imaskn (bits) {\n    assert(typeof bits === 'number' && bits >= 0);\n    var r = bits % 26;\n    var s = (bits - r) / 26;\n\n    assert(this.negative === 0, 'imaskn works only with positive numbers');\n\n    if (this.length <= s) {\n      return this;\n    }\n\n    if (r !== 0) {\n      s++;\n    }\n    this.length = Math.min(s, this.length);\n\n    if (r !== 0) {\n      var mask = 0x3ffffff ^ ((0x3ffffff >>> r) << r);\n      this.words[this.length - 1] &= mask;\n    }\n\n    return this.strip();\n  };\n\n  // Return only lowers bits of number\n  BN.prototype.maskn = function maskn (bits) {\n    return this.clone().imaskn(bits);\n  };\n\n  // Add plain number `num` to `this`\n  BN.prototype.iaddn = function iaddn (num) {\n    assert(typeof num === 'number');\n    assert(num < 0x4000000);\n    if (num < 0) return this.isubn(-num);\n\n    // Possible sign change\n    if (this.negative !== 0) {\n      if (this.length === 1 && (this.words[0] | 0) < num) {\n        this.words[0] = num - (this.words[0] | 0);\n        this.negative = 0;\n        return this;\n      }\n\n      this.negative = 0;\n      this.isubn(num);\n      this.negative = 1;\n      return this;\n    }\n\n    // Add without checks\n    return this._iaddn(num);\n  };\n\n  BN.prototype._iaddn = function _iaddn (num) {\n    this.words[0] += num;\n\n    // Carry\n    for (var i = 0; i < this.length && this.words[i] >= 0x4000000; i++) {\n      this.words[i] -= 0x4000000;\n      if (i === this.length - 1) {\n        this.words[i + 1] = 1;\n      } else {\n        this.words[i + 1]++;\n      }\n    }\n    this.length = Math.max(this.length, i + 1);\n\n    return this;\n  };\n\n  // Subtract plain number `num` from `this`\n  BN.prototype.isubn = function isubn (num) {\n    assert(typeof num === 'number');\n    assert(num < 0x4000000);\n    if (num < 0) return this.iaddn(-num);\n\n    if (this.negative !== 0) {\n      this.negative = 0;\n      this.iaddn(num);\n      this.negative = 1;\n      return this;\n    }\n\n    this.words[0] -= num;\n\n    if (this.length === 1 && this.words[0] < 0) {\n      this.words[0] = -this.words[0];\n      this.negative = 1;\n    } else {\n      // Carry\n      for (var i = 0; i < this.length && this.words[i] < 0; i++) {\n        this.words[i] += 0x4000000;\n        this.words[i + 1] -= 1;\n      }\n    }\n\n    return this.strip();\n  };\n\n  BN.prototype.addn = function addn (num) {\n    return this.clone().iaddn(num);\n  };\n\n  BN.prototype.subn = function subn (num) {\n    return this.clone().isubn(num);\n  };\n\n  BN.prototype.iabs = function iabs () {\n    this.negative = 0;\n\n    return this;\n  };\n\n  BN.prototype.abs = function abs () {\n    return this.clone().iabs();\n  };\n\n  BN.prototype._ishlnsubmul = function _ishlnsubmul (num, mul, shift) {\n    var len = num.length + shift;\n    var i;\n\n    this._expand(len);\n\n    var w;\n    var carry = 0;\n    for (i = 0; i < num.length; i++) {\n      w = (this.words[i + shift] | 0) + carry;\n      var right = (num.words[i] | 0) * mul;\n      w -= right & 0x3ffffff;\n      carry = (w >> 26) - ((right / 0x4000000) | 0);\n      this.words[i + shift] = w & 0x3ffffff;\n    }\n    for (; i < this.length - shift; i++) {\n      w = (this.words[i + shift] | 0) + carry;\n      carry = w >> 26;\n      this.words[i + shift] = w & 0x3ffffff;\n    }\n\n    if (carry === 0) return this.strip();\n\n    // Subtraction overflow\n    assert(carry === -1);\n    carry = 0;\n    for (i = 0; i < this.length; i++) {\n      w = -(this.words[i] | 0) + carry;\n      carry = w >> 26;\n      this.words[i] = w & 0x3ffffff;\n    }\n    this.negative = 1;\n\n    return this.strip();\n  };\n\n  BN.prototype._wordDiv = function _wordDiv (num, mode) {\n    var shift = this.length - num.length;\n\n    var a = this.clone();\n    var b = num;\n\n    // Normalize\n    var bhi = b.words[b.length - 1] | 0;\n    var bhiBits = this._countBits(bhi);\n    shift = 26 - bhiBits;\n    if (shift !== 0) {\n      b = b.ushln(shift);\n      a.iushln(shift);\n      bhi = b.words[b.length - 1] | 0;\n    }\n\n    // Initialize quotient\n    var m = a.length - b.length;\n    var q;\n\n    if (mode !== 'mod') {\n      q = new BN(null);\n      q.length = m + 1;\n      q.words = new Array(q.length);\n      for (var i = 0; i < q.length; i++) {\n        q.words[i] = 0;\n      }\n    }\n\n    var diff = a.clone()._ishlnsubmul(b, 1, m);\n    if (diff.negative === 0) {\n      a = diff;\n      if (q) {\n        q.words[m] = 1;\n      }\n    }\n\n    for (var j = m - 1; j >= 0; j--) {\n      var qj = (a.words[b.length + j] | 0) * 0x4000000 +\n        (a.words[b.length + j - 1] | 0);\n\n      // NOTE: (qj / bhi) is (0x3ffffff * 0x4000000 + 0x3ffffff) / 0x2000000 max\n      // (0x7ffffff)\n      qj = Math.min((qj / bhi) | 0, 0x3ffffff);\n\n      a._ishlnsubmul(b, qj, j);\n      while (a.negative !== 0) {\n        qj--;\n        a.negative = 0;\n        a._ishlnsubmul(b, 1, j);\n        if (!a.isZero()) {\n          a.negative ^= 1;\n        }\n      }\n      if (q) {\n        q.words[j] = qj;\n      }\n    }\n    if (q) {\n      q.strip();\n    }\n    a.strip();\n\n    // Denormalize\n    if (mode !== 'div' && shift !== 0) {\n      a.iushrn(shift);\n    }\n\n    return {\n      div: q || null,\n      mod: a\n    };\n  };\n\n  // NOTE: 1) `mode` can be set to `mod` to request mod only,\n  //       to `div` to request div only, or be absent to\n  //       request both div & mod\n  //       2) `positive` is true if unsigned mod is requested\n  BN.prototype.divmod = function divmod (num, mode, positive) {\n    assert(!num.isZero());\n\n    if (this.isZero()) {\n      return {\n        div: new BN(0),\n        mod: new BN(0)\n      };\n    }\n\n    var div, mod, res;\n    if (this.negative !== 0 && num.negative === 0) {\n      res = this.neg().divmod(num, mode);\n\n      if (mode !== 'mod') {\n        div = res.div.neg();\n      }\n\n      if (mode !== 'div') {\n        mod = res.mod.neg();\n        if (positive && mod.negative !== 0) {\n          mod.iadd(num);\n        }\n      }\n\n      return {\n        div: div,\n        mod: mod\n      };\n    }\n\n    if (this.negative === 0 && num.negative !== 0) {\n      res = this.divmod(num.neg(), mode);\n\n      if (mode !== 'mod') {\n        div = res.div.neg();\n      }\n\n      return {\n        div: div,\n        mod: res.mod\n      };\n    }\n\n    if ((this.negative & num.negative) !== 0) {\n      res = this.neg().divmod(num.neg(), mode);\n\n      if (mode !== 'div') {\n        mod = res.mod.neg();\n        if (positive && mod.negative !== 0) {\n          mod.isub(num);\n        }\n      }\n\n      return {\n        div: res.div,\n        mod: mod\n      };\n    }\n\n    // Both numbers are positive at this point\n\n    // Strip both numbers to approximate shift value\n    if (num.length > this.length || this.cmp(num) < 0) {\n      return {\n        div: new BN(0),\n        mod: this\n      };\n    }\n\n    // Very short reduction\n    if (num.length === 1) {\n      if (mode === 'div') {\n        return {\n          div: this.divn(num.words[0]),\n          mod: null\n        };\n      }\n\n      if (mode === 'mod') {\n        return {\n          div: null,\n          mod: new BN(this.modn(num.words[0]))\n        };\n      }\n\n      return {\n        div: this.divn(num.words[0]),\n        mod: new BN(this.modn(num.words[0]))\n      };\n    }\n\n    return this._wordDiv(num, mode);\n  };\n\n  // Find `this` / `num`\n  BN.prototype.div = function div (num) {\n    return this.divmod(num, 'div', false).div;\n  };\n\n  // Find `this` % `num`\n  BN.prototype.mod = function mod (num) {\n    return this.divmod(num, 'mod', false).mod;\n  };\n\n  BN.prototype.umod = function umod (num) {\n    return this.divmod(num, 'mod', true).mod;\n  };\n\n  // Find Round(`this` / `num`)\n  BN.prototype.divRound = function divRound (num) {\n    var dm = this.divmod(num);\n\n    // Fast case - exact division\n    if (dm.mod.isZero()) return dm.div;\n\n    var mod = dm.div.negative !== 0 ? dm.mod.isub(num) : dm.mod;\n\n    var half = num.ushrn(1);\n    var r2 = num.andln(1);\n    var cmp = mod.cmp(half);\n\n    // Round down\n    if (cmp < 0 || r2 === 1 && cmp === 0) return dm.div;\n\n    // Round up\n    return dm.div.negative !== 0 ? dm.div.isubn(1) : dm.div.iaddn(1);\n  };\n\n  BN.prototype.modn = function modn (num) {\n    assert(num <= 0x3ffffff);\n    var p = (1 << 26) % num;\n\n    var acc = 0;\n    for (var i = this.length - 1; i >= 0; i--) {\n      acc = (p * acc + (this.words[i] | 0)) % num;\n    }\n\n    return acc;\n  };\n\n  // In-place division by number\n  BN.prototype.idivn = function idivn (num) {\n    assert(num <= 0x3ffffff);\n\n    var carry = 0;\n    for (var i = this.length - 1; i >= 0; i--) {\n      var w = (this.words[i] | 0) + carry * 0x4000000;\n      this.words[i] = (w / num) | 0;\n      carry = w % num;\n    }\n\n    return this.strip();\n  };\n\n  BN.prototype.divn = function divn (num) {\n    return this.clone().idivn(num);\n  };\n\n  BN.prototype.egcd = function egcd (p) {\n    assert(p.negative === 0);\n    assert(!p.isZero());\n\n    var x = this;\n    var y = p.clone();\n\n    if (x.negative !== 0) {\n      x = x.umod(p);\n    } else {\n      x = x.clone();\n    }\n\n    // A * x + B * y = x\n    var A = new BN(1);\n    var B = new BN(0);\n\n    // C * x + D * y = y\n    var C = new BN(0);\n    var D = new BN(1);\n\n    var g = 0;\n\n    while (x.isEven() && y.isEven()) {\n      x.iushrn(1);\n      y.iushrn(1);\n      ++g;\n    }\n\n    var yp = y.clone();\n    var xp = x.clone();\n\n    while (!x.isZero()) {\n      for (var i = 0, im = 1; (x.words[0] & im) === 0 && i < 26; ++i, im <<= 1);\n      if (i > 0) {\n        x.iushrn(i);\n        while (i-- > 0) {\n          if (A.isOdd() || B.isOdd()) {\n            A.iadd(yp);\n            B.isub(xp);\n          }\n\n          A.iushrn(1);\n          B.iushrn(1);\n        }\n      }\n\n      for (var j = 0, jm = 1; (y.words[0] & jm) === 0 && j < 26; ++j, jm <<= 1);\n      if (j > 0) {\n        y.iushrn(j);\n        while (j-- > 0) {\n          if (C.isOdd() || D.isOdd()) {\n            C.iadd(yp);\n            D.isub(xp);\n          }\n\n          C.iushrn(1);\n          D.iushrn(1);\n        }\n      }\n\n      if (x.cmp(y) >= 0) {\n        x.isub(y);\n        A.isub(C);\n        B.isub(D);\n      } else {\n        y.isub(x);\n        C.isub(A);\n        D.isub(B);\n      }\n    }\n\n    return {\n      a: C,\n      b: D,\n      gcd: y.iushln(g)\n    };\n  };\n\n  // This is reduced incarnation of the binary EEA\n  // above, designated to invert members of the\n  // _prime_ fields F(p) at a maximal speed\n  BN.prototype._invmp = function _invmp (p) {\n    assert(p.negative === 0);\n    assert(!p.isZero());\n\n    var a = this;\n    var b = p.clone();\n\n    if (a.negative !== 0) {\n      a = a.umod(p);\n    } else {\n      a = a.clone();\n    }\n\n    var x1 = new BN(1);\n    var x2 = new BN(0);\n\n    var delta = b.clone();\n\n    while (a.cmpn(1) > 0 && b.cmpn(1) > 0) {\n      for (var i = 0, im = 1; (a.words[0] & im) === 0 && i < 26; ++i, im <<= 1);\n      if (i > 0) {\n        a.iushrn(i);\n        while (i-- > 0) {\n          if (x1.isOdd()) {\n            x1.iadd(delta);\n          }\n\n          x1.iushrn(1);\n        }\n      }\n\n      for (var j = 0, jm = 1; (b.words[0] & jm) === 0 && j < 26; ++j, jm <<= 1);\n      if (j > 0) {\n        b.iushrn(j);\n        while (j-- > 0) {\n          if (x2.isOdd()) {\n            x2.iadd(delta);\n          }\n\n          x2.iushrn(1);\n        }\n      }\n\n      if (a.cmp(b) >= 0) {\n        a.isub(b);\n        x1.isub(x2);\n      } else {\n        b.isub(a);\n        x2.isub(x1);\n      }\n    }\n\n    var res;\n    if (a.cmpn(1) === 0) {\n      res = x1;\n    } else {\n      res = x2;\n    }\n\n    if (res.cmpn(0) < 0) {\n      res.iadd(p);\n    }\n\n    return res;\n  };\n\n  BN.prototype.gcd = function gcd (num) {\n    if (this.isZero()) return num.abs();\n    if (num.isZero()) return this.abs();\n\n    var a = this.clone();\n    var b = num.clone();\n    a.negative = 0;\n    b.negative = 0;\n\n    // Remove common factor of two\n    for (var shift = 0; a.isEven() && b.isEven(); shift++) {\n      a.iushrn(1);\n      b.iushrn(1);\n    }\n\n    do {\n      while (a.isEven()) {\n        a.iushrn(1);\n      }\n      while (b.isEven()) {\n        b.iushrn(1);\n      }\n\n      var r = a.cmp(b);\n      if (r < 0) {\n        // Swap `a` and `b` to make `a` always bigger than `b`\n        var t = a;\n        a = b;\n        b = t;\n      } else if (r === 0 || b.cmpn(1) === 0) {\n        break;\n      }\n\n      a.isub(b);\n    } while (true);\n\n    return b.iushln(shift);\n  };\n\n  // Invert number in the field F(num)\n  BN.prototype.invm = function invm (num) {\n    return this.egcd(num).a.umod(num);\n  };\n\n  BN.prototype.isEven = function isEven () {\n    return (this.words[0] & 1) === 0;\n  };\n\n  BN.prototype.isOdd = function isOdd () {\n    return (this.words[0] & 1) === 1;\n  };\n\n  // And first word and num\n  BN.prototype.andln = function andln (num) {\n    return this.words[0] & num;\n  };\n\n  // Increment at the bit position in-line\n  BN.prototype.bincn = function bincn (bit) {\n    assert(typeof bit === 'number');\n    var r = bit % 26;\n    var s = (bit - r) / 26;\n    var q = 1 << r;\n\n    // Fast case: bit is much higher than all existing words\n    if (this.length <= s) {\n      this._expand(s + 1);\n      this.words[s] |= q;\n      return this;\n    }\n\n    // Add bit and propagate, if needed\n    var carry = q;\n    for (var i = s; carry !== 0 && i < this.length; i++) {\n      var w = this.words[i] | 0;\n      w += carry;\n      carry = w >>> 26;\n      w &= 0x3ffffff;\n      this.words[i] = w;\n    }\n    if (carry !== 0) {\n      this.words[i] = carry;\n      this.length++;\n    }\n    return this;\n  };\n\n  BN.prototype.isZero = function isZero () {\n    return this.length === 1 && this.words[0] === 0;\n  };\n\n  BN.prototype.cmpn = function cmpn (num) {\n    var negative = num < 0;\n\n    if (this.negative !== 0 && !negative) return -1;\n    if (this.negative === 0 && negative) return 1;\n\n    this.strip();\n\n    var res;\n    if (this.length > 1) {\n      res = 1;\n    } else {\n      if (negative) {\n        num = -num;\n      }\n\n      assert(num <= 0x3ffffff, 'Number is too big');\n\n      var w = this.words[0] | 0;\n      res = w === num ? 0 : w < num ? -1 : 1;\n    }\n    if (this.negative !== 0) return -res | 0;\n    return res;\n  };\n\n  // Compare two numbers and return:\n  // 1 - if `this` > `num`\n  // 0 - if `this` == `num`\n  // -1 - if `this` < `num`\n  BN.prototype.cmp = function cmp (num) {\n    if (this.negative !== 0 && num.negative === 0) return -1;\n    if (this.negative === 0 && num.negative !== 0) return 1;\n\n    var res = this.ucmp(num);\n    if (this.negative !== 0) return -res | 0;\n    return res;\n  };\n\n  // Unsigned comparison\n  BN.prototype.ucmp = function ucmp (num) {\n    // At this point both numbers have the same sign\n    if (this.length > num.length) return 1;\n    if (this.length < num.length) return -1;\n\n    var res = 0;\n    for (var i = this.length - 1; i >= 0; i--) {\n      var a = this.words[i] | 0;\n      var b = num.words[i] | 0;\n\n      if (a === b) continue;\n      if (a < b) {\n        res = -1;\n      } else if (a > b) {\n        res = 1;\n      }\n      break;\n    }\n    return res;\n  };\n\n  BN.prototype.gtn = function gtn (num) {\n    return this.cmpn(num) === 1;\n  };\n\n  BN.prototype.gt = function gt (num) {\n    return this.cmp(num) === 1;\n  };\n\n  BN.prototype.gten = function gten (num) {\n    return this.cmpn(num) >= 0;\n  };\n\n  BN.prototype.gte = function gte (num) {\n    return this.cmp(num) >= 0;\n  };\n\n  BN.prototype.ltn = function ltn (num) {\n    return this.cmpn(num) === -1;\n  };\n\n  BN.prototype.lt = function lt (num) {\n    return this.cmp(num) === -1;\n  };\n\n  BN.prototype.lten = function lten (num) {\n    return this.cmpn(num) <= 0;\n  };\n\n  BN.prototype.lte = function lte (num) {\n    return this.cmp(num) <= 0;\n  };\n\n  BN.prototype.eqn = function eqn (num) {\n    return this.cmpn(num) === 0;\n  };\n\n  BN.prototype.eq = function eq (num) {\n    return this.cmp(num) === 0;\n  };\n\n  //\n  // A reduce context, could be using montgomery or something better, depending\n  // on the `m` itself.\n  //\n  BN.red = function red (num) {\n    return new Red(num);\n  };\n\n  BN.prototype.toRed = function toRed (ctx) {\n    assert(!this.red, 'Already a number in reduction context');\n    assert(this.negative === 0, 'red works only with positives');\n    return ctx.convertTo(this)._forceRed(ctx);\n  };\n\n  BN.prototype.fromRed = function fromRed () {\n    assert(this.red, 'fromRed works only with numbers in reduction context');\n    return this.red.convertFrom(this);\n  };\n\n  BN.prototype._forceRed = function _forceRed (ctx) {\n    this.red = ctx;\n    return this;\n  };\n\n  BN.prototype.forceRed = function forceRed (ctx) {\n    assert(!this.red, 'Already a number in reduction context');\n    return this._forceRed(ctx);\n  };\n\n  BN.prototype.redAdd = function redAdd (num) {\n    assert(this.red, 'redAdd works only with red numbers');\n    return this.red.add(this, num);\n  };\n\n  BN.prototype.redIAdd = function redIAdd (num) {\n    assert(this.red, 'redIAdd works only with red numbers');\n    return this.red.iadd(this, num);\n  };\n\n  BN.prototype.redSub = function redSub (num) {\n    assert(this.red, 'redSub works only with red numbers');\n    return this.red.sub(this, num);\n  };\n\n  BN.prototype.redISub = function redISub (num) {\n    assert(this.red, 'redISub works only with red numbers');\n    return this.red.isub(this, num);\n  };\n\n  BN.prototype.redShl = function redShl (num) {\n    assert(this.red, 'redShl works only with red numbers');\n    return this.red.shl(this, num);\n  };\n\n  BN.prototype.redMul = function redMul (num) {\n    assert(this.red, 'redMul works only with red numbers');\n    this.red._verify2(this, num);\n    return this.red.mul(this, num);\n  };\n\n  BN.prototype.redIMul = function redIMul (num) {\n    assert(this.red, 'redMul works only with red numbers');\n    this.red._verify2(this, num);\n    return this.red.imul(this, num);\n  };\n\n  BN.prototype.redSqr = function redSqr () {\n    assert(this.red, 'redSqr works only with red numbers');\n    this.red._verify1(this);\n    return this.red.sqr(this);\n  };\n\n  BN.prototype.redISqr = function redISqr () {\n    assert(this.red, 'redISqr works only with red numbers');\n    this.red._verify1(this);\n    return this.red.isqr(this);\n  };\n\n  // Square root over p\n  BN.prototype.redSqrt = function redSqrt () {\n    assert(this.red, 'redSqrt works only with red numbers');\n    this.red._verify1(this);\n    return this.red.sqrt(this);\n  };\n\n  BN.prototype.redInvm = function redInvm () {\n    assert(this.red, 'redInvm works only with red numbers');\n    this.red._verify1(this);\n    return this.red.invm(this);\n  };\n\n  // Return negative clone of `this` % `red modulo`\n  BN.prototype.redNeg = function redNeg () {\n    assert(this.red, 'redNeg works only with red numbers');\n    this.red._verify1(this);\n    return this.red.neg(this);\n  };\n\n  BN.prototype.redPow = function redPow (num) {\n    assert(this.red && !num.red, 'redPow(normalNum)');\n    this.red._verify1(this);\n    return this.red.pow(this, num);\n  };\n\n  // Prime numbers with efficient reduction\n  var primes = {\n    k256: null,\n    p224: null,\n    p192: null,\n    p25519: null\n  };\n\n  // Pseudo-Mersenne prime\n  function MPrime (name, p) {\n    // P = 2 ^ N - K\n    this.name = name;\n    this.p = new BN(p, 16);\n    this.n = this.p.bitLength();\n    this.k = new BN(1).iushln(this.n).isub(this.p);\n\n    this.tmp = this._tmp();\n  }\n\n  MPrime.prototype._tmp = function _tmp () {\n    var tmp = new BN(null);\n    tmp.words = new Array(Math.ceil(this.n / 13));\n    return tmp;\n  };\n\n  MPrime.prototype.ireduce = function ireduce (num) {\n    // Assumes that `num` is less than `P^2`\n    // num = HI * (2 ^ N - K) + HI * K + LO = HI * K + LO (mod P)\n    var r = num;\n    var rlen;\n\n    do {\n      this.split(r, this.tmp);\n      r = this.imulK(r);\n      r = r.iadd(this.tmp);\n      rlen = r.bitLength();\n    } while (rlen > this.n);\n\n    var cmp = rlen < this.n ? -1 : r.ucmp(this.p);\n    if (cmp === 0) {\n      r.words[0] = 0;\n      r.length = 1;\n    } else if (cmp > 0) {\n      r.isub(this.p);\n    } else {\n      r.strip();\n    }\n\n    return r;\n  };\n\n  MPrime.prototype.split = function split (input, out) {\n    input.iushrn(this.n, 0, out);\n  };\n\n  MPrime.prototype.imulK = function imulK (num) {\n    return num.imul(this.k);\n  };\n\n  function K256 () {\n    MPrime.call(\n      this,\n      'k256',\n      'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f');\n  }\n  inherits(K256, MPrime);\n\n  K256.prototype.split = function split (input, output) {\n    // 256 = 9 * 26 + 22\n    var mask = 0x3fffff;\n\n    var outLen = Math.min(input.length, 9);\n    for (var i = 0; i < outLen; i++) {\n      output.words[i] = input.words[i];\n    }\n    output.length = outLen;\n\n    if (input.length <= 9) {\n      input.words[0] = 0;\n      input.length = 1;\n      return;\n    }\n\n    // Shift by 9 limbs\n    var prev = input.words[9];\n    output.words[output.length++] = prev & mask;\n\n    for (i = 10; i < input.length; i++) {\n      var next = input.words[i] | 0;\n      input.words[i - 10] = ((next & mask) << 4) | (prev >>> 22);\n      prev = next;\n    }\n    prev >>>= 22;\n    input.words[i - 10] = prev;\n    if (prev === 0 && input.length > 10) {\n      input.length -= 10;\n    } else {\n      input.length -= 9;\n    }\n  };\n\n  K256.prototype.imulK = function imulK (num) {\n    // K = 0x1000003d1 = [ 0x40, 0x3d1 ]\n    num.words[num.length] = 0;\n    num.words[num.length + 1] = 0;\n    num.length += 2;\n\n    // bounded at: 0x40 * 0x3ffffff + 0x3d0 = 0x100000390\n    var lo = 0;\n    for (var i = 0; i < num.length; i++) {\n      var w = num.words[i] | 0;\n      lo += w * 0x3d1;\n      num.words[i] = lo & 0x3ffffff;\n      lo = w * 0x40 + ((lo / 0x4000000) | 0);\n    }\n\n    // Fast length reduction\n    if (num.words[num.length - 1] === 0) {\n      num.length--;\n      if (num.words[num.length - 1] === 0) {\n        num.length--;\n      }\n    }\n    return num;\n  };\n\n  function P224 () {\n    MPrime.call(\n      this,\n      'p224',\n      'ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001');\n  }\n  inherits(P224, MPrime);\n\n  function P192 () {\n    MPrime.call(\n      this,\n      'p192',\n      'ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff');\n  }\n  inherits(P192, MPrime);\n\n  function P25519 () {\n    // 2 ^ 255 - 19\n    MPrime.call(\n      this,\n      '25519',\n      '7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed');\n  }\n  inherits(P25519, MPrime);\n\n  P25519.prototype.imulK = function imulK (num) {\n    // K = 0x13\n    var carry = 0;\n    for (var i = 0; i < num.length; i++) {\n      var hi = (num.words[i] | 0) * 0x13 + carry;\n      var lo = hi & 0x3ffffff;\n      hi >>>= 26;\n\n      num.words[i] = lo;\n      carry = hi;\n    }\n    if (carry !== 0) {\n      num.words[num.length++] = carry;\n    }\n    return num;\n  };\n\n  // Exported mostly for testing purposes, use plain name instead\n  BN._prime = function prime (name) {\n    // Cached version of prime\n    if (primes[name]) return primes[name];\n\n    var prime;\n    if (name === 'k256') {\n      prime = new K256();\n    } else if (name === 'p224') {\n      prime = new P224();\n    } else if (name === 'p192') {\n      prime = new P192();\n    } else if (name === 'p25519') {\n      prime = new P25519();\n    } else {\n      throw new Error('Unknown prime ' + name);\n    }\n    primes[name] = prime;\n\n    return prime;\n  };\n\n  //\n  // Base reduction engine\n  //\n  function Red (m) {\n    if (typeof m === 'string') {\n      var prime = BN._prime(m);\n      this.m = prime.p;\n      this.prime = prime;\n    } else {\n      assert(m.gtn(1), 'modulus must be greater than 1');\n      this.m = m;\n      this.prime = null;\n    }\n  }\n\n  Red.prototype._verify1 = function _verify1 (a) {\n    assert(a.negative === 0, 'red works only with positives');\n    assert(a.red, 'red works only with red numbers');\n  };\n\n  Red.prototype._verify2 = function _verify2 (a, b) {\n    assert((a.negative | b.negative) === 0, 'red works only with positives');\n    assert(a.red && a.red === b.red,\n      'red works only with red numbers');\n  };\n\n  Red.prototype.imod = function imod (a) {\n    if (this.prime) return this.prime.ireduce(a)._forceRed(this);\n    return a.umod(this.m)._forceRed(this);\n  };\n\n  Red.prototype.neg = function neg (a) {\n    if (a.isZero()) {\n      return a.clone();\n    }\n\n    return this.m.sub(a)._forceRed(this);\n  };\n\n  Red.prototype.add = function add (a, b) {\n    this._verify2(a, b);\n\n    var res = a.add(b);\n    if (res.cmp(this.m) >= 0) {\n      res.isub(this.m);\n    }\n    return res._forceRed(this);\n  };\n\n  Red.prototype.iadd = function iadd (a, b) {\n    this._verify2(a, b);\n\n    var res = a.iadd(b);\n    if (res.cmp(this.m) >= 0) {\n      res.isub(this.m);\n    }\n    return res;\n  };\n\n  Red.prototype.sub = function sub (a, b) {\n    this._verify2(a, b);\n\n    var res = a.sub(b);\n    if (res.cmpn(0) < 0) {\n      res.iadd(this.m);\n    }\n    return res._forceRed(this);\n  };\n\n  Red.prototype.isub = function isub (a, b) {\n    this._verify2(a, b);\n\n    var res = a.isub(b);\n    if (res.cmpn(0) < 0) {\n      res.iadd(this.m);\n    }\n    return res;\n  };\n\n  Red.prototype.shl = function shl (a, num) {\n    this._verify1(a);\n    return this.imod(a.ushln(num));\n  };\n\n  Red.prototype.imul = function imul (a, b) {\n    this._verify2(a, b);\n    return this.imod(a.imul(b));\n  };\n\n  Red.prototype.mul = function mul (a, b) {\n    this._verify2(a, b);\n    return this.imod(a.mul(b));\n  };\n\n  Red.prototype.isqr = function isqr (a) {\n    return this.imul(a, a.clone());\n  };\n\n  Red.prototype.sqr = function sqr (a) {\n    return this.mul(a, a);\n  };\n\n  Red.prototype.sqrt = function sqrt (a) {\n    if (a.isZero()) return a.clone();\n\n    var mod3 = this.m.andln(3);\n    assert(mod3 % 2 === 1);\n\n    // Fast case\n    if (mod3 === 3) {\n      var pow = this.m.add(new BN(1)).iushrn(2);\n      return this.pow(a, pow);\n    }\n\n    // Tonelli-Shanks algorithm (Totally unoptimized and slow)\n    //\n    // Find Q and S, that Q * 2 ^ S = (P - 1)\n    var q = this.m.subn(1);\n    var s = 0;\n    while (!q.isZero() && q.andln(1) === 0) {\n      s++;\n      q.iushrn(1);\n    }\n    assert(!q.isZero());\n\n    var one = new BN(1).toRed(this);\n    var nOne = one.redNeg();\n\n    // Find quadratic non-residue\n    // NOTE: Max is such because of generalized Riemann hypothesis.\n    var lpow = this.m.subn(1).iushrn(1);\n    var z = this.m.bitLength();\n    z = new BN(2 * z * z).toRed(this);\n\n    while (this.pow(z, lpow).cmp(nOne) !== 0) {\n      z.redIAdd(nOne);\n    }\n\n    var c = this.pow(z, q);\n    var r = this.pow(a, q.addn(1).iushrn(1));\n    var t = this.pow(a, q);\n    var m = s;\n    while (t.cmp(one) !== 0) {\n      var tmp = t;\n      for (var i = 0; tmp.cmp(one) !== 0; i++) {\n        tmp = tmp.redSqr();\n      }\n      assert(i < m);\n      var b = this.pow(c, new BN(1).iushln(m - i - 1));\n\n      r = r.redMul(b);\n      c = b.redSqr();\n      t = t.redMul(c);\n      m = i;\n    }\n\n    return r;\n  };\n\n  Red.prototype.invm = function invm (a) {\n    var inv = a._invmp(this.m);\n    if (inv.negative !== 0) {\n      inv.negative = 0;\n      return this.imod(inv).redNeg();\n    } else {\n      return this.imod(inv);\n    }\n  };\n\n  Red.prototype.pow = function pow (a, num) {\n    if (num.isZero()) return new BN(1).toRed(this);\n    if (num.cmpn(1) === 0) return a.clone();\n\n    var windowSize = 4;\n    var wnd = new Array(1 << windowSize);\n    wnd[0] = new BN(1).toRed(this);\n    wnd[1] = a;\n    for (var i = 2; i < wnd.length; i++) {\n      wnd[i] = this.mul(wnd[i - 1], a);\n    }\n\n    var res = wnd[0];\n    var current = 0;\n    var currentLen = 0;\n    var start = num.bitLength() % 26;\n    if (start === 0) {\n      start = 26;\n    }\n\n    for (i = num.length - 1; i >= 0; i--) {\n      var word = num.words[i];\n      for (var j = start - 1; j >= 0; j--) {\n        var bit = (word >> j) & 1;\n        if (res !== wnd[0]) {\n          res = this.sqr(res);\n        }\n\n        if (bit === 0 && current === 0) {\n          currentLen = 0;\n          continue;\n        }\n\n        current <<= 1;\n        current |= bit;\n        currentLen++;\n        if (currentLen !== windowSize && (i !== 0 || j !== 0)) continue;\n\n        res = this.mul(res, wnd[current]);\n        currentLen = 0;\n        current = 0;\n      }\n      start = 26;\n    }\n\n    return res;\n  };\n\n  Red.prototype.convertTo = function convertTo (num) {\n    var r = num.umod(this.m);\n\n    return r === num ? r.clone() : r;\n  };\n\n  Red.prototype.convertFrom = function convertFrom (num) {\n    var res = num.clone();\n    res.red = null;\n    return res;\n  };\n\n  //\n  // Montgomery method engine\n  //\n\n  BN.mont = function mont (num) {\n    return new Mont(num);\n  };\n\n  function Mont (m) {\n    Red.call(this, m);\n\n    this.shift = this.m.bitLength();\n    if (this.shift % 26 !== 0) {\n      this.shift += 26 - (this.shift % 26);\n    }\n\n    this.r = new BN(1).iushln(this.shift);\n    this.r2 = this.imod(this.r.sqr());\n    this.rinv = this.r._invmp(this.m);\n\n    this.minv = this.rinv.mul(this.r).isubn(1).div(this.m);\n    this.minv = this.minv.umod(this.r);\n    this.minv = this.r.sub(this.minv);\n  }\n  inherits(Mont, Red);\n\n  Mont.prototype.convertTo = function convertTo (num) {\n    return this.imod(num.ushln(this.shift));\n  };\n\n  Mont.prototype.convertFrom = function convertFrom (num) {\n    var r = this.imod(num.mul(this.rinv));\n    r.red = null;\n    return r;\n  };\n\n  Mont.prototype.imul = function imul (a, b) {\n    if (a.isZero() || b.isZero()) {\n      a.words[0] = 0;\n      a.length = 1;\n      return a;\n    }\n\n    var t = a.imul(b);\n    var c = t.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m);\n    var u = t.isub(c).iushrn(this.shift);\n    var res = u;\n\n    if (u.cmp(this.m) >= 0) {\n      res = u.isub(this.m);\n    } else if (u.cmpn(0) < 0) {\n      res = u.iadd(this.m);\n    }\n\n    return res._forceRed(this);\n  };\n\n  Mont.prototype.mul = function mul (a, b) {\n    if (a.isZero() || b.isZero()) return new BN(0)._forceRed(this);\n\n    var t = a.mul(b);\n    var c = t.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m);\n    var u = t.isub(c).iushrn(this.shift);\n    var res = u;\n    if (u.cmp(this.m) >= 0) {\n      res = u.isub(this.m);\n    } else if (u.cmpn(0) < 0) {\n      res = u.iadd(this.m);\n    }\n\n    return res._forceRed(this);\n  };\n\n  Mont.prototype.invm = function invm (a) {\n    // (AR)^-1 * R^2 = (A^-1 * R^-1) * R^2 = A^-1 * R\n    var res = this.imod(a._invmp(this.m).mul(this.r2));\n    return res._forceRed(this);\n  };\n})(typeof module === 'undefined' || module, this);\n","var r;\n\nmodule.exports = function rand(len) {\n  if (!r)\n    r = new Rand(null);\n\n  return r.generate(len);\n};\n\nfunction Rand(rand) {\n  this.rand = rand;\n}\nmodule.exports.Rand = Rand;\n\nRand.prototype.generate = function generate(len) {\n  return this._rand(len);\n};\n\n// Emulate crypto API using randy\nRand.prototype._rand = function _rand(n) {\n  if (this.rand.getBytes)\n    return this.rand.getBytes(n);\n\n  var res = new Uint8Array(n);\n  for (var i = 0; i < res.length; i++)\n    res[i] = this.rand.getByte();\n  return res;\n};\n\nif (typeof self === 'object') {\n  if (self.crypto && self.crypto.getRandomValues) {\n    // Modern browsers\n    Rand.prototype._rand = function _rand(n) {\n      var arr = new Uint8Array(n);\n      self.crypto.getRandomValues(arr);\n      return arr;\n    };\n  } else if (self.msCrypto && self.msCrypto.getRandomValues) {\n    // IE\n    Rand.prototype._rand = function _rand(n) {\n      var arr = new Uint8Array(n);\n      self.msCrypto.getRandomValues(arr);\n      return arr;\n    };\n\n  // Safari's WebWorkers do not have `crypto`\n  } else if (typeof window === 'object') {\n    // Old junk\n    Rand.prototype._rand = function() {\n      throw new Error('Not implemented yet');\n    };\n  }\n} else {\n  // Node.js or Web worker with no crypto support\n  try {\n    var crypto = require('crypto');\n    if (typeof crypto.randomBytes !== 'function')\n      throw new Error('Not supported');\n\n    Rand.prototype._rand = function _rand(n) {\n      return crypto.randomBytes(n);\n    };\n  } catch (e) {\n  }\n}\n","var bn = require('bn.js');\nvar brorand = require('brorand');\n\nfunction MillerRabin(rand) {\n  this.rand = rand || new brorand.Rand();\n}\nmodule.exports = MillerRabin;\n\nMillerRabin.create = function create(rand) {\n  return new MillerRabin(rand);\n};\n\nMillerRabin.prototype._randbelow = function _randbelow(n) {\n  var len = n.bitLength();\n  var min_bytes = Math.ceil(len / 8);\n\n  // Generage random bytes until a number less than n is found.\n  // This ensures that 0..n-1 have an equal probability of being selected.\n  do\n    var a = new bn(this.rand.generate(min_bytes));\n  while (a.cmp(n) >= 0);\n\n  return a;\n};\n\nMillerRabin.prototype._randrange = function _randrange(start, stop) {\n  // Generate a random number greater than or equal to start and less than stop.\n  var size = stop.sub(start);\n  return start.add(this._randbelow(size));\n};\n\nMillerRabin.prototype.test = function test(n, k, cb) {\n  var len = n.bitLength();\n  var red = bn.mont(n);\n  var rone = new bn(1).toRed(red);\n\n  if (!k)\n    k = Math.max(1, (len / 48) | 0);\n\n  // Find d and s, (n - 1) = (2 ^ s) * d;\n  var n1 = n.subn(1);\n  for (var s = 0; !n1.testn(s); s++) {}\n  var d = n.shrn(s);\n\n  var rn1 = n1.toRed(red);\n\n  var prime = true;\n  for (; k > 0; k--) {\n    var a = this._randrange(new bn(2), n1);\n    if (cb)\n      cb(a);\n\n    var x = a.toRed(red).redPow(d);\n    if (x.cmp(rone) === 0 || x.cmp(rn1) === 0)\n      continue;\n\n    for (var i = 1; i < s; i++) {\n      x = x.redSqr();\n\n      if (x.cmp(rone) === 0)\n        return false;\n      if (x.cmp(rn1) === 0)\n        break;\n    }\n\n    if (i === s)\n      return false;\n  }\n\n  return prime;\n};\n\nMillerRabin.prototype.getDivisor = function getDivisor(n, k) {\n  var len = n.bitLength();\n  var red = bn.mont(n);\n  var rone = new bn(1).toRed(red);\n\n  if (!k)\n    k = Math.max(1, (len / 48) | 0);\n\n  // Find d and s, (n - 1) = (2 ^ s) * d;\n  var n1 = n.subn(1);\n  for (var s = 0; !n1.testn(s); s++) {}\n  var d = n.shrn(s);\n\n  var rn1 = n1.toRed(red);\n\n  for (; k > 0; k--) {\n    var a = this._randrange(new bn(2), n1);\n\n    var g = n.gcd(a);\n    if (g.cmpn(1) !== 0)\n      return g;\n\n    var x = a.toRed(red).redPow(d);\n    if (x.cmp(rone) === 0 || x.cmp(rn1) === 0)\n      continue;\n\n    for (var i = 1; i < s; i++) {\n      x = x.redSqr();\n\n      if (x.cmp(rone) === 0)\n        return x.fromRed().subn(1).gcd(n);\n      if (x.cmp(rn1) === 0)\n        break;\n    }\n\n    if (i === s) {\n      x = x.redSqr();\n      return x.fromRed().subn(1).gcd(n);\n    }\n  }\n\n  return false;\n};\n","var randomBytes = require('randombytes');\nmodule.exports = findPrime;\nfindPrime.simpleSieve = simpleSieve;\nfindPrime.fermatTest = fermatTest;\nvar BN = require('bn.js');\nvar TWENTYFOUR = new BN(24);\nvar MillerRabin = require('miller-rabin');\nvar millerRabin = new MillerRabin();\nvar ONE = new BN(1);\nvar TWO = new BN(2);\nvar FIVE = new BN(5);\nvar SIXTEEN = new BN(16);\nvar EIGHT = new BN(8);\nvar TEN = new BN(10);\nvar THREE = new BN(3);\nvar SEVEN = new BN(7);\nvar ELEVEN = new BN(11);\nvar FOUR = new BN(4);\nvar TWELVE = new BN(12);\nvar primes = null;\n\nfunction _getPrimes() {\n  if (primes !== null)\n    return primes;\n\n  var limit = 0x100000;\n  var res = [];\n  res[0] = 2;\n  for (var i = 1, k = 3; k < limit; k += 2) {\n    var sqrt = Math.ceil(Math.sqrt(k));\n    for (var j = 0; j < i && res[j] <= sqrt; j++)\n      if (k % res[j] === 0)\n        break;\n\n    if (i !== j && res[j] <= sqrt)\n      continue;\n\n    res[i++] = k;\n  }\n  primes = res;\n  return res;\n}\n\nfunction simpleSieve(p) {\n  var primes = _getPrimes();\n\n  for (var i = 0; i < primes.length; i++)\n    if (p.modn(primes[i]) === 0) {\n      if (p.cmpn(primes[i]) === 0) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n\n  return true;\n}\n\nfunction fermatTest(p) {\n  var red = BN.mont(p);\n  return TWO.toRed(red).redPow(p.subn(1)).fromRed().cmpn(1) === 0;\n}\n\nfunction findPrime(bits, gen) {\n  if (bits < 16) {\n    // this is what openssl does\n    if (gen === 2 || gen === 5) {\n      return new BN([0x8c, 0x7b]);\n    } else {\n      return new BN([0x8c, 0x27]);\n    }\n  }\n  gen = new BN(gen);\n\n  var num, n2;\n\n  while (true) {\n    num = new BN(randomBytes(Math.ceil(bits / 8)));\n    while (num.bitLength() > bits) {\n      num.ishrn(1);\n    }\n    if (num.isEven()) {\n      num.iadd(ONE);\n    }\n    if (!num.testn(1)) {\n      num.iadd(TWO);\n    }\n    if (!gen.cmp(TWO)) {\n      while (num.mod(TWENTYFOUR).cmp(ELEVEN)) {\n        num.iadd(FOUR);\n      }\n    } else if (!gen.cmp(FIVE)) {\n      while (num.mod(TEN).cmp(THREE)) {\n        num.iadd(FOUR);\n      }\n    }\n    n2 = num.shrn(1);\n    if (simpleSieve(n2) && simpleSieve(num) &&\n      fermatTest(n2) && fermatTest(num) &&\n      millerRabin.test(n2) && millerRabin.test(num)) {\n      return num;\n    }\n  }\n\n}\n","var BN = require('bn.js');\nvar MillerRabin = require('miller-rabin');\nvar millerRabin = new MillerRabin();\nvar TWENTYFOUR = new BN(24);\nvar ELEVEN = new BN(11);\nvar TEN = new BN(10);\nvar THREE = new BN(3);\nvar SEVEN = new BN(7);\nvar primes = require('./generatePrime');\nvar randomBytes = require('randombytes');\nmodule.exports = DH;\n\nfunction setPublicKey(pub, enc) {\n  enc = enc || 'utf8';\n  if (!Buffer.isBuffer(pub)) {\n    pub = new Buffer(pub, enc);\n  }\n  this._pub = new BN(pub);\n  return this;\n}\n\nfunction setPrivateKey(priv, enc) {\n  enc = enc || 'utf8';\n  if (!Buffer.isBuffer(priv)) {\n    priv = new Buffer(priv, enc);\n  }\n  this._priv = new BN(priv);\n  return this;\n}\n\nvar primeCache = {};\nfunction checkPrime(prime, generator) {\n  var gen = generator.toString('hex');\n  var hex = [gen, prime.toString(16)].join('_');\n  if (hex in primeCache) {\n    return primeCache[hex];\n  }\n  var error = 0;\n\n  if (prime.isEven() ||\n    !primes.simpleSieve ||\n    !primes.fermatTest(prime) ||\n    !millerRabin.test(prime)) {\n    //not a prime so +1\n    error += 1;\n\n    if (gen === '02' || gen === '05') {\n      // we'd be able to check the generator\n      // it would fail so +8\n      error += 8;\n    } else {\n      //we wouldn't be able to test the generator\n      // so +4\n      error += 4;\n    }\n    primeCache[hex] = error;\n    return error;\n  }\n  if (!millerRabin.test(prime.shrn(1))) {\n    //not a safe prime\n    error += 2;\n  }\n  var rem;\n  switch (gen) {\n    case '02':\n      if (prime.mod(TWENTYFOUR).cmp(ELEVEN)) {\n        // unsuidable generator\n        error += 8;\n      }\n      break;\n    case '05':\n      rem = prime.mod(TEN);\n      if (rem.cmp(THREE) && rem.cmp(SEVEN)) {\n        // prime mod 10 needs to equal 3 or 7\n        error += 8;\n      }\n      break;\n    default:\n      error += 4;\n  }\n  primeCache[hex] = error;\n  return error;\n}\n\nfunction DH(prime, generator, malleable) {\n  this.setGenerator(generator);\n  this.__prime = new BN(prime);\n  this._prime = BN.mont(this.__prime);\n  this._primeLen = prime.length;\n  this._pub = undefined;\n  this._priv = undefined;\n  this._primeCode = undefined;\n  if (malleable) {\n    this.setPublicKey = setPublicKey;\n    this.setPrivateKey = setPrivateKey;\n  } else {\n    this._primeCode = 8;\n  }\n}\nObject.defineProperty(DH.prototype, 'verifyError', {\n  enumerable: true,\n  get: function () {\n    if (typeof this._primeCode !== 'number') {\n      this._primeCode = checkPrime(this.__prime, this.__gen);\n    }\n    return this._primeCode;\n  }\n});\nDH.prototype.generateKeys = function () {\n  if (!this._priv) {\n    this._priv = new BN(randomBytes(this._primeLen));\n  }\n  this._pub = this._gen.toRed(this._prime).redPow(this._priv).fromRed();\n  return this.getPublicKey();\n};\n\nDH.prototype.computeSecret = function (other) {\n  other = new BN(other);\n  other = other.toRed(this._prime);\n  var secret = other.redPow(this._priv).fromRed();\n  var out = new Buffer(secret.toArray());\n  var prime = this.getPrime();\n  if (out.length < prime.length) {\n    var front = new Buffer(prime.length - out.length);\n    front.fill(0);\n    out = Buffer.concat([front, out]);\n  }\n  return out;\n};\n\nDH.prototype.getPublicKey = function getPublicKey(enc) {\n  return formatReturnValue(this._pub, enc);\n};\n\nDH.prototype.getPrivateKey = function getPrivateKey(enc) {\n  return formatReturnValue(this._priv, enc);\n};\n\nDH.prototype.getPrime = function (enc) {\n  return formatReturnValue(this.__prime, enc);\n};\n\nDH.prototype.getGenerator = function (enc) {\n  return formatReturnValue(this._gen, enc);\n};\n\nDH.prototype.setGenerator = function (gen, enc) {\n  enc = enc || 'utf8';\n  if (!Buffer.isBuffer(gen)) {\n    gen = new Buffer(gen, enc);\n  }\n  this.__gen = gen;\n  this._gen = new BN(gen);\n  return this;\n};\n\nfunction formatReturnValue(bn, enc) {\n  var buf = new Buffer(bn.toArray());\n  if (!enc) {\n    return buf;\n  } else {\n    return buf.toString(enc);\n  }\n}\n","var generatePrime = require('./lib/generatePrime')\nvar primes = require('./lib/primes.json')\n\nvar DH = require('./lib/dh')\n\nfunction getDiffieHellman (mod) {\n  var prime = new Buffer(primes[mod].prime, 'hex')\n  var gen = new Buffer(primes[mod].gen, 'hex')\n\n  return new DH(prime, gen)\n}\n\nvar ENCODINGS = {\n  'binary': true, 'hex': true, 'base64': true\n}\n\nfunction createDiffieHellman (prime, enc, generator, genc) {\n  if (Buffer.isBuffer(enc) || ENCODINGS[enc] === undefined) {\n    return createDiffieHellman(prime, 'binary', enc, generator)\n  }\n\n  enc = enc || 'binary'\n  genc = genc || 'binary'\n  generator = generator || new Buffer([2])\n\n  if (!Buffer.isBuffer(generator)) {\n    generator = new Buffer(generator, genc)\n  }\n\n  if (typeof prime === 'number') {\n    return new DH(generatePrime(prime, generator), generator, true)\n  }\n\n  if (!Buffer.isBuffer(prime)) {\n    prime = new Buffer(prime, enc)\n  }\n\n  return new DH(prime, generator, true)\n}\n\nexports.DiffieHellmanGroup = exports.createDiffieHellmanGroup = exports.getDiffieHellman = getDiffieHellman\nexports.createDiffieHellman = exports.DiffieHellman = createDiffieHellman\n","var bn = require('bn.js');\nvar randomBytes = require('randombytes');\nmodule.exports = crt;\nfunction blind(priv) {\n  var r = getr(priv);\n  var blinder = r.toRed(bn.mont(priv.modulus))\n  .redPow(new bn(priv.publicExponent)).fromRed();\n  return {\n    blinder: blinder,\n    unblinder:r.invm(priv.modulus)\n  };\n}\nfunction crt(msg, priv) {\n  var blinds = blind(priv);\n  var len = priv.modulus.byteLength();\n  var mod = bn.mont(priv.modulus);\n  var blinded = new bn(msg).mul(blinds.blinder).umod(priv.modulus);\n  var c1 = blinded.toRed(bn.mont(priv.prime1));\n  var c2 = blinded.toRed(bn.mont(priv.prime2));\n  var qinv = priv.coefficient;\n  var p = priv.prime1;\n  var q = priv.prime2;\n  var m1 = c1.redPow(priv.exponent1);\n  var m2 = c2.redPow(priv.exponent2);\n  m1 = m1.fromRed();\n  m2 = m2.fromRed();\n  var h = m1.isub(m2).imul(qinv).umod(p);\n  h.imul(q);\n  m2.iadd(h);\n  return new Buffer(m2.imul(blinds.unblinder).umod(priv.modulus).toArray(false, len));\n}\ncrt.getr = getr;\nfunction getr(priv) {\n  var len = priv.modulus.byteLength();\n  var r = new bn(randomBytes(len));\n  while (r.cmp(priv.modulus) >=  0 || !r.umod(priv.prime1) || !r.umod(priv.prime2)) {\n    r = new bn(randomBytes(len));\n  }\n  return r;\n}\n","'use strict';\n\nvar utils = exports;\n\nfunction toArray(msg, enc) {\n  if (Array.isArray(msg))\n    return msg.slice();\n  if (!msg)\n    return [];\n  var res = [];\n  if (typeof msg !== 'string') {\n    for (var i = 0; i < msg.length; i++)\n      res[i] = msg[i] | 0;\n    return res;\n  }\n  if (enc === 'hex') {\n    msg = msg.replace(/[^a-z0-9]+/ig, '');\n    if (msg.length % 2 !== 0)\n      msg = '0' + msg;\n    for (var i = 0; i < msg.length; i += 2)\n      res.push(parseInt(msg[i] + msg[i + 1], 16));\n  } else {\n    for (var i = 0; i < msg.length; i++) {\n      var c = msg.charCodeAt(i);\n      var hi = c >> 8;\n      var lo = c & 0xff;\n      if (hi)\n        res.push(hi, lo);\n      else\n        res.push(lo);\n    }\n  }\n  return res;\n}\nutils.toArray = toArray;\n\nfunction zero2(word) {\n  if (word.length === 1)\n    return '0' + word;\n  else\n    return word;\n}\nutils.zero2 = zero2;\n\nfunction toHex(msg) {\n  var res = '';\n  for (var i = 0; i < msg.length; i++)\n    res += zero2(msg[i].toString(16));\n  return res;\n}\nutils.toHex = toHex;\n\nutils.encode = function encode(arr, enc) {\n  if (enc === 'hex')\n    return toHex(arr);\n  else\n    return arr;\n};\n","'use strict';\n\nvar utils = exports;\nvar BN = require('bn.js');\nvar minAssert = require('minimalistic-assert');\nvar minUtils = require('minimalistic-crypto-utils');\n\nutils.assert = minAssert;\nutils.toArray = minUtils.toArray;\nutils.zero2 = minUtils.zero2;\nutils.toHex = minUtils.toHex;\nutils.encode = minUtils.encode;\n\n// Represent num in a w-NAF form\nfunction getNAF(num, w) {\n  var naf = [];\n  var ws = 1 << (w + 1);\n  var k = num.clone();\n  while (k.cmpn(1) >= 0) {\n    var z;\n    if (k.isOdd()) {\n      var mod = k.andln(ws - 1);\n      if (mod > (ws >> 1) - 1)\n        z = (ws >> 1) - mod;\n      else\n        z = mod;\n      k.isubn(z);\n    } else {\n      z = 0;\n    }\n    naf.push(z);\n\n    // Optimization, shift by word if possible\n    var shift = (k.cmpn(0) !== 0 && k.andln(ws - 1) === 0) ? (w + 1) : 1;\n    for (var i = 1; i < shift; i++)\n      naf.push(0);\n    k.iushrn(shift);\n  }\n\n  return naf;\n}\nutils.getNAF = getNAF;\n\n// Represent k1, k2 in a Joint Sparse Form\nfunction getJSF(k1, k2) {\n  var jsf = [\n    [],\n    []\n  ];\n\n  k1 = k1.clone();\n  k2 = k2.clone();\n  var d1 = 0;\n  var d2 = 0;\n  while (k1.cmpn(-d1) > 0 || k2.cmpn(-d2) > 0) {\n\n    // First phase\n    var m14 = (k1.andln(3) + d1) & 3;\n    var m24 = (k2.andln(3) + d2) & 3;\n    if (m14 === 3)\n      m14 = -1;\n    if (m24 === 3)\n      m24 = -1;\n    var u1;\n    if ((m14 & 1) === 0) {\n      u1 = 0;\n    } else {\n      var m8 = (k1.andln(7) + d1) & 7;\n      if ((m8 === 3 || m8 === 5) && m24 === 2)\n        u1 = -m14;\n      else\n        u1 = m14;\n    }\n    jsf[0].push(u1);\n\n    var u2;\n    if ((m24 & 1) === 0) {\n      u2 = 0;\n    } else {\n      var m8 = (k2.andln(7) + d2) & 7;\n      if ((m8 === 3 || m8 === 5) && m14 === 2)\n        u2 = -m24;\n      else\n        u2 = m24;\n    }\n    jsf[1].push(u2);\n\n    // Second phase\n    if (2 * d1 === u1 + 1)\n      d1 = 1 - d1;\n    if (2 * d2 === u2 + 1)\n      d2 = 1 - d2;\n    k1.iushrn(1);\n    k2.iushrn(1);\n  }\n\n  return jsf;\n}\nutils.getJSF = getJSF;\n\nfunction cachedProperty(obj, name, computer) {\n  var key = '_' + name;\n  obj.prototype[name] = function cachedProperty() {\n    return this[key] !== undefined ? this[key] :\n           this[key] = computer.call(this);\n  };\n}\nutils.cachedProperty = cachedProperty;\n\nfunction parseBytes(bytes) {\n  return typeof bytes === 'string' ? utils.toArray(bytes, 'hex') :\n                                     bytes;\n}\nutils.parseBytes = parseBytes;\n\nfunction intFromLE(bytes) {\n  return new BN(bytes, 'hex', 'le');\n}\nutils.intFromLE = intFromLE;\n\n","'use strict';\n\nvar BN = require('bn.js');\nvar elliptic = require('../../elliptic');\nvar utils = elliptic.utils;\nvar getNAF = utils.getNAF;\nvar getJSF = utils.getJSF;\nvar assert = utils.assert;\n\nfunction BaseCurve(type, conf) {\n  this.type = type;\n  this.p = new BN(conf.p, 16);\n\n  // Use Montgomery, when there is no fast reduction for the prime\n  this.red = conf.prime ? BN.red(conf.prime) : BN.mont(this.p);\n\n  // Useful for many curves\n  this.zero = new BN(0).toRed(this.red);\n  this.one = new BN(1).toRed(this.red);\n  this.two = new BN(2).toRed(this.red);\n\n  // Curve configuration, optional\n  this.n = conf.n && new BN(conf.n, 16);\n  this.g = conf.g && this.pointFromJSON(conf.g, conf.gRed);\n\n  // Temporary arrays\n  this._wnafT1 = new Array(4);\n  this._wnafT2 = new Array(4);\n  this._wnafT3 = new Array(4);\n  this._wnafT4 = new Array(4);\n\n  // Generalized Greg Maxwell's trick\n  var adjustCount = this.n && this.p.div(this.n);\n  if (!adjustCount || adjustCount.cmpn(100) > 0) {\n    this.redN = null;\n  } else {\n    this._maxwellTrick = true;\n    this.redN = this.n.toRed(this.red);\n  }\n}\nmodule.exports = BaseCurve;\n\nBaseCurve.prototype.point = function point() {\n  throw new Error('Not implemented');\n};\n\nBaseCurve.prototype.validate = function validate() {\n  throw new Error('Not implemented');\n};\n\nBaseCurve.prototype._fixedNafMul = function _fixedNafMul(p, k) {\n  assert(p.precomputed);\n  var doubles = p._getDoubles();\n\n  var naf = getNAF(k, 1);\n  var I = (1 << (doubles.step + 1)) - (doubles.step % 2 === 0 ? 2 : 1);\n  I /= 3;\n\n  // Translate into more windowed form\n  var repr = [];\n  for (var j = 0; j < naf.length; j += doubles.step) {\n    var nafW = 0;\n    for (var k = j + doubles.step - 1; k >= j; k--)\n      nafW = (nafW << 1) + naf[k];\n    repr.push(nafW);\n  }\n\n  var a = this.jpoint(null, null, null);\n  var b = this.jpoint(null, null, null);\n  for (var i = I; i > 0; i--) {\n    for (var j = 0; j < repr.length; j++) {\n      var nafW = repr[j];\n      if (nafW === i)\n        b = b.mixedAdd(doubles.points[j]);\n      else if (nafW === -i)\n        b = b.mixedAdd(doubles.points[j].neg());\n    }\n    a = a.add(b);\n  }\n  return a.toP();\n};\n\nBaseCurve.prototype._wnafMul = function _wnafMul(p, k) {\n  var w = 4;\n\n  // Precompute window\n  var nafPoints = p._getNAFPoints(w);\n  w = nafPoints.wnd;\n  var wnd = nafPoints.points;\n\n  // Get NAF form\n  var naf = getNAF(k, w);\n\n  // Add `this`*(N+1) for every w-NAF index\n  var acc = this.jpoint(null, null, null);\n  for (var i = naf.length - 1; i >= 0; i--) {\n    // Count zeroes\n    for (var k = 0; i >= 0 && naf[i] === 0; i--)\n      k++;\n    if (i >= 0)\n      k++;\n    acc = acc.dblp(k);\n\n    if (i < 0)\n      break;\n    var z = naf[i];\n    assert(z !== 0);\n    if (p.type === 'affine') {\n      // J +- P\n      if (z > 0)\n        acc = acc.mixedAdd(wnd[(z - 1) >> 1]);\n      else\n        acc = acc.mixedAdd(wnd[(-z - 1) >> 1].neg());\n    } else {\n      // J +- J\n      if (z > 0)\n        acc = acc.add(wnd[(z - 1) >> 1]);\n      else\n        acc = acc.add(wnd[(-z - 1) >> 1].neg());\n    }\n  }\n  return p.type === 'affine' ? acc.toP() : acc;\n};\n\nBaseCurve.prototype._wnafMulAdd = function _wnafMulAdd(defW,\n                                                       points,\n                                                       coeffs,\n                                                       len,\n                                                       jacobianResult) {\n  var wndWidth = this._wnafT1;\n  var wnd = this._wnafT2;\n  var naf = this._wnafT3;\n\n  // Fill all arrays\n  var max = 0;\n  for (var i = 0; i < len; i++) {\n    var p = points[i];\n    var nafPoints = p._getNAFPoints(defW);\n    wndWidth[i] = nafPoints.wnd;\n    wnd[i] = nafPoints.points;\n  }\n\n  // Comb small window NAFs\n  for (var i = len - 1; i >= 1; i -= 2) {\n    var a = i - 1;\n    var b = i;\n    if (wndWidth[a] !== 1 || wndWidth[b] !== 1) {\n      naf[a] = getNAF(coeffs[a], wndWidth[a]);\n      naf[b] = getNAF(coeffs[b], wndWidth[b]);\n      max = Math.max(naf[a].length, max);\n      max = Math.max(naf[b].length, max);\n      continue;\n    }\n\n    var comb = [\n      points[a], /* 1 */\n      null, /* 3 */\n      null, /* 5 */\n      points[b] /* 7 */\n    ];\n\n    // Try to avoid Projective points, if possible\n    if (points[a].y.cmp(points[b].y) === 0) {\n      comb[1] = points[a].add(points[b]);\n      comb[2] = points[a].toJ().mixedAdd(points[b].neg());\n    } else if (points[a].y.cmp(points[b].y.redNeg()) === 0) {\n      comb[1] = points[a].toJ().mixedAdd(points[b]);\n      comb[2] = points[a].add(points[b].neg());\n    } else {\n      comb[1] = points[a].toJ().mixedAdd(points[b]);\n      comb[2] = points[a].toJ().mixedAdd(points[b].neg());\n    }\n\n    var index = [\n      -3, /* -1 -1 */\n      -1, /* -1 0 */\n      -5, /* -1 1 */\n      -7, /* 0 -1 */\n      0, /* 0 0 */\n      7, /* 0 1 */\n      5, /* 1 -1 */\n      1, /* 1 0 */\n      3  /* 1 1 */\n    ];\n\n    var jsf = getJSF(coeffs[a], coeffs[b]);\n    max = Math.max(jsf[0].length, max);\n    naf[a] = new Array(max);\n    naf[b] = new Array(max);\n    for (var j = 0; j < max; j++) {\n      var ja = jsf[0][j] | 0;\n      var jb = jsf[1][j] | 0;\n\n      naf[a][j] = index[(ja + 1) * 3 + (jb + 1)];\n      naf[b][j] = 0;\n      wnd[a] = comb;\n    }\n  }\n\n  var acc = this.jpoint(null, null, null);\n  var tmp = this._wnafT4;\n  for (var i = max; i >= 0; i--) {\n    var k = 0;\n\n    while (i >= 0) {\n      var zero = true;\n      for (var j = 0; j < len; j++) {\n        tmp[j] = naf[j][i] | 0;\n        if (tmp[j] !== 0)\n          zero = false;\n      }\n      if (!zero)\n        break;\n      k++;\n      i--;\n    }\n    if (i >= 0)\n      k++;\n    acc = acc.dblp(k);\n    if (i < 0)\n      break;\n\n    for (var j = 0; j < len; j++) {\n      var z = tmp[j];\n      var p;\n      if (z === 0)\n        continue;\n      else if (z > 0)\n        p = wnd[j][(z - 1) >> 1];\n      else if (z < 0)\n        p = wnd[j][(-z - 1) >> 1].neg();\n\n      if (p.type === 'affine')\n        acc = acc.mixedAdd(p);\n      else\n        acc = acc.add(p);\n    }\n  }\n  // Zeroify references\n  for (var i = 0; i < len; i++)\n    wnd[i] = null;\n\n  if (jacobianResult)\n    return acc;\n  else\n    return acc.toP();\n};\n\nfunction BasePoint(curve, type) {\n  this.curve = curve;\n  this.type = type;\n  this.precomputed = null;\n}\nBaseCurve.BasePoint = BasePoint;\n\nBasePoint.prototype.eq = function eq(/*other*/) {\n  throw new Error('Not implemented');\n};\n\nBasePoint.prototype.validate = function validate() {\n  return this.curve.validate(this);\n};\n\nBaseCurve.prototype.decodePoint = function decodePoint(bytes, enc) {\n  bytes = utils.toArray(bytes, enc);\n\n  var len = this.p.byteLength();\n\n  // uncompressed, hybrid-odd, hybrid-even\n  if ((bytes[0] === 0x04 || bytes[0] === 0x06 || bytes[0] === 0x07) &&\n      bytes.length - 1 === 2 * len) {\n    if (bytes[0] === 0x06)\n      assert(bytes[bytes.length - 1] % 2 === 0);\n    else if (bytes[0] === 0x07)\n      assert(bytes[bytes.length - 1] % 2 === 1);\n\n    var res =  this.point(bytes.slice(1, 1 + len),\n                          bytes.slice(1 + len, 1 + 2 * len));\n\n    return res;\n  } else if ((bytes[0] === 0x02 || bytes[0] === 0x03) &&\n              bytes.length - 1 === len) {\n    return this.pointFromX(bytes.slice(1, 1 + len), bytes[0] === 0x03);\n  }\n  throw new Error('Unknown point format');\n};\n\nBasePoint.prototype.encodeCompressed = function encodeCompressed(enc) {\n  return this.encode(enc, true);\n};\n\nBasePoint.prototype._encode = function _encode(compact) {\n  var len = this.curve.p.byteLength();\n  var x = this.getX().toArray('be', len);\n\n  if (compact)\n    return [ this.getY().isEven() ? 0x02 : 0x03 ].concat(x);\n\n  return [ 0x04 ].concat(x, this.getY().toArray('be', len)) ;\n};\n\nBasePoint.prototype.encode = function encode(enc, compact) {\n  return utils.encode(this._encode(compact), enc);\n};\n\nBasePoint.prototype.precompute = function precompute(power) {\n  if (this.precomputed)\n    return this;\n\n  var precomputed = {\n    doubles: null,\n    naf: null,\n    beta: null\n  };\n  precomputed.naf = this._getNAFPoints(8);\n  precomputed.doubles = this._getDoubles(4, power);\n  precomputed.beta = this._getBeta();\n  this.precomputed = precomputed;\n\n  return this;\n};\n\nBasePoint.prototype._hasDoubles = function _hasDoubles(k) {\n  if (!this.precomputed)\n    return false;\n\n  var doubles = this.precomputed.doubles;\n  if (!doubles)\n    return false;\n\n  return doubles.points.length >= Math.ceil((k.bitLength() + 1) / doubles.step);\n};\n\nBasePoint.prototype._getDoubles = function _getDoubles(step, power) {\n  if (this.precomputed && this.precomputed.doubles)\n    return this.precomputed.doubles;\n\n  var doubles = [ this ];\n  var acc = this;\n  for (var i = 0; i < power; i += step) {\n    for (var j = 0; j < step; j++)\n      acc = acc.dbl();\n    doubles.push(acc);\n  }\n  return {\n    step: step,\n    points: doubles\n  };\n};\n\nBasePoint.prototype._getNAFPoints = function _getNAFPoints(wnd) {\n  if (this.precomputed && this.precomputed.naf)\n    return this.precomputed.naf;\n\n  var res = [ this ];\n  var max = (1 << wnd) - 1;\n  var dbl = max === 1 ? null : this.dbl();\n  for (var i = 1; i < max; i++)\n    res[i] = res[i - 1].add(dbl);\n  return {\n    wnd: wnd,\n    points: res\n  };\n};\n\nBasePoint.prototype._getBeta = function _getBeta() {\n  return null;\n};\n\nBasePoint.prototype.dblp = function dblp(k) {\n  var r = this;\n  for (var i = 0; i < k; i++)\n    r = r.dbl();\n  return r;\n};\n","'use strict';\n\nvar curve = require('../curve');\nvar elliptic = require('../../elliptic');\nvar BN = require('bn.js');\nvar inherits = require('inherits');\nvar Base = curve.base;\n\nvar assert = elliptic.utils.assert;\n\nfunction ShortCurve(conf) {\n  Base.call(this, 'short', conf);\n\n  this.a = new BN(conf.a, 16).toRed(this.red);\n  this.b = new BN(conf.b, 16).toRed(this.red);\n  this.tinv = this.two.redInvm();\n\n  this.zeroA = this.a.fromRed().cmpn(0) === 0;\n  this.threeA = this.a.fromRed().sub(this.p).cmpn(-3) === 0;\n\n  // If the curve is endomorphic, precalculate beta and lambda\n  this.endo = this._getEndomorphism(conf);\n  this._endoWnafT1 = new Array(4);\n  this._endoWnafT2 = new Array(4);\n}\ninherits(ShortCurve, Base);\nmodule.exports = ShortCurve;\n\nShortCurve.prototype._getEndomorphism = function _getEndomorphism(conf) {\n  // No efficient endomorphism\n  if (!this.zeroA || !this.g || !this.n || this.p.modn(3) !== 1)\n    return;\n\n  // Compute beta and lambda, that lambda * P = (beta * Px; Py)\n  var beta;\n  var lambda;\n  if (conf.beta) {\n    beta = new BN(conf.beta, 16).toRed(this.red);\n  } else {\n    var betas = this._getEndoRoots(this.p);\n    // Choose the smallest beta\n    beta = betas[0].cmp(betas[1]) < 0 ? betas[0] : betas[1];\n    beta = beta.toRed(this.red);\n  }\n  if (conf.lambda) {\n    lambda = new BN(conf.lambda, 16);\n  } else {\n    // Choose the lambda that is matching selected beta\n    var lambdas = this._getEndoRoots(this.n);\n    if (this.g.mul(lambdas[0]).x.cmp(this.g.x.redMul(beta)) === 0) {\n      lambda = lambdas[0];\n    } else {\n      lambda = lambdas[1];\n      assert(this.g.mul(lambda).x.cmp(this.g.x.redMul(beta)) === 0);\n    }\n  }\n\n  // Get basis vectors, used for balanced length-two representation\n  var basis;\n  if (conf.basis) {\n    basis = conf.basis.map(function(vec) {\n      return {\n        a: new BN(vec.a, 16),\n        b: new BN(vec.b, 16)\n      };\n    });\n  } else {\n    basis = this._getEndoBasis(lambda);\n  }\n\n  return {\n    beta: beta,\n    lambda: lambda,\n    basis: basis\n  };\n};\n\nShortCurve.prototype._getEndoRoots = function _getEndoRoots(num) {\n  // Find roots of for x^2 + x + 1 in F\n  // Root = (-1 +- Sqrt(-3)) / 2\n  //\n  var red = num === this.p ? this.red : BN.mont(num);\n  var tinv = new BN(2).toRed(red).redInvm();\n  var ntinv = tinv.redNeg();\n\n  var s = new BN(3).toRed(red).redNeg().redSqrt().redMul(tinv);\n\n  var l1 = ntinv.redAdd(s).fromRed();\n  var l2 = ntinv.redSub(s).fromRed();\n  return [ l1, l2 ];\n};\n\nShortCurve.prototype._getEndoBasis = function _getEndoBasis(lambda) {\n  // aprxSqrt >= sqrt(this.n)\n  var aprxSqrt = this.n.ushrn(Math.floor(this.n.bitLength() / 2));\n\n  // 3.74\n  // Run EGCD, until r(L + 1) < aprxSqrt\n  var u = lambda;\n  var v = this.n.clone();\n  var x1 = new BN(1);\n  var y1 = new BN(0);\n  var x2 = new BN(0);\n  var y2 = new BN(1);\n\n  // NOTE: all vectors are roots of: a + b * lambda = 0 (mod n)\n  var a0;\n  var b0;\n  // First vector\n  var a1;\n  var b1;\n  // Second vector\n  var a2;\n  var b2;\n\n  var prevR;\n  var i = 0;\n  var r;\n  var x;\n  while (u.cmpn(0) !== 0) {\n    var q = v.div(u);\n    r = v.sub(q.mul(u));\n    x = x2.sub(q.mul(x1));\n    var y = y2.sub(q.mul(y1));\n\n    if (!a1 && r.cmp(aprxSqrt) < 0) {\n      a0 = prevR.neg();\n      b0 = x1;\n      a1 = r.neg();\n      b1 = x;\n    } else if (a1 && ++i === 2) {\n      break;\n    }\n    prevR = r;\n\n    v = u;\n    u = r;\n    x2 = x1;\n    x1 = x;\n    y2 = y1;\n    y1 = y;\n  }\n  a2 = r.neg();\n  b2 = x;\n\n  var len1 = a1.sqr().add(b1.sqr());\n  var len2 = a2.sqr().add(b2.sqr());\n  if (len2.cmp(len1) >= 0) {\n    a2 = a0;\n    b2 = b0;\n  }\n\n  // Normalize signs\n  if (a1.negative) {\n    a1 = a1.neg();\n    b1 = b1.neg();\n  }\n  if (a2.negative) {\n    a2 = a2.neg();\n    b2 = b2.neg();\n  }\n\n  return [\n    { a: a1, b: b1 },\n    { a: a2, b: b2 }\n  ];\n};\n\nShortCurve.prototype._endoSplit = function _endoSplit(k) {\n  var basis = this.endo.basis;\n  var v1 = basis[0];\n  var v2 = basis[1];\n\n  var c1 = v2.b.mul(k).divRound(this.n);\n  var c2 = v1.b.neg().mul(k).divRound(this.n);\n\n  var p1 = c1.mul(v1.a);\n  var p2 = c2.mul(v2.a);\n  var q1 = c1.mul(v1.b);\n  var q2 = c2.mul(v2.b);\n\n  // Calculate answer\n  var k1 = k.sub(p1).sub(p2);\n  var k2 = q1.add(q2).neg();\n  return { k1: k1, k2: k2 };\n};\n\nShortCurve.prototype.pointFromX = function pointFromX(x, odd) {\n  x = new BN(x, 16);\n  if (!x.red)\n    x = x.toRed(this.red);\n\n  var y2 = x.redSqr().redMul(x).redIAdd(x.redMul(this.a)).redIAdd(this.b);\n  var y = y2.redSqrt();\n  if (y.redSqr().redSub(y2).cmp(this.zero) !== 0)\n    throw new Error('invalid point');\n\n  // XXX Is there any way to tell if the number is odd without converting it\n  // to non-red form?\n  var isOdd = y.fromRed().isOdd();\n  if (odd && !isOdd || !odd && isOdd)\n    y = y.redNeg();\n\n  return this.point(x, y);\n};\n\nShortCurve.prototype.validate = function validate(point) {\n  if (point.inf)\n    return true;\n\n  var x = point.x;\n  var y = point.y;\n\n  var ax = this.a.redMul(x);\n  var rhs = x.redSqr().redMul(x).redIAdd(ax).redIAdd(this.b);\n  return y.redSqr().redISub(rhs).cmpn(0) === 0;\n};\n\nShortCurve.prototype._endoWnafMulAdd =\n    function _endoWnafMulAdd(points, coeffs, jacobianResult) {\n  var npoints = this._endoWnafT1;\n  var ncoeffs = this._endoWnafT2;\n  for (var i = 0; i < points.length; i++) {\n    var split = this._endoSplit(coeffs[i]);\n    var p = points[i];\n    var beta = p._getBeta();\n\n    if (split.k1.negative) {\n      split.k1.ineg();\n      p = p.neg(true);\n    }\n    if (split.k2.negative) {\n      split.k2.ineg();\n      beta = beta.neg(true);\n    }\n\n    npoints[i * 2] = p;\n    npoints[i * 2 + 1] = beta;\n    ncoeffs[i * 2] = split.k1;\n    ncoeffs[i * 2 + 1] = split.k2;\n  }\n  var res = this._wnafMulAdd(1, npoints, ncoeffs, i * 2, jacobianResult);\n\n  // Clean-up references to points and coefficients\n  for (var j = 0; j < i * 2; j++) {\n    npoints[j] = null;\n    ncoeffs[j] = null;\n  }\n  return res;\n};\n\nfunction Point(curve, x, y, isRed) {\n  Base.BasePoint.call(this, curve, 'affine');\n  if (x === null && y === null) {\n    this.x = null;\n    this.y = null;\n    this.inf = true;\n  } else {\n    this.x = new BN(x, 16);\n    this.y = new BN(y, 16);\n    // Force redgomery representation when loading from JSON\n    if (isRed) {\n      this.x.forceRed(this.curve.red);\n      this.y.forceRed(this.curve.red);\n    }\n    if (!this.x.red)\n      this.x = this.x.toRed(this.curve.red);\n    if (!this.y.red)\n      this.y = this.y.toRed(this.curve.red);\n    this.inf = false;\n  }\n}\ninherits(Point, Base.BasePoint);\n\nShortCurve.prototype.point = function point(x, y, isRed) {\n  return new Point(this, x, y, isRed);\n};\n\nShortCurve.prototype.pointFromJSON = function pointFromJSON(obj, red) {\n  return Point.fromJSON(this, obj, red);\n};\n\nPoint.prototype._getBeta = function _getBeta() {\n  if (!this.curve.endo)\n    return;\n\n  var pre = this.precomputed;\n  if (pre && pre.beta)\n    return pre.beta;\n\n  var beta = this.curve.point(this.x.redMul(this.curve.endo.beta), this.y);\n  if (pre) {\n    var curve = this.curve;\n    var endoMul = function(p) {\n      return curve.point(p.x.redMul(curve.endo.beta), p.y);\n    };\n    pre.beta = beta;\n    beta.precomputed = {\n      beta: null,\n      naf: pre.naf && {\n        wnd: pre.naf.wnd,\n        points: pre.naf.points.map(endoMul)\n      },\n      doubles: pre.doubles && {\n        step: pre.doubles.step,\n        points: pre.doubles.points.map(endoMul)\n      }\n    };\n  }\n  return beta;\n};\n\nPoint.prototype.toJSON = function toJSON() {\n  if (!this.precomputed)\n    return [ this.x, this.y ];\n\n  return [ this.x, this.y, this.precomputed && {\n    doubles: this.precomputed.doubles && {\n      step: this.precomputed.doubles.step,\n      points: this.precomputed.doubles.points.slice(1)\n    },\n    naf: this.precomputed.naf && {\n      wnd: this.precomputed.naf.wnd,\n      points: this.precomputed.naf.points.slice(1)\n    }\n  } ];\n};\n\nPoint.fromJSON = function fromJSON(curve, obj, red) {\n  if (typeof obj === 'string')\n    obj = JSON.parse(obj);\n  var res = curve.point(obj[0], obj[1], red);\n  if (!obj[2])\n    return res;\n\n  function obj2point(obj) {\n    return curve.point(obj[0], obj[1], red);\n  }\n\n  var pre = obj[2];\n  res.precomputed = {\n    beta: null,\n    doubles: pre.doubles && {\n      step: pre.doubles.step,\n      points: [ res ].concat(pre.doubles.points.map(obj2point))\n    },\n    naf: pre.naf && {\n      wnd: pre.naf.wnd,\n      points: [ res ].concat(pre.naf.points.map(obj2point))\n    }\n  };\n  return res;\n};\n\nPoint.prototype.inspect = function inspect() {\n  if (this.isInfinity())\n    return '<EC Point Infinity>';\n  return '<EC Point x: ' + this.x.fromRed().toString(16, 2) +\n      ' y: ' + this.y.fromRed().toString(16, 2) + '>';\n};\n\nPoint.prototype.isInfinity = function isInfinity() {\n  return this.inf;\n};\n\nPoint.prototype.add = function add(p) {\n  // O + P = P\n  if (this.inf)\n    return p;\n\n  // P + O = P\n  if (p.inf)\n    return this;\n\n  // P + P = 2P\n  if (this.eq(p))\n    return this.dbl();\n\n  // P + (-P) = O\n  if (this.neg().eq(p))\n    return this.curve.point(null, null);\n\n  // P + Q = O\n  if (this.x.cmp(p.x) === 0)\n    return this.curve.point(null, null);\n\n  var c = this.y.redSub(p.y);\n  if (c.cmpn(0) !== 0)\n    c = c.redMul(this.x.redSub(p.x).redInvm());\n  var nx = c.redSqr().redISub(this.x).redISub(p.x);\n  var ny = c.redMul(this.x.redSub(nx)).redISub(this.y);\n  return this.curve.point(nx, ny);\n};\n\nPoint.prototype.dbl = function dbl() {\n  if (this.inf)\n    return this;\n\n  // 2P = O\n  var ys1 = this.y.redAdd(this.y);\n  if (ys1.cmpn(0) === 0)\n    return this.curve.point(null, null);\n\n  var a = this.curve.a;\n\n  var x2 = this.x.redSqr();\n  var dyinv = ys1.redInvm();\n  var c = x2.redAdd(x2).redIAdd(x2).redIAdd(a).redMul(dyinv);\n\n  var nx = c.redSqr().redISub(this.x.redAdd(this.x));\n  var ny = c.redMul(this.x.redSub(nx)).redISub(this.y);\n  return this.curve.point(nx, ny);\n};\n\nPoint.prototype.getX = function getX() {\n  return this.x.fromRed();\n};\n\nPoint.prototype.getY = function getY() {\n  return this.y.fromRed();\n};\n\nPoint.prototype.mul = function mul(k) {\n  k = new BN(k, 16);\n\n  if (this._hasDoubles(k))\n    return this.curve._fixedNafMul(this, k);\n  else if (this.curve.endo)\n    return this.curve._endoWnafMulAdd([ this ], [ k ]);\n  else\n    return this.curve._wnafMul(this, k);\n};\n\nPoint.prototype.mulAdd = function mulAdd(k1, p2, k2) {\n  var points = [ this, p2 ];\n  var coeffs = [ k1, k2 ];\n  if (this.curve.endo)\n    return this.curve._endoWnafMulAdd(points, coeffs);\n  else\n    return this.curve._wnafMulAdd(1, points, coeffs, 2);\n};\n\nPoint.prototype.jmulAdd = function jmulAdd(k1, p2, k2) {\n  var points = [ this, p2 ];\n  var coeffs = [ k1, k2 ];\n  if (this.curve.endo)\n    return this.curve._endoWnafMulAdd(points, coeffs, true);\n  else\n    return this.curve._wnafMulAdd(1, points, coeffs, 2, true);\n};\n\nPoint.prototype.eq = function eq(p) {\n  return this === p ||\n         this.inf === p.inf &&\n             (this.inf || this.x.cmp(p.x) === 0 && this.y.cmp(p.y) === 0);\n};\n\nPoint.prototype.neg = function neg(_precompute) {\n  if (this.inf)\n    return this;\n\n  var res = this.curve.point(this.x, this.y.redNeg());\n  if (_precompute && this.precomputed) {\n    var pre = this.precomputed;\n    var negate = function(p) {\n      return p.neg();\n    };\n    res.precomputed = {\n      naf: pre.naf && {\n        wnd: pre.naf.wnd,\n        points: pre.naf.points.map(negate)\n      },\n      doubles: pre.doubles && {\n        step: pre.doubles.step,\n        points: pre.doubles.points.map(negate)\n      }\n    };\n  }\n  return res;\n};\n\nPoint.prototype.toJ = function toJ() {\n  if (this.inf)\n    return this.curve.jpoint(null, null, null);\n\n  var res = this.curve.jpoint(this.x, this.y, this.curve.one);\n  return res;\n};\n\nfunction JPoint(curve, x, y, z) {\n  Base.BasePoint.call(this, curve, 'jacobian');\n  if (x === null && y === null && z === null) {\n    this.x = this.curve.one;\n    this.y = this.curve.one;\n    this.z = new BN(0);\n  } else {\n    this.x = new BN(x, 16);\n    this.y = new BN(y, 16);\n    this.z = new BN(z, 16);\n  }\n  if (!this.x.red)\n    this.x = this.x.toRed(this.curve.red);\n  if (!this.y.red)\n    this.y = this.y.toRed(this.curve.red);\n  if (!this.z.red)\n    this.z = this.z.toRed(this.curve.red);\n\n  this.zOne = this.z === this.curve.one;\n}\ninherits(JPoint, Base.BasePoint);\n\nShortCurve.prototype.jpoint = function jpoint(x, y, z) {\n  return new JPoint(this, x, y, z);\n};\n\nJPoint.prototype.toP = function toP() {\n  if (this.isInfinity())\n    return this.curve.point(null, null);\n\n  var zinv = this.z.redInvm();\n  var zinv2 = zinv.redSqr();\n  var ax = this.x.redMul(zinv2);\n  var ay = this.y.redMul(zinv2).redMul(zinv);\n\n  return this.curve.point(ax, ay);\n};\n\nJPoint.prototype.neg = function neg() {\n  return this.curve.jpoint(this.x, this.y.redNeg(), this.z);\n};\n\nJPoint.prototype.add = function add(p) {\n  // O + P = P\n  if (this.isInfinity())\n    return p;\n\n  // P + O = P\n  if (p.isInfinity())\n    return this;\n\n  // 12M + 4S + 7A\n  var pz2 = p.z.redSqr();\n  var z2 = this.z.redSqr();\n  var u1 = this.x.redMul(pz2);\n  var u2 = p.x.redMul(z2);\n  var s1 = this.y.redMul(pz2.redMul(p.z));\n  var s2 = p.y.redMul(z2.redMul(this.z));\n\n  var h = u1.redSub(u2);\n  var r = s1.redSub(s2);\n  if (h.cmpn(0) === 0) {\n    if (r.cmpn(0) !== 0)\n      return this.curve.jpoint(null, null, null);\n    else\n      return this.dbl();\n  }\n\n  var h2 = h.redSqr();\n  var h3 = h2.redMul(h);\n  var v = u1.redMul(h2);\n\n  var nx = r.redSqr().redIAdd(h3).redISub(v).redISub(v);\n  var ny = r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));\n  var nz = this.z.redMul(p.z).redMul(h);\n\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype.mixedAdd = function mixedAdd(p) {\n  // O + P = P\n  if (this.isInfinity())\n    return p.toJ();\n\n  // P + O = P\n  if (p.isInfinity())\n    return this;\n\n  // 8M + 3S + 7A\n  var z2 = this.z.redSqr();\n  var u1 = this.x;\n  var u2 = p.x.redMul(z2);\n  var s1 = this.y;\n  var s2 = p.y.redMul(z2).redMul(this.z);\n\n  var h = u1.redSub(u2);\n  var r = s1.redSub(s2);\n  if (h.cmpn(0) === 0) {\n    if (r.cmpn(0) !== 0)\n      return this.curve.jpoint(null, null, null);\n    else\n      return this.dbl();\n  }\n\n  var h2 = h.redSqr();\n  var h3 = h2.redMul(h);\n  var v = u1.redMul(h2);\n\n  var nx = r.redSqr().redIAdd(h3).redISub(v).redISub(v);\n  var ny = r.redMul(v.redISub(nx)).redISub(s1.redMul(h3));\n  var nz = this.z.redMul(h);\n\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype.dblp = function dblp(pow) {\n  if (pow === 0)\n    return this;\n  if (this.isInfinity())\n    return this;\n  if (!pow)\n    return this.dbl();\n\n  if (this.curve.zeroA || this.curve.threeA) {\n    var r = this;\n    for (var i = 0; i < pow; i++)\n      r = r.dbl();\n    return r;\n  }\n\n  // 1M + 2S + 1A + N * (4S + 5M + 8A)\n  // N = 1 => 6M + 6S + 9A\n  var a = this.curve.a;\n  var tinv = this.curve.tinv;\n\n  var jx = this.x;\n  var jy = this.y;\n  var jz = this.z;\n  var jz4 = jz.redSqr().redSqr();\n\n  // Reuse results\n  var jyd = jy.redAdd(jy);\n  for (var i = 0; i < pow; i++) {\n    var jx2 = jx.redSqr();\n    var jyd2 = jyd.redSqr();\n    var jyd4 = jyd2.redSqr();\n    var c = jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4));\n\n    var t1 = jx.redMul(jyd2);\n    var nx = c.redSqr().redISub(t1.redAdd(t1));\n    var t2 = t1.redISub(nx);\n    var dny = c.redMul(t2);\n    dny = dny.redIAdd(dny).redISub(jyd4);\n    var nz = jyd.redMul(jz);\n    if (i + 1 < pow)\n      jz4 = jz4.redMul(jyd4);\n\n    jx = nx;\n    jz = nz;\n    jyd = dny;\n  }\n\n  return this.curve.jpoint(jx, jyd.redMul(tinv), jz);\n};\n\nJPoint.prototype.dbl = function dbl() {\n  if (this.isInfinity())\n    return this;\n\n  if (this.curve.zeroA)\n    return this._zeroDbl();\n  else if (this.curve.threeA)\n    return this._threeDbl();\n  else\n    return this._dbl();\n};\n\nJPoint.prototype._zeroDbl = function _zeroDbl() {\n  var nx;\n  var ny;\n  var nz;\n  // Z = 1\n  if (this.zOne) {\n    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html\n    //     #doubling-mdbl-2007-bl\n    // 1M + 5S + 14A\n\n    // XX = X1^2\n    var xx = this.x.redSqr();\n    // YY = Y1^2\n    var yy = this.y.redSqr();\n    // YYYY = YY^2\n    var yyyy = yy.redSqr();\n    // S = 2 * ((X1 + YY)^2 - XX - YYYY)\n    var s = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);\n    s = s.redIAdd(s);\n    // M = 3 * XX + a; a = 0\n    var m = xx.redAdd(xx).redIAdd(xx);\n    // T = M ^ 2 - 2*S\n    var t = m.redSqr().redISub(s).redISub(s);\n\n    // 8 * YYYY\n    var yyyy8 = yyyy.redIAdd(yyyy);\n    yyyy8 = yyyy8.redIAdd(yyyy8);\n    yyyy8 = yyyy8.redIAdd(yyyy8);\n\n    // X3 = T\n    nx = t;\n    // Y3 = M * (S - T) - 8 * YYYY\n    ny = m.redMul(s.redISub(t)).redISub(yyyy8);\n    // Z3 = 2*Y1\n    nz = this.y.redAdd(this.y);\n  } else {\n    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html\n    //     #doubling-dbl-2009-l\n    // 2M + 5S + 13A\n\n    // A = X1^2\n    var a = this.x.redSqr();\n    // B = Y1^2\n    var b = this.y.redSqr();\n    // C = B^2\n    var c = b.redSqr();\n    // D = 2 * ((X1 + B)^2 - A - C)\n    var d = this.x.redAdd(b).redSqr().redISub(a).redISub(c);\n    d = d.redIAdd(d);\n    // E = 3 * A\n    var e = a.redAdd(a).redIAdd(a);\n    // F = E^2\n    var f = e.redSqr();\n\n    // 8 * C\n    var c8 = c.redIAdd(c);\n    c8 = c8.redIAdd(c8);\n    c8 = c8.redIAdd(c8);\n\n    // X3 = F - 2 * D\n    nx = f.redISub(d).redISub(d);\n    // Y3 = E * (D - X3) - 8 * C\n    ny = e.redMul(d.redISub(nx)).redISub(c8);\n    // Z3 = 2 * Y1 * Z1\n    nz = this.y.redMul(this.z);\n    nz = nz.redIAdd(nz);\n  }\n\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype._threeDbl = function _threeDbl() {\n  var nx;\n  var ny;\n  var nz;\n  // Z = 1\n  if (this.zOne) {\n    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-3.html\n    //     #doubling-mdbl-2007-bl\n    // 1M + 5S + 15A\n\n    // XX = X1^2\n    var xx = this.x.redSqr();\n    // YY = Y1^2\n    var yy = this.y.redSqr();\n    // YYYY = YY^2\n    var yyyy = yy.redSqr();\n    // S = 2 * ((X1 + YY)^2 - XX - YYYY)\n    var s = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);\n    s = s.redIAdd(s);\n    // M = 3 * XX + a\n    var m = xx.redAdd(xx).redIAdd(xx).redIAdd(this.curve.a);\n    // T = M^2 - 2 * S\n    var t = m.redSqr().redISub(s).redISub(s);\n    // X3 = T\n    nx = t;\n    // Y3 = M * (S - T) - 8 * YYYY\n    var yyyy8 = yyyy.redIAdd(yyyy);\n    yyyy8 = yyyy8.redIAdd(yyyy8);\n    yyyy8 = yyyy8.redIAdd(yyyy8);\n    ny = m.redMul(s.redISub(t)).redISub(yyyy8);\n    // Z3 = 2 * Y1\n    nz = this.y.redAdd(this.y);\n  } else {\n    // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-3.html#doubling-dbl-2001-b\n    // 3M + 5S\n\n    // delta = Z1^2\n    var delta = this.z.redSqr();\n    // gamma = Y1^2\n    var gamma = this.y.redSqr();\n    // beta = X1 * gamma\n    var beta = this.x.redMul(gamma);\n    // alpha = 3 * (X1 - delta) * (X1 + delta)\n    var alpha = this.x.redSub(delta).redMul(this.x.redAdd(delta));\n    alpha = alpha.redAdd(alpha).redIAdd(alpha);\n    // X3 = alpha^2 - 8 * beta\n    var beta4 = beta.redIAdd(beta);\n    beta4 = beta4.redIAdd(beta4);\n    var beta8 = beta4.redAdd(beta4);\n    nx = alpha.redSqr().redISub(beta8);\n    // Z3 = (Y1 + Z1)^2 - gamma - delta\n    nz = this.y.redAdd(this.z).redSqr().redISub(gamma).redISub(delta);\n    // Y3 = alpha * (4 * beta - X3) - 8 * gamma^2\n    var ggamma8 = gamma.redSqr();\n    ggamma8 = ggamma8.redIAdd(ggamma8);\n    ggamma8 = ggamma8.redIAdd(ggamma8);\n    ggamma8 = ggamma8.redIAdd(ggamma8);\n    ny = alpha.redMul(beta4.redISub(nx)).redISub(ggamma8);\n  }\n\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype._dbl = function _dbl() {\n  var a = this.curve.a;\n\n  // 4M + 6S + 10A\n  var jx = this.x;\n  var jy = this.y;\n  var jz = this.z;\n  var jz4 = jz.redSqr().redSqr();\n\n  var jx2 = jx.redSqr();\n  var jy2 = jy.redSqr();\n\n  var c = jx2.redAdd(jx2).redIAdd(jx2).redIAdd(a.redMul(jz4));\n\n  var jxd4 = jx.redAdd(jx);\n  jxd4 = jxd4.redIAdd(jxd4);\n  var t1 = jxd4.redMul(jy2);\n  var nx = c.redSqr().redISub(t1.redAdd(t1));\n  var t2 = t1.redISub(nx);\n\n  var jyd8 = jy2.redSqr();\n  jyd8 = jyd8.redIAdd(jyd8);\n  jyd8 = jyd8.redIAdd(jyd8);\n  jyd8 = jyd8.redIAdd(jyd8);\n  var ny = c.redMul(t2).redISub(jyd8);\n  var nz = jy.redAdd(jy).redMul(jz);\n\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype.trpl = function trpl() {\n  if (!this.curve.zeroA)\n    return this.dbl().add(this);\n\n  // hyperelliptic.org/EFD/g1p/auto-shortw-jacobian-0.html#tripling-tpl-2007-bl\n  // 5M + 10S + ...\n\n  // XX = X1^2\n  var xx = this.x.redSqr();\n  // YY = Y1^2\n  var yy = this.y.redSqr();\n  // ZZ = Z1^2\n  var zz = this.z.redSqr();\n  // YYYY = YY^2\n  var yyyy = yy.redSqr();\n  // M = 3 * XX + a * ZZ2; a = 0\n  var m = xx.redAdd(xx).redIAdd(xx);\n  // MM = M^2\n  var mm = m.redSqr();\n  // E = 6 * ((X1 + YY)^2 - XX - YYYY) - MM\n  var e = this.x.redAdd(yy).redSqr().redISub(xx).redISub(yyyy);\n  e = e.redIAdd(e);\n  e = e.redAdd(e).redIAdd(e);\n  e = e.redISub(mm);\n  // EE = E^2\n  var ee = e.redSqr();\n  // T = 16*YYYY\n  var t = yyyy.redIAdd(yyyy);\n  t = t.redIAdd(t);\n  t = t.redIAdd(t);\n  t = t.redIAdd(t);\n  // U = (M + E)^2 - MM - EE - T\n  var u = m.redIAdd(e).redSqr().redISub(mm).redISub(ee).redISub(t);\n  // X3 = 4 * (X1 * EE - 4 * YY * U)\n  var yyu4 = yy.redMul(u);\n  yyu4 = yyu4.redIAdd(yyu4);\n  yyu4 = yyu4.redIAdd(yyu4);\n  var nx = this.x.redMul(ee).redISub(yyu4);\n  nx = nx.redIAdd(nx);\n  nx = nx.redIAdd(nx);\n  // Y3 = 8 * Y1 * (U * (T - U) - E * EE)\n  var ny = this.y.redMul(u.redMul(t.redISub(u)).redISub(e.redMul(ee)));\n  ny = ny.redIAdd(ny);\n  ny = ny.redIAdd(ny);\n  ny = ny.redIAdd(ny);\n  // Z3 = (Z1 + E)^2 - ZZ - EE\n  var nz = this.z.redAdd(e).redSqr().redISub(zz).redISub(ee);\n\n  return this.curve.jpoint(nx, ny, nz);\n};\n\nJPoint.prototype.mul = function mul(k, kbase) {\n  k = new BN(k, kbase);\n\n  return this.curve._wnafMul(this, k);\n};\n\nJPoint.prototype.eq = function eq(p) {\n  if (p.type === 'affine')\n    return this.eq(p.toJ());\n\n  if (this === p)\n    return true;\n\n  // x1 * z2^2 == x2 * z1^2\n  var z2 = this.z.redSqr();\n  var pz2 = p.z.redSqr();\n  if (this.x.redMul(pz2).redISub(p.x.redMul(z2)).cmpn(0) !== 0)\n    return false;\n\n  // y1 * z2^3 == y2 * z1^3\n  var z3 = z2.redMul(this.z);\n  var pz3 = pz2.redMul(p.z);\n  return this.y.redMul(pz3).redISub(p.y.redMul(z3)).cmpn(0) === 0;\n};\n\nJPoint.prototype.eqXToP = function eqXToP(x) {\n  var zs = this.z.redSqr();\n  var rx = x.toRed(this.curve.red).redMul(zs);\n  if (this.x.cmp(rx) === 0)\n    return true;\n\n  var xc = x.clone();\n  var t = this.curve.redN.redMul(zs);\n  for (;;) {\n    xc.iadd(this.curve.n);\n    if (xc.cmp(this.curve.p) >= 0)\n      return false;\n\n    rx.redIAdd(t);\n    if (this.x.cmp(rx) === 0)\n      return true;\n  }\n};\n\nJPoint.prototype.inspect = function inspect() {\n  if (this.isInfinity())\n    return '<EC JPoint Infinity>';\n  return '<EC JPoint x: ' + this.x.toString(16, 2) +\n      ' y: ' + this.y.toString(16, 2) +\n      ' z: ' + this.z.toString(16, 2) + '>';\n};\n\nJPoint.prototype.isInfinity = function isInfinity() {\n  // XXX This code assumes that zero is always zero in red\n  return this.z.cmpn(0) === 0;\n};\n","'use strict';\n\nvar curve = require('../curve');\nvar BN = require('bn.js');\nvar inherits = require('inherits');\nvar Base = curve.base;\n\nvar elliptic = require('../../elliptic');\nvar utils = elliptic.utils;\n\nfunction MontCurve(conf) {\n  Base.call(this, 'mont', conf);\n\n  this.a = new BN(conf.a, 16).toRed(this.red);\n  this.b = new BN(conf.b, 16).toRed(this.red);\n  this.i4 = new BN(4).toRed(this.red).redInvm();\n  this.two = new BN(2).toRed(this.red);\n  this.a24 = this.i4.redMul(this.a.redAdd(this.two));\n}\ninherits(MontCurve, Base);\nmodule.exports = MontCurve;\n\nMontCurve.prototype.validate = function validate(point) {\n  var x = point.normalize().x;\n  var x2 = x.redSqr();\n  var rhs = x2.redMul(x).redAdd(x2.redMul(this.a)).redAdd(x);\n  var y = rhs.redSqrt();\n\n  return y.redSqr().cmp(rhs) === 0;\n};\n\nfunction Point(curve, x, z) {\n  Base.BasePoint.call(this, curve, 'projective');\n  if (x === null && z === null) {\n    this.x = this.curve.one;\n    this.z = this.curve.zero;\n  } else {\n    this.x = new BN(x, 16);\n    this.z = new BN(z, 16);\n    if (!this.x.red)\n      this.x = this.x.toRed(this.curve.red);\n    if (!this.z.red)\n      this.z = this.z.toRed(this.curve.red);\n  }\n}\ninherits(Point, Base.BasePoint);\n\nMontCurve.prototype.decodePoint = function decodePoint(bytes, enc) {\n  return this.point(utils.toArray(bytes, enc), 1);\n};\n\nMontCurve.prototype.point = function point(x, z) {\n  return new Point(this, x, z);\n};\n\nMontCurve.prototype.pointFromJSON = function pointFromJSON(obj) {\n  return Point.fromJSON(this, obj);\n};\n\nPoint.prototype.precompute = function precompute() {\n  // No-op\n};\n\nPoint.prototype._encode = function _encode() {\n  return this.getX().toArray('be', this.curve.p.byteLength());\n};\n\nPoint.fromJSON = function fromJSON(curve, obj) {\n  return new Point(curve, obj[0], obj[1] || curve.one);\n};\n\nPoint.prototype.inspect = function inspect() {\n  if (this.isInfinity())\n    return '<EC Point Infinity>';\n  return '<EC Point x: ' + this.x.fromRed().toString(16, 2) +\n      ' z: ' + this.z.fromRed().toString(16, 2) + '>';\n};\n\nPoint.prototype.isInfinity = function isInfinity() {\n  // XXX This code assumes that zero is always zero in red\n  return this.z.cmpn(0) === 0;\n};\n\nPoint.prototype.dbl = function dbl() {\n  // http://hyperelliptic.org/EFD/g1p/auto-montgom-xz.html#doubling-dbl-1987-m-3\n  // 2M + 2S + 4A\n\n  // A = X1 + Z1\n  var a = this.x.redAdd(this.z);\n  // AA = A^2\n  var aa = a.redSqr();\n  // B = X1 - Z1\n  var b = this.x.redSub(this.z);\n  // BB = B^2\n  var bb = b.redSqr();\n  // C = AA - BB\n  var c = aa.redSub(bb);\n  // X3 = AA * BB\n  var nx = aa.redMul(bb);\n  // Z3 = C * (BB + A24 * C)\n  var nz = c.redMul(bb.redAdd(this.curve.a24.redMul(c)));\n  return this.curve.point(nx, nz);\n};\n\nPoint.prototype.add = function add() {\n  throw new Error('Not supported on Montgomery curve');\n};\n\nPoint.prototype.diffAdd = function diffAdd(p, diff) {\n  // http://hyperelliptic.org/EFD/g1p/auto-montgom-xz.html#diffadd-dadd-1987-m-3\n  // 4M + 2S + 6A\n\n  // A = X2 + Z2\n  var a = this.x.redAdd(this.z);\n  // B = X2 - Z2\n  var b = this.x.redSub(this.z);\n  // C = X3 + Z3\n  var c = p.x.redAdd(p.z);\n  // D = X3 - Z3\n  var d = p.x.redSub(p.z);\n  // DA = D * A\n  var da = d.redMul(a);\n  // CB = C * B\n  var cb = c.redMul(b);\n  // X5 = Z1 * (DA + CB)^2\n  var nx = diff.z.redMul(da.redAdd(cb).redSqr());\n  // Z5 = X1 * (DA - CB)^2\n  var nz = diff.x.redMul(da.redISub(cb).redSqr());\n  return this.curve.point(nx, nz);\n};\n\nPoint.prototype.mul = function mul(k) {\n  var t = k.clone();\n  var a = this; // (N / 2) * Q + Q\n  var b = this.curve.point(null, null); // (N / 2) * Q\n  var c = this; // Q\n\n  for (var bits = []; t.cmpn(0) !== 0; t.iushrn(1))\n    bits.push(t.andln(1));\n\n  for (var i = bits.length - 1; i >= 0; i--) {\n    if (bits[i] === 0) {\n      // N * Q + Q = ((N / 2) * Q + Q)) + (N / 2) * Q\n      a = a.diffAdd(b, c);\n      // N * Q = 2 * ((N / 2) * Q + Q))\n      b = b.dbl();\n    } else {\n      // N * Q = ((N / 2) * Q + Q) + ((N / 2) * Q)\n      b = a.diffAdd(b, c);\n      // N * Q + Q = 2 * ((N / 2) * Q + Q)\n      a = a.dbl();\n    }\n  }\n  return b;\n};\n\nPoint.prototype.mulAdd = function mulAdd() {\n  throw new Error('Not supported on Montgomery curve');\n};\n\nPoint.prototype.jumlAdd = function jumlAdd() {\n  throw new Error('Not supported on Montgomery curve');\n};\n\nPoint.prototype.eq = function eq(other) {\n  return this.getX().cmp(other.getX()) === 0;\n};\n\nPoint.prototype.normalize = function normalize() {\n  this.x = this.x.redMul(this.z.redInvm());\n  this.z = this.curve.one;\n  return this;\n};\n\nPoint.prototype.getX = function getX() {\n  // Normalize coordinates\n  this.normalize();\n\n  return this.x.fromRed();\n};\n","'use strict';\n\nvar curve = require('../curve');\nvar elliptic = require('../../elliptic');\nvar BN = require('bn.js');\nvar inherits = require('inherits');\nvar Base = curve.base;\n\nvar assert = elliptic.utils.assert;\n\nfunction EdwardsCurve(conf) {\n  // NOTE: Important as we are creating point in Base.call()\n  this.twisted = (conf.a | 0) !== 1;\n  this.mOneA = this.twisted && (conf.a | 0) === -1;\n  this.extended = this.mOneA;\n\n  Base.call(this, 'edwards', conf);\n\n  this.a = new BN(conf.a, 16).umod(this.red.m);\n  this.a = this.a.toRed(this.red);\n  this.c = new BN(conf.c, 16).toRed(this.red);\n  this.c2 = this.c.redSqr();\n  this.d = new BN(conf.d, 16).toRed(this.red);\n  this.dd = this.d.redAdd(this.d);\n\n  assert(!this.twisted || this.c.fromRed().cmpn(1) === 0);\n  this.oneC = (conf.c | 0) === 1;\n}\ninherits(EdwardsCurve, Base);\nmodule.exports = EdwardsCurve;\n\nEdwardsCurve.prototype._mulA = function _mulA(num) {\n  if (this.mOneA)\n    return num.redNeg();\n  else\n    return this.a.redMul(num);\n};\n\nEdwardsCurve.prototype._mulC = function _mulC(num) {\n  if (this.oneC)\n    return num;\n  else\n    return this.c.redMul(num);\n};\n\n// Just for compatibility with Short curve\nEdwardsCurve.prototype.jpoint = function jpoint(x, y, z, t) {\n  return this.point(x, y, z, t);\n};\n\nEdwardsCurve.prototype.pointFromX = function pointFromX(x, odd) {\n  x = new BN(x, 16);\n  if (!x.red)\n    x = x.toRed(this.red);\n\n  var x2 = x.redSqr();\n  var rhs = this.c2.redSub(this.a.redMul(x2));\n  var lhs = this.one.redSub(this.c2.redMul(this.d).redMul(x2));\n\n  var y2 = rhs.redMul(lhs.redInvm());\n  var y = y2.redSqrt();\n  if (y.redSqr().redSub(y2).cmp(this.zero) !== 0)\n    throw new Error('invalid point');\n\n  var isOdd = y.fromRed().isOdd();\n  if (odd && !isOdd || !odd && isOdd)\n    y = y.redNeg();\n\n  return this.point(x, y);\n};\n\nEdwardsCurve.prototype.pointFromY = function pointFromY(y, odd) {\n  y = new BN(y, 16);\n  if (!y.red)\n    y = y.toRed(this.red);\n\n  // x^2 = (y^2 - c^2) / (c^2 d y^2 - a)\n  var y2 = y.redSqr();\n  var lhs = y2.redSub(this.c2);\n  var rhs = y2.redMul(this.d).redMul(this.c2).redSub(this.a);\n  var x2 = lhs.redMul(rhs.redInvm());\n\n  if (x2.cmp(this.zero) === 0) {\n    if (odd)\n      throw new Error('invalid point');\n    else\n      return this.point(this.zero, y);\n  }\n\n  var x = x2.redSqrt();\n  if (x.redSqr().redSub(x2).cmp(this.zero) !== 0)\n    throw new Error('invalid point');\n\n  if (x.fromRed().isOdd() !== odd)\n    x = x.redNeg();\n\n  return this.point(x, y);\n};\n\nEdwardsCurve.prototype.validate = function validate(point) {\n  if (point.isInfinity())\n    return true;\n\n  // Curve: A * X^2 + Y^2 = C^2 * (1 + D * X^2 * Y^2)\n  point.normalize();\n\n  var x2 = point.x.redSqr();\n  var y2 = point.y.redSqr();\n  var lhs = x2.redMul(this.a).redAdd(y2);\n  var rhs = this.c2.redMul(this.one.redAdd(this.d.redMul(x2).redMul(y2)));\n\n  return lhs.cmp(rhs) === 0;\n};\n\nfunction Point(curve, x, y, z, t) {\n  Base.BasePoint.call(this, curve, 'projective');\n  if (x === null && y === null && z === null) {\n    this.x = this.curve.zero;\n    this.y = this.curve.one;\n    this.z = this.curve.one;\n    this.t = this.curve.zero;\n    this.zOne = true;\n  } else {\n    this.x = new BN(x, 16);\n    this.y = new BN(y, 16);\n    this.z = z ? new BN(z, 16) : this.curve.one;\n    this.t = t && new BN(t, 16);\n    if (!this.x.red)\n      this.x = this.x.toRed(this.curve.red);\n    if (!this.y.red)\n      this.y = this.y.toRed(this.curve.red);\n    if (!this.z.red)\n      this.z = this.z.toRed(this.curve.red);\n    if (this.t && !this.t.red)\n      this.t = this.t.toRed(this.curve.red);\n    this.zOne = this.z === this.curve.one;\n\n    // Use extended coordinates\n    if (this.curve.extended && !this.t) {\n      this.t = this.x.redMul(this.y);\n      if (!this.zOne)\n        this.t = this.t.redMul(this.z.redInvm());\n    }\n  }\n}\ninherits(Point, Base.BasePoint);\n\nEdwardsCurve.prototype.pointFromJSON = function pointFromJSON(obj) {\n  return Point.fromJSON(this, obj);\n};\n\nEdwardsCurve.prototype.point = function point(x, y, z, t) {\n  return new Point(this, x, y, z, t);\n};\n\nPoint.fromJSON = function fromJSON(curve, obj) {\n  return new Point(curve, obj[0], obj[1], obj[2]);\n};\n\nPoint.prototype.inspect = function inspect() {\n  if (this.isInfinity())\n    return '<EC Point Infinity>';\n  return '<EC Point x: ' + this.x.fromRed().toString(16, 2) +\n      ' y: ' + this.y.fromRed().toString(16, 2) +\n      ' z: ' + this.z.fromRed().toString(16, 2) + '>';\n};\n\nPoint.prototype.isInfinity = function isInfinity() {\n  // XXX This code assumes that zero is always zero in red\n  return this.x.cmpn(0) === 0 &&\n    (this.y.cmp(this.z) === 0 ||\n    (this.zOne && this.y.cmp(this.curve.c) === 0));\n};\n\nPoint.prototype._extDbl = function _extDbl() {\n  // hyperelliptic.org/EFD/g1p/auto-twisted-extended-1.html\n  //     #doubling-dbl-2008-hwcd\n  // 4M + 4S\n\n  // A = X1^2\n  var a = this.x.redSqr();\n  // B = Y1^2\n  var b = this.y.redSqr();\n  // C = 2 * Z1^2\n  var c = this.z.redSqr();\n  c = c.redIAdd(c);\n  // D = a * A\n  var d = this.curve._mulA(a);\n  // E = (X1 + Y1)^2 - A - B\n  var e = this.x.redAdd(this.y).redSqr().redISub(a).redISub(b);\n  // G = D + B\n  var g = d.redAdd(b);\n  // F = G - C\n  var f = g.redSub(c);\n  // H = D - B\n  var h = d.redSub(b);\n  // X3 = E * F\n  var nx = e.redMul(f);\n  // Y3 = G * H\n  var ny = g.redMul(h);\n  // T3 = E * H\n  var nt = e.redMul(h);\n  // Z3 = F * G\n  var nz = f.redMul(g);\n  return this.curve.point(nx, ny, nz, nt);\n};\n\nPoint.prototype._projDbl = function _projDbl() {\n  // hyperelliptic.org/EFD/g1p/auto-twisted-projective.html\n  //     #doubling-dbl-2008-bbjlp\n  //     #doubling-dbl-2007-bl\n  // and others\n  // Generally 3M + 4S or 2M + 4S\n\n  // B = (X1 + Y1)^2\n  var b = this.x.redAdd(this.y).redSqr();\n  // C = X1^2\n  var c = this.x.redSqr();\n  // D = Y1^2\n  var d = this.y.redSqr();\n\n  var nx;\n  var ny;\n  var nz;\n  if (this.curve.twisted) {\n    // E = a * C\n    var e = this.curve._mulA(c);\n    // F = E + D\n    var f = e.redAdd(d);\n    if (this.zOne) {\n      // X3 = (B - C - D) * (F - 2)\n      nx = b.redSub(c).redSub(d).redMul(f.redSub(this.curve.two));\n      // Y3 = F * (E - D)\n      ny = f.redMul(e.redSub(d));\n      // Z3 = F^2 - 2 * F\n      nz = f.redSqr().redSub(f).redSub(f);\n    } else {\n      // H = Z1^2\n      var h = this.z.redSqr();\n      // J = F - 2 * H\n      var j = f.redSub(h).redISub(h);\n      // X3 = (B-C-D)*J\n      nx = b.redSub(c).redISub(d).redMul(j);\n      // Y3 = F * (E - D)\n      ny = f.redMul(e.redSub(d));\n      // Z3 = F * J\n      nz = f.redMul(j);\n    }\n  } else {\n    // E = C + D\n    var e = c.redAdd(d);\n    // H = (c * Z1)^2\n    var h = this.curve._mulC(this.z).redSqr();\n    // J = E - 2 * H\n    var j = e.redSub(h).redSub(h);\n    // X3 = c * (B - E) * J\n    nx = this.curve._mulC(b.redISub(e)).redMul(j);\n    // Y3 = c * E * (C - D)\n    ny = this.curve._mulC(e).redMul(c.redISub(d));\n    // Z3 = E * J\n    nz = e.redMul(j);\n  }\n  return this.curve.point(nx, ny, nz);\n};\n\nPoint.prototype.dbl = function dbl() {\n  if (this.isInfinity())\n    return this;\n\n  // Double in extended coordinates\n  if (this.curve.extended)\n    return this._extDbl();\n  else\n    return this._projDbl();\n};\n\nPoint.prototype._extAdd = function _extAdd(p) {\n  // hyperelliptic.org/EFD/g1p/auto-twisted-extended-1.html\n  //     #addition-add-2008-hwcd-3\n  // 8M\n\n  // A = (Y1 - X1) * (Y2 - X2)\n  var a = this.y.redSub(this.x).redMul(p.y.redSub(p.x));\n  // B = (Y1 + X1) * (Y2 + X2)\n  var b = this.y.redAdd(this.x).redMul(p.y.redAdd(p.x));\n  // C = T1 * k * T2\n  var c = this.t.redMul(this.curve.dd).redMul(p.t);\n  // D = Z1 * 2 * Z2\n  var d = this.z.redMul(p.z.redAdd(p.z));\n  // E = B - A\n  var e = b.redSub(a);\n  // F = D - C\n  var f = d.redSub(c);\n  // G = D + C\n  var g = d.redAdd(c);\n  // H = B + A\n  var h = b.redAdd(a);\n  // X3 = E * F\n  var nx = e.redMul(f);\n  // Y3 = G * H\n  var ny = g.redMul(h);\n  // T3 = E * H\n  var nt = e.redMul(h);\n  // Z3 = F * G\n  var nz = f.redMul(g);\n  return this.curve.point(nx, ny, nz, nt);\n};\n\nPoint.prototype._projAdd = function _projAdd(p) {\n  // hyperelliptic.org/EFD/g1p/auto-twisted-projective.html\n  //     #addition-add-2008-bbjlp\n  //     #addition-add-2007-bl\n  // 10M + 1S\n\n  // A = Z1 * Z2\n  var a = this.z.redMul(p.z);\n  // B = A^2\n  var b = a.redSqr();\n  // C = X1 * X2\n  var c = this.x.redMul(p.x);\n  // D = Y1 * Y2\n  var d = this.y.redMul(p.y);\n  // E = d * C * D\n  var e = this.curve.d.redMul(c).redMul(d);\n  // F = B - E\n  var f = b.redSub(e);\n  // G = B + E\n  var g = b.redAdd(e);\n  // X3 = A * F * ((X1 + Y1) * (X2 + Y2) - C - D)\n  var tmp = this.x.redAdd(this.y).redMul(p.x.redAdd(p.y)).redISub(c).redISub(d);\n  var nx = a.redMul(f).redMul(tmp);\n  var ny;\n  var nz;\n  if (this.curve.twisted) {\n    // Y3 = A * G * (D - a * C)\n    ny = a.redMul(g).redMul(d.redSub(this.curve._mulA(c)));\n    // Z3 = F * G\n    nz = f.redMul(g);\n  } else {\n    // Y3 = A * G * (D - C)\n    ny = a.redMul(g).redMul(d.redSub(c));\n    // Z3 = c * F * G\n    nz = this.curve._mulC(f).redMul(g);\n  }\n  return this.curve.point(nx, ny, nz);\n};\n\nPoint.prototype.add = function add(p) {\n  if (this.isInfinity())\n    return p;\n  if (p.isInfinity())\n    return this;\n\n  if (this.curve.extended)\n    return this._extAdd(p);\n  else\n    return this._projAdd(p);\n};\n\nPoint.prototype.mul = function mul(k) {\n  if (this._hasDoubles(k))\n    return this.curve._fixedNafMul(this, k);\n  else\n    return this.curve._wnafMul(this, k);\n};\n\nPoint.prototype.mulAdd = function mulAdd(k1, p, k2) {\n  return this.curve._wnafMulAdd(1, [ this, p ], [ k1, k2 ], 2, false);\n};\n\nPoint.prototype.jmulAdd = function jmulAdd(k1, p, k2) {\n  return this.curve._wnafMulAdd(1, [ this, p ], [ k1, k2 ], 2, true);\n};\n\nPoint.prototype.normalize = function normalize() {\n  if (this.zOne)\n    return this;\n\n  // Normalize coordinates\n  var zi = this.z.redInvm();\n  this.x = this.x.redMul(zi);\n  this.y = this.y.redMul(zi);\n  if (this.t)\n    this.t = this.t.redMul(zi);\n  this.z = this.curve.one;\n  this.zOne = true;\n  return this;\n};\n\nPoint.prototype.neg = function neg() {\n  return this.curve.point(this.x.redNeg(),\n                          this.y,\n                          this.z,\n                          this.t && this.t.redNeg());\n};\n\nPoint.prototype.getX = function getX() {\n  this.normalize();\n  return this.x.fromRed();\n};\n\nPoint.prototype.getY = function getY() {\n  this.normalize();\n  return this.y.fromRed();\n};\n\nPoint.prototype.eq = function eq(other) {\n  return this === other ||\n         this.getX().cmp(other.getX()) === 0 &&\n         this.getY().cmp(other.getY()) === 0;\n};\n\nPoint.prototype.eqXToP = function eqXToP(x) {\n  var rx = x.toRed(this.curve.red).redMul(this.z);\n  if (this.x.cmp(rx) === 0)\n    return true;\n\n  var xc = x.clone();\n  var t = this.curve.redN.redMul(this.z);\n  for (;;) {\n    xc.iadd(this.curve.n);\n    if (xc.cmp(this.curve.p) >= 0)\n      return false;\n\n    rx.redIAdd(t);\n    if (this.x.cmp(rx) === 0)\n      return true;\n  }\n};\n\n// Compatibility with BaseCurve\nPoint.prototype.toP = Point.prototype.normalize;\nPoint.prototype.mixedAdd = Point.prototype.add;\n","'use strict';\n\nvar curve = exports;\n\ncurve.base = require('./base');\ncurve.short = require('./short');\ncurve.mont = require('./mont');\ncurve.edwards = require('./edwards');\n","'use strict';\n\nvar assert = require('minimalistic-assert');\nvar inherits = require('inherits');\n\nexports.inherits = inherits;\n\nfunction toArray(msg, enc) {\n  if (Array.isArray(msg))\n    return msg.slice();\n  if (!msg)\n    return [];\n  var res = [];\n  if (typeof msg === 'string') {\n    if (!enc) {\n      for (var i = 0; i < msg.length; i++) {\n        var c = msg.charCodeAt(i);\n        var hi = c >> 8;\n        var lo = c & 0xff;\n        if (hi)\n          res.push(hi, lo);\n        else\n          res.push(lo);\n      }\n    } else if (enc === 'hex') {\n      msg = msg.replace(/[^a-z0-9]+/ig, '');\n      if (msg.length % 2 !== 0)\n        msg = '0' + msg;\n      for (i = 0; i < msg.length; i += 2)\n        res.push(parseInt(msg[i] + msg[i + 1], 16));\n    }\n  } else {\n    for (i = 0; i < msg.length; i++)\n      res[i] = msg[i] | 0;\n  }\n  return res;\n}\nexports.toArray = toArray;\n\nfunction toHex(msg) {\n  var res = '';\n  for (var i = 0; i < msg.length; i++)\n    res += zero2(msg[i].toString(16));\n  return res;\n}\nexports.toHex = toHex;\n\nfunction htonl(w) {\n  var res = (w >>> 24) |\n            ((w >>> 8) & 0xff00) |\n            ((w << 8) & 0xff0000) |\n            ((w & 0xff) << 24);\n  return res >>> 0;\n}\nexports.htonl = htonl;\n\nfunction toHex32(msg, endian) {\n  var res = '';\n  for (var i = 0; i < msg.length; i++) {\n    var w = msg[i];\n    if (endian === 'little')\n      w = htonl(w);\n    res += zero8(w.toString(16));\n  }\n  return res;\n}\nexports.toHex32 = toHex32;\n\nfunction zero2(word) {\n  if (word.length === 1)\n    return '0' + word;\n  else\n    return word;\n}\nexports.zero2 = zero2;\n\nfunction zero8(word) {\n  if (word.length === 7)\n    return '0' + word;\n  else if (word.length === 6)\n    return '00' + word;\n  else if (word.length === 5)\n    return '000' + word;\n  else if (word.length === 4)\n    return '0000' + word;\n  else if (word.length === 3)\n    return '00000' + word;\n  else if (word.length === 2)\n    return '000000' + word;\n  else if (word.length === 1)\n    return '0000000' + word;\n  else\n    return word;\n}\nexports.zero8 = zero8;\n\nfunction join32(msg, start, end, endian) {\n  var len = end - start;\n  assert(len % 4 === 0);\n  var res = new Array(len / 4);\n  for (var i = 0, k = start; i < res.length; i++, k += 4) {\n    var w;\n    if (endian === 'big')\n      w = (msg[k] << 24) | (msg[k + 1] << 16) | (msg[k + 2] << 8) | msg[k + 3];\n    else\n      w = (msg[k + 3] << 24) | (msg[k + 2] << 16) | (msg[k + 1] << 8) | msg[k];\n    res[i] = w >>> 0;\n  }\n  return res;\n}\nexports.join32 = join32;\n\nfunction split32(msg, endian) {\n  var res = new Array(msg.length * 4);\n  for (var i = 0, k = 0; i < msg.length; i++, k += 4) {\n    var m = msg[i];\n    if (endian === 'big') {\n      res[k] = m >>> 24;\n      res[k + 1] = (m >>> 16) & 0xff;\n      res[k + 2] = (m >>> 8) & 0xff;\n      res[k + 3] = m & 0xff;\n    } else {\n      res[k + 3] = m >>> 24;\n      res[k + 2] = (m >>> 16) & 0xff;\n      res[k + 1] = (m >>> 8) & 0xff;\n      res[k] = m & 0xff;\n    }\n  }\n  return res;\n}\nexports.split32 = split32;\n\nfunction rotr32(w, b) {\n  return (w >>> b) | (w << (32 - b));\n}\nexports.rotr32 = rotr32;\n\nfunction rotl32(w, b) {\n  return (w << b) | (w >>> (32 - b));\n}\nexports.rotl32 = rotl32;\n\nfunction sum32(a, b) {\n  return (a + b) >>> 0;\n}\nexports.sum32 = sum32;\n\nfunction sum32_3(a, b, c) {\n  return (a + b + c) >>> 0;\n}\nexports.sum32_3 = sum32_3;\n\nfunction sum32_4(a, b, c, d) {\n  return (a + b + c + d) >>> 0;\n}\nexports.sum32_4 = sum32_4;\n\nfunction sum32_5(a, b, c, d, e) {\n  return (a + b + c + d + e) >>> 0;\n}\nexports.sum32_5 = sum32_5;\n\nfunction sum64(buf, pos, ah, al) {\n  var bh = buf[pos];\n  var bl = buf[pos + 1];\n\n  var lo = (al + bl) >>> 0;\n  var hi = (lo < al ? 1 : 0) + ah + bh;\n  buf[pos] = hi >>> 0;\n  buf[pos + 1] = lo;\n}\nexports.sum64 = sum64;\n\nfunction sum64_hi(ah, al, bh, bl) {\n  var lo = (al + bl) >>> 0;\n  var hi = (lo < al ? 1 : 0) + ah + bh;\n  return hi >>> 0;\n}\nexports.sum64_hi = sum64_hi;\n\nfunction sum64_lo(ah, al, bh, bl) {\n  var lo = al + bl;\n  return lo >>> 0;\n}\nexports.sum64_lo = sum64_lo;\n\nfunction sum64_4_hi(ah, al, bh, bl, ch, cl, dh, dl) {\n  var carry = 0;\n  var lo = al;\n  lo = (lo + bl) >>> 0;\n  carry += lo < al ? 1 : 0;\n  lo = (lo + cl) >>> 0;\n  carry += lo < cl ? 1 : 0;\n  lo = (lo + dl) >>> 0;\n  carry += lo < dl ? 1 : 0;\n\n  var hi = ah + bh + ch + dh + carry;\n  return hi >>> 0;\n}\nexports.sum64_4_hi = sum64_4_hi;\n\nfunction sum64_4_lo(ah, al, bh, bl, ch, cl, dh, dl) {\n  var lo = al + bl + cl + dl;\n  return lo >>> 0;\n}\nexports.sum64_4_lo = sum64_4_lo;\n\nfunction sum64_5_hi(ah, al, bh, bl, ch, cl, dh, dl, eh, el) {\n  var carry = 0;\n  var lo = al;\n  lo = (lo + bl) >>> 0;\n  carry += lo < al ? 1 : 0;\n  lo = (lo + cl) >>> 0;\n  carry += lo < cl ? 1 : 0;\n  lo = (lo + dl) >>> 0;\n  carry += lo < dl ? 1 : 0;\n  lo = (lo + el) >>> 0;\n  carry += lo < el ? 1 : 0;\n\n  var hi = ah + bh + ch + dh + eh + carry;\n  return hi >>> 0;\n}\nexports.sum64_5_hi = sum64_5_hi;\n\nfunction sum64_5_lo(ah, al, bh, bl, ch, cl, dh, dl, eh, el) {\n  var lo = al + bl + cl + dl + el;\n\n  return lo >>> 0;\n}\nexports.sum64_5_lo = sum64_5_lo;\n\nfunction rotr64_hi(ah, al, num) {\n  var r = (al << (32 - num)) | (ah >>> num);\n  return r >>> 0;\n}\nexports.rotr64_hi = rotr64_hi;\n\nfunction rotr64_lo(ah, al, num) {\n  var r = (ah << (32 - num)) | (al >>> num);\n  return r >>> 0;\n}\nexports.rotr64_lo = rotr64_lo;\n\nfunction shr64_hi(ah, al, num) {\n  return ah >>> num;\n}\nexports.shr64_hi = shr64_hi;\n\nfunction shr64_lo(ah, al, num) {\n  var r = (ah << (32 - num)) | (al >>> num);\n  return r >>> 0;\n}\nexports.shr64_lo = shr64_lo;\n","'use strict';\n\nvar utils = require('./utils');\nvar assert = require('minimalistic-assert');\n\nfunction BlockHash() {\n  this.pending = null;\n  this.pendingTotal = 0;\n  this.blockSize = this.constructor.blockSize;\n  this.outSize = this.constructor.outSize;\n  this.hmacStrength = this.constructor.hmacStrength;\n  this.padLength = this.constructor.padLength / 8;\n  this.endian = 'big';\n\n  this._delta8 = this.blockSize / 8;\n  this._delta32 = this.blockSize / 32;\n}\nexports.BlockHash = BlockHash;\n\nBlockHash.prototype.update = function update(msg, enc) {\n  // Convert message to array, pad it, and join into 32bit blocks\n  msg = utils.toArray(msg, enc);\n  if (!this.pending)\n    this.pending = msg;\n  else\n    this.pending = this.pending.concat(msg);\n  this.pendingTotal += msg.length;\n\n  // Enough data, try updating\n  if (this.pending.length >= this._delta8) {\n    msg = this.pending;\n\n    // Process pending data in blocks\n    var r = msg.length % this._delta8;\n    this.pending = msg.slice(msg.length - r, msg.length);\n    if (this.pending.length === 0)\n      this.pending = null;\n\n    msg = utils.join32(msg, 0, msg.length - r, this.endian);\n    for (var i = 0; i < msg.length; i += this._delta32)\n      this._update(msg, i, i + this._delta32);\n  }\n\n  return this;\n};\n\nBlockHash.prototype.digest = function digest(enc) {\n  this.update(this._pad());\n  assert(this.pending === null);\n\n  return this._digest(enc);\n};\n\nBlockHash.prototype._pad = function pad() {\n  var len = this.pendingTotal;\n  var bytes = this._delta8;\n  var k = bytes - ((len + this.padLength) % bytes);\n  var res = new Array(k + this.padLength);\n  res[0] = 0x80;\n  for (var i = 1; i < k; i++)\n    res[i] = 0;\n\n  // Append length\n  len <<= 3;\n  if (this.endian === 'big') {\n    for (var t = 8; t < this.padLength; t++)\n      res[i++] = 0;\n\n    res[i++] = 0;\n    res[i++] = 0;\n    res[i++] = 0;\n    res[i++] = 0;\n    res[i++] = (len >>> 24) & 0xff;\n    res[i++] = (len >>> 16) & 0xff;\n    res[i++] = (len >>> 8) & 0xff;\n    res[i++] = len & 0xff;\n  } else {\n    res[i++] = len & 0xff;\n    res[i++] = (len >>> 8) & 0xff;\n    res[i++] = (len >>> 16) & 0xff;\n    res[i++] = (len >>> 24) & 0xff;\n    res[i++] = 0;\n    res[i++] = 0;\n    res[i++] = 0;\n    res[i++] = 0;\n\n    for (t = 8; t < this.padLength; t++)\n      res[i++] = 0;\n  }\n\n  return res;\n};\n","'use strict';\n\nvar utils = require('../utils');\nvar rotr32 = utils.rotr32;\n\nfunction ft_1(s, x, y, z) {\n  if (s === 0)\n    return ch32(x, y, z);\n  if (s === 1 || s === 3)\n    return p32(x, y, z);\n  if (s === 2)\n    return maj32(x, y, z);\n}\nexports.ft_1 = ft_1;\n\nfunction ch32(x, y, z) {\n  return (x & y) ^ ((~x) & z);\n}\nexports.ch32 = ch32;\n\nfunction maj32(x, y, z) {\n  return (x & y) ^ (x & z) ^ (y & z);\n}\nexports.maj32 = maj32;\n\nfunction p32(x, y, z) {\n  return x ^ y ^ z;\n}\nexports.p32 = p32;\n\nfunction s0_256(x) {\n  return rotr32(x, 2) ^ rotr32(x, 13) ^ rotr32(x, 22);\n}\nexports.s0_256 = s0_256;\n\nfunction s1_256(x) {\n  return rotr32(x, 6) ^ rotr32(x, 11) ^ rotr32(x, 25);\n}\nexports.s1_256 = s1_256;\n\nfunction g0_256(x) {\n  return rotr32(x, 7) ^ rotr32(x, 18) ^ (x >>> 3);\n}\nexports.g0_256 = g0_256;\n\nfunction g1_256(x) {\n  return rotr32(x, 17) ^ rotr32(x, 19) ^ (x >>> 10);\n}\nexports.g1_256 = g1_256;\n","'use strict';\n\nvar utils = require('../utils');\nvar common = require('../common');\nvar shaCommon = require('./common');\n\nvar rotl32 = utils.rotl32;\nvar sum32 = utils.sum32;\nvar sum32_5 = utils.sum32_5;\nvar ft_1 = shaCommon.ft_1;\nvar BlockHash = common.BlockHash;\n\nvar sha1_K = [\n  0x5A827999, 0x6ED9EBA1,\n  0x8F1BBCDC, 0xCA62C1D6\n];\n\nfunction SHA1() {\n  if (!(this instanceof SHA1))\n    return new SHA1();\n\n  BlockHash.call(this);\n  this.h = [\n    0x67452301, 0xefcdab89, 0x98badcfe,\n    0x10325476, 0xc3d2e1f0 ];\n  this.W = new Array(80);\n}\n\nutils.inherits(SHA1, BlockHash);\nmodule.exports = SHA1;\n\nSHA1.blockSize = 512;\nSHA1.outSize = 160;\nSHA1.hmacStrength = 80;\nSHA1.padLength = 64;\n\nSHA1.prototype._update = function _update(msg, start) {\n  var W = this.W;\n\n  for (var i = 0; i < 16; i++)\n    W[i] = msg[start + i];\n\n  for(; i < W.length; i++)\n    W[i] = rotl32(W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16], 1);\n\n  var a = this.h[0];\n  var b = this.h[1];\n  var c = this.h[2];\n  var d = this.h[3];\n  var e = this.h[4];\n\n  for (i = 0; i < W.length; i++) {\n    var s = ~~(i / 20);\n    var t = sum32_5(rotl32(a, 5), ft_1(s, b, c, d), e, W[i], sha1_K[s]);\n    e = d;\n    d = c;\n    c = rotl32(b, 30);\n    b = a;\n    a = t;\n  }\n\n  this.h[0] = sum32(this.h[0], a);\n  this.h[1] = sum32(this.h[1], b);\n  this.h[2] = sum32(this.h[2], c);\n  this.h[3] = sum32(this.h[3], d);\n  this.h[4] = sum32(this.h[4], e);\n};\n\nSHA1.prototype._digest = function digest(enc) {\n  if (enc === 'hex')\n    return utils.toHex32(this.h, 'big');\n  else\n    return utils.split32(this.h, 'big');\n};\n","'use strict';\n\nvar utils = require('../utils');\nvar common = require('../common');\nvar shaCommon = require('./common');\nvar assert = require('minimalistic-assert');\n\nvar sum32 = utils.sum32;\nvar sum32_4 = utils.sum32_4;\nvar sum32_5 = utils.sum32_5;\nvar ch32 = shaCommon.ch32;\nvar maj32 = shaCommon.maj32;\nvar s0_256 = shaCommon.s0_256;\nvar s1_256 = shaCommon.s1_256;\nvar g0_256 = shaCommon.g0_256;\nvar g1_256 = shaCommon.g1_256;\n\nvar BlockHash = common.BlockHash;\n\nvar sha256_K = [\n  0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5,\n  0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,\n  0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3,\n  0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,\n  0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc,\n  0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,\n  0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7,\n  0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,\n  0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13,\n  0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,\n  0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3,\n  0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,\n  0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5,\n  0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,\n  0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208,\n  0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2\n];\n\nfunction SHA256() {\n  if (!(this instanceof SHA256))\n    return new SHA256();\n\n  BlockHash.call(this);\n  this.h = [\n    0x6a09e667, 0xbb67ae85, 0x3c6ef372, 0xa54ff53a,\n    0x510e527f, 0x9b05688c, 0x1f83d9ab, 0x5be0cd19\n  ];\n  this.k = sha256_K;\n  this.W = new Array(64);\n}\nutils.inherits(SHA256, BlockHash);\nmodule.exports = SHA256;\n\nSHA256.blockSize = 512;\nSHA256.outSize = 256;\nSHA256.hmacStrength = 192;\nSHA256.padLength = 64;\n\nSHA256.prototype._update = function _update(msg, start) {\n  var W = this.W;\n\n  for (var i = 0; i < 16; i++)\n    W[i] = msg[start + i];\n  for (; i < W.length; i++)\n    W[i] = sum32_4(g1_256(W[i - 2]), W[i - 7], g0_256(W[i - 15]), W[i - 16]);\n\n  var a = this.h[0];\n  var b = this.h[1];\n  var c = this.h[2];\n  var d = this.h[3];\n  var e = this.h[4];\n  var f = this.h[5];\n  var g = this.h[6];\n  var h = this.h[7];\n\n  assert(this.k.length === W.length);\n  for (i = 0; i < W.length; i++) {\n    var T1 = sum32_5(h, s1_256(e), ch32(e, f, g), this.k[i], W[i]);\n    var T2 = sum32(s0_256(a), maj32(a, b, c));\n    h = g;\n    g = f;\n    f = e;\n    e = sum32(d, T1);\n    d = c;\n    c = b;\n    b = a;\n    a = sum32(T1, T2);\n  }\n\n  this.h[0] = sum32(this.h[0], a);\n  this.h[1] = sum32(this.h[1], b);\n  this.h[2] = sum32(this.h[2], c);\n  this.h[3] = sum32(this.h[3], d);\n  this.h[4] = sum32(this.h[4], e);\n  this.h[5] = sum32(this.h[5], f);\n  this.h[6] = sum32(this.h[6], g);\n  this.h[7] = sum32(this.h[7], h);\n};\n\nSHA256.prototype._digest = function digest(enc) {\n  if (enc === 'hex')\n    return utils.toHex32(this.h, 'big');\n  else\n    return utils.split32(this.h, 'big');\n};\n","'use strict';\n\nvar utils = require('../utils');\nvar SHA256 = require('./256');\n\nfunction SHA224() {\n  if (!(this instanceof SHA224))\n    return new SHA224();\n\n  SHA256.call(this);\n  this.h = [\n    0xc1059ed8, 0x367cd507, 0x3070dd17, 0xf70e5939,\n    0xffc00b31, 0x68581511, 0x64f98fa7, 0xbefa4fa4 ];\n}\nutils.inherits(SHA224, SHA256);\nmodule.exports = SHA224;\n\nSHA224.blockSize = 512;\nSHA224.outSize = 224;\nSHA224.hmacStrength = 192;\nSHA224.padLength = 64;\n\nSHA224.prototype._digest = function digest(enc) {\n  // Just truncate output\n  if (enc === 'hex')\n    return utils.toHex32(this.h.slice(0, 7), 'big');\n  else\n    return utils.split32(this.h.slice(0, 7), 'big');\n};\n\n","'use strict';\n\nvar utils = require('../utils');\nvar common = require('../common');\nvar assert = require('minimalistic-assert');\n\nvar rotr64_hi = utils.rotr64_hi;\nvar rotr64_lo = utils.rotr64_lo;\nvar shr64_hi = utils.shr64_hi;\nvar shr64_lo = utils.shr64_lo;\nvar sum64 = utils.sum64;\nvar sum64_hi = utils.sum64_hi;\nvar sum64_lo = utils.sum64_lo;\nvar sum64_4_hi = utils.sum64_4_hi;\nvar sum64_4_lo = utils.sum64_4_lo;\nvar sum64_5_hi = utils.sum64_5_hi;\nvar sum64_5_lo = utils.sum64_5_lo;\n\nvar BlockHash = common.BlockHash;\n\nvar sha512_K = [\n  0x428a2f98, 0xd728ae22, 0x71374491, 0x23ef65cd,\n  0xb5c0fbcf, 0xec4d3b2f, 0xe9b5dba5, 0x8189dbbc,\n  0x3956c25b, 0xf348b538, 0x59f111f1, 0xb605d019,\n  0x923f82a4, 0xaf194f9b, 0xab1c5ed5, 0xda6d8118,\n  0xd807aa98, 0xa3030242, 0x12835b01, 0x45706fbe,\n  0x243185be, 0x4ee4b28c, 0x550c7dc3, 0xd5ffb4e2,\n  0x72be5d74, 0xf27b896f, 0x80deb1fe, 0x3b1696b1,\n  0x9bdc06a7, 0x25c71235, 0xc19bf174, 0xcf692694,\n  0xe49b69c1, 0x9ef14ad2, 0xefbe4786, 0x384f25e3,\n  0x0fc19dc6, 0x8b8cd5b5, 0x240ca1cc, 0x77ac9c65,\n  0x2de92c6f, 0x592b0275, 0x4a7484aa, 0x6ea6e483,\n  0x5cb0a9dc, 0xbd41fbd4, 0x76f988da, 0x831153b5,\n  0x983e5152, 0xee66dfab, 0xa831c66d, 0x2db43210,\n  0xb00327c8, 0x98fb213f, 0xbf597fc7, 0xbeef0ee4,\n  0xc6e00bf3, 0x3da88fc2, 0xd5a79147, 0x930aa725,\n  0x06ca6351, 0xe003826f, 0x14292967, 0x0a0e6e70,\n  0x27b70a85, 0x46d22ffc, 0x2e1b2138, 0x5c26c926,\n  0x4d2c6dfc, 0x5ac42aed, 0x53380d13, 0x9d95b3df,\n  0x650a7354, 0x8baf63de, 0x766a0abb, 0x3c77b2a8,\n  0x81c2c92e, 0x47edaee6, 0x92722c85, 0x1482353b,\n  0xa2bfe8a1, 0x4cf10364, 0xa81a664b, 0xbc423001,\n  0xc24b8b70, 0xd0f89791, 0xc76c51a3, 0x0654be30,\n  0xd192e819, 0xd6ef5218, 0xd6990624, 0x5565a910,\n  0xf40e3585, 0x5771202a, 0x106aa070, 0x32bbd1b8,\n  0x19a4c116, 0xb8d2d0c8, 0x1e376c08, 0x5141ab53,\n  0x2748774c, 0xdf8eeb99, 0x34b0bcb5, 0xe19b48a8,\n  0x391c0cb3, 0xc5c95a63, 0x4ed8aa4a, 0xe3418acb,\n  0x5b9cca4f, 0x7763e373, 0x682e6ff3, 0xd6b2b8a3,\n  0x748f82ee, 0x5defb2fc, 0x78a5636f, 0x43172f60,\n  0x84c87814, 0xa1f0ab72, 0x8cc70208, 0x1a6439ec,\n  0x90befffa, 0x23631e28, 0xa4506ceb, 0xde82bde9,\n  0xbef9a3f7, 0xb2c67915, 0xc67178f2, 0xe372532b,\n  0xca273ece, 0xea26619c, 0xd186b8c7, 0x21c0c207,\n  0xeada7dd6, 0xcde0eb1e, 0xf57d4f7f, 0xee6ed178,\n  0x06f067aa, 0x72176fba, 0x0a637dc5, 0xa2c898a6,\n  0x113f9804, 0xbef90dae, 0x1b710b35, 0x131c471b,\n  0x28db77f5, 0x23047d84, 0x32caab7b, 0x40c72493,\n  0x3c9ebe0a, 0x15c9bebc, 0x431d67c4, 0x9c100d4c,\n  0x4cc5d4be, 0xcb3e42b6, 0x597f299c, 0xfc657e2a,\n  0x5fcb6fab, 0x3ad6faec, 0x6c44198c, 0x4a475817\n];\n\nfunction SHA512() {\n  if (!(this instanceof SHA512))\n    return new SHA512();\n\n  BlockHash.call(this);\n  this.h = [\n    0x6a09e667, 0xf3bcc908,\n    0xbb67ae85, 0x84caa73b,\n    0x3c6ef372, 0xfe94f82b,\n    0xa54ff53a, 0x5f1d36f1,\n    0x510e527f, 0xade682d1,\n    0x9b05688c, 0x2b3e6c1f,\n    0x1f83d9ab, 0xfb41bd6b,\n    0x5be0cd19, 0x137e2179 ];\n  this.k = sha512_K;\n  this.W = new Array(160);\n}\nutils.inherits(SHA512, BlockHash);\nmodule.exports = SHA512;\n\nSHA512.blockSize = 1024;\nSHA512.outSize = 512;\nSHA512.hmacStrength = 192;\nSHA512.padLength = 128;\n\nSHA512.prototype._prepareBlock = function _prepareBlock(msg, start) {\n  var W = this.W;\n\n  // 32 x 32bit words\n  for (var i = 0; i < 32; i++)\n    W[i] = msg[start + i];\n  for (; i < W.length; i += 2) {\n    var c0_hi = g1_512_hi(W[i - 4], W[i - 3]);  // i - 2\n    var c0_lo = g1_512_lo(W[i - 4], W[i - 3]);\n    var c1_hi = W[i - 14];  // i - 7\n    var c1_lo = W[i - 13];\n    var c2_hi = g0_512_hi(W[i - 30], W[i - 29]);  // i - 15\n    var c2_lo = g0_512_lo(W[i - 30], W[i - 29]);\n    var c3_hi = W[i - 32];  // i - 16\n    var c3_lo = W[i - 31];\n\n    W[i] = sum64_4_hi(\n      c0_hi, c0_lo,\n      c1_hi, c1_lo,\n      c2_hi, c2_lo,\n      c3_hi, c3_lo);\n    W[i + 1] = sum64_4_lo(\n      c0_hi, c0_lo,\n      c1_hi, c1_lo,\n      c2_hi, c2_lo,\n      c3_hi, c3_lo);\n  }\n};\n\nSHA512.prototype._update = function _update(msg, start) {\n  this._prepareBlock(msg, start);\n\n  var W = this.W;\n\n  var ah = this.h[0];\n  var al = this.h[1];\n  var bh = this.h[2];\n  var bl = this.h[3];\n  var ch = this.h[4];\n  var cl = this.h[5];\n  var dh = this.h[6];\n  var dl = this.h[7];\n  var eh = this.h[8];\n  var el = this.h[9];\n  var fh = this.h[10];\n  var fl = this.h[11];\n  var gh = this.h[12];\n  var gl = this.h[13];\n  var hh = this.h[14];\n  var hl = this.h[15];\n\n  assert(this.k.length === W.length);\n  for (var i = 0; i < W.length; i += 2) {\n    var c0_hi = hh;\n    var c0_lo = hl;\n    var c1_hi = s1_512_hi(eh, el);\n    var c1_lo = s1_512_lo(eh, el);\n    var c2_hi = ch64_hi(eh, el, fh, fl, gh, gl);\n    var c2_lo = ch64_lo(eh, el, fh, fl, gh, gl);\n    var c3_hi = this.k[i];\n    var c3_lo = this.k[i + 1];\n    var c4_hi = W[i];\n    var c4_lo = W[i + 1];\n\n    var T1_hi = sum64_5_hi(\n      c0_hi, c0_lo,\n      c1_hi, c1_lo,\n      c2_hi, c2_lo,\n      c3_hi, c3_lo,\n      c4_hi, c4_lo);\n    var T1_lo = sum64_5_lo(\n      c0_hi, c0_lo,\n      c1_hi, c1_lo,\n      c2_hi, c2_lo,\n      c3_hi, c3_lo,\n      c4_hi, c4_lo);\n\n    c0_hi = s0_512_hi(ah, al);\n    c0_lo = s0_512_lo(ah, al);\n    c1_hi = maj64_hi(ah, al, bh, bl, ch, cl);\n    c1_lo = maj64_lo(ah, al, bh, bl, ch, cl);\n\n    var T2_hi = sum64_hi(c0_hi, c0_lo, c1_hi, c1_lo);\n    var T2_lo = sum64_lo(c0_hi, c0_lo, c1_hi, c1_lo);\n\n    hh = gh;\n    hl = gl;\n\n    gh = fh;\n    gl = fl;\n\n    fh = eh;\n    fl = el;\n\n    eh = sum64_hi(dh, dl, T1_hi, T1_lo);\n    el = sum64_lo(dl, dl, T1_hi, T1_lo);\n\n    dh = ch;\n    dl = cl;\n\n    ch = bh;\n    cl = bl;\n\n    bh = ah;\n    bl = al;\n\n    ah = sum64_hi(T1_hi, T1_lo, T2_hi, T2_lo);\n    al = sum64_lo(T1_hi, T1_lo, T2_hi, T2_lo);\n  }\n\n  sum64(this.h, 0, ah, al);\n  sum64(this.h, 2, bh, bl);\n  sum64(this.h, 4, ch, cl);\n  sum64(this.h, 6, dh, dl);\n  sum64(this.h, 8, eh, el);\n  sum64(this.h, 10, fh, fl);\n  sum64(this.h, 12, gh, gl);\n  sum64(this.h, 14, hh, hl);\n};\n\nSHA512.prototype._digest = function digest(enc) {\n  if (enc === 'hex')\n    return utils.toHex32(this.h, 'big');\n  else\n    return utils.split32(this.h, 'big');\n};\n\nfunction ch64_hi(xh, xl, yh, yl, zh) {\n  var r = (xh & yh) ^ ((~xh) & zh);\n  if (r < 0)\n    r += 0x100000000;\n  return r;\n}\n\nfunction ch64_lo(xh, xl, yh, yl, zh, zl) {\n  var r = (xl & yl) ^ ((~xl) & zl);\n  if (r < 0)\n    r += 0x100000000;\n  return r;\n}\n\nfunction maj64_hi(xh, xl, yh, yl, zh) {\n  var r = (xh & yh) ^ (xh & zh) ^ (yh & zh);\n  if (r < 0)\n    r += 0x100000000;\n  return r;\n}\n\nfunction maj64_lo(xh, xl, yh, yl, zh, zl) {\n  var r = (xl & yl) ^ (xl & zl) ^ (yl & zl);\n  if (r < 0)\n    r += 0x100000000;\n  return r;\n}\n\nfunction s0_512_hi(xh, xl) {\n  var c0_hi = rotr64_hi(xh, xl, 28);\n  var c1_hi = rotr64_hi(xl, xh, 2);  // 34\n  var c2_hi = rotr64_hi(xl, xh, 7);  // 39\n\n  var r = c0_hi ^ c1_hi ^ c2_hi;\n  if (r < 0)\n    r += 0x100000000;\n  return r;\n}\n\nfunction s0_512_lo(xh, xl) {\n  var c0_lo = rotr64_lo(xh, xl, 28);\n  var c1_lo = rotr64_lo(xl, xh, 2);  // 34\n  var c2_lo = rotr64_lo(xl, xh, 7);  // 39\n\n  var r = c0_lo ^ c1_lo ^ c2_lo;\n  if (r < 0)\n    r += 0x100000000;\n  return r;\n}\n\nfunction s1_512_hi(xh, xl) {\n  var c0_hi = rotr64_hi(xh, xl, 14);\n  var c1_hi = rotr64_hi(xh, xl, 18);\n  var c2_hi = rotr64_hi(xl, xh, 9);  // 41\n\n  var r = c0_hi ^ c1_hi ^ c2_hi;\n  if (r < 0)\n    r += 0x100000000;\n  return r;\n}\n\nfunction s1_512_lo(xh, xl) {\n  var c0_lo = rotr64_lo(xh, xl, 14);\n  var c1_lo = rotr64_lo(xh, xl, 18);\n  var c2_lo = rotr64_lo(xl, xh, 9);  // 41\n\n  var r = c0_lo ^ c1_lo ^ c2_lo;\n  if (r < 0)\n    r += 0x100000000;\n  return r;\n}\n\nfunction g0_512_hi(xh, xl) {\n  var c0_hi = rotr64_hi(xh, xl, 1);\n  var c1_hi = rotr64_hi(xh, xl, 8);\n  var c2_hi = shr64_hi(xh, xl, 7);\n\n  var r = c0_hi ^ c1_hi ^ c2_hi;\n  if (r < 0)\n    r += 0x100000000;\n  return r;\n}\n\nfunction g0_512_lo(xh, xl) {\n  var c0_lo = rotr64_lo(xh, xl, 1);\n  var c1_lo = rotr64_lo(xh, xl, 8);\n  var c2_lo = shr64_lo(xh, xl, 7);\n\n  var r = c0_lo ^ c1_lo ^ c2_lo;\n  if (r < 0)\n    r += 0x100000000;\n  return r;\n}\n\nfunction g1_512_hi(xh, xl) {\n  var c0_hi = rotr64_hi(xh, xl, 19);\n  var c1_hi = rotr64_hi(xl, xh, 29);  // 61\n  var c2_hi = shr64_hi(xh, xl, 6);\n\n  var r = c0_hi ^ c1_hi ^ c2_hi;\n  if (r < 0)\n    r += 0x100000000;\n  return r;\n}\n\nfunction g1_512_lo(xh, xl) {\n  var c0_lo = rotr64_lo(xh, xl, 19);\n  var c1_lo = rotr64_lo(xl, xh, 29);  // 61\n  var c2_lo = shr64_lo(xh, xl, 6);\n\n  var r = c0_lo ^ c1_lo ^ c2_lo;\n  if (r < 0)\n    r += 0x100000000;\n  return r;\n}\n","'use strict';\n\nvar utils = require('../utils');\n\nvar SHA512 = require('./512');\n\nfunction SHA384() {\n  if (!(this instanceof SHA384))\n    return new SHA384();\n\n  SHA512.call(this);\n  this.h = [\n    0xcbbb9d5d, 0xc1059ed8,\n    0x629a292a, 0x367cd507,\n    0x9159015a, 0x3070dd17,\n    0x152fecd8, 0xf70e5939,\n    0x67332667, 0xffc00b31,\n    0x8eb44a87, 0x68581511,\n    0xdb0c2e0d, 0x64f98fa7,\n    0x47b5481d, 0xbefa4fa4 ];\n}\nutils.inherits(SHA384, SHA512);\nmodule.exports = SHA384;\n\nSHA384.blockSize = 1024;\nSHA384.outSize = 384;\nSHA384.hmacStrength = 192;\nSHA384.padLength = 128;\n\nSHA384.prototype._digest = function digest(enc) {\n  if (enc === 'hex')\n    return utils.toHex32(this.h.slice(0, 12), 'big');\n  else\n    return utils.split32(this.h.slice(0, 12), 'big');\n};\n","'use strict';\n\nexports.sha1 = require('./sha/1');\nexports.sha224 = require('./sha/224');\nexports.sha256 = require('./sha/256');\nexports.sha384 = require('./sha/384');\nexports.sha512 = require('./sha/512');\n","'use strict';\n\nvar utils = require('./utils');\nvar common = require('./common');\n\nvar rotl32 = utils.rotl32;\nvar sum32 = utils.sum32;\nvar sum32_3 = utils.sum32_3;\nvar sum32_4 = utils.sum32_4;\nvar BlockHash = common.BlockHash;\n\nfunction RIPEMD160() {\n  if (!(this instanceof RIPEMD160))\n    return new RIPEMD160();\n\n  BlockHash.call(this);\n\n  this.h = [ 0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0 ];\n  this.endian = 'little';\n}\nutils.inherits(RIPEMD160, BlockHash);\nexports.ripemd160 = RIPEMD160;\n\nRIPEMD160.blockSize = 512;\nRIPEMD160.outSize = 160;\nRIPEMD160.hmacStrength = 192;\nRIPEMD160.padLength = 64;\n\nRIPEMD160.prototype._update = function update(msg, start) {\n  var A = this.h[0];\n  var B = this.h[1];\n  var C = this.h[2];\n  var D = this.h[3];\n  var E = this.h[4];\n  var Ah = A;\n  var Bh = B;\n  var Ch = C;\n  var Dh = D;\n  var Eh = E;\n  for (var j = 0; j < 80; j++) {\n    var T = sum32(\n      rotl32(\n        sum32_4(A, f(j, B, C, D), msg[r[j] + start], K(j)),\n        s[j]),\n      E);\n    A = E;\n    E = D;\n    D = rotl32(C, 10);\n    C = B;\n    B = T;\n    T = sum32(\n      rotl32(\n        sum32_4(Ah, f(79 - j, Bh, Ch, Dh), msg[rh[j] + start], Kh(j)),\n        sh[j]),\n      Eh);\n    Ah = Eh;\n    Eh = Dh;\n    Dh = rotl32(Ch, 10);\n    Ch = Bh;\n    Bh = T;\n  }\n  T = sum32_3(this.h[1], C, Dh);\n  this.h[1] = sum32_3(this.h[2], D, Eh);\n  this.h[2] = sum32_3(this.h[3], E, Ah);\n  this.h[3] = sum32_3(this.h[4], A, Bh);\n  this.h[4] = sum32_3(this.h[0], B, Ch);\n  this.h[0] = T;\n};\n\nRIPEMD160.prototype._digest = function digest(enc) {\n  if (enc === 'hex')\n    return utils.toHex32(this.h, 'little');\n  else\n    return utils.split32(this.h, 'little');\n};\n\nfunction f(j, x, y, z) {\n  if (j <= 15)\n    return x ^ y ^ z;\n  else if (j <= 31)\n    return (x & y) | ((~x) & z);\n  else if (j <= 47)\n    return (x | (~y)) ^ z;\n  else if (j <= 63)\n    return (x & z) | (y & (~z));\n  else\n    return x ^ (y | (~z));\n}\n\nfunction K(j) {\n  if (j <= 15)\n    return 0x00000000;\n  else if (j <= 31)\n    return 0x5a827999;\n  else if (j <= 47)\n    return 0x6ed9eba1;\n  else if (j <= 63)\n    return 0x8f1bbcdc;\n  else\n    return 0xa953fd4e;\n}\n\nfunction Kh(j) {\n  if (j <= 15)\n    return 0x50a28be6;\n  else if (j <= 31)\n    return 0x5c4dd124;\n  else if (j <= 47)\n    return 0x6d703ef3;\n  else if (j <= 63)\n    return 0x7a6d76e9;\n  else\n    return 0x00000000;\n}\n\nvar r = [\n  0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,\n  7, 4, 13, 1, 10, 6, 15, 3, 12, 0, 9, 5, 2, 14, 11, 8,\n  3, 10, 14, 4, 9, 15, 8, 1, 2, 7, 0, 6, 13, 11, 5, 12,\n  1, 9, 11, 10, 0, 8, 12, 4, 13, 3, 7, 15, 14, 5, 6, 2,\n  4, 0, 5, 9, 7, 12, 2, 10, 14, 1, 3, 8, 11, 6, 15, 13\n];\n\nvar rh = [\n  5, 14, 7, 0, 9, 2, 11, 4, 13, 6, 15, 8, 1, 10, 3, 12,\n  6, 11, 3, 7, 0, 13, 5, 10, 14, 15, 8, 12, 4, 9, 1, 2,\n  15, 5, 1, 3, 7, 14, 6, 9, 11, 8, 12, 2, 10, 0, 4, 13,\n  8, 6, 4, 1, 3, 11, 15, 0, 5, 12, 2, 13, 9, 7, 10, 14,\n  12, 15, 10, 4, 1, 5, 8, 7, 6, 2, 13, 14, 0, 3, 9, 11\n];\n\nvar s = [\n  11, 14, 15, 12, 5, 8, 7, 9, 11, 13, 14, 15, 6, 7, 9, 8,\n  7, 6, 8, 13, 11, 9, 7, 15, 7, 12, 15, 9, 11, 7, 13, 12,\n  11, 13, 6, 7, 14, 9, 13, 15, 14, 8, 13, 6, 5, 12, 7, 5,\n  11, 12, 14, 15, 14, 15, 9, 8, 9, 14, 5, 6, 8, 6, 5, 12,\n  9, 15, 5, 11, 6, 8, 13, 12, 5, 12, 13, 14, 11, 8, 5, 6\n];\n\nvar sh = [\n  8, 9, 9, 11, 13, 15, 15, 5, 7, 7, 8, 11, 14, 14, 12, 6,\n  9, 13, 15, 7, 12, 8, 9, 11, 7, 7, 12, 7, 6, 15, 13, 11,\n  9, 7, 15, 11, 8, 6, 6, 14, 12, 13, 5, 14, 13, 13, 7, 5,\n  15, 5, 8, 11, 14, 14, 6, 14, 6, 9, 12, 9, 12, 5, 15, 8,\n  8, 5, 12, 9, 12, 5, 14, 6, 8, 13, 6, 5, 15, 13, 11, 11\n];\n","'use strict';\n\nvar utils = require('./utils');\nvar assert = require('minimalistic-assert');\n\nfunction Hmac(hash, key, enc) {\n  if (!(this instanceof Hmac))\n    return new Hmac(hash, key, enc);\n  this.Hash = hash;\n  this.blockSize = hash.blockSize / 8;\n  this.outSize = hash.outSize / 8;\n  this.inner = null;\n  this.outer = null;\n\n  this._init(utils.toArray(key, enc));\n}\nmodule.exports = Hmac;\n\nHmac.prototype._init = function init(key) {\n  // Shorten key, if needed\n  if (key.length > this.blockSize)\n    key = new this.Hash().update(key).digest();\n  assert(key.length <= this.blockSize);\n\n  // Add padding to key\n  for (var i = key.length; i < this.blockSize; i++)\n    key.push(0);\n\n  for (i = 0; i < key.length; i++)\n    key[i] ^= 0x36;\n  this.inner = new this.Hash().update(key);\n\n  // 0x36 ^ 0x5c = 0x6a\n  for (i = 0; i < key.length; i++)\n    key[i] ^= 0x6a;\n  this.outer = new this.Hash().update(key);\n};\n\nHmac.prototype.update = function update(msg, enc) {\n  this.inner.update(msg, enc);\n  return this;\n};\n\nHmac.prototype.digest = function digest(enc) {\n  this.outer.update(this.inner.digest());\n  return this.outer.digest(enc);\n};\n","var hash = exports;\n\nhash.utils = require('./hash/utils');\nhash.common = require('./hash/common');\nhash.sha = require('./hash/sha');\nhash.ripemd = require('./hash/ripemd');\nhash.hmac = require('./hash/hmac');\n\n// Proxy hash functions to the main object\nhash.sha1 = hash.sha.sha1;\nhash.sha256 = hash.sha.sha256;\nhash.sha224 = hash.sha.sha224;\nhash.sha384 = hash.sha.sha384;\nhash.sha512 = hash.sha.sha512;\nhash.ripemd160 = hash.ripemd.ripemd160;\n","module.exports = {\n  doubles: {\n    step: 4,\n    points: [\n      [\n        'e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a',\n        'f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821'\n      ],\n      [\n        '8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508',\n        '11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf'\n      ],\n      [\n        '175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739',\n        'd3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695'\n      ],\n      [\n        '363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640',\n        '4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9'\n      ],\n      [\n        '8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c',\n        '4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36'\n      ],\n      [\n        '723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda',\n        '96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f'\n      ],\n      [\n        'eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa',\n        '5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999'\n      ],\n      [\n        '100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0',\n        'cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09'\n      ],\n      [\n        'e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d',\n        '9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d'\n      ],\n      [\n        'feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d',\n        'e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088'\n      ],\n      [\n        'da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1',\n        '9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d'\n      ],\n      [\n        '53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0',\n        '5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8'\n      ],\n      [\n        '8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047',\n        '10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a'\n      ],\n      [\n        '385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862',\n        '283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453'\n      ],\n      [\n        '6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7',\n        '7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160'\n      ],\n      [\n        '3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd',\n        '56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0'\n      ],\n      [\n        '85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83',\n        '7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6'\n      ],\n      [\n        '948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a',\n        '53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589'\n      ],\n      [\n        '6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8',\n        'bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17'\n      ],\n      [\n        'e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d',\n        '4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda'\n      ],\n      [\n        'e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725',\n        '7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd'\n      ],\n      [\n        '213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754',\n        '4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2'\n      ],\n      [\n        '4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c',\n        '17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6'\n      ],\n      [\n        'fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6',\n        '6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f'\n      ],\n      [\n        '76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39',\n        'c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01'\n      ],\n      [\n        'c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891',\n        '893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3'\n      ],\n      [\n        'd895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b',\n        'febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f'\n      ],\n      [\n        'b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03',\n        '2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7'\n      ],\n      [\n        'e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d',\n        'eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78'\n      ],\n      [\n        'a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070',\n        '7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1'\n      ],\n      [\n        '90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4',\n        'e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150'\n      ],\n      [\n        '8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da',\n        '662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82'\n      ],\n      [\n        'e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11',\n        '1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc'\n      ],\n      [\n        '8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e',\n        'efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b'\n      ],\n      [\n        'e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41',\n        '2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51'\n      ],\n      [\n        'b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef',\n        '67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45'\n      ],\n      [\n        'd68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8',\n        'db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120'\n      ],\n      [\n        '324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d',\n        '648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84'\n      ],\n      [\n        '4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96',\n        '35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d'\n      ],\n      [\n        '9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd',\n        'ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d'\n      ],\n      [\n        '6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5',\n        '9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8'\n      ],\n      [\n        'a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266',\n        '40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8'\n      ],\n      [\n        '7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71',\n        '34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac'\n      ],\n      [\n        '928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac',\n        'c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f'\n      ],\n      [\n        '85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751',\n        '1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962'\n      ],\n      [\n        'ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e',\n        '493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907'\n      ],\n      [\n        '827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241',\n        'c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec'\n      ],\n      [\n        'eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3',\n        'be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d'\n      ],\n      [\n        'e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f',\n        '4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414'\n      ],\n      [\n        '1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19',\n        'aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd'\n      ],\n      [\n        '146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be',\n        'b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0'\n      ],\n      [\n        'fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9',\n        '6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811'\n      ],\n      [\n        'da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2',\n        '8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1'\n      ],\n      [\n        'a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13',\n        '7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c'\n      ],\n      [\n        '174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c',\n        'ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73'\n      ],\n      [\n        '959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba',\n        '2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd'\n      ],\n      [\n        'd2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151',\n        'e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405'\n      ],\n      [\n        '64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073',\n        'd99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589'\n      ],\n      [\n        '8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458',\n        '38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e'\n      ],\n      [\n        '13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b',\n        '69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27'\n      ],\n      [\n        'bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366',\n        'd3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1'\n      ],\n      [\n        '8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa',\n        '40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482'\n      ],\n      [\n        '8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0',\n        '620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945'\n      ],\n      [\n        'dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787',\n        '7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573'\n      ],\n      [\n        'f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e',\n        'ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82'\n      ]\n    ]\n  },\n  naf: {\n    wnd: 7,\n    points: [\n      [\n        'f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9',\n        '388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672'\n      ],\n      [\n        '2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4',\n        'd8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6'\n      ],\n      [\n        '5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc',\n        '6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da'\n      ],\n      [\n        'acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe',\n        'cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37'\n      ],\n      [\n        '774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb',\n        'd984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b'\n      ],\n      [\n        'f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8',\n        'ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81'\n      ],\n      [\n        'd7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e',\n        '581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58'\n      ],\n      [\n        'defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34',\n        '4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77'\n      ],\n      [\n        '2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c',\n        '85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a'\n      ],\n      [\n        '352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5',\n        '321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c'\n      ],\n      [\n        '2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f',\n        '2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67'\n      ],\n      [\n        '9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714',\n        '73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402'\n      ],\n      [\n        'daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729',\n        'a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55'\n      ],\n      [\n        'c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db',\n        '2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482'\n      ],\n      [\n        '6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4',\n        'e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82'\n      ],\n      [\n        '1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5',\n        'b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396'\n      ],\n      [\n        '605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479',\n        '2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49'\n      ],\n      [\n        '62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d',\n        '80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf'\n      ],\n      [\n        '80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f',\n        '1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a'\n      ],\n      [\n        '7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb',\n        'd0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7'\n      ],\n      [\n        'd528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9',\n        'eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933'\n      ],\n      [\n        '49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963',\n        '758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a'\n      ],\n      [\n        '77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74',\n        '958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6'\n      ],\n      [\n        'f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530',\n        'e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37'\n      ],\n      [\n        '463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b',\n        '5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e'\n      ],\n      [\n        'f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247',\n        'cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6'\n      ],\n      [\n        'caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1',\n        'cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476'\n      ],\n      [\n        '2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120',\n        '4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40'\n      ],\n      [\n        '7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435',\n        '91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61'\n      ],\n      [\n        '754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18',\n        '673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683'\n      ],\n      [\n        'e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8',\n        '59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5'\n      ],\n      [\n        '186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb',\n        '3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b'\n      ],\n      [\n        'df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f',\n        '55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417'\n      ],\n      [\n        '5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143',\n        'efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868'\n      ],\n      [\n        '290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba',\n        'e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a'\n      ],\n      [\n        'af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45',\n        'f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6'\n      ],\n      [\n        '766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a',\n        '744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996'\n      ],\n      [\n        '59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e',\n        'c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e'\n      ],\n      [\n        'f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8',\n        'e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d'\n      ],\n      [\n        '7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c',\n        '30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2'\n      ],\n      [\n        '948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519',\n        'e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e'\n      ],\n      [\n        '7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab',\n        '100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437'\n      ],\n      [\n        '3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca',\n        'ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311'\n      ],\n      [\n        'd3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf',\n        '8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4'\n      ],\n      [\n        '1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610',\n        '68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575'\n      ],\n      [\n        '733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4',\n        'f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d'\n      ],\n      [\n        '15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c',\n        'd56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d'\n      ],\n      [\n        'a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940',\n        'edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629'\n      ],\n      [\n        'e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980',\n        'a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06'\n      ],\n      [\n        '311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3',\n        '66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374'\n      ],\n      [\n        '34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf',\n        '9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee'\n      ],\n      [\n        'f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63',\n        '4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1'\n      ],\n      [\n        'd7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448',\n        'fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b'\n      ],\n      [\n        '32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf',\n        '5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661'\n      ],\n      [\n        '7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5',\n        '8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6'\n      ],\n      [\n        'ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6',\n        '8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e'\n      ],\n      [\n        '16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5',\n        '5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d'\n      ],\n      [\n        'eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99',\n        'f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc'\n      ],\n      [\n        '78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51',\n        'f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4'\n      ],\n      [\n        '494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5',\n        '42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c'\n      ],\n      [\n        'a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5',\n        '204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b'\n      ],\n      [\n        'c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997',\n        '4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913'\n      ],\n      [\n        '841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881',\n        '73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154'\n      ],\n      [\n        '5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5',\n        '39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865'\n      ],\n      [\n        '36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66',\n        'd2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc'\n      ],\n      [\n        '336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726',\n        'ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224'\n      ],\n      [\n        '8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede',\n        '6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e'\n      ],\n      [\n        '1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94',\n        '60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6'\n      ],\n      [\n        '85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31',\n        '3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511'\n      ],\n      [\n        '29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51',\n        'b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b'\n      ],\n      [\n        'a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252',\n        'ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2'\n      ],\n      [\n        '4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5',\n        'cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c'\n      ],\n      [\n        'd24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b',\n        '6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3'\n      ],\n      [\n        'ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4',\n        '322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d'\n      ],\n      [\n        'af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f',\n        '6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700'\n      ],\n      [\n        'e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889',\n        '2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4'\n      ],\n      [\n        '591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246',\n        'b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196'\n      ],\n      [\n        '11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984',\n        '998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4'\n      ],\n      [\n        '3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a',\n        'b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257'\n      ],\n      [\n        'cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030',\n        'bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13'\n      ],\n      [\n        'c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197',\n        '6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096'\n      ],\n      [\n        'c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593',\n        'c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38'\n      ],\n      [\n        'a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef',\n        '21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f'\n      ],\n      [\n        '347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38',\n        '60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448'\n      ],\n      [\n        'da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a',\n        '49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a'\n      ],\n      [\n        'c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111',\n        '5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4'\n      ],\n      [\n        '4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502',\n        '7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437'\n      ],\n      [\n        '3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea',\n        'be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7'\n      ],\n      [\n        'cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26',\n        '8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d'\n      ],\n      [\n        'b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986',\n        '39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a'\n      ],\n      [\n        'd4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e',\n        '62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54'\n      ],\n      [\n        '48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4',\n        '25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77'\n      ],\n      [\n        'dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda',\n        'ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517'\n      ],\n      [\n        '6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859',\n        'cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10'\n      ],\n      [\n        'e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f',\n        'f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125'\n      ],\n      [\n        'eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c',\n        '6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e'\n      ],\n      [\n        '13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942',\n        'fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1'\n      ],\n      [\n        'ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a',\n        '1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2'\n      ],\n      [\n        'b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80',\n        '5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423'\n      ],\n      [\n        'ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d',\n        '438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8'\n      ],\n      [\n        '8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1',\n        'cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758'\n      ],\n      [\n        '52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63',\n        'c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375'\n      ],\n      [\n        'e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352',\n        '6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d'\n      ],\n      [\n        '7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193',\n        'ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec'\n      ],\n      [\n        '5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00',\n        '9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0'\n      ],\n      [\n        '32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58',\n        'ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c'\n      ],\n      [\n        'e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7',\n        'd3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4'\n      ],\n      [\n        '8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8',\n        'c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f'\n      ],\n      [\n        '4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e',\n        '67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649'\n      ],\n      [\n        '3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d',\n        'cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826'\n      ],\n      [\n        '674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b',\n        '299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5'\n      ],\n      [\n        'd32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f',\n        'f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87'\n      ],\n      [\n        '30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6',\n        '462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b'\n      ],\n      [\n        'be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297',\n        '62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc'\n      ],\n      [\n        '93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a',\n        '7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c'\n      ],\n      [\n        'b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c',\n        'ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f'\n      ],\n      [\n        'd5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52',\n        '4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a'\n      ],\n      [\n        'd3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb',\n        'bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46'\n      ],\n      [\n        '463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065',\n        'bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f'\n      ],\n      [\n        '7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917',\n        '603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03'\n      ],\n      [\n        '74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9',\n        'cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08'\n      ],\n      [\n        '30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3',\n        '553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8'\n      ],\n      [\n        '9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57',\n        '712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373'\n      ],\n      [\n        '176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66',\n        'ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3'\n      ],\n      [\n        '75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8',\n        '9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8'\n      ],\n      [\n        '809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721',\n        '9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1'\n      ],\n      [\n        '1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180',\n        '4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9'\n      ]\n    ]\n  }\n};\n","'use strict';\n\nvar curves = exports;\n\nvar hash = require('hash.js');\nvar elliptic = require('../elliptic');\n\nvar assert = elliptic.utils.assert;\n\nfunction PresetCurve(options) {\n  if (options.type === 'short')\n    this.curve = new elliptic.curve.short(options);\n  else if (options.type === 'edwards')\n    this.curve = new elliptic.curve.edwards(options);\n  else\n    this.curve = new elliptic.curve.mont(options);\n  this.g = this.curve.g;\n  this.n = this.curve.n;\n  this.hash = options.hash;\n\n  assert(this.g.validate(), 'Invalid curve');\n  assert(this.g.mul(this.n).isInfinity(), 'Invalid curve, G*N != O');\n}\ncurves.PresetCurve = PresetCurve;\n\nfunction defineCurve(name, options) {\n  Object.defineProperty(curves, name, {\n    configurable: true,\n    enumerable: true,\n    get: function() {\n      var curve = new PresetCurve(options);\n      Object.defineProperty(curves, name, {\n        configurable: true,\n        enumerable: true,\n        value: curve\n      });\n      return curve;\n    }\n  });\n}\n\ndefineCurve('p192', {\n  type: 'short',\n  prime: 'p192',\n  p: 'ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff',\n  a: 'ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc',\n  b: '64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1',\n  n: 'ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831',\n  hash: hash.sha256,\n  gRed: false,\n  g: [\n    '188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012',\n    '07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811'\n  ]\n});\n\ndefineCurve('p224', {\n  type: 'short',\n  prime: 'p224',\n  p: 'ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001',\n  a: 'ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe',\n  b: 'b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4',\n  n: 'ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d',\n  hash: hash.sha256,\n  gRed: false,\n  g: [\n    'b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21',\n    'bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34'\n  ]\n});\n\ndefineCurve('p256', {\n  type: 'short',\n  prime: null,\n  p: 'ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff',\n  a: 'ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc',\n  b: '5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b',\n  n: 'ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551',\n  hash: hash.sha256,\n  gRed: false,\n  g: [\n    '6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296',\n    '4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5'\n  ]\n});\n\ndefineCurve('p384', {\n  type: 'short',\n  prime: null,\n  p: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +\n     'fffffffe ffffffff 00000000 00000000 ffffffff',\n  a: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +\n     'fffffffe ffffffff 00000000 00000000 fffffffc',\n  b: 'b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f ' +\n     '5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef',\n  n: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 ' +\n     'f4372ddf 581a0db2 48b0a77a ecec196a ccc52973',\n  hash: hash.sha384,\n  gRed: false,\n  g: [\n    'aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 ' +\n    '5502f25d bf55296c 3a545e38 72760ab7',\n    '3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 ' +\n    '0a60b1ce 1d7e819d 7a431d7c 90ea0e5f'\n  ]\n});\n\ndefineCurve('p521', {\n  type: 'short',\n  prime: null,\n  p: '000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ' +\n     'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +\n     'ffffffff ffffffff ffffffff ffffffff ffffffff',\n  a: '000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ' +\n     'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ' +\n     'ffffffff ffffffff ffffffff ffffffff fffffffc',\n  b: '00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b ' +\n     '99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd ' +\n     '3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00',\n  n: '000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ' +\n     'ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 ' +\n     'f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409',\n  hash: hash.sha512,\n  gRed: false,\n  g: [\n    '000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 ' +\n    '053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 ' +\n    'a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66',\n    '00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 ' +\n    '579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 ' +\n    '3fad0761 353c7086 a272c240 88be9476 9fd16650'\n  ]\n});\n\ndefineCurve('curve25519', {\n  type: 'mont',\n  prime: 'p25519',\n  p: '7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed',\n  a: '76d06',\n  b: '1',\n  n: '1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed',\n  hash: hash.sha256,\n  gRed: false,\n  g: [\n    '9'\n  ]\n});\n\ndefineCurve('ed25519', {\n  type: 'edwards',\n  prime: 'p25519',\n  p: '7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed',\n  a: '-1',\n  c: '1',\n  // -121665 * (121666^(-1)) (mod P)\n  d: '52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3',\n  n: '1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed',\n  hash: hash.sha256,\n  gRed: false,\n  g: [\n    '216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a',\n\n    // 4/5\n    '6666666666666666666666666666666666666666666666666666666666666658'\n  ]\n});\n\nvar pre;\ntry {\n  pre = require('./precomputed/secp256k1');\n} catch (e) {\n  pre = undefined;\n}\n\ndefineCurve('secp256k1', {\n  type: 'short',\n  prime: 'k256',\n  p: 'ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f',\n  a: '0',\n  b: '7',\n  n: 'ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141',\n  h: '1',\n  hash: hash.sha256,\n\n  // Precomputed endomorphism\n  beta: '7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee',\n  lambda: '5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72',\n  basis: [\n    {\n      a: '3086d221a7d46bcde86c90e49284eb15',\n      b: '-e4437ed6010e88286f547fa90abfe4c3'\n    },\n    {\n      a: '114ca50f7a8e2f3f657c1108d9d44cfd8',\n      b: '3086d221a7d46bcde86c90e49284eb15'\n    }\n  ],\n\n  gRed: false,\n  g: [\n    '79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798',\n    '483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8',\n    pre\n  ]\n});\n","'use strict';\n\nvar hash = require('hash.js');\nvar utils = require('minimalistic-crypto-utils');\nvar assert = require('minimalistic-assert');\n\nfunction HmacDRBG(options) {\n  if (!(this instanceof HmacDRBG))\n    return new HmacDRBG(options);\n  this.hash = options.hash;\n  this.predResist = !!options.predResist;\n\n  this.outLen = this.hash.outSize;\n  this.minEntropy = options.minEntropy || this.hash.hmacStrength;\n\n  this._reseed = null;\n  this.reseedInterval = null;\n  this.K = null;\n  this.V = null;\n\n  var entropy = utils.toArray(options.entropy, options.entropyEnc || 'hex');\n  var nonce = utils.toArray(options.nonce, options.nonceEnc || 'hex');\n  var pers = utils.toArray(options.pers, options.persEnc || 'hex');\n  assert(entropy.length >= (this.minEntropy / 8),\n         'Not enough entropy. Minimum is: ' + this.minEntropy + ' bits');\n  this._init(entropy, nonce, pers);\n}\nmodule.exports = HmacDRBG;\n\nHmacDRBG.prototype._init = function init(entropy, nonce, pers) {\n  var seed = entropy.concat(nonce).concat(pers);\n\n  this.K = new Array(this.outLen / 8);\n  this.V = new Array(this.outLen / 8);\n  for (var i = 0; i < this.V.length; i++) {\n    this.K[i] = 0x00;\n    this.V[i] = 0x01;\n  }\n\n  this._update(seed);\n  this._reseed = 1;\n  this.reseedInterval = 0x1000000000000;  // 2^48\n};\n\nHmacDRBG.prototype._hmac = function hmac() {\n  return new hash.hmac(this.hash, this.K);\n};\n\nHmacDRBG.prototype._update = function update(seed) {\n  var kmac = this._hmac()\n                 .update(this.V)\n                 .update([ 0x00 ]);\n  if (seed)\n    kmac = kmac.update(seed);\n  this.K = kmac.digest();\n  this.V = this._hmac().update(this.V).digest();\n  if (!seed)\n    return;\n\n  this.K = this._hmac()\n               .update(this.V)\n               .update([ 0x01 ])\n               .update(seed)\n               .digest();\n  this.V = this._hmac().update(this.V).digest();\n};\n\nHmacDRBG.prototype.reseed = function reseed(entropy, entropyEnc, add, addEnc) {\n  // Optional entropy enc\n  if (typeof entropyEnc !== 'string') {\n    addEnc = add;\n    add = entropyEnc;\n    entropyEnc = null;\n  }\n\n  entropy = utils.toArray(entropy, entropyEnc);\n  add = utils.toArray(add, addEnc);\n\n  assert(entropy.length >= (this.minEntropy / 8),\n         'Not enough entropy. Minimum is: ' + this.minEntropy + ' bits');\n\n  this._update(entropy.concat(add || []));\n  this._reseed = 1;\n};\n\nHmacDRBG.prototype.generate = function generate(len, enc, add, addEnc) {\n  if (this._reseed > this.reseedInterval)\n    throw new Error('Reseed is required');\n\n  // Optional encoding\n  if (typeof enc !== 'string') {\n    addEnc = add;\n    add = enc;\n    enc = null;\n  }\n\n  // Optional additional data\n  if (add) {\n    add = utils.toArray(add, addEnc || 'hex');\n    this._update(add);\n  }\n\n  var temp = [];\n  while (temp.length < len) {\n    this.V = this._hmac().update(this.V).digest();\n    temp = temp.concat(this.V);\n  }\n\n  var res = temp.slice(0, len);\n  this._update(add);\n  this._reseed++;\n  return utils.encode(res, enc);\n};\n","'use strict';\n\nvar BN = require('bn.js');\nvar elliptic = require('../../elliptic');\nvar utils = elliptic.utils;\nvar assert = utils.assert;\n\nfunction KeyPair(ec, options) {\n  this.ec = ec;\n  this.priv = null;\n  this.pub = null;\n\n  // KeyPair(ec, { priv: ..., pub: ... })\n  if (options.priv)\n    this._importPrivate(options.priv, options.privEnc);\n  if (options.pub)\n    this._importPublic(options.pub, options.pubEnc);\n}\nmodule.exports = KeyPair;\n\nKeyPair.fromPublic = function fromPublic(ec, pub, enc) {\n  if (pub instanceof KeyPair)\n    return pub;\n\n  return new KeyPair(ec, {\n    pub: pub,\n    pubEnc: enc\n  });\n};\n\nKeyPair.fromPrivate = function fromPrivate(ec, priv, enc) {\n  if (priv instanceof KeyPair)\n    return priv;\n\n  return new KeyPair(ec, {\n    priv: priv,\n    privEnc: enc\n  });\n};\n\nKeyPair.prototype.validate = function validate() {\n  var pub = this.getPublic();\n\n  if (pub.isInfinity())\n    return { result: false, reason: 'Invalid public key' };\n  if (!pub.validate())\n    return { result: false, reason: 'Public key is not a point' };\n  if (!pub.mul(this.ec.curve.n).isInfinity())\n    return { result: false, reason: 'Public key * N != O' };\n\n  return { result: true, reason: null };\n};\n\nKeyPair.prototype.getPublic = function getPublic(compact, enc) {\n  // compact is optional argument\n  if (typeof compact === 'string') {\n    enc = compact;\n    compact = null;\n  }\n\n  if (!this.pub)\n    this.pub = this.ec.g.mul(this.priv);\n\n  if (!enc)\n    return this.pub;\n\n  return this.pub.encode(enc, compact);\n};\n\nKeyPair.prototype.getPrivate = function getPrivate(enc) {\n  if (enc === 'hex')\n    return this.priv.toString(16, 2);\n  else\n    return this.priv;\n};\n\nKeyPair.prototype._importPrivate = function _importPrivate(key, enc) {\n  this.priv = new BN(key, enc || 16);\n\n  // Ensure that the priv won't be bigger than n, otherwise we may fail\n  // in fixed multiplication method\n  this.priv = this.priv.umod(this.ec.curve.n);\n};\n\nKeyPair.prototype._importPublic = function _importPublic(key, enc) {\n  if (key.x || key.y) {\n    // Montgomery points only have an `x` coordinate.\n    // Weierstrass/Edwards points on the other hand have both `x` and\n    // `y` coordinates.\n    if (this.ec.curve.type === 'mont') {\n      assert(key.x, 'Need x coordinate');\n    } else if (this.ec.curve.type === 'short' ||\n               this.ec.curve.type === 'edwards') {\n      assert(key.x && key.y, 'Need both x and y coordinate');\n    }\n    this.pub = this.ec.curve.point(key.x, key.y);\n    return;\n  }\n  this.pub = this.ec.curve.decodePoint(key, enc);\n};\n\n// ECDH\nKeyPair.prototype.derive = function derive(pub) {\n  return pub.mul(this.priv).getX();\n};\n\n// ECDSA\nKeyPair.prototype.sign = function sign(msg, enc, options) {\n  return this.ec.sign(msg, this, enc, options);\n};\n\nKeyPair.prototype.verify = function verify(msg, signature) {\n  return this.ec.verify(msg, signature, this);\n};\n\nKeyPair.prototype.inspect = function inspect() {\n  return '<Key priv: ' + (this.priv && this.priv.toString(16, 2)) +\n         ' pub: ' + (this.pub && this.pub.inspect()) + ' >';\n};\n","'use strict';\n\nvar BN = require('bn.js');\n\nvar elliptic = require('../../elliptic');\nvar utils = elliptic.utils;\nvar assert = utils.assert;\n\nfunction Signature(options, enc) {\n  if (options instanceof Signature)\n    return options;\n\n  if (this._importDER(options, enc))\n    return;\n\n  assert(options.r && options.s, 'Signature without r or s');\n  this.r = new BN(options.r, 16);\n  this.s = new BN(options.s, 16);\n  if (options.recoveryParam === undefined)\n    this.recoveryParam = null;\n  else\n    this.recoveryParam = options.recoveryParam;\n}\nmodule.exports = Signature;\n\nfunction Position() {\n  this.place = 0;\n}\n\nfunction getLength(buf, p) {\n  var initial = buf[p.place++];\n  if (!(initial & 0x80)) {\n    return initial;\n  }\n  var octetLen = initial & 0xf;\n  var val = 0;\n  for (var i = 0, off = p.place; i < octetLen; i++, off++) {\n    val <<= 8;\n    val |= buf[off];\n  }\n  p.place = off;\n  return val;\n}\n\nfunction rmPadding(buf) {\n  var i = 0;\n  var len = buf.length - 1;\n  while (!buf[i] && !(buf[i + 1] & 0x80) && i < len) {\n    i++;\n  }\n  if (i === 0) {\n    return buf;\n  }\n  return buf.slice(i);\n}\n\nSignature.prototype._importDER = function _importDER(data, enc) {\n  data = utils.toArray(data, enc);\n  var p = new Position();\n  if (data[p.place++] !== 0x30) {\n    return false;\n  }\n  var len = getLength(data, p);\n  if ((len + p.place) !== data.length) {\n    return false;\n  }\n  if (data[p.place++] !== 0x02) {\n    return false;\n  }\n  var rlen = getLength(data, p);\n  var r = data.slice(p.place, rlen + p.place);\n  p.place += rlen;\n  if (data[p.place++] !== 0x02) {\n    return false;\n  }\n  var slen = getLength(data, p);\n  if (data.length !== slen + p.place) {\n    return false;\n  }\n  var s = data.slice(p.place, slen + p.place);\n  if (r[0] === 0 && (r[1] & 0x80)) {\n    r = r.slice(1);\n  }\n  if (s[0] === 0 && (s[1] & 0x80)) {\n    s = s.slice(1);\n  }\n\n  this.r = new BN(r);\n  this.s = new BN(s);\n  this.recoveryParam = null;\n\n  return true;\n};\n\nfunction constructLength(arr, len) {\n  if (len < 0x80) {\n    arr.push(len);\n    return;\n  }\n  var octets = 1 + (Math.log(len) / Math.LN2 >>> 3);\n  arr.push(octets | 0x80);\n  while (--octets) {\n    arr.push((len >>> (octets << 3)) & 0xff);\n  }\n  arr.push(len);\n}\n\nSignature.prototype.toDER = function toDER(enc) {\n  var r = this.r.toArray();\n  var s = this.s.toArray();\n\n  // Pad values\n  if (r[0] & 0x80)\n    r = [ 0 ].concat(r);\n  // Pad values\n  if (s[0] & 0x80)\n    s = [ 0 ].concat(s);\n\n  r = rmPadding(r);\n  s = rmPadding(s);\n\n  while (!s[0] && !(s[1] & 0x80)) {\n    s = s.slice(1);\n  }\n  var arr = [ 0x02 ];\n  constructLength(arr, r.length);\n  arr = arr.concat(r);\n  arr.push(0x02);\n  constructLength(arr, s.length);\n  var backHalf = arr.concat(s);\n  var res = [ 0x30 ];\n  constructLength(res, backHalf.length);\n  res = res.concat(backHalf);\n  return utils.encode(res, enc);\n};\n","'use strict';\n\nvar BN = require('bn.js');\nvar HmacDRBG = require('hmac-drbg');\nvar elliptic = require('../../elliptic');\nvar utils = elliptic.utils;\nvar assert = utils.assert;\n\nvar KeyPair = require('./key');\nvar Signature = require('./signature');\n\nfunction EC(options) {\n  if (!(this instanceof EC))\n    return new EC(options);\n\n  // Shortcut `elliptic.ec(curve-name)`\n  if (typeof options === 'string') {\n    assert(elliptic.curves.hasOwnProperty(options), 'Unknown curve ' + options);\n\n    options = elliptic.curves[options];\n  }\n\n  // Shortcut for `elliptic.ec(elliptic.curves.curveName)`\n  if (options instanceof elliptic.curves.PresetCurve)\n    options = { curve: options };\n\n  this.curve = options.curve.curve;\n  this.n = this.curve.n;\n  this.nh = this.n.ushrn(1);\n  this.g = this.curve.g;\n\n  // Point on curve\n  this.g = options.curve.g;\n  this.g.precompute(options.curve.n.bitLength() + 1);\n\n  // Hash for function for DRBG\n  this.hash = options.hash || options.curve.hash;\n}\nmodule.exports = EC;\n\nEC.prototype.keyPair = function keyPair(options) {\n  return new KeyPair(this, options);\n};\n\nEC.prototype.keyFromPrivate = function keyFromPrivate(priv, enc) {\n  return KeyPair.fromPrivate(this, priv, enc);\n};\n\nEC.prototype.keyFromPublic = function keyFromPublic(pub, enc) {\n  return KeyPair.fromPublic(this, pub, enc);\n};\n\nEC.prototype.genKeyPair = function genKeyPair(options) {\n  if (!options)\n    options = {};\n\n  // Instantiate Hmac_DRBG\n  var drbg = new HmacDRBG({\n    hash: this.hash,\n    pers: options.pers,\n    persEnc: options.persEnc || 'utf8',\n    entropy: options.entropy || elliptic.rand(this.hash.hmacStrength),\n    entropyEnc: options.entropy && options.entropyEnc || 'utf8',\n    nonce: this.n.toArray()\n  });\n\n  var bytes = this.n.byteLength();\n  var ns2 = this.n.sub(new BN(2));\n  do {\n    var priv = new BN(drbg.generate(bytes));\n    if (priv.cmp(ns2) > 0)\n      continue;\n\n    priv.iaddn(1);\n    return this.keyFromPrivate(priv);\n  } while (true);\n};\n\nEC.prototype._truncateToN = function truncateToN(msg, truncOnly) {\n  var delta = msg.byteLength() * 8 - this.n.bitLength();\n  if (delta > 0)\n    msg = msg.ushrn(delta);\n  if (!truncOnly && msg.cmp(this.n) >= 0)\n    return msg.sub(this.n);\n  else\n    return msg;\n};\n\nEC.prototype.sign = function sign(msg, key, enc, options) {\n  if (typeof enc === 'object') {\n    options = enc;\n    enc = null;\n  }\n  if (!options)\n    options = {};\n\n  key = this.keyFromPrivate(key, enc);\n  msg = this._truncateToN(new BN(msg, 16));\n\n  // Zero-extend key to provide enough entropy\n  var bytes = this.n.byteLength();\n  var bkey = key.getPrivate().toArray('be', bytes);\n\n  // Zero-extend nonce to have the same byte size as N\n  var nonce = msg.toArray('be', bytes);\n\n  // Instantiate Hmac_DRBG\n  var drbg = new HmacDRBG({\n    hash: this.hash,\n    entropy: bkey,\n    nonce: nonce,\n    pers: options.pers,\n    persEnc: options.persEnc || 'utf8'\n  });\n\n  // Number of bytes to generate\n  var ns1 = this.n.sub(new BN(1));\n\n  for (var iter = 0; true; iter++) {\n    var k = options.k ?\n        options.k(iter) :\n        new BN(drbg.generate(this.n.byteLength()));\n    k = this._truncateToN(k, true);\n    if (k.cmpn(1) <= 0 || k.cmp(ns1) >= 0)\n      continue;\n\n    var kp = this.g.mul(k);\n    if (kp.isInfinity())\n      continue;\n\n    var kpX = kp.getX();\n    var r = kpX.umod(this.n);\n    if (r.cmpn(0) === 0)\n      continue;\n\n    var s = k.invm(this.n).mul(r.mul(key.getPrivate()).iadd(msg));\n    s = s.umod(this.n);\n    if (s.cmpn(0) === 0)\n      continue;\n\n    var recoveryParam = (kp.getY().isOdd() ? 1 : 0) |\n                        (kpX.cmp(r) !== 0 ? 2 : 0);\n\n    // Use complement of `s`, if it is > `n / 2`\n    if (options.canonical && s.cmp(this.nh) > 0) {\n      s = this.n.sub(s);\n      recoveryParam ^= 1;\n    }\n\n    return new Signature({ r: r, s: s, recoveryParam: recoveryParam });\n  }\n};\n\nEC.prototype.verify = function verify(msg, signature, key, enc) {\n  msg = this._truncateToN(new BN(msg, 16));\n  key = this.keyFromPublic(key, enc);\n  signature = new Signature(signature, 'hex');\n\n  // Perform primitive values validation\n  var r = signature.r;\n  var s = signature.s;\n  if (r.cmpn(1) < 0 || r.cmp(this.n) >= 0)\n    return false;\n  if (s.cmpn(1) < 0 || s.cmp(this.n) >= 0)\n    return false;\n\n  // Validate signature\n  var sinv = s.invm(this.n);\n  var u1 = sinv.mul(msg).umod(this.n);\n  var u2 = sinv.mul(r).umod(this.n);\n\n  if (!this.curve._maxwellTrick) {\n    var p = this.g.mulAdd(u1, key.getPublic(), u2);\n    if (p.isInfinity())\n      return false;\n\n    return p.getX().umod(this.n).cmp(r) === 0;\n  }\n\n  // NOTE: Greg Maxwell's trick, inspired by:\n  // https://git.io/vad3K\n\n  var p = this.g.jmulAdd(u1, key.getPublic(), u2);\n  if (p.isInfinity())\n    return false;\n\n  // Compare `p.x` of Jacobian point with `r`,\n  // this will do `p.x == r * p.z^2` instead of multiplying `p.x` by the\n  // inverse of `p.z^2`\n  return p.eqXToP(r);\n};\n\nEC.prototype.recoverPubKey = function(msg, signature, j, enc) {\n  assert((3 & j) === j, 'The recovery param is more than two bits');\n  signature = new Signature(signature, enc);\n\n  var n = this.n;\n  var e = new BN(msg);\n  var r = signature.r;\n  var s = signature.s;\n\n  // A set LSB signifies that the y-coordinate is odd\n  var isYOdd = j & 1;\n  var isSecondKey = j >> 1;\n  if (r.cmp(this.curve.p.umod(this.curve.n)) >= 0 && isSecondKey)\n    throw new Error('Unable to find sencond key candinate');\n\n  // 1.1. Let x = r + jn.\n  if (isSecondKey)\n    r = this.curve.pointFromX(r.add(this.curve.n), isYOdd);\n  else\n    r = this.curve.pointFromX(r, isYOdd);\n\n  var rInv = signature.r.invm(n);\n  var s1 = n.sub(e).mul(rInv).umod(n);\n  var s2 = s.mul(rInv).umod(n);\n\n  // 1.6.1 Compute Q = r^-1 (sR -  eG)\n  //               Q = r^-1 (sR + -eG)\n  return this.g.mulAdd(s1, r, s2);\n};\n\nEC.prototype.getKeyRecoveryParam = function(e, signature, Q, enc) {\n  signature = new Signature(signature, enc);\n  if (signature.recoveryParam !== null)\n    return signature.recoveryParam;\n\n  for (var i = 0; i < 4; i++) {\n    var Qprime;\n    try {\n      Qprime = this.recoverPubKey(e, signature, i);\n    } catch (e) {\n      continue;\n    }\n\n    if (Qprime.eq(Q))\n      return i;\n  }\n  throw new Error('Unable to find valid recovery factor');\n};\n","'use strict';\n\nvar elliptic = require('../../elliptic');\nvar utils = elliptic.utils;\nvar assert = utils.assert;\nvar parseBytes = utils.parseBytes;\nvar cachedProperty = utils.cachedProperty;\n\n/**\n* @param {EDDSA} eddsa - instance\n* @param {Object} params - public/private key parameters\n*\n* @param {Array<Byte>} [params.secret] - secret seed bytes\n* @param {Point} [params.pub] - public key point (aka `A` in eddsa terms)\n* @param {Array<Byte>} [params.pub] - public key point encoded as bytes\n*\n*/\nfunction KeyPair(eddsa, params) {\n  this.eddsa = eddsa;\n  this._secret = parseBytes(params.secret);\n  if (eddsa.isPoint(params.pub))\n    this._pub = params.pub;\n  else\n    this._pubBytes = parseBytes(params.pub);\n}\n\nKeyPair.fromPublic = function fromPublic(eddsa, pub) {\n  if (pub instanceof KeyPair)\n    return pub;\n  return new KeyPair(eddsa, { pub: pub });\n};\n\nKeyPair.fromSecret = function fromSecret(eddsa, secret) {\n  if (secret instanceof KeyPair)\n    return secret;\n  return new KeyPair(eddsa, { secret: secret });\n};\n\nKeyPair.prototype.secret = function secret() {\n  return this._secret;\n};\n\ncachedProperty(KeyPair, 'pubBytes', function pubBytes() {\n  return this.eddsa.encodePoint(this.pub());\n});\n\ncachedProperty(KeyPair, 'pub', function pub() {\n  if (this._pubBytes)\n    return this.eddsa.decodePoint(this._pubBytes);\n  return this.eddsa.g.mul(this.priv());\n});\n\ncachedProperty(KeyPair, 'privBytes', function privBytes() {\n  var eddsa = this.eddsa;\n  var hash = this.hash();\n  var lastIx = eddsa.encodingLength - 1;\n\n  var a = hash.slice(0, eddsa.encodingLength);\n  a[0] &= 248;\n  a[lastIx] &= 127;\n  a[lastIx] |= 64;\n\n  return a;\n});\n\ncachedProperty(KeyPair, 'priv', function priv() {\n  return this.eddsa.decodeInt(this.privBytes());\n});\n\ncachedProperty(KeyPair, 'hash', function hash() {\n  return this.eddsa.hash().update(this.secret()).digest();\n});\n\ncachedProperty(KeyPair, 'messagePrefix', function messagePrefix() {\n  return this.hash().slice(this.eddsa.encodingLength);\n});\n\nKeyPair.prototype.sign = function sign(message) {\n  assert(this._secret, 'KeyPair can only verify');\n  return this.eddsa.sign(message, this);\n};\n\nKeyPair.prototype.verify = function verify(message, sig) {\n  return this.eddsa.verify(message, sig, this);\n};\n\nKeyPair.prototype.getSecret = function getSecret(enc) {\n  assert(this._secret, 'KeyPair is public only');\n  return utils.encode(this.secret(), enc);\n};\n\nKeyPair.prototype.getPublic = function getPublic(enc) {\n  return utils.encode(this.pubBytes(), enc);\n};\n\nmodule.exports = KeyPair;\n","'use strict';\n\nvar BN = require('bn.js');\nvar elliptic = require('../../elliptic');\nvar utils = elliptic.utils;\nvar assert = utils.assert;\nvar cachedProperty = utils.cachedProperty;\nvar parseBytes = utils.parseBytes;\n\n/**\n* @param {EDDSA} eddsa - eddsa instance\n* @param {Array<Bytes>|Object} sig -\n* @param {Array<Bytes>|Point} [sig.R] - R point as Point or bytes\n* @param {Array<Bytes>|bn} [sig.S] - S scalar as bn or bytes\n* @param {Array<Bytes>} [sig.Rencoded] - R point encoded\n* @param {Array<Bytes>} [sig.Sencoded] - S scalar encoded\n*/\nfunction Signature(eddsa, sig) {\n  this.eddsa = eddsa;\n\n  if (typeof sig !== 'object')\n    sig = parseBytes(sig);\n\n  if (Array.isArray(sig)) {\n    sig = {\n      R: sig.slice(0, eddsa.encodingLength),\n      S: sig.slice(eddsa.encodingLength)\n    };\n  }\n\n  assert(sig.R && sig.S, 'Signature without R or S');\n\n  if (eddsa.isPoint(sig.R))\n    this._R = sig.R;\n  if (sig.S instanceof BN)\n    this._S = sig.S;\n\n  this._Rencoded = Array.isArray(sig.R) ? sig.R : sig.Rencoded;\n  this._Sencoded = Array.isArray(sig.S) ? sig.S : sig.Sencoded;\n}\n\ncachedProperty(Signature, 'S', function S() {\n  return this.eddsa.decodeInt(this.Sencoded());\n});\n\ncachedProperty(Signature, 'R', function R() {\n  return this.eddsa.decodePoint(this.Rencoded());\n});\n\ncachedProperty(Signature, 'Rencoded', function Rencoded() {\n  return this.eddsa.encodePoint(this.R());\n});\n\ncachedProperty(Signature, 'Sencoded', function Sencoded() {\n  return this.eddsa.encodeInt(this.S());\n});\n\nSignature.prototype.toBytes = function toBytes() {\n  return this.Rencoded().concat(this.Sencoded());\n};\n\nSignature.prototype.toHex = function toHex() {\n  return utils.encode(this.toBytes(), 'hex').toUpperCase();\n};\n\nmodule.exports = Signature;\n","'use strict';\n\nvar hash = require('hash.js');\nvar elliptic = require('../../elliptic');\nvar utils = elliptic.utils;\nvar assert = utils.assert;\nvar parseBytes = utils.parseBytes;\nvar KeyPair = require('./key');\nvar Signature = require('./signature');\n\nfunction EDDSA(curve) {\n  assert(curve === 'ed25519', 'only tested with ed25519 so far');\n\n  if (!(this instanceof EDDSA))\n    return new EDDSA(curve);\n\n  var curve = elliptic.curves[curve].curve;\n  this.curve = curve;\n  this.g = curve.g;\n  this.g.precompute(curve.n.bitLength() + 1);\n\n  this.pointClass = curve.point().constructor;\n  this.encodingLength = Math.ceil(curve.n.bitLength() / 8);\n  this.hash = hash.sha512;\n}\n\nmodule.exports = EDDSA;\n\n/**\n* @param {Array|String} message - message bytes\n* @param {Array|String|KeyPair} secret - secret bytes or a keypair\n* @returns {Signature} - signature\n*/\nEDDSA.prototype.sign = function sign(message, secret) {\n  message = parseBytes(message);\n  var key = this.keyFromSecret(secret);\n  var r = this.hashInt(key.messagePrefix(), message);\n  var R = this.g.mul(r);\n  var Rencoded = this.encodePoint(R);\n  var s_ = this.hashInt(Rencoded, key.pubBytes(), message)\n               .mul(key.priv());\n  var S = r.add(s_).umod(this.curve.n);\n  return this.makeSignature({ R: R, S: S, Rencoded: Rencoded });\n};\n\n/**\n* @param {Array} message - message bytes\n* @param {Array|String|Signature} sig - sig bytes\n* @param {Array|String|Point|KeyPair} pub - public key\n* @returns {Boolean} - true if public key matches sig of message\n*/\nEDDSA.prototype.verify = function verify(message, sig, pub) {\n  message = parseBytes(message);\n  sig = this.makeSignature(sig);\n  var key = this.keyFromPublic(pub);\n  var h = this.hashInt(sig.Rencoded(), key.pubBytes(), message);\n  var SG = this.g.mul(sig.S());\n  var RplusAh = sig.R().add(key.pub().mul(h));\n  return RplusAh.eq(SG);\n};\n\nEDDSA.prototype.hashInt = function hashInt() {\n  var hash = this.hash();\n  for (var i = 0; i < arguments.length; i++)\n    hash.update(arguments[i]);\n  return utils.intFromLE(hash.digest()).umod(this.curve.n);\n};\n\nEDDSA.prototype.keyFromPublic = function keyFromPublic(pub) {\n  return KeyPair.fromPublic(this, pub);\n};\n\nEDDSA.prototype.keyFromSecret = function keyFromSecret(secret) {\n  return KeyPair.fromSecret(this, secret);\n};\n\nEDDSA.prototype.makeSignature = function makeSignature(sig) {\n  if (sig instanceof Signature)\n    return sig;\n  return new Signature(this, sig);\n};\n\n/**\n* * https://tools.ietf.org/html/draft-josefsson-eddsa-ed25519-03#section-5.2\n*\n* EDDSA defines methods for encoding and decoding points and integers. These are\n* helper convenience methods, that pass along to utility functions implied\n* parameters.\n*\n*/\nEDDSA.prototype.encodePoint = function encodePoint(point) {\n  var enc = point.getY().toArray('le', this.encodingLength);\n  enc[this.encodingLength - 1] |= point.getX().isOdd() ? 0x80 : 0;\n  return enc;\n};\n\nEDDSA.prototype.decodePoint = function decodePoint(bytes) {\n  bytes = utils.parseBytes(bytes);\n\n  var lastIx = bytes.length - 1;\n  var normed = bytes.slice(0, lastIx).concat(bytes[lastIx] & ~0x80);\n  var xIsOdd = (bytes[lastIx] & 0x80) !== 0;\n\n  var y = utils.intFromLE(normed);\n  return this.curve.pointFromY(y, xIsOdd);\n};\n\nEDDSA.prototype.encodeInt = function encodeInt(num) {\n  return num.toArray('le', this.encodingLength);\n};\n\nEDDSA.prototype.decodeInt = function decodeInt(bytes) {\n  return utils.intFromLE(bytes);\n};\n\nEDDSA.prototype.isPoint = function isPoint(val) {\n  return val instanceof this.pointClass;\n};\n","'use strict';\n\nvar elliptic = exports;\n\nelliptic.version = require('../package.json').version;\nelliptic.utils = require('./elliptic/utils');\nelliptic.rand = require('brorand');\nelliptic.curve = require('./elliptic/curve');\nelliptic.curves = require('./elliptic/curves');\n\n// Protocols\nelliptic.ec = require('./elliptic/ec');\nelliptic.eddsa = require('./elliptic/eddsa');\n","\nvar indexOf = [].indexOf;\n\nmodule.exports = function(arr, obj){\n  if (indexOf) return arr.indexOf(obj);\n  for (var i = 0; i < arr.length; ++i) {\n    if (arr[i] === obj) return i;\n  }\n  return -1;\n};","var indexOf = require('indexof');\n\nvar Object_keys = function (obj) {\n    if (Object.keys) return Object.keys(obj)\n    else {\n        var res = [];\n        for (var key in obj) res.push(key)\n        return res;\n    }\n};\n\nvar forEach = function (xs, fn) {\n    if (xs.forEach) return xs.forEach(fn)\n    else for (var i = 0; i < xs.length; i++) {\n        fn(xs[i], i, xs);\n    }\n};\n\nvar defineProp = (function() {\n    try {\n        Object.defineProperty({}, '_', {});\n        return function(obj, name, value) {\n            Object.defineProperty(obj, name, {\n                writable: true,\n                enumerable: false,\n                configurable: true,\n                value: value\n            })\n        };\n    } catch(e) {\n        return function(obj, name, value) {\n            obj[name] = value;\n        };\n    }\n}());\n\nvar globals = ['Array', 'Boolean', 'Date', 'Error', 'EvalError', 'Function',\n'Infinity', 'JSON', 'Math', 'NaN', 'Number', 'Object', 'RangeError',\n'ReferenceError', 'RegExp', 'String', 'SyntaxError', 'TypeError', 'URIError',\n'decodeURI', 'decodeURIComponent', 'encodeURI', 'encodeURIComponent', 'escape',\n'eval', 'isFinite', 'isNaN', 'parseFloat', 'parseInt', 'undefined', 'unescape'];\n\nfunction Context() {}\nContext.prototype = {};\n\nvar Script = exports.Script = function NodeScript (code) {\n    if (!(this instanceof Script)) return new Script(code);\n    this.code = code;\n};\n\nScript.prototype.runInContext = function (context) {\n    if (!(context instanceof Context)) {\n        throw new TypeError(\"needs a 'context' argument.\");\n    }\n    \n    var iframe = document.createElement('iframe');\n    if (!iframe.style) iframe.style = {};\n    iframe.style.display = 'none';\n    \n    document.body.appendChild(iframe);\n    \n    var win = iframe.contentWindow;\n    var wEval = win.eval, wExecScript = win.execScript;\n\n    if (!wEval && wExecScript) {\n        // win.eval() magically appears when this is called in IE:\n        wExecScript.call(win, 'null');\n        wEval = win.eval;\n    }\n    \n    forEach(Object_keys(context), function (key) {\n        win[key] = context[key];\n    });\n    forEach(globals, function (key) {\n        if (context[key]) {\n            win[key] = context[key];\n        }\n    });\n    \n    var winKeys = Object_keys(win);\n\n    var res = wEval.call(win, this.code);\n    \n    forEach(Object_keys(win), function (key) {\n        // Avoid copying circular objects like `top` and `window` by only\n        // updating existing context properties or new properties in the `win`\n        // that was only introduced after the eval.\n        if (key in context || indexOf(winKeys, key) === -1) {\n            context[key] = win[key];\n        }\n    });\n\n    forEach(globals, function (key) {\n        if (!(key in context)) {\n            defineProp(context, key, win[key]);\n        }\n    });\n    \n    document.body.removeChild(iframe);\n    \n    return res;\n};\n\nScript.prototype.runInThisContext = function () {\n    return eval(this.code); // maybe...\n};\n\nScript.prototype.runInNewContext = function (context) {\n    var ctx = Script.createContext(context);\n    var res = this.runInContext(ctx);\n\n    forEach(Object_keys(ctx), function (key) {\n        context[key] = ctx[key];\n    });\n\n    return res;\n};\n\nforEach(Object_keys(Script.prototype), function (name) {\n    exports[name] = Script[name] = function (code) {\n        var s = Script(code);\n        return s[name].apply(s, [].slice.call(arguments, 1));\n    };\n});\n\nexports.createScript = function (code) {\n    return exports.Script(code);\n};\n\nexports.createContext = Script.createContext = function (context) {\n    var copy = new Context();\n    if(typeof context === 'object') {\n        forEach(Object_keys(context), function (key) {\n            copy[key] = context[key];\n        });\n    }\n    return copy;\n};\n","var asn1 = require('../asn1');\nvar inherits = require('inherits');\n\nvar api = exports;\n\napi.define = function define(name, body) {\n  return new Entity(name, body);\n};\n\nfunction Entity(name, body) {\n  this.name = name;\n  this.body = body;\n\n  this.decoders = {};\n  this.encoders = {};\n};\n\nEntity.prototype._createNamed = function createNamed(base) {\n  var named;\n  try {\n    named = require('vm').runInThisContext(\n      '(function ' + this.name + '(entity) {\\n' +\n      '  this._initNamed(entity);\\n' +\n      '})'\n    );\n  } catch (e) {\n    named = function (entity) {\n      this._initNamed(entity);\n    };\n  }\n  inherits(named, base);\n  named.prototype._initNamed = function initnamed(entity) {\n    base.call(this, entity);\n  };\n\n  return new named(this);\n};\n\nEntity.prototype._getDecoder = function _getDecoder(enc) {\n  enc = enc || 'der';\n  // Lazily create decoder\n  if (!this.decoders.hasOwnProperty(enc))\n    this.decoders[enc] = this._createNamed(asn1.decoders[enc]);\n  return this.decoders[enc];\n};\n\nEntity.prototype.decode = function decode(data, enc, options) {\n  return this._getDecoder(enc).decode(data, options);\n};\n\nEntity.prototype._getEncoder = function _getEncoder(enc) {\n  enc = enc || 'der';\n  // Lazily create encoder\n  if (!this.encoders.hasOwnProperty(enc))\n    this.encoders[enc] = this._createNamed(asn1.encoders[enc]);\n  return this.encoders[enc];\n};\n\nEntity.prototype.encode = function encode(data, enc, /* internal */ reporter) {\n  return this._getEncoder(enc).encode(data, reporter);\n};\n","var inherits = require('inherits');\n\nfunction Reporter(options) {\n  this._reporterState = {\n    obj: null,\n    path: [],\n    options: options || {},\n    errors: []\n  };\n}\nexports.Reporter = Reporter;\n\nReporter.prototype.isError = function isError(obj) {\n  return obj instanceof ReporterError;\n};\n\nReporter.prototype.save = function save() {\n  var state = this._reporterState;\n\n  return { obj: state.obj, pathLen: state.path.length };\n};\n\nReporter.prototype.restore = function restore(data) {\n  var state = this._reporterState;\n\n  state.obj = data.obj;\n  state.path = state.path.slice(0, data.pathLen);\n};\n\nReporter.prototype.enterKey = function enterKey(key) {\n  return this._reporterState.path.push(key);\n};\n\nReporter.prototype.exitKey = function exitKey(index) {\n  var state = this._reporterState;\n\n  state.path = state.path.slice(0, index - 1);\n};\n\nReporter.prototype.leaveKey = function leaveKey(index, key, value) {\n  var state = this._reporterState;\n\n  this.exitKey(index);\n  if (state.obj !== null)\n    state.obj[key] = value;\n};\n\nReporter.prototype.path = function path() {\n  return this._reporterState.path.join('/');\n};\n\nReporter.prototype.enterObject = function enterObject() {\n  var state = this._reporterState;\n\n  var prev = state.obj;\n  state.obj = {};\n  return prev;\n};\n\nReporter.prototype.leaveObject = function leaveObject(prev) {\n  var state = this._reporterState;\n\n  var now = state.obj;\n  state.obj = prev;\n  return now;\n};\n\nReporter.prototype.error = function error(msg) {\n  var err;\n  var state = this._reporterState;\n\n  var inherited = msg instanceof ReporterError;\n  if (inherited) {\n    err = msg;\n  } else {\n    err = new ReporterError(state.path.map(function(elem) {\n      return '[' + JSON.stringify(elem) + ']';\n    }).join(''), msg.message || msg, msg.stack);\n  }\n\n  if (!state.options.partial)\n    throw err;\n\n  if (!inherited)\n    state.errors.push(err);\n\n  return err;\n};\n\nReporter.prototype.wrapResult = function wrapResult(result) {\n  var state = this._reporterState;\n  if (!state.options.partial)\n    return result;\n\n  return {\n    result: this.isError(result) ? null : result,\n    errors: state.errors\n  };\n};\n\nfunction ReporterError(path, msg) {\n  this.path = path;\n  this.rethrow(msg);\n};\ninherits(ReporterError, Error);\n\nReporterError.prototype.rethrow = function rethrow(msg) {\n  this.message = msg + ' at: ' + (this.path || '(shallow)');\n  if (Error.captureStackTrace)\n    Error.captureStackTrace(this, ReporterError);\n\n  if (!this.stack) {\n    try {\n      // IE only adds stack when thrown\n      throw new Error(this.message);\n    } catch (e) {\n      this.stack = e.stack;\n    }\n  }\n  return this;\n};\n","var inherits = require('inherits');\nvar Reporter = require('../base').Reporter;\nvar Buffer = require('buffer').Buffer;\n\nfunction DecoderBuffer(base, options) {\n  Reporter.call(this, options);\n  if (!Buffer.isBuffer(base)) {\n    this.error('Input not Buffer');\n    return;\n  }\n\n  this.base = base;\n  this.offset = 0;\n  this.length = base.length;\n}\ninherits(DecoderBuffer, Reporter);\nexports.DecoderBuffer = DecoderBuffer;\n\nDecoderBuffer.prototype.save = function save() {\n  return { offset: this.offset, reporter: Reporter.prototype.save.call(this) };\n};\n\nDecoderBuffer.prototype.restore = function restore(save) {\n  // Return skipped data\n  var res = new DecoderBuffer(this.base);\n  res.offset = save.offset;\n  res.length = this.offset;\n\n  this.offset = save.offset;\n  Reporter.prototype.restore.call(this, save.reporter);\n\n  return res;\n};\n\nDecoderBuffer.prototype.isEmpty = function isEmpty() {\n  return this.offset === this.length;\n};\n\nDecoderBuffer.prototype.readUInt8 = function readUInt8(fail) {\n  if (this.offset + 1 <= this.length)\n    return this.base.readUInt8(this.offset++, true);\n  else\n    return this.error(fail || 'DecoderBuffer overrun');\n}\n\nDecoderBuffer.prototype.skip = function skip(bytes, fail) {\n  if (!(this.offset + bytes <= this.length))\n    return this.error(fail || 'DecoderBuffer overrun');\n\n  var res = new DecoderBuffer(this.base);\n\n  // Share reporter state\n  res._reporterState = this._reporterState;\n\n  res.offset = this.offset;\n  res.length = this.offset + bytes;\n  this.offset += bytes;\n  return res;\n}\n\nDecoderBuffer.prototype.raw = function raw(save) {\n  return this.base.slice(save ? save.offset : this.offset, this.length);\n}\n\nfunction EncoderBuffer(value, reporter) {\n  if (Array.isArray(value)) {\n    this.length = 0;\n    this.value = value.map(function(item) {\n      if (!(item instanceof EncoderBuffer))\n        item = new EncoderBuffer(item, reporter);\n      this.length += item.length;\n      return item;\n    }, this);\n  } else if (typeof value === 'number') {\n    if (!(0 <= value && value <= 0xff))\n      return reporter.error('non-byte EncoderBuffer value');\n    this.value = value;\n    this.length = 1;\n  } else if (typeof value === 'string') {\n    this.value = value;\n    this.length = Buffer.byteLength(value);\n  } else if (Buffer.isBuffer(value)) {\n    this.value = value;\n    this.length = value.length;\n  } else {\n    return reporter.error('Unsupported type: ' + typeof value);\n  }\n}\nexports.EncoderBuffer = EncoderBuffer;\n\nEncoderBuffer.prototype.join = function join(out, offset) {\n  if (!out)\n    out = new Buffer(this.length);\n  if (!offset)\n    offset = 0;\n\n  if (this.length === 0)\n    return out;\n\n  if (Array.isArray(this.value)) {\n    this.value.forEach(function(item) {\n      item.join(out, offset);\n      offset += item.length;\n    });\n  } else {\n    if (typeof this.value === 'number')\n      out[offset] = this.value;\n    else if (typeof this.value === 'string')\n      out.write(this.value, offset);\n    else if (Buffer.isBuffer(this.value))\n      this.value.copy(out, offset);\n    offset += this.length;\n  }\n\n  return out;\n};\n","var Reporter = require('../base').Reporter;\nvar EncoderBuffer = require('../base').EncoderBuffer;\nvar DecoderBuffer = require('../base').DecoderBuffer;\nvar assert = require('minimalistic-assert');\n\n// Supported tags\nvar tags = [\n  'seq', 'seqof', 'set', 'setof', 'objid', 'bool',\n  'gentime', 'utctime', 'null_', 'enum', 'int', 'objDesc',\n  'bitstr', 'bmpstr', 'charstr', 'genstr', 'graphstr', 'ia5str', 'iso646str',\n  'numstr', 'octstr', 'printstr', 't61str', 'unistr', 'utf8str', 'videostr'\n];\n\n// Public methods list\nvar methods = [\n  'key', 'obj', 'use', 'optional', 'explicit', 'implicit', 'def', 'choice',\n  'any', 'contains'\n].concat(tags);\n\n// Overrided methods list\nvar overrided = [\n  '_peekTag', '_decodeTag', '_use',\n  '_decodeStr', '_decodeObjid', '_decodeTime',\n  '_decodeNull', '_decodeInt', '_decodeBool', '_decodeList',\n\n  '_encodeComposite', '_encodeStr', '_encodeObjid', '_encodeTime',\n  '_encodeNull', '_encodeInt', '_encodeBool'\n];\n\nfunction Node(enc, parent) {\n  var state = {};\n  this._baseState = state;\n\n  state.enc = enc;\n\n  state.parent = parent || null;\n  state.children = null;\n\n  // State\n  state.tag = null;\n  state.args = null;\n  state.reverseArgs = null;\n  state.choice = null;\n  state.optional = false;\n  state.any = false;\n  state.obj = false;\n  state.use = null;\n  state.useDecoder = null;\n  state.key = null;\n  state['default'] = null;\n  state.explicit = null;\n  state.implicit = null;\n  state.contains = null;\n\n  // Should create new instance on each method\n  if (!state.parent) {\n    state.children = [];\n    this._wrap();\n  }\n}\nmodule.exports = Node;\n\nvar stateProps = [\n  'enc', 'parent', 'children', 'tag', 'args', 'reverseArgs', 'choice',\n  'optional', 'any', 'obj', 'use', 'alteredUse', 'key', 'default', 'explicit',\n  'implicit', 'contains'\n];\n\nNode.prototype.clone = function clone() {\n  var state = this._baseState;\n  var cstate = {};\n  stateProps.forEach(function(prop) {\n    cstate[prop] = state[prop];\n  });\n  var res = new this.constructor(cstate.parent);\n  res._baseState = cstate;\n  return res;\n};\n\nNode.prototype._wrap = function wrap() {\n  var state = this._baseState;\n  methods.forEach(function(method) {\n    this[method] = function _wrappedMethod() {\n      var clone = new this.constructor(this);\n      state.children.push(clone);\n      return clone[method].apply(clone, arguments);\n    };\n  }, this);\n};\n\nNode.prototype._init = function init(body) {\n  var state = this._baseState;\n\n  assert(state.parent === null);\n  body.call(this);\n\n  // Filter children\n  state.children = state.children.filter(function(child) {\n    return child._baseState.parent === this;\n  }, this);\n  assert.equal(state.children.length, 1, 'Root node can have only one child');\n};\n\nNode.prototype._useArgs = function useArgs(args) {\n  var state = this._baseState;\n\n  // Filter children and args\n  var children = args.filter(function(arg) {\n    return arg instanceof this.constructor;\n  }, this);\n  args = args.filter(function(arg) {\n    return !(arg instanceof this.constructor);\n  }, this);\n\n  if (children.length !== 0) {\n    assert(state.children === null);\n    state.children = children;\n\n    // Replace parent to maintain backward link\n    children.forEach(function(child) {\n      child._baseState.parent = this;\n    }, this);\n  }\n  if (args.length !== 0) {\n    assert(state.args === null);\n    state.args = args;\n    state.reverseArgs = args.map(function(arg) {\n      if (typeof arg !== 'object' || arg.constructor !== Object)\n        return arg;\n\n      var res = {};\n      Object.keys(arg).forEach(function(key) {\n        if (key == (key | 0))\n          key |= 0;\n        var value = arg[key];\n        res[value] = key;\n      });\n      return res;\n    });\n  }\n};\n\n//\n// Overrided methods\n//\n\noverrided.forEach(function(method) {\n  Node.prototype[method] = function _overrided() {\n    var state = this._baseState;\n    throw new Error(method + ' not implemented for encoding: ' + state.enc);\n  };\n});\n\n//\n// Public methods\n//\n\ntags.forEach(function(tag) {\n  Node.prototype[tag] = function _tagMethod() {\n    var state = this._baseState;\n    var args = Array.prototype.slice.call(arguments);\n\n    assert(state.tag === null);\n    state.tag = tag;\n\n    this._useArgs(args);\n\n    return this;\n  };\n});\n\nNode.prototype.use = function use(item) {\n  assert(item);\n  var state = this._baseState;\n\n  assert(state.use === null);\n  state.use = item;\n\n  return this;\n};\n\nNode.prototype.optional = function optional() {\n  var state = this._baseState;\n\n  state.optional = true;\n\n  return this;\n};\n\nNode.prototype.def = function def(val) {\n  var state = this._baseState;\n\n  assert(state['default'] === null);\n  state['default'] = val;\n  state.optional = true;\n\n  return this;\n};\n\nNode.prototype.explicit = function explicit(num) {\n  var state = this._baseState;\n\n  assert(state.explicit === null && state.implicit === null);\n  state.explicit = num;\n\n  return this;\n};\n\nNode.prototype.implicit = function implicit(num) {\n  var state = this._baseState;\n\n  assert(state.explicit === null && state.implicit === null);\n  state.implicit = num;\n\n  return this;\n};\n\nNode.prototype.obj = function obj() {\n  var state = this._baseState;\n  var args = Array.prototype.slice.call(arguments);\n\n  state.obj = true;\n\n  if (args.length !== 0)\n    this._useArgs(args);\n\n  return this;\n};\n\nNode.prototype.key = function key(newKey) {\n  var state = this._baseState;\n\n  assert(state.key === null);\n  state.key = newKey;\n\n  return this;\n};\n\nNode.prototype.any = function any() {\n  var state = this._baseState;\n\n  state.any = true;\n\n  return this;\n};\n\nNode.prototype.choice = function choice(obj) {\n  var state = this._baseState;\n\n  assert(state.choice === null);\n  state.choice = obj;\n  this._useArgs(Object.keys(obj).map(function(key) {\n    return obj[key];\n  }));\n\n  return this;\n};\n\nNode.prototype.contains = function contains(item) {\n  var state = this._baseState;\n\n  assert(state.use === null);\n  state.contains = item;\n\n  return this;\n};\n\n//\n// Decoding\n//\n\nNode.prototype._decode = function decode(input, options) {\n  var state = this._baseState;\n\n  // Decode root node\n  if (state.parent === null)\n    return input.wrapResult(state.children[0]._decode(input, options));\n\n  var result = state['default'];\n  var present = true;\n\n  var prevKey = null;\n  if (state.key !== null)\n    prevKey = input.enterKey(state.key);\n\n  // Check if tag is there\n  if (state.optional) {\n    var tag = null;\n    if (state.explicit !== null)\n      tag = state.explicit;\n    else if (state.implicit !== null)\n      tag = state.implicit;\n    else if (state.tag !== null)\n      tag = state.tag;\n\n    if (tag === null && !state.any) {\n      // Trial and Error\n      var save = input.save();\n      try {\n        if (state.choice === null)\n          this._decodeGeneric(state.tag, input, options);\n        else\n          this._decodeChoice(input, options);\n        present = true;\n      } catch (e) {\n        present = false;\n      }\n      input.restore(save);\n    } else {\n      present = this._peekTag(input, tag, state.any);\n\n      if (input.isError(present))\n        return present;\n    }\n  }\n\n  // Push object on stack\n  var prevObj;\n  if (state.obj && present)\n    prevObj = input.enterObject();\n\n  if (present) {\n    // Unwrap explicit values\n    if (state.explicit !== null) {\n      var explicit = this._decodeTag(input, state.explicit);\n      if (input.isError(explicit))\n        return explicit;\n      input = explicit;\n    }\n\n    var start = input.offset;\n\n    // Unwrap implicit and normal values\n    if (state.use === null && state.choice === null) {\n      if (state.any)\n        var save = input.save();\n      var body = this._decodeTag(\n        input,\n        state.implicit !== null ? state.implicit : state.tag,\n        state.any\n      );\n      if (input.isError(body))\n        return body;\n\n      if (state.any)\n        result = input.raw(save);\n      else\n        input = body;\n    }\n\n    if (options && options.track && state.tag !== null)\n      options.track(input.path(), start, input.length, 'tagged');\n\n    if (options && options.track && state.tag !== null)\n      options.track(input.path(), input.offset, input.length, 'content');\n\n    // Select proper method for tag\n    if (state.any)\n      result = result;\n    else if (state.choice === null)\n      result = this._decodeGeneric(state.tag, input, options);\n    else\n      result = this._decodeChoice(input, options);\n\n    if (input.isError(result))\n      return result;\n\n    // Decode children\n    if (!state.any && state.choice === null && state.children !== null) {\n      state.children.forEach(function decodeChildren(child) {\n        // NOTE: We are ignoring errors here, to let parser continue with other\n        // parts of encoded data\n        child._decode(input, options);\n      });\n    }\n\n    // Decode contained/encoded by schema, only in bit or octet strings\n    if (state.contains && (state.tag === 'octstr' || state.tag === 'bitstr')) {\n      var data = new DecoderBuffer(result);\n      result = this._getUse(state.contains, input._reporterState.obj)\n          ._decode(data, options);\n    }\n  }\n\n  // Pop object\n  if (state.obj && present)\n    result = input.leaveObject(prevObj);\n\n  // Set key\n  if (state.key !== null && (result !== null || present === true))\n    input.leaveKey(prevKey, state.key, result);\n  else if (prevKey !== null)\n    input.exitKey(prevKey);\n\n  return result;\n};\n\nNode.prototype._decodeGeneric = function decodeGeneric(tag, input, options) {\n  var state = this._baseState;\n\n  if (tag === 'seq' || tag === 'set')\n    return null;\n  if (tag === 'seqof' || tag === 'setof')\n    return this._decodeList(input, tag, state.args[0], options);\n  else if (/str$/.test(tag))\n    return this._decodeStr(input, tag, options);\n  else if (tag === 'objid' && state.args)\n    return this._decodeObjid(input, state.args[0], state.args[1], options);\n  else if (tag === 'objid')\n    return this._decodeObjid(input, null, null, options);\n  else if (tag === 'gentime' || tag === 'utctime')\n    return this._decodeTime(input, tag, options);\n  else if (tag === 'null_')\n    return this._decodeNull(input, options);\n  else if (tag === 'bool')\n    return this._decodeBool(input, options);\n  else if (tag === 'objDesc')\n    return this._decodeStr(input, tag, options);\n  else if (tag === 'int' || tag === 'enum')\n    return this._decodeInt(input, state.args && state.args[0], options);\n\n  if (state.use !== null) {\n    return this._getUse(state.use, input._reporterState.obj)\n        ._decode(input, options);\n  } else {\n    return input.error('unknown tag: ' + tag);\n  }\n};\n\nNode.prototype._getUse = function _getUse(entity, obj) {\n\n  var state = this._baseState;\n  // Create altered use decoder if implicit is set\n  state.useDecoder = this._use(entity, obj);\n  assert(state.useDecoder._baseState.parent === null);\n  state.useDecoder = state.useDecoder._baseState.children[0];\n  if (state.implicit !== state.useDecoder._baseState.implicit) {\n    state.useDecoder = state.useDecoder.clone();\n    state.useDecoder._baseState.implicit = state.implicit;\n  }\n  return state.useDecoder;\n};\n\nNode.prototype._decodeChoice = function decodeChoice(input, options) {\n  var state = this._baseState;\n  var result = null;\n  var match = false;\n\n  Object.keys(state.choice).some(function(key) {\n    var save = input.save();\n    var node = state.choice[key];\n    try {\n      var value = node._decode(input, options);\n      if (input.isError(value))\n        return false;\n\n      result = { type: key, value: value };\n      match = true;\n    } catch (e) {\n      input.restore(save);\n      return false;\n    }\n    return true;\n  }, this);\n\n  if (!match)\n    return input.error('Choice not matched');\n\n  return result;\n};\n\n//\n// Encoding\n//\n\nNode.prototype._createEncoderBuffer = function createEncoderBuffer(data) {\n  return new EncoderBuffer(data, this.reporter);\n};\n\nNode.prototype._encode = function encode(data, reporter, parent) {\n  var state = this._baseState;\n  if (state['default'] !== null && state['default'] === data)\n    return;\n\n  var result = this._encodeValue(data, reporter, parent);\n  if (result === undefined)\n    return;\n\n  if (this._skipDefault(result, reporter, parent))\n    return;\n\n  return result;\n};\n\nNode.prototype._encodeValue = function encode(data, reporter, parent) {\n  var state = this._baseState;\n\n  // Decode root node\n  if (state.parent === null)\n    return state.children[0]._encode(data, reporter || new Reporter());\n\n  var result = null;\n\n  // Set reporter to share it with a child class\n  this.reporter = reporter;\n\n  // Check if data is there\n  if (state.optional && data === undefined) {\n    if (state['default'] !== null)\n      data = state['default']\n    else\n      return;\n  }\n\n  // Encode children first\n  var content = null;\n  var primitive = false;\n  if (state.any) {\n    // Anything that was given is translated to buffer\n    result = this._createEncoderBuffer(data);\n  } else if (state.choice) {\n    result = this._encodeChoice(data, reporter);\n  } else if (state.contains) {\n    content = this._getUse(state.contains, parent)._encode(data, reporter);\n    primitive = true;\n  } else if (state.children) {\n    content = state.children.map(function(child) {\n      if (child._baseState.tag === 'null_')\n        return child._encode(null, reporter, data);\n\n      if (child._baseState.key === null)\n        return reporter.error('Child should have a key');\n      var prevKey = reporter.enterKey(child._baseState.key);\n\n      if (typeof data !== 'object')\n        return reporter.error('Child expected, but input is not object');\n\n      var res = child._encode(data[child._baseState.key], reporter, data);\n      reporter.leaveKey(prevKey);\n\n      return res;\n    }, this).filter(function(child) {\n      return child;\n    });\n    content = this._createEncoderBuffer(content);\n  } else {\n    if (state.tag === 'seqof' || state.tag === 'setof') {\n      // TODO(indutny): this should be thrown on DSL level\n      if (!(state.args && state.args.length === 1))\n        return reporter.error('Too many args for : ' + state.tag);\n\n      if (!Array.isArray(data))\n        return reporter.error('seqof/setof, but data is not Array');\n\n      var child = this.clone();\n      child._baseState.implicit = null;\n      content = this._createEncoderBuffer(data.map(function(item) {\n        var state = this._baseState;\n\n        return this._getUse(state.args[0], data)._encode(item, reporter);\n      }, child));\n    } else if (state.use !== null) {\n      result = this._getUse(state.use, parent)._encode(data, reporter);\n    } else {\n      content = this._encodePrimitive(state.tag, data);\n      primitive = true;\n    }\n  }\n\n  // Encode data itself\n  var result;\n  if (!state.any && state.choice === null) {\n    var tag = state.implicit !== null ? state.implicit : state.tag;\n    var cls = state.implicit === null ? 'universal' : 'context';\n\n    if (tag === null) {\n      if (state.use === null)\n        reporter.error('Tag could be omitted only for .use()');\n    } else {\n      if (state.use === null)\n        result = this._encodeComposite(tag, primitive, cls, content);\n    }\n  }\n\n  // Wrap in explicit\n  if (state.explicit !== null)\n    result = this._encodeComposite(state.explicit, false, 'context', result);\n\n  return result;\n};\n\nNode.prototype._encodeChoice = function encodeChoice(data, reporter) {\n  var state = this._baseState;\n\n  var node = state.choice[data.type];\n  if (!node) {\n    assert(\n        false,\n        data.type + ' not found in ' +\n            JSON.stringify(Object.keys(state.choice)));\n  }\n  return node._encode(data.value, reporter);\n};\n\nNode.prototype._encodePrimitive = function encodePrimitive(tag, data) {\n  var state = this._baseState;\n\n  if (/str$/.test(tag))\n    return this._encodeStr(data, tag);\n  else if (tag === 'objid' && state.args)\n    return this._encodeObjid(data, state.reverseArgs[0], state.args[1]);\n  else if (tag === 'objid')\n    return this._encodeObjid(data, null, null);\n  else if (tag === 'gentime' || tag === 'utctime')\n    return this._encodeTime(data, tag);\n  else if (tag === 'null_')\n    return this._encodeNull();\n  else if (tag === 'int' || tag === 'enum')\n    return this._encodeInt(data, state.args && state.reverseArgs[0]);\n  else if (tag === 'bool')\n    return this._encodeBool(data);\n  else if (tag === 'objDesc')\n    return this._encodeStr(data, tag);\n  else\n    throw new Error('Unsupported tag: ' + tag);\n};\n\nNode.prototype._isNumstr = function isNumstr(str) {\n  return /^[0-9 ]*$/.test(str);\n};\n\nNode.prototype._isPrintstr = function isPrintstr(str) {\n  return /^[A-Za-z0-9 '\\(\\)\\+,\\-\\.\\/:=\\?]*$/.test(str);\n};\n","var base = exports;\n\nbase.Reporter = require('./reporter').Reporter;\nbase.DecoderBuffer = require('./buffer').DecoderBuffer;\nbase.EncoderBuffer = require('./buffer').EncoderBuffer;\nbase.Node = require('./node');\n","var constants = require('../constants');\n\nexports.tagClass = {\n  0: 'universal',\n  1: 'application',\n  2: 'context',\n  3: 'private'\n};\nexports.tagClassByName = constants._reverse(exports.tagClass);\n\nexports.tag = {\n  0x00: 'end',\n  0x01: 'bool',\n  0x02: 'int',\n  0x03: 'bitstr',\n  0x04: 'octstr',\n  0x05: 'null_',\n  0x06: 'objid',\n  0x07: 'objDesc',\n  0x08: 'external',\n  0x09: 'real',\n  0x0a: 'enum',\n  0x0b: 'embed',\n  0x0c: 'utf8str',\n  0x0d: 'relativeOid',\n  0x10: 'seq',\n  0x11: 'set',\n  0x12: 'numstr',\n  0x13: 'printstr',\n  0x14: 't61str',\n  0x15: 'videostr',\n  0x16: 'ia5str',\n  0x17: 'utctime',\n  0x18: 'gentime',\n  0x19: 'graphstr',\n  0x1a: 'iso646str',\n  0x1b: 'genstr',\n  0x1c: 'unistr',\n  0x1d: 'charstr',\n  0x1e: 'bmpstr'\n};\nexports.tagByName = constants._reverse(exports.tag);\n","var constants = exports;\n\n// Helper\nconstants._reverse = function reverse(map) {\n  var res = {};\n\n  Object.keys(map).forEach(function(key) {\n    // Convert key to integer if it is stringified\n    if ((key | 0) == key)\n      key = key | 0;\n\n    var value = map[key];\n    res[value] = key;\n  });\n\n  return res;\n};\n\nconstants.der = require('./der');\n","var inherits = require('inherits');\n\nvar asn1 = require('../../asn1');\nvar base = asn1.base;\nvar bignum = asn1.bignum;\n\n// Import DER constants\nvar der = asn1.constants.der;\n\nfunction DERDecoder(entity) {\n  this.enc = 'der';\n  this.name = entity.name;\n  this.entity = entity;\n\n  // Construct base tree\n  this.tree = new DERNode();\n  this.tree._init(entity.body);\n};\nmodule.exports = DERDecoder;\n\nDERDecoder.prototype.decode = function decode(data, options) {\n  if (!(data instanceof base.DecoderBuffer))\n    data = new base.DecoderBuffer(data, options);\n\n  return this.tree._decode(data, options);\n};\n\n// Tree methods\n\nfunction DERNode(parent) {\n  base.Node.call(this, 'der', parent);\n}\ninherits(DERNode, base.Node);\n\nDERNode.prototype._peekTag = function peekTag(buffer, tag, any) {\n  if (buffer.isEmpty())\n    return false;\n\n  var state = buffer.save();\n  var decodedTag = derDecodeTag(buffer, 'Failed to peek tag: \"' + tag + '\"');\n  if (buffer.isError(decodedTag))\n    return decodedTag;\n\n  buffer.restore(state);\n\n  return decodedTag.tag === tag || decodedTag.tagStr === tag ||\n    (decodedTag.tagStr + 'of') === tag || any;\n};\n\nDERNode.prototype._decodeTag = function decodeTag(buffer, tag, any) {\n  var decodedTag = derDecodeTag(buffer,\n                                'Failed to decode tag of \"' + tag + '\"');\n  if (buffer.isError(decodedTag))\n    return decodedTag;\n\n  var len = derDecodeLen(buffer,\n                         decodedTag.primitive,\n                         'Failed to get length of \"' + tag + '\"');\n\n  // Failure\n  if (buffer.isError(len))\n    return len;\n\n  if (!any &&\n      decodedTag.tag !== tag &&\n      decodedTag.tagStr !== tag &&\n      decodedTag.tagStr + 'of' !== tag) {\n    return buffer.error('Failed to match tag: \"' + tag + '\"');\n  }\n\n  if (decodedTag.primitive || len !== null)\n    return buffer.skip(len, 'Failed to match body of: \"' + tag + '\"');\n\n  // Indefinite length... find END tag\n  var state = buffer.save();\n  var res = this._skipUntilEnd(\n      buffer,\n      'Failed to skip indefinite length body: \"' + this.tag + '\"');\n  if (buffer.isError(res))\n    return res;\n\n  len = buffer.offset - state.offset;\n  buffer.restore(state);\n  return buffer.skip(len, 'Failed to match body of: \"' + tag + '\"');\n};\n\nDERNode.prototype._skipUntilEnd = function skipUntilEnd(buffer, fail) {\n  while (true) {\n    var tag = derDecodeTag(buffer, fail);\n    if (buffer.isError(tag))\n      return tag;\n    var len = derDecodeLen(buffer, tag.primitive, fail);\n    if (buffer.isError(len))\n      return len;\n\n    var res;\n    if (tag.primitive || len !== null)\n      res = buffer.skip(len)\n    else\n      res = this._skipUntilEnd(buffer, fail);\n\n    // Failure\n    if (buffer.isError(res))\n      return res;\n\n    if (tag.tagStr === 'end')\n      break;\n  }\n};\n\nDERNode.prototype._decodeList = function decodeList(buffer, tag, decoder,\n                                                    options) {\n  var result = [];\n  while (!buffer.isEmpty()) {\n    var possibleEnd = this._peekTag(buffer, 'end');\n    if (buffer.isError(possibleEnd))\n      return possibleEnd;\n\n    var res = decoder.decode(buffer, 'der', options);\n    if (buffer.isError(res) && possibleEnd)\n      break;\n    result.push(res);\n  }\n  return result;\n};\n\nDERNode.prototype._decodeStr = function decodeStr(buffer, tag) {\n  if (tag === 'bitstr') {\n    var unused = buffer.readUInt8();\n    if (buffer.isError(unused))\n      return unused;\n    return { unused: unused, data: buffer.raw() };\n  } else if (tag === 'bmpstr') {\n    var raw = buffer.raw();\n    if (raw.length % 2 === 1)\n      return buffer.error('Decoding of string type: bmpstr length mismatch');\n\n    var str = '';\n    for (var i = 0; i < raw.length / 2; i++) {\n      str += String.fromCharCode(raw.readUInt16BE(i * 2));\n    }\n    return str;\n  } else if (tag === 'numstr') {\n    var numstr = buffer.raw().toString('ascii');\n    if (!this._isNumstr(numstr)) {\n      return buffer.error('Decoding of string type: ' +\n                          'numstr unsupported characters');\n    }\n    return numstr;\n  } else if (tag === 'octstr') {\n    return buffer.raw();\n  } else if (tag === 'objDesc') {\n    return buffer.raw();\n  } else if (tag === 'printstr') {\n    var printstr = buffer.raw().toString('ascii');\n    if (!this._isPrintstr(printstr)) {\n      return buffer.error('Decoding of string type: ' +\n                          'printstr unsupported characters');\n    }\n    return printstr;\n  } else if (/str$/.test(tag)) {\n    return buffer.raw().toString();\n  } else {\n    return buffer.error('Decoding of string type: ' + tag + ' unsupported');\n  }\n};\n\nDERNode.prototype._decodeObjid = function decodeObjid(buffer, values, relative) {\n  var result;\n  var identifiers = [];\n  var ident = 0;\n  while (!buffer.isEmpty()) {\n    var subident = buffer.readUInt8();\n    ident <<= 7;\n    ident |= subident & 0x7f;\n    if ((subident & 0x80) === 0) {\n      identifiers.push(ident);\n      ident = 0;\n    }\n  }\n  if (subident & 0x80)\n    identifiers.push(ident);\n\n  var first = (identifiers[0] / 40) | 0;\n  var second = identifiers[0] % 40;\n\n  if (relative)\n    result = identifiers;\n  else\n    result = [first, second].concat(identifiers.slice(1));\n\n  if (values) {\n    var tmp = values[result.join(' ')];\n    if (tmp === undefined)\n      tmp = values[result.join('.')];\n    if (tmp !== undefined)\n      result = tmp;\n  }\n\n  return result;\n};\n\nDERNode.prototype._decodeTime = function decodeTime(buffer, tag) {\n  var str = buffer.raw().toString();\n  if (tag === 'gentime') {\n    var year = str.slice(0, 4) | 0;\n    var mon = str.slice(4, 6) | 0;\n    var day = str.slice(6, 8) | 0;\n    var hour = str.slice(8, 10) | 0;\n    var min = str.slice(10, 12) | 0;\n    var sec = str.slice(12, 14) | 0;\n  } else if (tag === 'utctime') {\n    var year = str.slice(0, 2) | 0;\n    var mon = str.slice(2, 4) | 0;\n    var day = str.slice(4, 6) | 0;\n    var hour = str.slice(6, 8) | 0;\n    var min = str.slice(8, 10) | 0;\n    var sec = str.slice(10, 12) | 0;\n    if (year < 70)\n      year = 2000 + year;\n    else\n      year = 1900 + year;\n  } else {\n    return buffer.error('Decoding ' + tag + ' time is not supported yet');\n  }\n\n  return Date.UTC(year, mon - 1, day, hour, min, sec, 0);\n};\n\nDERNode.prototype._decodeNull = function decodeNull(buffer) {\n  return null;\n};\n\nDERNode.prototype._decodeBool = function decodeBool(buffer) {\n  var res = buffer.readUInt8();\n  if (buffer.isError(res))\n    return res;\n  else\n    return res !== 0;\n};\n\nDERNode.prototype._decodeInt = function decodeInt(buffer, values) {\n  // Bigint, return as it is (assume big endian)\n  var raw = buffer.raw();\n  var res = new bignum(raw);\n\n  if (values)\n    res = values[res.toString(10)] || res;\n\n  return res;\n};\n\nDERNode.prototype._use = function use(entity, obj) {\n  if (typeof entity === 'function')\n    entity = entity(obj);\n  return entity._getDecoder('der').tree;\n};\n\n// Utility methods\n\nfunction derDecodeTag(buf, fail) {\n  var tag = buf.readUInt8(fail);\n  if (buf.isError(tag))\n    return tag;\n\n  var cls = der.tagClass[tag >> 6];\n  var primitive = (tag & 0x20) === 0;\n\n  // Multi-octet tag - load\n  if ((tag & 0x1f) === 0x1f) {\n    var oct = tag;\n    tag = 0;\n    while ((oct & 0x80) === 0x80) {\n      oct = buf.readUInt8(fail);\n      if (buf.isError(oct))\n        return oct;\n\n      tag <<= 7;\n      tag |= oct & 0x7f;\n    }\n  } else {\n    tag &= 0x1f;\n  }\n  var tagStr = der.tag[tag];\n\n  return {\n    cls: cls,\n    primitive: primitive,\n    tag: tag,\n    tagStr: tagStr\n  };\n}\n\nfunction derDecodeLen(buf, primitive, fail) {\n  var len = buf.readUInt8(fail);\n  if (buf.isError(len))\n    return len;\n\n  // Indefinite form\n  if (!primitive && len === 0x80)\n    return null;\n\n  // Definite form\n  if ((len & 0x80) === 0) {\n    // Short form\n    return len;\n  }\n\n  // Long form\n  var num = len & 0x7f;\n  if (num > 4)\n    return buf.error('length octect is too long');\n\n  len = 0;\n  for (var i = 0; i < num; i++) {\n    len <<= 8;\n    var j = buf.readUInt8(fail);\n    if (buf.isError(j))\n      return j;\n    len |= j;\n  }\n\n  return len;\n}\n","var inherits = require('inherits');\nvar Buffer = require('buffer').Buffer;\n\nvar DERDecoder = require('./der');\n\nfunction PEMDecoder(entity) {\n  DERDecoder.call(this, entity);\n  this.enc = 'pem';\n};\ninherits(PEMDecoder, DERDecoder);\nmodule.exports = PEMDecoder;\n\nPEMDecoder.prototype.decode = function decode(data, options) {\n  var lines = data.toString().split(/[\\r\\n]+/g);\n\n  var label = options.label.toUpperCase();\n\n  var re = /^-----(BEGIN|END) ([^-]+)-----$/;\n  var start = -1;\n  var end = -1;\n  for (var i = 0; i < lines.length; i++) {\n    var match = lines[i].match(re);\n    if (match === null)\n      continue;\n\n    if (match[2] !== label)\n      continue;\n\n    if (start === -1) {\n      if (match[1] !== 'BEGIN')\n        break;\n      start = i;\n    } else {\n      if (match[1] !== 'END')\n        break;\n      end = i;\n      break;\n    }\n  }\n  if (start === -1 || end === -1)\n    throw new Error('PEM section not found for: ' + label);\n\n  var base64 = lines.slice(start + 1, end).join('');\n  // Remove excessive symbols\n  base64.replace(/[^a-z0-9\\+\\/=]+/gi, '');\n\n  var input = new Buffer(base64, 'base64');\n  return DERDecoder.prototype.decode.call(this, input, options);\n};\n","var decoders = exports;\n\ndecoders.der = require('./der');\ndecoders.pem = require('./pem');\n","var inherits = require('inherits');\nvar Buffer = require('buffer').Buffer;\n\nvar asn1 = require('../../asn1');\nvar base = asn1.base;\n\n// Import DER constants\nvar der = asn1.constants.der;\n\nfunction DEREncoder(entity) {\n  this.enc = 'der';\n  this.name = entity.name;\n  this.entity = entity;\n\n  // Construct base tree\n  this.tree = new DERNode();\n  this.tree._init(entity.body);\n};\nmodule.exports = DEREncoder;\n\nDEREncoder.prototype.encode = function encode(data, reporter) {\n  return this.tree._encode(data, reporter).join();\n};\n\n// Tree methods\n\nfunction DERNode(parent) {\n  base.Node.call(this, 'der', parent);\n}\ninherits(DERNode, base.Node);\n\nDERNode.prototype._encodeComposite = function encodeComposite(tag,\n                                                              primitive,\n                                                              cls,\n                                                              content) {\n  var encodedTag = encodeTag(tag, primitive, cls, this.reporter);\n\n  // Short form\n  if (content.length < 0x80) {\n    var header = new Buffer(2);\n    header[0] = encodedTag;\n    header[1] = content.length;\n    return this._createEncoderBuffer([ header, content ]);\n  }\n\n  // Long form\n  // Count octets required to store length\n  var lenOctets = 1;\n  for (var i = content.length; i >= 0x100; i >>= 8)\n    lenOctets++;\n\n  var header = new Buffer(1 + 1 + lenOctets);\n  header[0] = encodedTag;\n  header[1] = 0x80 | lenOctets;\n\n  for (var i = 1 + lenOctets, j = content.length; j > 0; i--, j >>= 8)\n    header[i] = j & 0xff;\n\n  return this._createEncoderBuffer([ header, content ]);\n};\n\nDERNode.prototype._encodeStr = function encodeStr(str, tag) {\n  if (tag === 'bitstr') {\n    return this._createEncoderBuffer([ str.unused | 0, str.data ]);\n  } else if (tag === 'bmpstr') {\n    var buf = new Buffer(str.length * 2);\n    for (var i = 0; i < str.length; i++) {\n      buf.writeUInt16BE(str.charCodeAt(i), i * 2);\n    }\n    return this._createEncoderBuffer(buf);\n  } else if (tag === 'numstr') {\n    if (!this._isNumstr(str)) {\n      return this.reporter.error('Encoding of string type: numstr supports ' +\n                                 'only digits and space');\n    }\n    return this._createEncoderBuffer(str);\n  } else if (tag === 'printstr') {\n    if (!this._isPrintstr(str)) {\n      return this.reporter.error('Encoding of string type: printstr supports ' +\n                                 'only latin upper and lower case letters, ' +\n                                 'digits, space, apostrophe, left and rigth ' +\n                                 'parenthesis, plus sign, comma, hyphen, ' +\n                                 'dot, slash, colon, equal sign, ' +\n                                 'question mark');\n    }\n    return this._createEncoderBuffer(str);\n  } else if (/str$/.test(tag)) {\n    return this._createEncoderBuffer(str);\n  } else if (tag === 'objDesc') {\n    return this._createEncoderBuffer(str);\n  } else {\n    return this.reporter.error('Encoding of string type: ' + tag +\n                               ' unsupported');\n  }\n};\n\nDERNode.prototype._encodeObjid = function encodeObjid(id, values, relative) {\n  if (typeof id === 'string') {\n    if (!values)\n      return this.reporter.error('string objid given, but no values map found');\n    if (!values.hasOwnProperty(id))\n      return this.reporter.error('objid not found in values map');\n    id = values[id].split(/[\\s\\.]+/g);\n    for (var i = 0; i < id.length; i++)\n      id[i] |= 0;\n  } else if (Array.isArray(id)) {\n    id = id.slice();\n    for (var i = 0; i < id.length; i++)\n      id[i] |= 0;\n  }\n\n  if (!Array.isArray(id)) {\n    return this.reporter.error('objid() should be either array or string, ' +\n                               'got: ' + JSON.stringify(id));\n  }\n\n  if (!relative) {\n    if (id[1] >= 40)\n      return this.reporter.error('Second objid identifier OOB');\n    id.splice(0, 2, id[0] * 40 + id[1]);\n  }\n\n  // Count number of octets\n  var size = 0;\n  for (var i = 0; i < id.length; i++) {\n    var ident = id[i];\n    for (size++; ident >= 0x80; ident >>= 7)\n      size++;\n  }\n\n  var objid = new Buffer(size);\n  var offset = objid.length - 1;\n  for (var i = id.length - 1; i >= 0; i--) {\n    var ident = id[i];\n    objid[offset--] = ident & 0x7f;\n    while ((ident >>= 7) > 0)\n      objid[offset--] = 0x80 | (ident & 0x7f);\n  }\n\n  return this._createEncoderBuffer(objid);\n};\n\nfunction two(num) {\n  if (num < 10)\n    return '0' + num;\n  else\n    return num;\n}\n\nDERNode.prototype._encodeTime = function encodeTime(time, tag) {\n  var str;\n  var date = new Date(time);\n\n  if (tag === 'gentime') {\n    str = [\n      two(date.getFullYear()),\n      two(date.getUTCMonth() + 1),\n      two(date.getUTCDate()),\n      two(date.getUTCHours()),\n      two(date.getUTCMinutes()),\n      two(date.getUTCSeconds()),\n      'Z'\n    ].join('');\n  } else if (tag === 'utctime') {\n    str = [\n      two(date.getFullYear() % 100),\n      two(date.getUTCMonth() + 1),\n      two(date.getUTCDate()),\n      two(date.getUTCHours()),\n      two(date.getUTCMinutes()),\n      two(date.getUTCSeconds()),\n      'Z'\n    ].join('');\n  } else {\n    this.reporter.error('Encoding ' + tag + ' time is not supported yet');\n  }\n\n  return this._encodeStr(str, 'octstr');\n};\n\nDERNode.prototype._encodeNull = function encodeNull() {\n  return this._createEncoderBuffer('');\n};\n\nDERNode.prototype._encodeInt = function encodeInt(num, values) {\n  if (typeof num === 'string') {\n    if (!values)\n      return this.reporter.error('String int or enum given, but no values map');\n    if (!values.hasOwnProperty(num)) {\n      return this.reporter.error('Values map doesn\\'t contain: ' +\n                                 JSON.stringify(num));\n    }\n    num = values[num];\n  }\n\n  // Bignum, assume big endian\n  if (typeof num !== 'number' && !Buffer.isBuffer(num)) {\n    var numArray = num.toArray();\n    if (!num.sign && numArray[0] & 0x80) {\n      numArray.unshift(0);\n    }\n    num = new Buffer(numArray);\n  }\n\n  if (Buffer.isBuffer(num)) {\n    var size = num.length;\n    if (num.length === 0)\n      size++;\n\n    var out = new Buffer(size);\n    num.copy(out);\n    if (num.length === 0)\n      out[0] = 0\n    return this._createEncoderBuffer(out);\n  }\n\n  if (num < 0x80)\n    return this._createEncoderBuffer(num);\n\n  if (num < 0x100)\n    return this._createEncoderBuffer([0, num]);\n\n  var size = 1;\n  for (var i = num; i >= 0x100; i >>= 8)\n    size++;\n\n  var out = new Array(size);\n  for (var i = out.length - 1; i >= 0; i--) {\n    out[i] = num & 0xff;\n    num >>= 8;\n  }\n  if(out[0] & 0x80) {\n    out.unshift(0);\n  }\n\n  return this._createEncoderBuffer(new Buffer(out));\n};\n\nDERNode.prototype._encodeBool = function encodeBool(value) {\n  return this._createEncoderBuffer(value ? 0xff : 0);\n};\n\nDERNode.prototype._use = function use(entity, obj) {\n  if (typeof entity === 'function')\n    entity = entity(obj);\n  return entity._getEncoder('der').tree;\n};\n\nDERNode.prototype._skipDefault = function skipDefault(dataBuffer, reporter, parent) {\n  var state = this._baseState;\n  var i;\n  if (state['default'] === null)\n    return false;\n\n  var data = dataBuffer.join();\n  if (state.defaultBuffer === undefined)\n    state.defaultBuffer = this._encodeValue(state['default'], reporter, parent).join();\n\n  if (data.length !== state.defaultBuffer.length)\n    return false;\n\n  for (i=0; i < data.length; i++)\n    if (data[i] !== state.defaultBuffer[i])\n      return false;\n\n  return true;\n};\n\n// Utility methods\n\nfunction encodeTag(tag, primitive, cls, reporter) {\n  var res;\n\n  if (tag === 'seqof')\n    tag = 'seq';\n  else if (tag === 'setof')\n    tag = 'set';\n\n  if (der.tagByName.hasOwnProperty(tag))\n    res = der.tagByName[tag];\n  else if (typeof tag === 'number' && (tag | 0) === tag)\n    res = tag;\n  else\n    return reporter.error('Unknown tag: ' + tag);\n\n  if (res >= 0x1f)\n    return reporter.error('Multi-octet tag encoding unsupported');\n\n  if (!primitive)\n    res |= 0x20;\n\n  res |= (der.tagClassByName[cls || 'universal'] << 6);\n\n  return res;\n}\n","var inherits = require('inherits');\n\nvar DEREncoder = require('./der');\n\nfunction PEMEncoder(entity) {\n  DEREncoder.call(this, entity);\n  this.enc = 'pem';\n};\ninherits(PEMEncoder, DEREncoder);\nmodule.exports = PEMEncoder;\n\nPEMEncoder.prototype.encode = function encode(data, options) {\n  var buf = DEREncoder.prototype.encode.call(this, data);\n\n  var p = buf.toString('base64');\n  var out = [ '-----BEGIN ' + options.label + '-----' ];\n  for (var i = 0; i < p.length; i += 64)\n    out.push(p.slice(i, i + 64));\n  out.push('-----END ' + options.label + '-----');\n  return out.join('\\n');\n};\n","var encoders = exports;\n\nencoders.der = require('./der');\nencoders.pem = require('./pem');\n","var asn1 = exports;\n\nasn1.bignum = require('bn.js');\n\nasn1.define = require('./asn1/api').define;\nasn1.base = require('./asn1/base');\nasn1.constants = require('./asn1/constants');\nasn1.decoders = require('./asn1/decoders');\nasn1.encoders = require('./asn1/encoders');\n","// from https://github.com/Rantanen/node-dtls/blob/25a7dc861bda38cfeac93a723500eea4f0ac2e86/Certificate.js\n// thanks to @Rantanen\n\n'use strict'\n\nvar asn = require('asn1.js')\n\nvar Time = asn.define('Time', function () {\n  this.choice({\n    utcTime: this.utctime(),\n    generalTime: this.gentime()\n  })\n})\n\nvar AttributeTypeValue = asn.define('AttributeTypeValue', function () {\n  this.seq().obj(\n    this.key('type').objid(),\n    this.key('value').any()\n  )\n})\n\nvar AlgorithmIdentifier = asn.define('AlgorithmIdentifier', function () {\n  this.seq().obj(\n    this.key('algorithm').objid(),\n    this.key('parameters').optional()\n  )\n})\n\nvar SubjectPublicKeyInfo = asn.define('SubjectPublicKeyInfo', function () {\n  this.seq().obj(\n    this.key('algorithm').use(AlgorithmIdentifier),\n    this.key('subjectPublicKey').bitstr()\n  )\n})\n\nvar RelativeDistinguishedName = asn.define('RelativeDistinguishedName', function () {\n  this.setof(AttributeTypeValue)\n})\n\nvar RDNSequence = asn.define('RDNSequence', function () {\n  this.seqof(RelativeDistinguishedName)\n})\n\nvar Name = asn.define('Name', function () {\n  this.choice({\n    rdnSequence: this.use(RDNSequence)\n  })\n})\n\nvar Validity = asn.define('Validity', function () {\n  this.seq().obj(\n    this.key('notBefore').use(Time),\n    this.key('notAfter').use(Time)\n  )\n})\n\nvar Extension = asn.define('Extension', function () {\n  this.seq().obj(\n    this.key('extnID').objid(),\n    this.key('critical').bool().def(false),\n    this.key('extnValue').octstr()\n  )\n})\n\nvar TBSCertificate = asn.define('TBSCertificate', function () {\n  this.seq().obj(\n    this.key('version').explicit(0).int(),\n    this.key('serialNumber').int(),\n    this.key('signature').use(AlgorithmIdentifier),\n    this.key('issuer').use(Name),\n    this.key('validity').use(Validity),\n    this.key('subject').use(Name),\n    this.key('subjectPublicKeyInfo').use(SubjectPublicKeyInfo),\n    this.key('issuerUniqueID').implicit(1).bitstr().optional(),\n    this.key('subjectUniqueID').implicit(2).bitstr().optional(),\n    this.key('extensions').explicit(3).seqof(Extension).optional()\n  )\n})\n\nvar X509Certificate = asn.define('X509Certificate', function () {\n  this.seq().obj(\n    this.key('tbsCertificate').use(TBSCertificate),\n    this.key('signatureAlgorithm').use(AlgorithmIdentifier),\n    this.key('signatureValue').bitstr()\n  )\n})\n\nmodule.exports = X509Certificate\n","// from https://github.com/indutny/self-signed/blob/gh-pages/lib/asn1.js\n// Fedor, you are amazing.\n'use strict'\n\nvar asn1 = require('asn1.js')\n\nexports.certificate = require('./certificate')\n\nvar RSAPrivateKey = asn1.define('RSAPrivateKey', function () {\n  this.seq().obj(\n    this.key('version').int(),\n    this.key('modulus').int(),\n    this.key('publicExponent').int(),\n    this.key('privateExponent').int(),\n    this.key('prime1').int(),\n    this.key('prime2').int(),\n    this.key('exponent1').int(),\n    this.key('exponent2').int(),\n    this.key('coefficient').int()\n  )\n})\nexports.RSAPrivateKey = RSAPrivateKey\n\nvar RSAPublicKey = asn1.define('RSAPublicKey', function () {\n  this.seq().obj(\n    this.key('modulus').int(),\n    this.key('publicExponent').int()\n  )\n})\nexports.RSAPublicKey = RSAPublicKey\n\nvar PublicKey = asn1.define('SubjectPublicKeyInfo', function () {\n  this.seq().obj(\n    this.key('algorithm').use(AlgorithmIdentifier),\n    this.key('subjectPublicKey').bitstr()\n  )\n})\nexports.PublicKey = PublicKey\n\nvar AlgorithmIdentifier = asn1.define('AlgorithmIdentifier', function () {\n  this.seq().obj(\n    this.key('algorithm').objid(),\n    this.key('none').null_().optional(),\n    this.key('curve').objid().optional(),\n    this.key('params').seq().obj(\n      this.key('p').int(),\n      this.key('q').int(),\n      this.key('g').int()\n    ).optional()\n  )\n})\n\nvar PrivateKeyInfo = asn1.define('PrivateKeyInfo', function () {\n  this.seq().obj(\n    this.key('version').int(),\n    this.key('algorithm').use(AlgorithmIdentifier),\n    this.key('subjectPrivateKey').octstr()\n  )\n})\nexports.PrivateKey = PrivateKeyInfo\nvar EncryptedPrivateKeyInfo = asn1.define('EncryptedPrivateKeyInfo', function () {\n  this.seq().obj(\n    this.key('algorithm').seq().obj(\n      this.key('id').objid(),\n      this.key('decrypt').seq().obj(\n        this.key('kde').seq().obj(\n          this.key('id').objid(),\n          this.key('kdeparams').seq().obj(\n            this.key('salt').octstr(),\n            this.key('iters').int()\n          )\n        ),\n        this.key('cipher').seq().obj(\n          this.key('algo').objid(),\n          this.key('iv').octstr()\n        )\n      )\n    ),\n    this.key('subjectPrivateKey').octstr()\n  )\n})\n\nexports.EncryptedPrivateKey = EncryptedPrivateKeyInfo\n\nvar DSAPrivateKey = asn1.define('DSAPrivateKey', function () {\n  this.seq().obj(\n    this.key('version').int(),\n    this.key('p').int(),\n    this.key('q').int(),\n    this.key('g').int(),\n    this.key('pub_key').int(),\n    this.key('priv_key').int()\n  )\n})\nexports.DSAPrivateKey = DSAPrivateKey\n\nexports.DSAparam = asn1.define('DSAparam', function () {\n  this.int()\n})\n\nvar ECPrivateKey = asn1.define('ECPrivateKey', function () {\n  this.seq().obj(\n    this.key('version').int(),\n    this.key('privateKey').octstr(),\n    this.key('parameters').optional().explicit(0).use(ECParameters),\n    this.key('publicKey').optional().explicit(1).bitstr()\n  )\n})\nexports.ECPrivateKey = ECPrivateKey\n\nvar ECParameters = asn1.define('ECParameters', function () {\n  this.choice({\n    namedCurve: this.objid()\n  })\n})\n\nexports.signature = asn1.define('signature', function () {\n  this.seq().obj(\n    this.key('r').int(),\n    this.key('s').int()\n  )\n})\n","// adapted from https://github.com/apatil/pemstrip\nvar findProc = /Proc-Type: 4,ENCRYPTED[\\n\\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\\n\\r]+([0-9A-z\\n\\r\\+\\/\\=]+)[\\n\\r]+/m\nvar startRegex = /^-----BEGIN ((?:.* KEY)|CERTIFICATE)-----/m\nvar fullRegex = /^-----BEGIN ((?:.* KEY)|CERTIFICATE)-----([0-9A-z\\n\\r\\+\\/\\=]+)-----END \\1-----$/m\nvar evp = require('evp_bytestokey')\nvar ciphers = require('browserify-aes')\nmodule.exports = function (okey, password) {\n  var key = okey.toString()\n  var match = key.match(findProc)\n  var decrypted\n  if (!match) {\n    var match2 = key.match(fullRegex)\n    decrypted = new Buffer(match2[2].replace(/[\\r\\n]/g, ''), 'base64')\n  } else {\n    var suite = 'aes' + match[1]\n    var iv = new Buffer(match[2], 'hex')\n    var cipherText = new Buffer(match[3].replace(/[\\r\\n]/g, ''), 'base64')\n    var cipherKey = evp(password, iv.slice(0, 8), parseInt(match[1], 10)).key\n    var out = []\n    var cipher = ciphers.createDecipheriv(suite, cipherKey, iv)\n    out.push(cipher.update(cipherText))\n    out.push(cipher.final())\n    decrypted = Buffer.concat(out)\n  }\n  var tag = key.match(startRegex)[1]\n  return {\n    tag: tag,\n    data: decrypted\n  }\n}\n","var asn1 = require('./asn1')\nvar aesid = require('./aesid.json')\nvar fixProc = require('./fixProc')\nvar ciphers = require('browserify-aes')\nvar compat = require('pbkdf2')\nmodule.exports = parseKeys\n\nfunction parseKeys (buffer) {\n  var password\n  if (typeof buffer === 'object' && !Buffer.isBuffer(buffer)) {\n    password = buffer.passphrase\n    buffer = buffer.key\n  }\n  if (typeof buffer === 'string') {\n    buffer = new Buffer(buffer)\n  }\n\n  var stripped = fixProc(buffer, password)\n\n  var type = stripped.tag\n  var data = stripped.data\n  var subtype, ndata\n  switch (type) {\n    case 'CERTIFICATE':\n      ndata = asn1.certificate.decode(data, 'der').tbsCertificate.subjectPublicKeyInfo\n      // falls through\n    case 'PUBLIC KEY':\n      if (!ndata) {\n        ndata = asn1.PublicKey.decode(data, 'der')\n      }\n      subtype = ndata.algorithm.algorithm.join('.')\n      switch (subtype) {\n        case '1.2.840.113549.1.1.1':\n          return asn1.RSAPublicKey.decode(ndata.subjectPublicKey.data, 'der')\n        case '1.2.840.10045.2.1':\n          ndata.subjectPrivateKey = ndata.subjectPublicKey\n          return {\n            type: 'ec',\n            data: ndata\n          }\n        case '1.2.840.10040.4.1':\n          ndata.algorithm.params.pub_key = asn1.DSAparam.decode(ndata.subjectPublicKey.data, 'der')\n          return {\n            type: 'dsa',\n            data: ndata.algorithm.params\n          }\n        default: throw new Error('unknown key id ' + subtype)\n      }\n      throw new Error('unknown key type ' + type)\n    case 'ENCRYPTED PRIVATE KEY':\n      data = asn1.EncryptedPrivateKey.decode(data, 'der')\n      data = decrypt(data, password)\n      // falls through\n    case 'PRIVATE KEY':\n      ndata = asn1.PrivateKey.decode(data, 'der')\n      subtype = ndata.algorithm.algorithm.join('.')\n      switch (subtype) {\n        case '1.2.840.113549.1.1.1':\n          return asn1.RSAPrivateKey.decode(ndata.subjectPrivateKey, 'der')\n        case '1.2.840.10045.2.1':\n          return {\n            curve: ndata.algorithm.curve,\n            privateKey: asn1.ECPrivateKey.decode(ndata.subjectPrivateKey, 'der').privateKey\n          }\n        case '1.2.840.10040.4.1':\n          ndata.algorithm.params.priv_key = asn1.DSAparam.decode(ndata.subjectPrivateKey, 'der')\n          return {\n            type: 'dsa',\n            params: ndata.algorithm.params\n          }\n        default: throw new Error('unknown key id ' + subtype)\n      }\n      throw new Error('unknown key type ' + type)\n    case 'RSA PUBLIC KEY':\n      return asn1.RSAPublicKey.decode(data, 'der')\n    case 'RSA PRIVATE KEY':\n      return asn1.RSAPrivateKey.decode(data, 'der')\n    case 'DSA PRIVATE KEY':\n      return {\n        type: 'dsa',\n        params: asn1.DSAPrivateKey.decode(data, 'der')\n      }\n    case 'EC PRIVATE KEY':\n      data = asn1.ECPrivateKey.decode(data, 'der')\n      return {\n        curve: data.parameters.value,\n        privateKey: data.privateKey\n      }\n    default: throw new Error('unknown key type ' + type)\n  }\n}\nparseKeys.signature = asn1.signature\nfunction decrypt (data, password) {\n  var salt = data.algorithm.decrypt.kde.kdeparams.salt\n  var iters = parseInt(data.algorithm.decrypt.kde.kdeparams.iters.toString(), 10)\n  var algo = aesid[data.algorithm.decrypt.cipher.algo.join('.')]\n  var iv = data.algorithm.decrypt.cipher.iv\n  var cipherText = data.subjectPrivateKey\n  var keylen = parseInt(algo.split('-')[1], 10) / 8\n  var key = compat.pbkdf2Sync(password, salt, iters, keylen)\n  var cipher = ciphers.createDecipheriv(algo, key, iv)\n  var out = []\n  out.push(cipher.update(cipherText))\n  out.push(cipher.final())\n  return Buffer.concat(out)\n}\n","// much of this based on https://github.com/indutny/self-signed/blob/gh-pages/lib/rsa.js\nvar createHmac = require('create-hmac')\nvar crt = require('browserify-rsa')\nvar EC = require('elliptic').ec\nvar BN = require('bn.js')\nvar parseKeys = require('parse-asn1')\nvar curves = require('./curves.json')\n\nfunction sign (hash, key, hashType, signType, tag) {\n  var priv = parseKeys(key)\n  if (priv.curve) {\n    // rsa keys can be interpreted as ecdsa ones in openssl\n    if (signType !== 'ecdsa' && signType !== 'ecdsa/rsa') throw new Error('wrong private key type')\n    return ecSign(hash, priv)\n  } else if (priv.type === 'dsa') {\n    if (signType !== 'dsa') throw new Error('wrong private key type')\n    return dsaSign(hash, priv, hashType)\n  } else {\n    if (signType !== 'rsa' && signType !== 'ecdsa/rsa') throw new Error('wrong private key type')\n  }\n  hash = Buffer.concat([tag, hash])\n  var len = priv.modulus.byteLength()\n  var pad = [ 0, 1 ]\n  while (hash.length + pad.length + 1 < len) pad.push(0xff)\n  pad.push(0x00)\n  var i = -1\n  while (++i < hash.length) pad.push(hash[i])\n\n  var out = crt(pad, priv)\n  return out\n}\n\nfunction ecSign (hash, priv) {\n  var curveId = curves[priv.curve.join('.')]\n  if (!curveId) throw new Error('unknown curve ' + priv.curve.join('.'))\n\n  var curve = new EC(curveId)\n  var key = curve.keyFromPrivate(priv.privateKey)\n  var out = key.sign(hash)\n\n  return new Buffer(out.toDER())\n}\n\nfunction dsaSign (hash, priv, algo) {\n  var x = priv.params.priv_key\n  var p = priv.params.p\n  var q = priv.params.q\n  var g = priv.params.g\n  var r = new BN(0)\n  var k\n  var H = bits2int(hash, q).mod(q)\n  var s = false\n  var kv = getKey(x, q, hash, algo)\n  while (s === false) {\n    k = makeKey(q, kv, algo)\n    r = makeR(g, k, p, q)\n    s = k.invm(q).imul(H.add(x.mul(r))).mod(q)\n    if (s.cmpn(0) === 0) {\n      s = false\n      r = new BN(0)\n    }\n  }\n  return toDER(r, s)\n}\n\nfunction toDER (r, s) {\n  r = r.toArray()\n  s = s.toArray()\n\n  // Pad values\n  if (r[0] & 0x80) r = [ 0 ].concat(r)\n  if (s[0] & 0x80) s = [ 0 ].concat(s)\n\n  var total = r.length + s.length + 4\n  var res = [ 0x30, total, 0x02, r.length ]\n  res = res.concat(r, [ 0x02, s.length ], s)\n  return new Buffer(res)\n}\n\nfunction getKey (x, q, hash, algo) {\n  x = new Buffer(x.toArray())\n  if (x.length < q.byteLength()) {\n    var zeros = new Buffer(q.byteLength() - x.length)\n    zeros.fill(0)\n    x = Buffer.concat([ zeros, x ])\n  }\n  var hlen = hash.length\n  var hbits = bits2octets(hash, q)\n  var v = new Buffer(hlen)\n  v.fill(1)\n  var k = new Buffer(hlen)\n  k.fill(0)\n  k = createHmac(algo, k).update(v).update(new Buffer([ 0 ])).update(x).update(hbits).digest()\n  v = createHmac(algo, k).update(v).digest()\n  k = createHmac(algo, k).update(v).update(new Buffer([ 1 ])).update(x).update(hbits).digest()\n  v = createHmac(algo, k).update(v).digest()\n  return { k: k, v: v }\n}\n\nfunction bits2int (obits, q) {\n  var bits = new BN(obits)\n  var shift = (obits.length << 3) - q.bitLength()\n  if (shift > 0) bits.ishrn(shift)\n  return bits\n}\n\nfunction bits2octets (bits, q) {\n  bits = bits2int(bits, q)\n  bits = bits.mod(q)\n  var out = new Buffer(bits.toArray())\n  if (out.length < q.byteLength()) {\n    var zeros = new Buffer(q.byteLength() - out.length)\n    zeros.fill(0)\n    out = Buffer.concat([ zeros, out ])\n  }\n  return out\n}\n\nfunction makeKey (q, kv, algo) {\n  var t\n  var k\n\n  do {\n    t = new Buffer(0)\n\n    while (t.length * 8 < q.bitLength()) {\n      kv.v = createHmac(algo, kv.k).update(kv.v).digest()\n      t = Buffer.concat([ t, kv.v ])\n    }\n\n    k = bits2int(t, q)\n    kv.k = createHmac(algo, kv.k).update(kv.v).update(new Buffer([ 0 ])).digest()\n    kv.v = createHmac(algo, kv.k).update(kv.v).digest()\n  } while (k.cmp(q) !== -1)\n\n  return k\n}\n\nfunction makeR (g, k, p, q) {\n  return g.toRed(BN.mont(p)).redPow(k).fromRed().mod(q)\n}\n\nmodule.exports = sign\nmodule.exports.getKey = getKey\nmodule.exports.makeKey = makeKey\n","// much of this based on https://github.com/indutny/self-signed/blob/gh-pages/lib/rsa.js\nvar BN = require('bn.js')\nvar EC = require('elliptic').ec\nvar parseKeys = require('parse-asn1')\nvar curves = require('./curves.json')\n\nfunction verify (sig, hash, key, signType, tag) {\n  var pub = parseKeys(key)\n  if (pub.type === 'ec') {\n    // rsa keys can be interpreted as ecdsa ones in openssl\n    if (signType !== 'ecdsa' && signType !== 'ecdsa/rsa') throw new Error('wrong public key type')\n    return ecVerify(sig, hash, pub)\n  } else if (pub.type === 'dsa') {\n    if (signType !== 'dsa') throw new Error('wrong public key type')\n    return dsaVerify(sig, hash, pub)\n  } else {\n    if (signType !== 'rsa' && signType !== 'ecdsa/rsa') throw new Error('wrong public key type')\n  }\n  hash = Buffer.concat([tag, hash])\n  var len = pub.modulus.byteLength()\n  var pad = [ 1 ]\n  var padNum = 0\n  while (hash.length + pad.length + 2 < len) {\n    pad.push(0xff)\n    padNum++\n  }\n  pad.push(0x00)\n  var i = -1\n  while (++i < hash.length) {\n    pad.push(hash[i])\n  }\n  pad = new Buffer(pad)\n  var red = BN.mont(pub.modulus)\n  sig = new BN(sig).toRed(red)\n\n  sig = sig.redPow(new BN(pub.publicExponent))\n  sig = new Buffer(sig.fromRed().toArray())\n  var out = padNum < 8 ? 1 : 0\n  len = Math.min(sig.length, pad.length)\n  if (sig.length !== pad.length) out = 1\n\n  i = -1\n  while (++i < len) out |= sig[i] ^ pad[i]\n  return out === 0\n}\n\nfunction ecVerify (sig, hash, pub) {\n  var curveId = curves[pub.data.algorithm.curve.join('.')]\n  if (!curveId) throw new Error('unknown curve ' + pub.data.algorithm.curve.join('.'))\n\n  var curve = new EC(curveId)\n  var pubkey = pub.data.subjectPrivateKey.data\n\n  return curve.verify(hash, sig, pubkey)\n}\n\nfunction dsaVerify (sig, hash, pub) {\n  var p = pub.data.p\n  var q = pub.data.q\n  var g = pub.data.g\n  var y = pub.data.pub_key\n  var unpacked = parseKeys.signature.decode(sig, 'der')\n  var s = unpacked.s\n  var r = unpacked.r\n  checkValue(s, q)\n  checkValue(r, q)\n  var montp = BN.mont(p)\n  var w = s.invm(q)\n  var v = g.toRed(montp)\n    .redPow(new BN(hash).mul(w).mod(q))\n    .fromRed()\n    .mul(y.toRed(montp).redPow(r.mul(w).mod(q)).fromRed())\n    .mod(p)\n    .mod(q)\n  return v.cmp(r) === 0\n}\n\nfunction checkValue (b, q) {\n  if (b.cmpn(0) <= 0) throw new Error('invalid sig')\n  if (b.cmp(q) >= q) throw new Error('invalid sig')\n}\n\nmodule.exports = verify\n","var createHash = require('create-hash')\nvar stream = require('stream')\nvar inherits = require('inherits')\nvar sign = require('./sign')\nvar verify = require('./verify')\n\nvar algorithms = require('./algorithms.json')\nObject.keys(algorithms).forEach(function (key) {\n  algorithms[key].id = new Buffer(algorithms[key].id, 'hex')\n  algorithms[key.toLowerCase()] = algorithms[key]\n})\n\nfunction Sign (algorithm) {\n  stream.Writable.call(this)\n\n  var data = algorithms[algorithm]\n  if (!data) throw new Error('Unknown message digest')\n\n  this._hashType = data.hash\n  this._hash = createHash(data.hash)\n  this._tag = data.id\n  this._signType = data.sign\n}\ninherits(Sign, stream.Writable)\n\nSign.prototype._write = function _write (data, _, done) {\n  this._hash.update(data)\n  done()\n}\n\nSign.prototype.update = function update (data, enc) {\n  if (typeof data === 'string') data = new Buffer(data, enc)\n\n  this._hash.update(data)\n  return this\n}\n\nSign.prototype.sign = function signMethod (key, enc) {\n  this.end()\n  var hash = this._hash.digest()\n  var sig = sign(hash, key, this._hashType, this._signType, this._tag)\n\n  return enc ? sig.toString(enc) : sig\n}\n\nfunction Verify (algorithm) {\n  stream.Writable.call(this)\n\n  var data = algorithms[algorithm]\n  if (!data) throw new Error('Unknown message digest')\n\n  this._hash = createHash(data.hash)\n  this._tag = data.id\n  this._signType = data.sign\n}\ninherits(Verify, stream.Writable)\n\nVerify.prototype._write = function _write (data, _, done) {\n  this._hash.update(data)\n  done()\n}\n\nVerify.prototype.update = function update (data, enc) {\n  if (typeof data === 'string') data = new Buffer(data, enc)\n\n  this._hash.update(data)\n  return this\n}\n\nVerify.prototype.verify = function verifyMethod (key, sig, enc) {\n  if (typeof sig === 'string') sig = new Buffer(sig, enc)\n\n  this.end()\n  var hash = this._hash.digest()\n  return verify(sig, hash, key, this._signType, this._tag)\n}\n\nfunction createSign (algorithm) {\n  return new Sign(algorithm)\n}\n\nfunction createVerify (algorithm) {\n  return new Verify(algorithm)\n}\n\nmodule.exports = {\n  Sign: createSign,\n  Verify: createVerify,\n  createSign: createSign,\n  createVerify: createVerify\n}\n","var elliptic = require('elliptic')\nvar BN = require('bn.js')\n\nmodule.exports = function createECDH (curve) {\n  return new ECDH(curve)\n}\n\nvar aliases = {\n  secp256k1: {\n    name: 'secp256k1',\n    byteLength: 32\n  },\n  secp224r1: {\n    name: 'p224',\n    byteLength: 28\n  },\n  prime256v1: {\n    name: 'p256',\n    byteLength: 32\n  },\n  prime192v1: {\n    name: 'p192',\n    byteLength: 24\n  },\n  ed25519: {\n    name: 'ed25519',\n    byteLength: 32\n  },\n  secp384r1: {\n    name: 'p384',\n    byteLength: 48\n  },\n  secp521r1: {\n    name: 'p521',\n    byteLength: 66\n  }\n}\n\naliases.p224 = aliases.secp224r1\naliases.p256 = aliases.secp256r1 = aliases.prime256v1\naliases.p192 = aliases.secp192r1 = aliases.prime192v1\naliases.p384 = aliases.secp384r1\naliases.p521 = aliases.secp521r1\n\nfunction ECDH (curve) {\n  this.curveType = aliases[curve]\n  if (!this.curveType) {\n    this.curveType = {\n      name: curve\n    }\n  }\n  this.curve = new elliptic.ec(this.curveType.name) // eslint-disable-line new-cap\n  this.keys = void 0\n}\n\nECDH.prototype.generateKeys = function (enc, format) {\n  this.keys = this.curve.genKeyPair()\n  return this.getPublicKey(enc, format)\n}\n\nECDH.prototype.computeSecret = function (other, inenc, enc) {\n  inenc = inenc || 'utf8'\n  if (!Buffer.isBuffer(other)) {\n    other = new Buffer(other, inenc)\n  }\n  var otherPub = this.curve.keyFromPublic(other).getPublic()\n  var out = otherPub.mul(this.keys.getPrivate()).getX()\n  return formatReturnValue(out, enc, this.curveType.byteLength)\n}\n\nECDH.prototype.getPublicKey = function (enc, format) {\n  var key = this.keys.getPublic(format === 'compressed', true)\n  if (format === 'hybrid') {\n    if (key[key.length - 1] % 2) {\n      key[0] = 7\n    } else {\n      key[0] = 6\n    }\n  }\n  return formatReturnValue(key, enc)\n}\n\nECDH.prototype.getPrivateKey = function (enc) {\n  return formatReturnValue(this.keys.getPrivate(), enc)\n}\n\nECDH.prototype.setPublicKey = function (pub, enc) {\n  enc = enc || 'utf8'\n  if (!Buffer.isBuffer(pub)) {\n    pub = new Buffer(pub, enc)\n  }\n  this.keys._importPublic(pub)\n  return this\n}\n\nECDH.prototype.setPrivateKey = function (priv, enc) {\n  enc = enc || 'utf8'\n  if (!Buffer.isBuffer(priv)) {\n    priv = new Buffer(priv, enc)\n  }\n\n  var _priv = new BN(priv)\n  _priv = _priv.toString(16)\n  this.keys = this.curve.genKeyPair()\n  this.keys._importPrivate(_priv)\n  return this\n}\n\nfunction formatReturnValue (bn, enc, len) {\n  if (!Array.isArray(bn)) {\n    bn = bn.toArray()\n  }\n  var buf = new Buffer(bn)\n  if (len && buf.length < len) {\n    var zeros = new Buffer(len - buf.length)\n    zeros.fill(0)\n    buf = Buffer.concat([zeros, buf])\n  }\n  if (!enc) {\n    return buf\n  } else {\n    return buf.toString(enc)\n  }\n}\n","var createHash = require('create-hash');\nmodule.exports = function (seed, len) {\n  var t = new Buffer('');\n  var  i = 0, c;\n  while (t.length < len) {\n    c = i2ops(i++);\n    t = Buffer.concat([t, createHash('sha1').update(seed).update(c).digest()]);\n  }\n  return t.slice(0, len);\n};\n\nfunction i2ops(c) {\n  var out = new Buffer(4);\n  out.writeUInt32BE(c,0);\n  return out;\n}","module.exports = function xor(a, b) {\n  var len = a.length;\n  var i = -1;\n  while (++i < len) {\n    a[i] ^= b[i];\n  }\n  return a\n};","var bn = require('bn.js');\nfunction withPublic(paddedMsg, key) {\n  return new Buffer(paddedMsg\n    .toRed(bn.mont(key.modulus))\n    .redPow(new bn(key.publicExponent))\n    .fromRed()\n    .toArray());\n}\n\nmodule.exports = withPublic;","var parseKeys = require('parse-asn1');\nvar randomBytes = require('randombytes');\nvar createHash = require('create-hash');\nvar mgf = require('./mgf');\nvar xor = require('./xor');\nvar bn = require('bn.js');\nvar withPublic = require('./withPublic');\nvar crt = require('browserify-rsa');\n\nvar constants = {\n  RSA_PKCS1_OAEP_PADDING: 4,\n  RSA_PKCS1_PADDIN: 1,\n  RSA_NO_PADDING: 3\n};\n\nmodule.exports = function publicEncrypt(public_key, msg, reverse) {\n  var padding;\n  if (public_key.padding) {\n    padding = public_key.padding;\n  } else if (reverse) {\n    padding = 1;\n  } else {\n    padding = 4;\n  }\n  var key = parseKeys(public_key);\n  var paddedMsg;\n  if (padding === 4) {\n    paddedMsg = oaep(key, msg);\n  } else if (padding === 1) {\n    paddedMsg = pkcs1(key, msg, reverse);\n  } else if (padding === 3) {\n    paddedMsg = new bn(msg);\n    if (paddedMsg.cmp(key.modulus) >= 0) {\n      throw new Error('data too long for modulus');\n    }\n  } else {\n    throw new Error('unknown padding');\n  }\n  if (reverse) {\n    return crt(paddedMsg, key);\n  } else {\n    return withPublic(paddedMsg, key);\n  }\n};\n\nfunction oaep(key, msg){\n  var k = key.modulus.byteLength();\n  var mLen = msg.length;\n  var iHash = createHash('sha1').update(new Buffer('')).digest();\n  var hLen = iHash.length;\n  var hLen2 = 2 * hLen;\n  if (mLen > k - hLen2 - 2) {\n    throw new Error('message too long');\n  }\n  var ps = new Buffer(k - mLen - hLen2 - 2);\n  ps.fill(0);\n  var dblen = k - hLen - 1;\n  var seed = randomBytes(hLen);\n  var maskedDb = xor(Buffer.concat([iHash, ps, new Buffer([1]), msg], dblen), mgf(seed, dblen));\n  var maskedSeed = xor(seed, mgf(maskedDb, hLen));\n  return new bn(Buffer.concat([new Buffer([0]), maskedSeed, maskedDb], k));\n}\nfunction pkcs1(key, msg, reverse){\n  var mLen = msg.length;\n  var k = key.modulus.byteLength();\n  if (mLen > k - 11) {\n    throw new Error('message too long');\n  }\n  var ps;\n  if (reverse) {\n    ps = new Buffer(k - mLen - 3);\n    ps.fill(0xff);\n  } else {\n    ps = nonZero(k - mLen - 3);\n  }\n  return new bn(Buffer.concat([new Buffer([0, reverse?1:2]), ps, new Buffer([0]), msg], k));\n}\nfunction nonZero(len, crypto) {\n  var out = new Buffer(len);\n  var i = 0;\n  var cache = randomBytes(len*2);\n  var cur = 0;\n  var num;\n  while (i < len) {\n    if (cur === cache.length) {\n      cache = randomBytes(len*2);\n      cur = 0;\n    }\n    num = cache[cur++];\n    if (num) {\n      out[i++] = num;\n    }\n  }\n  return out;\n}","var parseKeys = require('parse-asn1');\nvar mgf = require('./mgf');\nvar xor = require('./xor');\nvar bn = require('bn.js');\nvar crt = require('browserify-rsa');\nvar createHash = require('create-hash');\nvar withPublic = require('./withPublic');\nmodule.exports = function privateDecrypt(private_key, enc, reverse) {\n  var padding;\n  if (private_key.padding) {\n    padding = private_key.padding;\n  } else if (reverse) {\n    padding = 1;\n  } else {\n    padding = 4;\n  }\n  \n  var key = parseKeys(private_key);\n  var k = key.modulus.byteLength();\n  if (enc.length > k || new bn(enc).cmp(key.modulus) >= 0) {\n    throw new Error('decryption error');\n  }\n  var msg;\n  if (reverse) {\n    msg = withPublic(new bn(enc), key);\n  } else {\n    msg = crt(enc, key);\n  }\n  var zBuffer = new Buffer(k - msg.length);\n  zBuffer.fill(0);\n  msg = Buffer.concat([zBuffer, msg], k);\n  if (padding === 4) {\n    return oaep(key, msg);\n  } else if (padding === 1) {\n    return pkcs1(key, msg, reverse);\n  } else if (padding === 3) {\n    return msg;\n  } else {\n    throw new Error('unknown padding');\n  }\n};\n\nfunction oaep(key, msg){\n  var n = key.modulus;\n  var k = key.modulus.byteLength();\n  var mLen = msg.length;\n  var iHash = createHash('sha1').update(new Buffer('')).digest();\n  var hLen = iHash.length;\n  var hLen2 = 2 * hLen;\n  if (msg[0] !== 0) {\n    throw new Error('decryption error');\n  }\n  var maskedSeed = msg.slice(1, hLen + 1);\n  var maskedDb =  msg.slice(hLen + 1);\n  var seed = xor(maskedSeed, mgf(maskedDb, hLen));\n  var db = xor(maskedDb, mgf(seed, k - hLen - 1));\n  if (compare(iHash, db.slice(0, hLen))) {\n    throw new Error('decryption error');\n  }\n  var i = hLen;\n  while (db[i] === 0) {\n    i++;\n  }\n  if (db[i++] !== 1) {\n    throw new Error('decryption error');\n  }\n  return db.slice(i);\n}\n\nfunction pkcs1(key, msg, reverse){\n  var p1 = msg.slice(0, 2);\n  var i = 2;\n  var status = 0;\n  while (msg[i++] !== 0) {\n    if (i >= msg.length) {\n      status++;\n      break;\n    }\n  }\n  var ps = msg.slice(2, i - 1);\n  var p2 = msg.slice(i - 1, i);\n\n  if ((p1.toString('hex') !== '0002' && !reverse) || (p1.toString('hex') !== '0001' && reverse)){\n    status++;\n  }\n  if (ps.length < 8) {\n    status++;\n  }\n  if (status) {\n    throw new Error('decryption error');\n  }\n  return  msg.slice(i);\n}\nfunction compare(a, b){\n  a = new Buffer(a);\n  b = new Buffer(b);\n  var dif = 0;\n  var len = a.length;\n  if (a.length !== b.length) {\n    dif++;\n    len = Math.min(a.length, b.length);\n  }\n  var i = -1;\n  while (++i < len) {\n    dif += (a[i] ^ b[i]);\n  }\n  return dif;\n}","exports.publicEncrypt = require('./publicEncrypt');\nexports.privateDecrypt = require('./privateDecrypt');\n\nexports.privateEncrypt = function privateEncrypt(key, buf) {\n  return exports.publicEncrypt(key, buf, true);\n};\n\nexports.publicDecrypt = function publicDecrypt(key, buf) {\n  return exports.privateDecrypt(key, buf, true);\n};","'use strict'\n\nfunction oldBrowser () {\n  throw new Error('secure random number generation not supported by this browser\\nuse chrome, FireFox or Internet Explorer 11')\n}\nvar safeBuffer = require('safe-buffer')\nvar randombytes = require('randombytes')\nvar Buffer = safeBuffer.Buffer\nvar kBufferMaxLength = safeBuffer.kMaxLength\nvar crypto = global.crypto || global.msCrypto\nvar kMaxUint32 = Math.pow(2, 32) - 1\nfunction assertOffset (offset, length) {\n  if (typeof offset !== 'number' || offset !== offset) { // eslint-disable-line no-self-compare\n    throw new TypeError('offset must be a number')\n  }\n\n  if (offset > kMaxUint32 || offset < 0) {\n    throw new TypeError('offset must be a uint32')\n  }\n\n  if (offset > kBufferMaxLength || offset > length) {\n    throw new RangeError('offset out of range')\n  }\n}\n\nfunction assertSize (size, offset, length) {\n  if (typeof size !== 'number' || size !== size) { // eslint-disable-line no-self-compare\n    throw new TypeError('size must be a number')\n  }\n\n  if (size > kMaxUint32 || size < 0) {\n    throw new TypeError('size must be a uint32')\n  }\n\n  if (size + offset > length || size > kBufferMaxLength) {\n    throw new RangeError('buffer too small')\n  }\n}\nif ((crypto && crypto.getRandomValues) || !process.browser) {\n  exports.randomFill = randomFill\n  exports.randomFillSync = randomFillSync\n} else {\n  exports.randomFill = oldBrowser\n  exports.randomFillSync = oldBrowser\n}\nfunction randomFill (buf, offset, size, cb) {\n  if (!Buffer.isBuffer(buf) && !(buf instanceof global.Uint8Array)) {\n    throw new TypeError('\"buf\" argument must be a Buffer or Uint8Array')\n  }\n\n  if (typeof offset === 'function') {\n    cb = offset\n    offset = 0\n    size = buf.length\n  } else if (typeof size === 'function') {\n    cb = size\n    size = buf.length - offset\n  } else if (typeof cb !== 'function') {\n    throw new TypeError('\"cb\" argument must be a function')\n  }\n  assertOffset(offset, buf.length)\n  assertSize(size, offset, buf.length)\n  return actualFill(buf, offset, size, cb)\n}\n\nfunction actualFill (buf, offset, size, cb) {\n  if (process.browser) {\n    var ourBuf = buf.buffer\n    var uint = new Uint8Array(ourBuf, offset, size)\n    crypto.getRandomValues(uint)\n    if (cb) {\n      process.nextTick(function () {\n        cb(null, buf)\n      })\n      return\n    }\n    return buf\n  }\n  if (cb) {\n    randombytes(size, function (err, bytes) {\n      if (err) {\n        return cb(err)\n      }\n      bytes.copy(buf, offset)\n      cb(null, buf)\n    })\n    return\n  }\n  var bytes = randombytes(size)\n  bytes.copy(buf, offset)\n  return buf\n}\nfunction randomFillSync (buf, offset, size) {\n  if (typeof offset === 'undefined') {\n    offset = 0\n  }\n  if (!Buffer.isBuffer(buf) && !(buf instanceof global.Uint8Array)) {\n    throw new TypeError('\"buf\" argument must be a Buffer or Uint8Array')\n  }\n\n  assertOffset(offset, buf.length)\n\n  if (size === undefined) size = buf.length - offset\n\n  assertSize(size, offset, buf.length)\n\n  return actualFill(buf, offset, size)\n}\n","'use strict'\n\nexports.randomBytes = exports.rng = exports.pseudoRandomBytes = exports.prng = require('randombytes')\nexports.createHash = exports.Hash = require('create-hash')\nexports.createHmac = exports.Hmac = require('create-hmac')\n\nvar algos = require('browserify-sign/algos')\nvar algoKeys = Object.keys(algos)\nvar hashes = ['sha1', 'sha224', 'sha256', 'sha384', 'sha512', 'md5', 'rmd160'].concat(algoKeys)\nexports.getHashes = function () {\n  return hashes\n}\n\nvar p = require('pbkdf2')\nexports.pbkdf2 = p.pbkdf2\nexports.pbkdf2Sync = p.pbkdf2Sync\n\nvar aes = require('browserify-cipher')\n\nexports.Cipher = aes.Cipher\nexports.createCipher = aes.createCipher\nexports.Cipheriv = aes.Cipheriv\nexports.createCipheriv = aes.createCipheriv\nexports.Decipher = aes.Decipher\nexports.createDecipher = aes.createDecipher\nexports.Decipheriv = aes.Decipheriv\nexports.createDecipheriv = aes.createDecipheriv\nexports.getCiphers = aes.getCiphers\nexports.listCiphers = aes.listCiphers\n\nvar dh = require('diffie-hellman')\n\nexports.DiffieHellmanGroup = dh.DiffieHellmanGroup\nexports.createDiffieHellmanGroup = dh.createDiffieHellmanGroup\nexports.getDiffieHellman = dh.getDiffieHellman\nexports.createDiffieHellman = dh.createDiffieHellman\nexports.DiffieHellman = dh.DiffieHellman\n\nvar sign = require('browserify-sign')\n\nexports.createSign = sign.createSign\nexports.Sign = sign.Sign\nexports.createVerify = sign.createVerify\nexports.Verify = sign.Verify\n\nexports.createECDH = require('create-ecdh')\n\nvar publicEncrypt = require('public-encrypt')\n\nexports.publicEncrypt = publicEncrypt.publicEncrypt\nexports.privateEncrypt = publicEncrypt.privateEncrypt\nexports.publicDecrypt = publicEncrypt.publicDecrypt\nexports.privateDecrypt = publicEncrypt.privateDecrypt\n\n// the least I can do is make error messages for the rest of the node.js/crypto api.\n// ;[\n//   'createCredentials'\n// ].forEach(function (name) {\n//   exports[name] = function () {\n//     throw new Error([\n//       'sorry, ' + name + ' is not implemented yet',\n//       'we accept pull requests',\n//       'https://github.com/crypto-browserify/crypto-browserify'\n//     ].join('\\n'))\n//   }\n// })\n\nvar rf = require('randomfill')\n\nexports.randomFill = rf.randomFill\nexports.randomFillSync = rf.randomFillSync\n\nexports.createCredentials = function () {\n  throw new Error([\n    'sorry, createCredentials is not implemented yet',\n    'we accept pull requests',\n    'https://github.com/crypto-browserify/crypto-browserify'\n  ].join('\\n'))\n}\n\nexports.constants = {\n  'DH_CHECK_P_NOT_SAFE_PRIME': 2,\n  'DH_CHECK_P_NOT_PRIME': 1,\n  'DH_UNABLE_TO_CHECK_GENERATOR': 4,\n  'DH_NOT_SUITABLE_GENERATOR': 8,\n  'NPN_ENABLED': 1,\n  'ALPN_ENABLED': 1,\n  'RSA_PKCS1_PADDING': 1,\n  'RSA_SSLV23_PADDING': 2,\n  'RSA_NO_PADDING': 3,\n  'RSA_PKCS1_OAEP_PADDING': 4,\n  'RSA_X931_PADDING': 5,\n  'RSA_PKCS1_PSS_PADDING': 6,\n  'POINT_CONVERSION_COMPRESSED': 2,\n  'POINT_CONVERSION_UNCOMPRESSED': 4,\n  'POINT_CONVERSION_HYBRID': 6\n}\n","// Unique ID creation requires a high quality random # generator.  In node.js\n// this is pretty straight-forward - we use the crypto API.\n\nvar crypto = require('crypto');\n\nmodule.exports = function nodeRNG() {\n  return crypto.randomBytes(16);\n};\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  return bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] + '-' +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]] +\n          bth[buf[i++]] + bth[buf[i++]];\n}\n\nmodule.exports = bytesToUuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","'use strict';\n\n/**\n * Stringify/parse functions that don't operate\n * recursively, so they avoid call stack exceeded\n * errors.\n */\nexports.stringify = function stringify(input) {\n  var queue = [];\n  queue.push({obj: input});\n\n  var res = '';\n  var next, obj, prefix, val, i, arrayPrefix, keys, k, key, value, objPrefix;\n  while ((next = queue.pop())) {\n    obj = next.obj;\n    prefix = next.prefix || '';\n    val = next.val || '';\n    res += prefix;\n    if (val) {\n      res += val;\n    } else if (typeof obj !== 'object') {\n      res += typeof obj === 'undefined' ? null : JSON.stringify(obj);\n    } else if (obj === null) {\n      res += 'null';\n    } else if (Array.isArray(obj)) {\n      queue.push({val: ']'});\n      for (i = obj.length - 1; i >= 0; i--) {\n        arrayPrefix = i === 0 ? '' : ',';\n        queue.push({obj: obj[i], prefix: arrayPrefix});\n      }\n      queue.push({val: '['});\n    } else { // object\n      keys = [];\n      for (k in obj) {\n        if (obj.hasOwnProperty(k)) {\n          keys.push(k);\n        }\n      }\n      queue.push({val: '}'});\n      for (i = keys.length - 1; i >= 0; i--) {\n        key = keys[i];\n        value = obj[key];\n        objPrefix = (i > 0 ? ',' : '');\n        objPrefix += JSON.stringify(key) + ':';\n        queue.push({obj: value, prefix: objPrefix});\n      }\n      queue.push({val: '{'});\n    }\n  }\n  return res;\n};\n\n// Convenience function for the parse function.\n// This pop function is basically copied from\n// pouchCollate.parseIndexableString\nfunction pop(obj, stack, metaStack) {\n  var lastMetaElement = metaStack[metaStack.length - 1];\n  if (obj === lastMetaElement.element) {\n    // popping a meta-element, e.g. an object whose value is another object\n    metaStack.pop();\n    lastMetaElement = metaStack[metaStack.length - 1];\n  }\n  var element = lastMetaElement.element;\n  var lastElementIndex = lastMetaElement.index;\n  if (Array.isArray(element)) {\n    element.push(obj);\n  } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n    var key = stack.pop();\n    element[key] = obj;\n  } else {\n    stack.push(obj); // obj with key only\n  }\n}\n\nexports.parse = function (str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n  var collationIndex,parsedNum,numChar;\n  var parsedString,lastCh,numConsecutiveSlashes,ch;\n  var arrayElement, objElement;\n  while (true) {\n    collationIndex = str[i++];\n    if (collationIndex === '}' ||\n        collationIndex === ']' ||\n        typeof collationIndex === 'undefined') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack.pop(), stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case ' ':\n      case '\\t':\n      case '\\n':\n      case ':':\n      case ',':\n        break;\n      case 'n':\n        i += 3; // 'ull'\n        pop(null, stack, metaStack);\n        break;\n      case 't':\n        i += 3; // 'rue'\n        pop(true, stack, metaStack);\n        break;\n      case 'f':\n        i += 4; // 'alse'\n        pop(false, stack, metaStack);\n        break;\n      case '0':\n      case '1':\n      case '2':\n      case '3':\n      case '4':\n      case '5':\n      case '6':\n      case '7':\n      case '8':\n      case '9':\n      case '-':\n        parsedNum = '';\n        i--;\n        while (true) {\n          numChar = str[i++];\n          if (/[\\d\\.\\-e\\+]/.test(numChar)) {\n            parsedNum += numChar;\n          } else {\n            i--;\n            break;\n          }\n        }\n        pop(parseFloat(parsedNum), stack, metaStack);\n        break;\n      case '\"':\n        parsedString = '';\n        lastCh = void 0;\n        numConsecutiveSlashes = 0;\n        while (true) {\n          ch = str[i++];\n          if (ch !== '\"' || (lastCh === '\\\\' &&\n              numConsecutiveSlashes % 2 === 1)) {\n            parsedString += ch;\n            lastCh = ch;\n            if (lastCh === '\\\\') {\n              numConsecutiveSlashes++;\n            } else {\n              numConsecutiveSlashes = 0;\n            }\n          } else {\n            break;\n          }\n        }\n        pop(JSON.parse('\"' + parsedString + '\"'), stack, metaStack);\n        break;\n      case '[':\n        arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '{':\n        objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      default:\n        throw new Error(\n          'unexpectedly reached end of input: ' + collationIndex);\n    }\n  }\n};\n","import getArguments from 'argsarray';\nimport nextTick from 'immediate';\nimport { EventEmitter } from 'events';\nimport inherits from 'inherits';\nimport Md5 from 'spark-md5';\nimport uuidV4 from 'uuid';\nimport vuvuzela from 'vuvuzela';\n\nfunction isBinaryObject(object) {\n  return (typeof ArrayBuffer !== 'undefined' && object instanceof ArrayBuffer) ||\n    (typeof Blob !== 'undefined' && object instanceof Blob);\n}\n\nfunction cloneArrayBuffer(buff) {\n  if (typeof buff.slice === 'function') {\n    return buff.slice(0);\n  }\n  // IE10-11 slice() polyfill\n  var target = new ArrayBuffer(buff.byteLength);\n  var targetArray = new Uint8Array(target);\n  var sourceArray = new Uint8Array(buff);\n  targetArray.set(sourceArray);\n  return target;\n}\n\nfunction cloneBinaryObject(object) {\n  if (object instanceof ArrayBuffer) {\n    return cloneArrayBuffer(object);\n  }\n  var size = object.size;\n  var type = object.type;\n  // Blob\n  if (typeof object.slice === 'function') {\n    return object.slice(0, size, type);\n  }\n  // PhantomJS slice() replacement\n  return object.webkitSlice(0, size, type);\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBinaryObject(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\nfunction mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new ExportedMap();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\nvar hasLocal;\n\ntry {\n  localStorage.setItem('_pouch_check_localstorage', 1);\n  hasLocal = !!localStorage.getItem('_pouch_check_localstorage');\n} catch (e) {\n  hasLocal = false;\n}\n\nfunction hasLocalStorage() {\n  return hasLocal;\n}\n\n// Custom nextTick() shim for browsers. In node, this will just be process.nextTick(). We\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        nextTick(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// designed to give info to browser users, who are disturbed\n// when they see http errors in the console\nfunction explainError(status, str) {\n  guardedConsole('info', 'The above ' + status + ' is totally normal. ' + str);\n}\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar $inject_Object_assign = assign;\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nvar thisAtob = function (str) {\n  return atob(str);\n};\n\nvar thisBtoa = function (str) {\n  return btoa(str);\n};\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor (e.g.\n// old QtWebKit versions, Android < 4.4).\nfunction createBlob(parts, properties) {\n  /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n  parts = parts || [];\n  properties = properties || {};\n  try {\n    return new Blob(parts, properties);\n  } catch (e) {\n    if (e.name !== \"TypeError\") {\n      throw e;\n    }\n    var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\n                  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\n                  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder :\n                  WebKitBlobBuilder;\n    var builder = new Builder();\n    for (var i = 0; i < parts.length; i += 1) {\n      builder.append(parts[i]);\n    }\n    return builder.getBlob(properties.type);\n  }\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return createBlob([binaryStringToArrayBuffer(binString)], {type: type});\n}\n\nfunction b64ToBluffer(b64, type) {\n  return binStringToBluffer(thisAtob(b64), type);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nfunction blobToBinaryString(blobOrBuffer, callback) {\n  readAsBinaryString(blobOrBuffer, function (bin) {\n    callback(bin);\n  });\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  blobToBinaryString(blobOrBuffer, function (base64) {\n    callback(thisBtoa(base64));\n  });\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n// this is not used in the browser\n\nvar setImmediateShim = global.setImmediate || global.setTimeout;\nvar MD5_CHUNK_SIZE = 32768;\n\nfunction rawToBase64(raw) {\n  return thisBtoa(raw);\n}\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  }\n  return blob.slice(start, end);\n}\n\nfunction appendBlob(buffer, blob, start, end, callback) {\n  if (start > 0 || end < blob.size) {\n    // only slice blob if we really need to\n    blob = sliceBlob(blob, start, end);\n  }\n  readAsArrayBuffer(blob, function (arrayBuffer) {\n    buffer.append(arrayBuffer);\n    callback();\n  });\n}\n\nfunction appendString(buffer, string, start, end, callback) {\n  if (start > 0 || end < string.length) {\n    // only create a substring if we really need to\n    string = string.substring(start, end);\n  }\n  buffer.appendBinary(string);\n  callback();\n}\n\nfunction binaryMd5(data, callback) {\n  var inputIsString = typeof data === 'string';\n  var len = inputIsString ? data.length : data.size;\n  var chunkSize = Math.min(MD5_CHUNK_SIZE, len);\n  var chunks = Math.ceil(len / chunkSize);\n  var currentChunk = 0;\n  var buffer = inputIsString ? new Md5() : new Md5.ArrayBuffer();\n\n  var append = inputIsString ? appendString : appendBlob;\n\n  function next() {\n    setImmediateShim(loadNextChunk);\n  }\n\n  function done() {\n    var raw = buffer.end(true);\n    var base64 = rawToBase64(raw);\n    callback(base64);\n    buffer.destroy();\n  }\n\n  function loadNextChunk() {\n    var start = currentChunk * chunkSize;\n    var end = start + chunkSize;\n    currentChunk++;\n    if (currentChunk < chunks) {\n      append(buffer, data, start, end, next);\n    } else {\n      append(buffer, data, start, end, done);\n    }\n  }\n  loadNextChunk();\n}\n\nfunction stringMd5(string) {\n  return Md5.hash(string);\n}\n\nfunction rev$$1(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\n// We fetch all leafs of the revision tree, and sort them based on tree length\n// and whether they were deleted, undeleted documents with the longest revision\n// tree (most edits) win\n// The final sort algorithm is slightly documented in a sidebar here:\n// http://guide.couchdb.org/draft/conflicts.html\nfunction winningRev(metadata) {\n  var winningId;\n  var winningPos;\n  var winningDeleted;\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var tree = node.ids;\n    var branches = tree[2];\n    var pos = node.pos;\n    if (branches.length) { // non-leaf\n      for (var i = 0, len = branches.length; i < len; i++) {\n        toVisit.push({pos: pos + 1, ids: branches[i]});\n      }\n      continue;\n    }\n    var deleted = !!tree[1].deleted;\n    var id = tree[0];\n    // sort by deleted, then pos, then id\n    if (!winningId || (winningDeleted !== deleted ? winningDeleted :\n        winningPos !== pos ? winningPos < pos : winningId < id)) {\n      winningId = id;\n      winningPos = pos;\n      winningDeleted = deleted;\n    }\n  }\n\n  return winningPos + '-' + winningId;\n}\n\n// Pretty much all below can be combined into a higher order function to\n// traverse revisions\n// The return value from the callback will be passed as context to all\n// children of that node\nfunction traverseRevTree(revs, callback) {\n  var toVisit = revs.slice();\n\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var branches = tree[2];\n    var newCtx =\n      callback(branches.length === 0, pos, tree[0], node.ctx, tree[1]);\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], ctx: newCtx});\n    }\n  }\n}\n\nfunction sortByPos(a, b) {\n  return a.pos - b.pos;\n}\n\nfunction collectLeaves(revs) {\n  var leaves = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, acc, opts) {\n    if (isLeaf) {\n      leaves.push({rev: pos + \"-\" + id, pos: pos, opts: opts});\n    }\n  });\n  leaves.sort(sortByPos).reverse();\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    delete leaves[i].pos;\n  }\n  return leaves;\n}\n\n// returns revs of all conflicts that is leaves such that\n// 1. are not deleted and\n// 2. are different than winning revision\nfunction collectConflicts(metadata) {\n  var win = winningRev(metadata);\n  var leaves = collectLeaves(metadata.rev_tree);\n  var conflicts = [];\n  for (var i = 0, len = leaves.length; i < len; i++) {\n    var leaf = leaves[i];\n    if (leaf.rev !== win && !leaf.opts.deleted) {\n      conflicts.push(leaf.rev);\n    }\n  }\n  return conflicts;\n}\n\n// compact a tree by marking its non-leafs as missing,\n// and return a list of revs to delete\nfunction compactTree(metadata) {\n  var revs = [];\n  traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                               revHash, ctx, opts) {\n    if (opts.status === 'available' && !isLeaf) {\n      revs.push(pos + '-' + revHash);\n      opts.status = 'missing';\n    }\n  });\n  return revs;\n}\n\n// build up a list of all the paths to the leafs in this revision tree\nfunction rootToLeaf(revs) {\n  var paths = [];\n  var toVisit = revs.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, opts: opts});\n    if (isLeaf) {\n      paths.push({pos: (pos + 1 - history.length), ids: history});\n    }\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: pos + 1, ids: branches[i], history: history});\n    }\n  }\n  return paths.reverse();\n}\n\n// for a better overview of what this is doing, read:\n\nfunction sortByPos$1(a, b) {\n  return a.pos - b.pos;\n}\n\n// classic binary search\nfunction binarySearch(arr, item, comparator) {\n  var low = 0;\n  var high = arr.length;\n  var mid;\n  while (low < high) {\n    mid = (low + high) >>> 1;\n    if (comparator(arr[mid], item) < 0) {\n      low = mid + 1;\n    } else {\n      high = mid;\n    }\n  }\n  return low;\n}\n\n// assuming the arr is sorted, insert the item in the proper place\nfunction insertSorted(arr, item, comparator) {\n  var idx = binarySearch(arr, item, comparator);\n  arr.splice(idx, 0, item);\n}\n\n// Turn a path as a flat array into a tree with a single branch.\n// If any should be stemmed from the beginning of the array, that's passed\n// in as the second argument\nfunction pathToTree(path, numStemmed) {\n  var root;\n  var leaf;\n  for (var i = numStemmed, len = path.length; i < len; i++) {\n    var node = path[i];\n    var currentLeaf = [node.id, node.opts, []];\n    if (leaf) {\n      leaf[2].push(currentLeaf);\n      leaf = currentLeaf;\n    } else {\n      root = leaf = currentLeaf;\n    }\n  }\n  return root;\n}\n\n// compare the IDs of two trees\nfunction compareTree(a, b) {\n  return a[0] < b[0] ? -1 : 1;\n}\n\n// Merge two trees together\n// The roots of tree1 and tree2 must be the same revision\nfunction mergeTree(in_tree1, in_tree2) {\n  var queue = [{tree1: in_tree1, tree2: in_tree2}];\n  var conflicts = false;\n  while (queue.length > 0) {\n    var item = queue.pop();\n    var tree1 = item.tree1;\n    var tree2 = item.tree2;\n\n    if (tree1[1].status || tree2[1].status) {\n      tree1[1].status =\n        (tree1[1].status ===  'available' ||\n        tree2[1].status === 'available') ? 'available' : 'missing';\n    }\n\n    for (var i = 0; i < tree2[2].length; i++) {\n      if (!tree1[2][0]) {\n        conflicts = 'new_leaf';\n        tree1[2][0] = tree2[2][i];\n        continue;\n      }\n\n      var merged = false;\n      for (var j = 0; j < tree1[2].length; j++) {\n        if (tree1[2][j][0] === tree2[2][i][0]) {\n          queue.push({tree1: tree1[2][j], tree2: tree2[2][i]});\n          merged = true;\n        }\n      }\n      if (!merged) {\n        conflicts = 'new_branch';\n        insertSorted(tree1[2], tree2[2][i], compareTree);\n      }\n    }\n  }\n  return {conflicts: conflicts, tree: in_tree1};\n}\n\nfunction doMerge(tree, path, dontExpand) {\n  var restree = [];\n  var conflicts = false;\n  var merged = false;\n  var res;\n\n  if (!tree.length) {\n    return {tree: [path], conflicts: 'new_leaf'};\n  }\n\n  for (var i = 0, len = tree.length; i < len; i++) {\n    var branch = tree[i];\n    if (branch.pos === path.pos && branch.ids[0] === path.ids[0]) {\n      // Paths start at the same position and have the same root, so they need\n      // merged\n      res = mergeTree(branch.ids, path.ids);\n      restree.push({pos: branch.pos, ids: res.tree});\n      conflicts = conflicts || res.conflicts;\n      merged = true;\n    } else if (dontExpand !== true) {\n      // The paths start at a different position, take the earliest path and\n      // traverse up until it as at the same point from root as the path we\n      // want to merge.  If the keys match we return the longer path with the\n      // other merged After stemming we dont want to expand the trees\n\n      var t1 = branch.pos < path.pos ? branch : path;\n      var t2 = branch.pos < path.pos ? path : branch;\n      var diff = t2.pos - t1.pos;\n\n      var candidateParents = [];\n\n      var trees = [];\n      trees.push({ids: t1.ids, diff: diff, parent: null, parentIdx: null});\n      while (trees.length > 0) {\n        var item = trees.pop();\n        if (item.diff === 0) {\n          if (item.ids[0] === t2.ids[0]) {\n            candidateParents.push(item);\n          }\n          continue;\n        }\n        var elements = item.ids[2];\n        for (var j = 0, elementsLen = elements.length; j < elementsLen; j++) {\n          trees.push({\n            ids: elements[j],\n            diff: item.diff - 1,\n            parent: item.ids,\n            parentIdx: j\n          });\n        }\n      }\n\n      var el = candidateParents[0];\n\n      if (!el) {\n        restree.push(branch);\n      } else {\n        res = mergeTree(el.ids, t2.ids);\n        el.parent[2][el.parentIdx] = res.tree;\n        restree.push({pos: t1.pos, ids: t1.ids});\n        conflicts = conflicts || res.conflicts;\n        merged = true;\n      }\n    } else {\n      restree.push(branch);\n    }\n  }\n\n  // We didnt find\n  if (!merged) {\n    restree.push(path);\n  }\n\n  restree.sort(sortByPos$1);\n\n  return {\n    tree: restree,\n    conflicts: conflicts || 'internal_node'\n  };\n}\n\n// To ensure we dont grow the revision tree infinitely, we stem old revisions\nfunction stem(tree, depth) {\n  // First we break out the tree into a complete list of root to leaf paths\n  var paths = rootToLeaf(tree);\n  var stemmedRevs;\n\n  var result;\n  for (var i = 0, len = paths.length; i < len; i++) {\n    // Then for each path, we cut off the start of the path based on the\n    // `depth` to stem to, and generate a new set of flat trees\n    var path = paths[i];\n    var stemmed = path.ids;\n    var node;\n    if (stemmed.length > depth) {\n      // only do the stemming work if we actually need to stem\n      if (!stemmedRevs) {\n        stemmedRevs = {}; // avoid allocating this object unnecessarily\n      }\n      var numStemmed = stemmed.length - depth;\n      node = {\n        pos: path.pos + numStemmed,\n        ids: pathToTree(stemmed, numStemmed)\n      };\n\n      for (var s = 0; s < numStemmed; s++) {\n        var rev = (path.pos + s) + '-' + stemmed[s].id;\n        stemmedRevs[rev] = true;\n      }\n    } else { // no need to actually stem\n      node = {\n        pos: path.pos,\n        ids: pathToTree(stemmed, 0)\n      };\n    }\n\n    // Then we remerge all those flat trees together, ensuring that we dont\n    // connect trees that would go beyond the depth limit\n    if (result) {\n      result = doMerge(result, node, true).tree;\n    } else {\n      result = [node];\n    }\n  }\n\n  // this is memory-heavy per Chrome profiler, avoid unless we actually stemmed\n  if (stemmedRevs) {\n    traverseRevTree(result, function (isLeaf, pos, revHash) {\n      // some revisions may have been removed in a branch but not in another\n      delete stemmedRevs[pos + '-' + revHash];\n    });\n  }\n\n  return {\n    tree: result,\n    revs: stemmedRevs ? Object.keys(stemmedRevs) : []\n  };\n}\n\nfunction merge(tree, path, depth) {\n  var newTree = doMerge(tree, path);\n  var stemmed = stem(newTree.tree, depth);\n  return {\n    tree: stemmed.tree,\n    stemmedRevs: stemmed.revs,\n    conflicts: newTree.conflicts\n  };\n}\n\n// return true if a rev exists in the rev tree, false otherwise\nfunction revExists(revs, rev) {\n  var toVisit = revs.slice();\n  var splitRev = rev.split('-');\n  var targetPos = parseInt(splitRev[0], 10);\n  var targetId = splitRev[1];\n\n  var node;\n  while ((node = toVisit.pop())) {\n    if (node.pos === targetPos && node.ids[0] === targetId) {\n      return true;\n    }\n    var branches = node.ids[2];\n    for (var i = 0, len = branches.length; i < len; i++) {\n      toVisit.push({pos: node.pos + 1, ids: branches[i]});\n    }\n  }\n  return false;\n}\n\nfunction getTrees(node) {\n  return node.ids;\n}\n\n// check if a specific revision of a doc has been deleted\n//  - metadata: the metadata object from the doc store\n//  - rev: (optional) the revision to check. defaults to winning revision\nfunction isDeleted(metadata, rev) {\n  if (!rev) {\n    rev = winningRev(metadata);\n  }\n  var id = rev.substring(rev.indexOf('-') + 1);\n  var toVisit = metadata.rev_tree.map(getTrees);\n\n  var tree;\n  while ((tree = toVisit.pop())) {\n    if (tree[0] === id) {\n      return !!tree[1].deleted;\n    }\n    toVisit = toVisit.concat(tree[2]);\n  }\n}\n\nfunction isLocalId(id) {\n  return (/^_local/).test(id);\n}\n\n// returns the current leaf node for a given revision\nfunction latest(rev, metadata) {\n  var toVisit = metadata.rev_tree.slice();\n  var node;\n  while ((node = toVisit.pop())) {\n    var pos = node.pos;\n    var tree = node.ids;\n    var id = tree[0];\n    var opts = tree[1];\n    var branches = tree[2];\n    var isLeaf = branches.length === 0;\n\n    var history = node.history ? node.history.slice() : [];\n    history.push({id: id, pos: pos, opts: opts});\n\n    if (isLeaf) {\n      for (var i = 0, len = history.length; i < len; i++) {\n        var historyNode = history[i];\n        var historyRev = historyNode.pos + '-' + historyNode.id;\n\n        if (historyRev === rev) {\n          // return the rev of this leaf\n          return pos + '-' + id;\n        }\n      }\n    }\n\n    for (var j = 0, l = branches.length; j < l; j++) {\n      toVisit.push({pos: pos + 1, ids: branches[j], history: history});\n    }\n  }\n\n  /* istanbul ignore next */\n  throw new Error('Unable to resolve latest revision for id ' + metadata.id + ', rev ' + rev);\n}\n\ninherits(Changes$1, EventEmitter);\n\nfunction tryCatchInChangeListener(self, change, pending, lastSeq) {\n  // isolate try/catches to avoid V8 deoptimizations\n  try {\n    self.emit('change', change, pending, lastSeq);\n  } catch (e) {\n    guardedConsole('error', 'Error in .on(\"change\", function):', e);\n  }\n}\n\nfunction Changes$1(db, opts, callback) {\n  EventEmitter.call(this);\n  var self = this;\n  this.db = db;\n  opts = opts ? clone(opts) : {};\n  var complete = opts.complete = once(function (err, resp) {\n    if (err) {\n      if (listenerCount(self, 'error') > 0) {\n        self.emit('error', err);\n      }\n    } else {\n      self.emit('complete', resp);\n    }\n    self.removeAllListeners();\n    db.removeListener('destroyed', onDestroy);\n  });\n  if (callback) {\n    self.on('complete', function (resp) {\n      callback(null, resp);\n    });\n    self.on('error', callback);\n  }\n  function onDestroy() {\n    self.cancel();\n  }\n  db.once('destroyed', onDestroy);\n\n  opts.onChange = function (change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (self.isCancelled) {\n      return;\n    }\n    tryCatchInChangeListener(self, change, pending, lastSeq);\n  };\n\n  var promise = new Promise(function (fulfill, reject) {\n    opts.complete = function (err, res) {\n      if (err) {\n        reject(err);\n      } else {\n        fulfill(res);\n      }\n    };\n  });\n  self.once('cancel', function () {\n    db.removeListener('destroyed', onDestroy);\n    opts.complete(null, {status: 'cancelled'});\n  });\n  this.then = promise.then.bind(promise);\n  this['catch'] = promise['catch'].bind(promise);\n  this.then(function (result) {\n    complete(null, result);\n  }, complete);\n\n\n\n  if (!db.taskqueue.isReady) {\n    db.taskqueue.addTask(function (failed) {\n      if (failed) {\n        opts.complete(failed);\n      } else if (self.isCancelled) {\n        self.emit('cancel');\n      } else {\n        self.validateChanges(opts);\n      }\n    });\n  } else {\n    self.validateChanges(opts);\n  }\n}\nChanges$1.prototype.cancel = function () {\n  this.isCancelled = true;\n  if (this.db.taskqueue.isReady) {\n    this.emit('cancel');\n  }\n};\nfunction processChange(doc, metadata, opts) {\n  var changeList = [{rev: doc._rev}];\n  if (opts.style === 'all_docs') {\n    changeList = collectLeaves(metadata.rev_tree)\n    .map(function (x) { return {rev: x.rev}; });\n  }\n  var change = {\n    id: metadata.id,\n    changes: changeList,\n    doc: doc\n  };\n\n  if (isDeleted(metadata, doc._rev)) {\n    change.deleted = true;\n  }\n  if (opts.conflicts) {\n    change.doc._conflicts = collectConflicts(metadata);\n    if (!change.doc._conflicts.length) {\n      delete change.doc._conflicts;\n    }\n  }\n  return change;\n}\n\nChanges$1.prototype.validateChanges = function (opts) {\n  var callback = opts.complete;\n  var self = this;\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.validate(opts, function (err) {\n      if (err) {\n        return callback(err);\n      }\n      self.doChanges(opts);\n    });\n  } else {\n    self.doChanges(opts);\n  }\n};\n\nChanges$1.prototype.doChanges = function (opts) {\n  var self = this;\n  var callback = opts.complete;\n\n  opts = clone(opts);\n  if ('live' in opts && !('continuous' in opts)) {\n    opts.continuous = opts.live;\n  }\n  opts.processChange = processChange;\n\n  if (opts.since === 'latest') {\n    opts.since = 'now';\n  }\n  if (!opts.since) {\n    opts.since = 0;\n  }\n  if (opts.since === 'now') {\n    this.db.info().then(function (info) {\n      /* istanbul ignore if */\n      if (self.isCancelled) {\n        callback(null, {status: 'cancelled'});\n        return;\n      }\n      opts.since = info.update_seq;\n      self.doChanges(opts);\n    }, callback);\n    return;\n  }\n\n  /* istanbul ignore else */\n  if (PouchDB._changesFilterPlugin) {\n    PouchDB._changesFilterPlugin.normalize(opts);\n    if (PouchDB._changesFilterPlugin.shouldFilter(this, opts)) {\n      return PouchDB._changesFilterPlugin.filter(this, opts);\n    }\n  } else {\n    ['doc_ids', 'filter', 'selector', 'view'].forEach(function (key) {\n      if (key in opts) {\n        guardedConsole('warn',\n          'The \"' + key + '\" option was passed in to changes/replicate, ' +\n          'but pouchdb-changes-filter plugin is not installed, so it ' +\n          'was ignored. Please install the plugin to enable filtering.'\n        );\n      }\n    });\n  }\n\n  if (!('descending' in opts)) {\n    opts.descending = false;\n  }\n\n  // 0 and 1 should return 1 document\n  opts.limit = opts.limit === 0 ? 1 : opts.limit;\n  opts.complete = callback;\n  var newPromise = this.db._changes(opts);\n  /* istanbul ignore else */\n  if (newPromise && typeof newPromise.cancel === 'function') {\n    var cancel = self.cancel;\n    self.cancel = getArguments(function (args) {\n      newPromise.cancel();\n      cancel.apply(this, args);\n    });\n  }\n};\n\n/*\n * A generic pouch adapter\n */\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Wrapper for functions that call the bulkdocs api with a single doc,\n// if the first result is an error, return an error\nfunction yankError(callback, docId) {\n  return function (err, results) {\n    if (err || (results[0] && results[0].error)) {\n      err = err || results[0];\n      err.docId = docId;\n      callback(err);\n    } else {\n      callback(null, results.length ? results[0]  : results);\n    }\n  };\n}\n\n// clean docs given to us by the user\nfunction cleanDocs(docs) {\n  for (var i = 0; i < docs.length; i++) {\n    var doc = docs[i];\n    if (doc._deleted) {\n      delete doc._attachments; // ignore atts for deleted docs\n    } else if (doc._attachments) {\n      // filter out extraneous keys from _attachments\n      var atts = Object.keys(doc._attachments);\n      for (var j = 0; j < atts.length; j++) {\n        var att = atts[j];\n        doc._attachments[att] = pick(doc._attachments[att],\n          ['data', 'digest', 'content_type', 'length', 'revpos', 'stub']);\n      }\n    }\n  }\n}\n\n// compare two docs, first by _id then by _rev\nfunction compareByIdThenRev(a, b) {\n  var idCompare = compare(a._id, b._id);\n  if (idCompare !== 0) {\n    return idCompare;\n  }\n  var aStart = a._revisions ? a._revisions.start : 0;\n  var bStart = b._revisions ? b._revisions.start : 0;\n  return compare(aStart, bStart);\n}\n\n// for every node in a revision tree computes its distance from the closest\n// leaf\nfunction computeHeight(revs) {\n  var height = {};\n  var edges = [];\n  traverseRevTree(revs, function (isLeaf, pos, id, prnt) {\n    var rev = pos + \"-\" + id;\n    if (isLeaf) {\n      height[rev] = 0;\n    }\n    if (prnt !== undefined) {\n      edges.push({from: prnt, to: rev});\n    }\n    return rev;\n  });\n\n  edges.reverse();\n  edges.forEach(function (edge) {\n    if (height[edge.from] === undefined) {\n      height[edge.from] = 1 + height[edge.to];\n    } else {\n      height[edge.from] = Math.min(height[edge.from], 1 + height[edge.to]);\n    }\n  });\n  return height;\n}\n\nfunction allDocsKeysParse(opts) {\n  var keys =  ('limit' in opts) ?\n    opts.keys.slice(opts.skip, opts.limit + opts.skip) :\n    (opts.skip > 0) ? opts.keys.slice(opts.skip) : opts.keys;\n  opts.keys = keys;\n  opts.skip = 0;\n  delete opts.limit;\n  if (opts.descending) {\n    keys.reverse();\n    opts.descending = false;\n  }\n}\n\n// all compaction is done in a queue, to avoid attaching\n// too many listeners at once\nfunction doNextCompaction(self) {\n  var task = self._compactionQueue[0];\n  var opts = task.opts;\n  var callback = task.callback;\n  self.get('_local/compaction').catch(function () {\n    return false;\n  }).then(function (doc) {\n    if (doc && doc.last_seq) {\n      opts.last_seq = doc.last_seq;\n    }\n    self._compact(opts, function (err, res) {\n      /* istanbul ignore if */\n      if (err) {\n        callback(err);\n      } else {\n        callback(null, res);\n      }\n      nextTick(function () {\n        self._compactionQueue.shift();\n        if (self._compactionQueue.length) {\n          doNextCompaction(self);\n        }\n      });\n    });\n  });\n}\n\nfunction attachmentNameError(name) {\n  if (name.charAt(0) === '_') {\n    return name + ' is not a valid attachment name, attachment ' +\n      'names cannot start with \\'_\\'';\n  }\n  return false;\n}\n\ninherits(AbstractPouchDB, EventEmitter);\n\nfunction AbstractPouchDB() {\n  EventEmitter.call(this);\n\n  // re-bind prototyped methods\n  for (var p in AbstractPouchDB.prototype) {\n    if (typeof this[p] === 'function') {\n      this[p] = this[p].bind(this);\n    }\n  }\n}\n\nAbstractPouchDB.prototype.post =\n  adapterFun('post', function (doc, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return callback(createError(NOT_AN_OBJECT));\n  }\n  this.bulkDocs({docs: [doc]}, opts, yankError(callback, doc._id));\n});\n\nAbstractPouchDB.prototype.put = adapterFun('put', function (doc, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof doc !== 'object' || Array.isArray(doc)) {\n    return cb(createError(NOT_AN_OBJECT));\n  }\n  invalidIdError(doc._id);\n  if (isLocalId(doc._id) && typeof this._putLocal === 'function') {\n    if (doc._deleted) {\n      return this._removeLocal(doc, cb);\n    } else {\n      return this._putLocal(doc, cb);\n    }\n  }\n  var self = this;\n  if (opts.force && doc._rev) {\n    transformForceOptionToNewEditsOption();\n    putDoc(function (err) {\n      var result = err ? null : {ok: true, id: doc._id, rev: doc._rev};\n      cb(err, result);\n    });\n  } else {\n    putDoc(cb);\n  }\n\n  function transformForceOptionToNewEditsOption() {\n    var parts = doc._rev.split('-');\n    var oldRevId = parts[1];\n    var oldRevNum = parseInt(parts[0], 10);\n\n    var newRevNum = oldRevNum + 1;\n    var newRevId = rev$$1();\n\n    doc._revisions = {\n      start: newRevNum,\n      ids: [newRevId, oldRevId]\n    };\n    doc._rev = newRevNum + '-' + newRevId;\n    opts.new_edits = false;\n  }\n  function putDoc(next) {\n    if (typeof self._put === 'function' && opts.new_edits !== false) {\n      self._put(doc, opts, next);\n    } else {\n      self.bulkDocs({docs: [doc]}, opts, yankError(next, doc._id));\n    }\n  }\n});\n\nAbstractPouchDB.prototype.putAttachment =\n  adapterFun('putAttachment', function (docId, attachmentId, rev,\n                                              blob, type) {\n  var api = this;\n  if (typeof type === 'function') {\n    type = blob;\n    blob = rev;\n    rev = null;\n  }\n  // Lets fix in https://github.com/pouchdb/pouchdb/issues/3267\n  /* istanbul ignore if */\n  if (typeof type === 'undefined') {\n    type = blob;\n    blob = rev;\n    rev = null;\n  }\n  if (!type) {\n    guardedConsole('warn', 'Attachment', attachmentId, 'on document', docId, 'is missing content_type');\n  }\n\n  function createAttachment(doc) {\n    var prevrevpos = '_rev' in doc ? parseInt(doc._rev, 10) : 0;\n    doc._attachments = doc._attachments || {};\n    doc._attachments[attachmentId] = {\n      content_type: type,\n      data: blob,\n      revpos: ++prevrevpos\n    };\n    return api.put(doc);\n  }\n\n  return api.get(docId).then(function (doc) {\n    if (doc._rev !== rev) {\n      throw createError(REV_CONFLICT);\n    }\n\n    return createAttachment(doc);\n  }, function (err) {\n     // create new doc\n    /* istanbul ignore else */\n    if (err.reason === MISSING_DOC.message) {\n      return createAttachment({_id: docId});\n    } else {\n      throw err;\n    }\n  });\n});\n\nAbstractPouchDB.prototype.removeAttachment =\n  adapterFun('removeAttachment', function (docId, attachmentId, rev,\n                                                 callback) {\n  var self = this;\n  self.get(docId, function (err, obj) {\n    /* istanbul ignore if */\n    if (err) {\n      callback(err);\n      return;\n    }\n    if (obj._rev !== rev) {\n      callback(createError(REV_CONFLICT));\n      return;\n    }\n    /* istanbul ignore if */\n    if (!obj._attachments) {\n      return callback();\n    }\n    delete obj._attachments[attachmentId];\n    if (Object.keys(obj._attachments).length === 0) {\n      delete obj._attachments;\n    }\n    self.put(obj, callback);\n  });\n});\n\nAbstractPouchDB.prototype.remove =\n  adapterFun('remove', function (docOrId, optsOrRev, opts, callback) {\n  var doc;\n  if (typeof optsOrRev === 'string') {\n    // id, rev, opts, callback style\n    doc = {\n      _id: docOrId,\n      _rev: optsOrRev\n    };\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n  } else {\n    // doc, opts, callback style\n    doc = docOrId;\n    if (typeof optsOrRev === 'function') {\n      callback = optsOrRev;\n      opts = {};\n    } else {\n      callback = opts;\n      opts = optsOrRev;\n    }\n  }\n  opts = opts || {};\n  opts.was_delete = true;\n  var newDoc = {_id: doc._id, _rev: (doc._rev || opts.rev)};\n  newDoc._deleted = true;\n  if (isLocalId(newDoc._id) && typeof this._removeLocal === 'function') {\n    return this._removeLocal(doc, callback);\n  }\n  this.bulkDocs({docs: [newDoc]}, opts, yankError(callback, newDoc._id));\n});\n\nAbstractPouchDB.prototype.revsDiff =\n  adapterFun('revsDiff', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  var ids = Object.keys(req);\n\n  if (!ids.length) {\n    return callback(null, {});\n  }\n\n  var count = 0;\n  var missing = new ExportedMap();\n\n  function addToMissing(id, revId) {\n    if (!missing.has(id)) {\n      missing.set(id, {missing: []});\n    }\n    missing.get(id).missing.push(revId);\n  }\n\n  function processDoc(id, rev_tree) {\n    // Is this fast enough? Maybe we should switch to a set simulated by a map\n    var missingForId = req[id].slice(0);\n    traverseRevTree(rev_tree, function (isLeaf, pos, revHash, ctx,\n      opts) {\n        var rev = pos + '-' + revHash;\n        var idx = missingForId.indexOf(rev);\n        if (idx === -1) {\n          return;\n        }\n\n        missingForId.splice(idx, 1);\n        /* istanbul ignore if */\n        if (opts.status !== 'available') {\n          addToMissing(id, rev);\n        }\n      });\n\n    // Traversing the tree is synchronous, so now `missingForId` contains\n    // revisions that were not found in the tree\n    missingForId.forEach(function (rev) {\n      addToMissing(id, rev);\n    });\n  }\n\n  ids.map(function (id) {\n    this._getRevisionTree(id, function (err, rev_tree) {\n      if (err && err.status === 404 && err.message === 'missing') {\n        missing.set(id, {missing: req[id]});\n      } else if (err) {\n        /* istanbul ignore next */\n        return callback(err);\n      } else {\n        processDoc(id, rev_tree);\n      }\n\n      if (++count === ids.length) {\n        // convert LazyMap to object\n        var missingObj = {};\n        missing.forEach(function (value, key) {\n          missingObj[key] = value;\n        });\n        return callback(null, missingObj);\n      }\n    });\n  }, this);\n});\n\n// _bulk_get API for faster replication, as described in\n// https://github.com/apache/couchdb-chttpd/pull/33\n// At the \"abstract\" level, it will just run multiple get()s in\n// parallel, because this isn't much of a performance cost\n// for local databases (except the cost of multiple transactions, which is\n// small). The http adapter overrides this in order\n// to do a more efficient single HTTP request.\nAbstractPouchDB.prototype.bulkGet =\n  adapterFun('bulkGet', function (opts, callback) {\n  bulkGet(this, opts, callback);\n});\n\n// compact one document and fire callback\n// by compacting we mean removing all revisions which\n// are further from the leaf in revision tree than max_height\nAbstractPouchDB.prototype.compactDocument =\n  adapterFun('compactDocument', function (docId, maxHeight, callback) {\n  var self = this;\n  this._getRevisionTree(docId, function (err, revTree) {\n    /* istanbul ignore if */\n    if (err) {\n      return callback(err);\n    }\n    var height = computeHeight(revTree);\n    var candidates = [];\n    var revs = [];\n    Object.keys(height).forEach(function (rev) {\n      if (height[rev] > maxHeight) {\n        candidates.push(rev);\n      }\n    });\n\n    traverseRevTree(revTree, function (isLeaf, pos, revHash, ctx, opts) {\n      var rev = pos + '-' + revHash;\n      if (opts.status === 'available' && candidates.indexOf(rev) !== -1) {\n        revs.push(rev);\n      }\n    });\n    self._doCompaction(docId, revs, callback);\n  });\n});\n\n// compact the whole database using single document\n// compaction\nAbstractPouchDB.prototype.compact =\n  adapterFun('compact', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  self._compactionQueue = self._compactionQueue || [];\n  self._compactionQueue.push({opts: opts, callback: callback});\n  if (self._compactionQueue.length === 1) {\n    doNextCompaction(self);\n  }\n});\nAbstractPouchDB.prototype._compact = function (opts, callback) {\n  var self = this;\n  var changesOpts = {\n    return_docs: false,\n    last_seq: opts.last_seq || 0\n  };\n  var promises = [];\n\n  function onChange(row) {\n    promises.push(self.compactDocument(row.id, 0));\n  }\n  function onComplete(resp) {\n    var lastSeq = resp.last_seq;\n    Promise.all(promises).then(function () {\n      return upsert(self, '_local/compaction', function deltaFunc(doc) {\n        if (!doc.last_seq || doc.last_seq < lastSeq) {\n          doc.last_seq = lastSeq;\n          return doc;\n        }\n        return false; // somebody else got here first, don't update\n      });\n    }).then(function () {\n      callback(null, {ok: true});\n    }).catch(callback);\n  }\n  self.changes(changesOpts)\n    .on('change', onChange)\n    .on('complete', onComplete)\n    .on('error', callback);\n};\n\n/* Begin api wrappers. Specific functionality to storage belongs in the\n   _[method] */\nAbstractPouchDB.prototype.get = adapterFun('get', function (id, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n  if (typeof id !== 'string') {\n    return cb(createError(INVALID_ID));\n  }\n  if (isLocalId(id) && typeof this._getLocal === 'function') {\n    return this._getLocal(id, cb);\n  }\n  var leaves = [], self = this;\n\n  function finishOpenRevs() {\n    var result = [];\n    var count = leaves.length;\n    /* istanbul ignore if */\n    if (!count) {\n      return cb(null, result);\n    }\n\n    // order with open_revs is unspecified\n    leaves.forEach(function (leaf) {\n      self.get(id, {\n        rev: leaf,\n        revs: opts.revs,\n        latest: opts.latest,\n        attachments: opts.attachments,\n        binary: opts.binary\n      }, function (err, doc) {\n        if (!err) {\n          // using latest=true can produce duplicates\n          var existing;\n          for (var i = 0, l = result.length; i < l; i++) {\n            if (result[i].ok && result[i].ok._rev === doc._rev) {\n              existing = true;\n              break;\n            }\n          }\n          if (!existing) {\n            result.push({ok: doc});\n          }\n        } else {\n          result.push({missing: leaf});\n        }\n        count--;\n        if (!count) {\n          cb(null, result);\n        }\n      });\n    });\n  }\n\n  if (opts.open_revs) {\n    if (opts.open_revs === \"all\") {\n      this._getRevisionTree(id, function (err, rev_tree) {\n        /* istanbul ignore if */\n        if (err) {\n          return cb(err);\n        }\n        leaves = collectLeaves(rev_tree).map(function (leaf) {\n          return leaf.rev;\n        });\n        finishOpenRevs();\n      });\n    } else {\n      if (Array.isArray(opts.open_revs)) {\n        leaves = opts.open_revs;\n        for (var i = 0; i < leaves.length; i++) {\n          var l = leaves[i];\n          // looks like it's the only thing couchdb checks\n          if (!(typeof (l) === \"string\" && /^\\d+-/.test(l))) {\n            return cb(createError(INVALID_REV));\n          }\n        }\n        finishOpenRevs();\n      } else {\n        return cb(createError(UNKNOWN_ERROR, 'function_clause'));\n      }\n    }\n    return; // open_revs does not like other options\n  }\n\n  return this._get(id, opts, function (err, result) {\n    if (err) {\n      err.docId = id;\n      return cb(err);\n    }\n\n    var doc = result.doc;\n    var metadata = result.metadata;\n    var ctx = result.ctx;\n\n    if (opts.conflicts) {\n      var conflicts = collectConflicts(metadata);\n      if (conflicts.length) {\n        doc._conflicts = conflicts;\n      }\n    }\n\n    if (isDeleted(metadata, doc._rev)) {\n      doc._deleted = true;\n    }\n\n    if (opts.revs || opts.revs_info) {\n      var splittedRev = doc._rev.split('-');\n      var revNo       = parseInt(splittedRev[0], 10);\n      var revHash     = splittedRev[1];\n\n      var paths = rootToLeaf(metadata.rev_tree);\n      var path = null;\n\n      for (var i = 0; i < paths.length; i++) {\n        var currentPath = paths[i];\n        var hashIndex = currentPath.ids.map(function (x) { return x.id; })\n          .indexOf(revHash);\n        var hashFoundAtRevPos = hashIndex === (revNo - 1);\n\n        if (hashFoundAtRevPos || (!path && hashIndex !== -1)) {\n          path = currentPath;\n        }\n      }\n\n      var indexOfRev = path.ids.map(function (x) { return x.id; })\n        .indexOf(doc._rev.split('-')[1]) + 1;\n      var howMany = path.ids.length - indexOfRev;\n      path.ids.splice(indexOfRev, howMany);\n      path.ids.reverse();\n\n      if (opts.revs) {\n        doc._revisions = {\n          start: (path.pos + path.ids.length) - 1,\n          ids: path.ids.map(function (rev) {\n            return rev.id;\n          })\n        };\n      }\n      if (opts.revs_info) {\n        var pos =  path.pos + path.ids.length;\n        doc._revs_info = path.ids.map(function (rev) {\n          pos--;\n          return {\n            rev: pos + '-' + rev.id,\n            status: rev.opts.status\n          };\n        });\n      }\n    }\n\n    if (opts.attachments && doc._attachments) {\n      var attachments = doc._attachments;\n      var count = Object.keys(attachments).length;\n      if (count === 0) {\n        return cb(null, doc);\n      }\n      Object.keys(attachments).forEach(function (key) {\n        this._getAttachment(doc._id, key, attachments[key], {\n          // Previously the revision handling was done in adapter.js\n          // getAttachment, however since idb-next doesnt we need to\n          // pass the rev through\n          rev: doc._rev,\n          binary: opts.binary,\n          ctx: ctx\n        }, function (err, data) {\n          var att = doc._attachments[key];\n          att.data = data;\n          delete att.stub;\n          delete att.length;\n          if (!--count) {\n            cb(null, doc);\n          }\n        });\n      }, self);\n    } else {\n      if (doc._attachments) {\n        for (var key in doc._attachments) {\n          /* istanbul ignore else */\n          if (doc._attachments.hasOwnProperty(key)) {\n            doc._attachments[key].stub = true;\n          }\n        }\n      }\n      cb(null, doc);\n    }\n  });\n});\n\n// TODO: I dont like this, it forces an extra read for every\n// attachment read and enforces a confusing api between\n// adapter.js and the adapter implementation\nAbstractPouchDB.prototype.getAttachment =\n  adapterFun('getAttachment', function (docId, attachmentId, opts, callback) {\n  var self = this;\n  if (opts instanceof Function) {\n    callback = opts;\n    opts = {};\n  }\n  this._get(docId, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (res.doc._attachments && res.doc._attachments[attachmentId]) {\n      opts.ctx = res.ctx;\n      opts.binary = true;\n      self._getAttachment(docId, attachmentId,\n                          res.doc._attachments[attachmentId], opts, callback);\n    } else {\n      return callback(createError(MISSING_DOC));\n    }\n  });\n});\n\nAbstractPouchDB.prototype.allDocs =\n  adapterFun('allDocs', function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  opts.skip = typeof opts.skip !== 'undefined' ? opts.skip : 0;\n  if (opts.start_key) {\n    opts.startkey = opts.start_key;\n  }\n  if (opts.end_key) {\n    opts.endkey = opts.end_key;\n  }\n  if ('keys' in opts) {\n    if (!Array.isArray(opts.keys)) {\n      return callback(new TypeError('options.keys must be an array'));\n    }\n    var incompatibleOpt =\n      ['startkey', 'endkey', 'key'].filter(function (incompatibleOpt) {\n      return incompatibleOpt in opts;\n    })[0];\n    if (incompatibleOpt) {\n      callback(createError(QUERY_PARSE_ERROR,\n        'Query parameter `' + incompatibleOpt +\n        '` is not compatible with multi-get'\n      ));\n      return;\n    }\n    if (!isRemote(this)) {\n      allDocsKeysParse(opts);\n      if (opts.keys.length === 0) {\n        return this._allDocs({limit: 0}, callback);\n      }\n    }\n  }\n\n  return this._allDocs(opts, callback);\n});\n\nAbstractPouchDB.prototype.changes = function (opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  // By default set return_docs to false if the caller has opts.live = true,\n  // this will prevent us from collecting the set of changes indefinitely\n  // resulting in growing memory\n  opts.return_docs = ('return_docs' in opts) ? opts.return_docs : !opts.live;\n\n  return new Changes$1(this, opts, callback);\n};\n\nAbstractPouchDB.prototype.close = adapterFun('close', function (callback) {\n  this._closed = true;\n  this.emit('closed');\n  return this._close(callback);\n});\n\nAbstractPouchDB.prototype.info = adapterFun('info', function (callback) {\n  var self = this;\n  this._info(function (err, info) {\n    if (err) {\n      return callback(err);\n    }\n    // assume we know better than the adapter, unless it informs us\n    info.db_name = info.db_name || self.name;\n    info.auto_compaction = !!(self.auto_compaction && !isRemote(self));\n    info.adapter = self.adapter;\n    callback(null, info);\n  });\n});\n\nAbstractPouchDB.prototype.id = adapterFun('id', function (callback) {\n  return this._id(callback);\n});\n\n/* istanbul ignore next */\nAbstractPouchDB.prototype.type = function () {\n  return (typeof this._type === 'function') ? this._type() : this.adapter;\n};\n\nAbstractPouchDB.prototype.bulkDocs =\n  adapterFun('bulkDocs', function (req, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  opts = opts || {};\n\n  if (Array.isArray(req)) {\n    req = {\n      docs: req\n    };\n  }\n\n  if (!req || !req.docs || !Array.isArray(req.docs)) {\n    return callback(createError(MISSING_BULK_DOCS));\n  }\n\n  for (var i = 0; i < req.docs.length; ++i) {\n    if (typeof req.docs[i] !== 'object' || Array.isArray(req.docs[i])) {\n      return callback(createError(NOT_AN_OBJECT));\n    }\n  }\n\n  var attachmentError;\n  req.docs.forEach(function (doc) {\n    if (doc._attachments) {\n      Object.keys(doc._attachments).forEach(function (name) {\n        attachmentError = attachmentError || attachmentNameError(name);\n        if (!doc._attachments[name].content_type) {\n          guardedConsole('warn', 'Attachment', name, 'on document', doc._id, 'is missing content_type');\n        }\n      });\n    }\n  });\n\n  if (attachmentError) {\n    return callback(createError(BAD_REQUEST, attachmentError));\n  }\n\n  if (!('new_edits' in opts)) {\n    if ('new_edits' in req) {\n      opts.new_edits = req.new_edits;\n    } else {\n      opts.new_edits = true;\n    }\n  }\n\n  var adapter = this;\n  if (!opts.new_edits && !isRemote(adapter)) {\n    // ensure revisions of the same doc are sorted, so that\n    // the local adapter processes them correctly (#2935)\n    req.docs.sort(compareByIdThenRev);\n  }\n\n  cleanDocs(req.docs);\n\n  // in the case of conflicts, we want to return the _ids to the user\n  // however, the underlying adapter may destroy the docs array, so\n  // create a copy here\n  var ids = req.docs.map(function (doc) {\n    return doc._id;\n  });\n\n  return this._bulkDocs(req, opts, function (err, res) {\n    if (err) {\n      return callback(err);\n    }\n    if (!opts.new_edits) {\n      // this is what couch does when new_edits is false\n      res = res.filter(function (x) {\n        return x.error;\n      });\n    }\n    // add ids for error/conflict responses (not required for CouchDB)\n    if (!isRemote(adapter)) {\n      for (var i = 0, l = res.length; i < l; i++) {\n        res[i].id = res[i].id || ids[i];\n      }\n    }\n\n    callback(null, res);\n  });\n});\n\nAbstractPouchDB.prototype.registerDependentDatabase =\n  adapterFun('registerDependentDatabase', function (dependentDb,\n                                                          callback) {\n  var depDB = new this.constructor(dependentDb, this.__opts);\n\n  function diffFun(doc) {\n    doc.dependentDbs = doc.dependentDbs || {};\n    if (doc.dependentDbs[dependentDb]) {\n      return false; // no update required\n    }\n    doc.dependentDbs[dependentDb] = true;\n    return doc;\n  }\n  upsert(this, '_local/_pouch_dependentDbs', diffFun)\n    .then(function () {\n      callback(null, {db: depDB});\n    }).catch(callback);\n});\n\nAbstractPouchDB.prototype.destroy =\n  adapterFun('destroy', function (opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n\n  var self = this;\n  var usePrefix = 'use_prefix' in self ? self.use_prefix : true;\n\n  function destroyDb() {\n    // call destroy method of the particular adaptor\n    self._destroy(opts, function (err, resp) {\n      if (err) {\n        return callback(err);\n      }\n      self._destroyed = true;\n      self.emit('destroyed');\n      callback(null, resp || { 'ok': true });\n    });\n  }\n\n  if (isRemote(self)) {\n    // no need to check for dependent DBs if it's a remote DB\n    return destroyDb();\n  }\n\n  self.get('_local/_pouch_dependentDbs', function (err, localDoc) {\n    if (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        return callback(err);\n      } else { // no dependencies\n        return destroyDb();\n      }\n    }\n    var dependentDbs = localDoc.dependentDbs;\n    var PouchDB = self.constructor;\n    var deletedMap = Object.keys(dependentDbs).map(function (name) {\n      // use_prefix is only false in the browser\n      /* istanbul ignore next */\n      var trueName = usePrefix ?\n        name.replace(new RegExp('^' + PouchDB.prefix), '') : name;\n      return new PouchDB(trueName, self.__opts).destroy();\n    });\n    Promise.all(deletedMap).then(destroyDb, callback);\n  });\n});\n\nfunction TaskQueue() {\n  this.isReady = false;\n  this.failed = false;\n  this.queue = [];\n}\n\nTaskQueue.prototype.execute = function () {\n  var fun;\n  if (this.failed) {\n    while ((fun = this.queue.shift())) {\n      fun(this.failed);\n    }\n  } else {\n    while ((fun = this.queue.shift())) {\n      fun();\n    }\n  }\n};\n\nTaskQueue.prototype.fail = function (err) {\n  this.failed = err;\n  this.execute();\n};\n\nTaskQueue.prototype.ready = function (db) {\n  this.isReady = true;\n  this.db = db;\n  this.execute();\n};\n\nTaskQueue.prototype.addTask = function (fun) {\n  this.queue.push(fun);\n  if (this.failed) {\n    this.execute();\n  }\n};\n\nfunction parseAdapter(name, opts) {\n  var match = name.match(/([a-z-]*):\\/\\/(.*)/);\n  if (match) {\n    // the http adapter expects the fully qualified name\n    return {\n      name: /https?/.test(match[1]) ? match[1] + '://' + match[2] : match[2],\n      adapter: match[1]\n    };\n  }\n\n  var adapters = PouchDB.adapters;\n  var preferredAdapters = PouchDB.preferredAdapters;\n  var prefix = PouchDB.prefix;\n  var adapterName = opts.adapter;\n\n  if (!adapterName) { // automatically determine adapter\n    for (var i = 0; i < preferredAdapters.length; ++i) {\n      adapterName = preferredAdapters[i];\n      // check for browsers that have been upgraded from websql-only to websql+idb\n      /* istanbul ignore if */\n      if (adapterName === 'idb' && 'websql' in adapters &&\n          hasLocalStorage() && localStorage['_pouch__websqldb_' + prefix + name]) {\n        // log it, because this can be confusing during development\n        guardedConsole('log', 'PouchDB is downgrading \"' + name + '\" to WebSQL to' +\n          ' avoid data loss, because it was already opened with WebSQL.');\n        continue; // keep using websql to avoid user data loss\n      }\n      break;\n    }\n  }\n\n  var adapter = adapters[adapterName];\n\n  // if adapter is invalid, then an error will be thrown later\n  var usePrefix = (adapter && 'use_prefix' in adapter) ?\n    adapter.use_prefix : true;\n\n  return {\n    name: usePrefix ? (prefix + name) : name,\n    adapter: adapterName\n  };\n}\n\n// OK, so here's the deal. Consider this code:\n//     var db1 = new PouchDB('foo');\n//     var db2 = new PouchDB('foo');\n//     db1.destroy();\n// ^ these two both need to emit 'destroyed' events,\n// as well as the PouchDB constructor itself.\n// So we have one db object (whichever one got destroy() called on it)\n// responsible for emitting the initial event, which then gets emitted\n// by the constructor, which then broadcasts it to any other dbs\n// that may have been created with the same name.\nfunction prepareForDestruction(self) {\n\n  function onDestroyed(from_constructor) {\n    self.removeListener('closed', onClosed);\n    if (!from_constructor) {\n      self.constructor.emit('destroyed', self.name);\n    }\n  }\n\n  function onClosed() {\n    self.removeListener('destroyed', onDestroyed);\n    self.constructor.emit('unref', self);\n  }\n\n  self.once('destroyed', onDestroyed);\n  self.once('closed', onClosed);\n  self.constructor.emit('ref', self);\n}\n\ninherits(PouchDB, AbstractPouchDB);\nfunction PouchDB(name, opts) {\n  // In Node our test suite only tests this for PouchAlt unfortunately\n  /* istanbul ignore if */\n  if (!(this instanceof PouchDB)) {\n    return new PouchDB(name, opts);\n  }\n\n  var self = this;\n  opts = opts || {};\n\n  if (name && typeof name === 'object') {\n    opts = name;\n    name = opts.name;\n    delete opts.name;\n  }\n\n  if (opts.deterministic_revs === undefined) {\n    opts.deterministic_revs = true;\n  }\n\n  this.__opts = opts = clone(opts);\n\n  self.auto_compaction = opts.auto_compaction;\n  self.prefix = PouchDB.prefix;\n\n  if (typeof name !== 'string') {\n    throw new Error('Missing/invalid DB name');\n  }\n\n  var prefixedName = (opts.prefix || '') + name;\n  var backend = parseAdapter(prefixedName, opts);\n\n  opts.name = backend.name;\n  opts.adapter = opts.adapter || backend.adapter;\n\n  self.name = name;\n  self._adapter = opts.adapter;\n  PouchDB.emit('debug', ['adapter', 'Picked adapter: ', opts.adapter]);\n\n  if (!PouchDB.adapters[opts.adapter] ||\n      !PouchDB.adapters[opts.adapter].valid()) {\n    throw new Error('Invalid Adapter: ' + opts.adapter);\n  }\n\n  AbstractPouchDB.call(self);\n  self.taskqueue = new TaskQueue();\n\n  self.adapter = opts.adapter;\n\n  PouchDB.adapters[opts.adapter].call(self, opts, function (err) {\n    if (err) {\n      return self.taskqueue.fail(err);\n    }\n    prepareForDestruction(self);\n\n    self.emit('created', self);\n    PouchDB.emit('created', self.name);\n    self.taskqueue.ready(self);\n  });\n\n}\n\n// AbortController was introduced quite a while after fetch and\n// isnt required for PouchDB to function so polyfill if needed\nvar a = (typeof AbortController !== 'undefined')\n    ? AbortController\n    : function () { return {abort: function () {}}; };\n\nvar f$1 = fetch;\nvar h = Headers;\n\nPouchDB.adapters = {};\nPouchDB.preferredAdapters = [];\n\nPouchDB.prefix = '_pouch_';\n\nvar eventEmitter = new EventEmitter();\n\nfunction setUpEventEmitter(Pouch) {\n  Object.keys(EventEmitter.prototype).forEach(function (key) {\n    if (typeof EventEmitter.prototype[key] === 'function') {\n      Pouch[key] = eventEmitter[key].bind(eventEmitter);\n    }\n  });\n\n  // these are created in constructor.js, and allow us to notify each DB with\n  // the same name that it was destroyed, via the constructor object\n  var destructListeners = Pouch._destructionListeners = new ExportedMap();\n\n  Pouch.on('ref', function onConstructorRef(db) {\n    if (!destructListeners.has(db.name)) {\n      destructListeners.set(db.name, []);\n    }\n    destructListeners.get(db.name).push(db);\n  });\n\n  Pouch.on('unref', function onConstructorUnref(db) {\n    if (!destructListeners.has(db.name)) {\n      return;\n    }\n    var dbList = destructListeners.get(db.name);\n    var pos = dbList.indexOf(db);\n    if (pos < 0) {\n      /* istanbul ignore next */\n      return;\n    }\n    dbList.splice(pos, 1);\n    if (dbList.length > 1) {\n      /* istanbul ignore next */\n      destructListeners.set(db.name, dbList);\n    } else {\n      destructListeners.delete(db.name);\n    }\n  });\n\n  Pouch.on('destroyed', function onConstructorDestroyed(name) {\n    if (!destructListeners.has(name)) {\n      return;\n    }\n    var dbList = destructListeners.get(name);\n    destructListeners.delete(name);\n    dbList.forEach(function (db) {\n      db.emit('destroyed',true);\n    });\n  });\n}\n\nsetUpEventEmitter(PouchDB);\n\nPouchDB.adapter = function (id, obj, addToPreferredAdapters) {\n  /* istanbul ignore else */\n  if (obj.valid()) {\n    PouchDB.adapters[id] = obj;\n    if (addToPreferredAdapters) {\n      PouchDB.preferredAdapters.push(id);\n    }\n  }\n};\n\nPouchDB.plugin = function (obj) {\n  if (typeof obj === 'function') { // function style for plugins\n    obj(PouchDB);\n  } else if (typeof obj !== 'object' || Object.keys(obj).length === 0) {\n    throw new Error('Invalid plugin: got \"' + obj + '\", expected an object or a function');\n  } else {\n    Object.keys(obj).forEach(function (id) { // object style for plugins\n      PouchDB.prototype[id] = obj[id];\n    });\n  }\n  if (this.__defaults) {\n    PouchDB.__defaults = $inject_Object_assign({}, this.__defaults);\n  }\n  return PouchDB;\n};\n\nPouchDB.defaults = function (defaultOpts) {\n  function PouchAlt(name, opts) {\n    if (!(this instanceof PouchAlt)) {\n      return new PouchAlt(name, opts);\n    }\n\n    opts = opts || {};\n\n    if (name && typeof name === 'object') {\n      opts = name;\n      name = opts.name;\n      delete opts.name;\n    }\n\n    opts = $inject_Object_assign({}, PouchAlt.__defaults, opts);\n    PouchDB.call(this, name, opts);\n  }\n\n  inherits(PouchAlt, PouchDB);\n\n  PouchAlt.preferredAdapters = PouchDB.preferredAdapters.slice();\n  Object.keys(PouchDB).forEach(function (key) {\n    if (!(key in PouchAlt)) {\n      PouchAlt[key] = PouchDB[key];\n    }\n  });\n\n  // make default options transitive\n  // https://github.com/pouchdb/pouchdb/issues/5922\n  PouchAlt.__defaults = $inject_Object_assign({}, this.__defaults, defaultOpts);\n\n  return PouchAlt;\n};\n\nPouchDB.fetch = function (url, opts) {\n  return f$1(url, opts);\n};\n\n// managed automatically by set-version.js\nvar version = \"7.0.0\";\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction compare$1(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n  if ('$and' in result) {\n    result = mergeAndedSelectors(result['$and']);\n    wasAnded = true;\n  }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\nfunction pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare$1(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  return Object.keys(matcher).every(function (userOperator) {\n    var userValue = matcher[userOperator];\n    return match(userOperator, doc, userValue, parsedField, docFieldValue);\n  });\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nfunction evalFilter(input) {\n  return scopeEval('\"use strict\";\\nreturn ' + input + ';', {});\n}\n\nfunction evalView(input) {\n  var code = [\n    'return function(doc) {',\n    '  \"use strict\";',\n    '  var emitted = false;',\n    '  var emit = function (a, b) {',\n    '    emitted = true;',\n    '  };',\n    '  var view = ' + input + ';',\n    '  view(doc);',\n    '  if (emitted) {',\n    '    return true;',\n    '  }',\n    '};'\n  ].join('\\n');\n\n  return scopeEval(code, {});\n}\n\nfunction validate(opts, callback) {\n  if (opts.selector) {\n    if (opts.filter && opts.filter !== '_selector') {\n      var filterName = typeof opts.filter === 'string' ?\n        opts.filter : 'function';\n      return callback(new Error('selector invalid for filter \"' + filterName + '\"'));\n    }\n  }\n  callback();\n}\n\nfunction normalize(opts) {\n  if (opts.view && !opts.filter) {\n    opts.filter = '_view';\n  }\n\n  if (opts.selector && !opts.filter) {\n    opts.filter = '_selector';\n  }\n\n  if (opts.filter && typeof opts.filter === 'string') {\n    if (opts.filter === '_view') {\n      opts.view = normalizeDesignDocFunctionName(opts.view);\n    } else {\n      opts.filter = normalizeDesignDocFunctionName(opts.filter);\n    }\n  }\n}\n\nfunction shouldFilter(changesHandler, opts) {\n  return opts.filter && typeof opts.filter === 'string' &&\n    !opts.doc_ids && !isRemote(changesHandler.db);\n}\n\nfunction filter(changesHandler, opts) {\n  var callback = opts.complete;\n  if (opts.filter === '_view') {\n    if (!opts.view || typeof opts.view !== 'string') {\n      var err = createError(BAD_REQUEST,\n        '`view` filter parameter not found or invalid.');\n      return callback(err);\n    }\n    // fetch a view from a design doc, make it behave like a filter\n    var viewName = parseDesignDocFunctionName(opts.view);\n    changesHandler.db.get('_design/' + viewName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var mapFun = ddoc && ddoc.views && ddoc.views[viewName[1]] &&\n        ddoc.views[viewName[1]].map;\n      if (!mapFun) {\n        return callback(createError(MISSING_DOC,\n          (ddoc.views ? 'missing json key: ' + viewName[1] :\n            'missing json key: views')));\n      }\n      opts.filter = evalView(mapFun);\n      changesHandler.doChanges(opts);\n    });\n  } else if (opts.selector) {\n    opts.filter = function (doc) {\n      return matchesSelector(doc, opts.selector);\n    };\n    changesHandler.doChanges(opts);\n  } else {\n    // fetch a filter from a design doc\n    var filterName = parseDesignDocFunctionName(opts.filter);\n    changesHandler.db.get('_design/' + filterName[0], function (err, ddoc) {\n      /* istanbul ignore if */\n      if (changesHandler.isCancelled) {\n        return callback(null, {status: 'cancelled'});\n      }\n      /* istanbul ignore next */\n      if (err) {\n        return callback(generateErrorFromResponse(err));\n      }\n      var filterFun = ddoc && ddoc.filters && ddoc.filters[filterName[1]];\n      if (!filterFun) {\n        return callback(createError(MISSING_DOC,\n          ((ddoc && ddoc.filters) ? 'missing json key: ' + filterName[1]\n            : 'missing json key: filters')));\n      }\n      opts.filter = evalFilter(filterFun);\n      changesHandler.doChanges(opts);\n    });\n  }\n}\n\nfunction applyChangesFilterPlugin(PouchDB) {\n  PouchDB._changesFilterPlugin = {\n    validate: validate,\n    normalize: normalize,\n    shouldFilter: shouldFilter,\n    filter: filter\n  };\n}\n\n// TODO: remove from pouchdb-core (breaking)\nPouchDB.plugin(applyChangesFilterPlugin);\n\nPouchDB.version = version;\n\nfunction toObject(array) {\n  return array.reduce(function (obj, item) {\n    obj[item] = true;\n    return obj;\n  }, {});\n}\n// List of top level reserved words for doc\nvar reservedWords = toObject([\n  '_id',\n  '_rev',\n  '_attachments',\n  '_deleted',\n  '_revisions',\n  '_revs_info',\n  '_conflicts',\n  '_deleted_conflicts',\n  '_local_seq',\n  '_rev_tree',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats',\n  // Specific to Couchbase Sync Gateway\n  '_removed'\n]);\n\n// List of reserved words that should end up the document\nvar dataWords = toObject([\n  '_attachments',\n  //replication documents\n  '_replication_id',\n  '_replication_state',\n  '_replication_state_time',\n  '_replication_state_reason',\n  '_replication_stats'\n]);\n\nfunction parseRevisionInfo(rev) {\n  if (!/^\\d+-./.test(rev)) {\n    return createError(INVALID_REV);\n  }\n  var idx = rev.indexOf('-');\n  var left = rev.substring(0, idx);\n  var right = rev.substring(idx + 1);\n  return {\n    prefix: parseInt(left, 10),\n    id: right\n  };\n}\n\nfunction makeRevTreeFromRevisions(revisions, opts) {\n  var pos = revisions.start - revisions.ids.length + 1;\n\n  var revisionIds = revisions.ids;\n  var ids = [revisionIds[0], opts, []];\n\n  for (var i = 1, len = revisionIds.length; i < len; i++) {\n    ids = [revisionIds[i], {status: 'missing'}, [ids]];\n  }\n\n  return [{\n    pos: pos,\n    ids: ids\n  }];\n}\n\n// Preprocess documents, parse their revisions, assign an id and a\n// revision for new writes that are missing them, etc\nfunction parseDoc(doc, newEdits, dbOpts) {\n  if (!dbOpts) {\n    dbOpts = {\n      deterministic_revs: true\n    };\n  }\n\n  var nRevNum;\n  var newRevId;\n  var revInfo;\n  var opts = {status: 'available'};\n  if (doc._deleted) {\n    opts.deleted = true;\n  }\n\n  if (newEdits) {\n    if (!doc._id) {\n      doc._id = uuid();\n    }\n    newRevId = rev$$1(doc, dbOpts.deterministic_revs);\n    if (doc._rev) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      doc._rev_tree = [{\n        pos: revInfo.prefix,\n        ids: [revInfo.id, {status: 'missing'}, [[newRevId, opts, []]]]\n      }];\n      nRevNum = revInfo.prefix + 1;\n    } else {\n      doc._rev_tree = [{\n        pos: 1,\n        ids : [newRevId, opts, []]\n      }];\n      nRevNum = 1;\n    }\n  } else {\n    if (doc._revisions) {\n      doc._rev_tree = makeRevTreeFromRevisions(doc._revisions, opts);\n      nRevNum = doc._revisions.start;\n      newRevId = doc._revisions.ids[0];\n    }\n    if (!doc._rev_tree) {\n      revInfo = parseRevisionInfo(doc._rev);\n      if (revInfo.error) {\n        return revInfo;\n      }\n      nRevNum = revInfo.prefix;\n      newRevId = revInfo.id;\n      doc._rev_tree = [{\n        pos: nRevNum,\n        ids: [newRevId, opts, []]\n      }];\n    }\n  }\n\n  invalidIdError(doc._id);\n\n  doc._rev = nRevNum + '-' + newRevId;\n\n  var result = {metadata : {}, data : {}};\n  for (var key in doc) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(doc, key)) {\n      var specialKey = key[0] === '_';\n      if (specialKey && !reservedWords[key]) {\n        var error = createError(DOC_VALIDATION, key);\n        error.message = DOC_VALIDATION.message + ': ' + key;\n        throw error;\n      } else if (specialKey && !dataWords[key]) {\n        result.metadata[key.slice(1)] = doc[key];\n      } else {\n        result.data[key] = doc[key];\n      }\n    }\n  }\n  return result;\n}\n\nfunction parseBase64(data) {\n  try {\n    return thisAtob(data);\n  } catch (e) {\n    var err = createError(BAD_ARG,\n      'Attachment is not a valid base64 string');\n    return {error: err};\n  }\n}\n\nfunction preprocessString(att, blobType, callback) {\n  var asBinary = parseBase64(att.data);\n  if (asBinary.error) {\n    return callback(asBinary.error);\n  }\n\n  att.length = asBinary.length;\n  if (blobType === 'blob') {\n    att.data = binStringToBluffer(asBinary, att.content_type);\n  } else if (blobType === 'base64') {\n    att.data = thisBtoa(asBinary);\n  } else { // binary\n    att.data = asBinary;\n  }\n  binaryMd5(asBinary, function (result) {\n    att.digest = 'md5-' + result;\n    callback();\n  });\n}\n\nfunction preprocessBlob(att, blobType, callback) {\n  binaryMd5(att.data, function (md5) {\n    att.digest = 'md5-' + md5;\n    // size is for blobs (browser), length is for buffers (node)\n    att.length = att.data.size || att.data.length || 0;\n    if (blobType === 'binary') {\n      blobToBinaryString(att.data, function (binString) {\n        att.data = binString;\n        callback();\n      });\n    } else if (blobType === 'base64') {\n      blobToBase64(att.data, function (b64) {\n        att.data = b64;\n        callback();\n      });\n    } else {\n      callback();\n    }\n  });\n}\n\nfunction preprocessAttachment(att, blobType, callback) {\n  if (att.stub) {\n    return callback();\n  }\n  if (typeof att.data === 'string') { // input is a base64 string\n    preprocessString(att, blobType, callback);\n  } else { // input is a blob\n    preprocessBlob(att, blobType, callback);\n  }\n}\n\nfunction preprocessAttachments(docInfos, blobType, callback) {\n\n  if (!docInfos.length) {\n    return callback();\n  }\n\n  var docv = 0;\n  var overallErr;\n\n  docInfos.forEach(function (docInfo) {\n    var attachments = docInfo.data && docInfo.data._attachments ?\n      Object.keys(docInfo.data._attachments) : [];\n    var recv = 0;\n\n    if (!attachments.length) {\n      return done();\n    }\n\n    function processedAttachment(err) {\n      overallErr = err;\n      recv++;\n      if (recv === attachments.length) {\n        done();\n      }\n    }\n\n    for (var key in docInfo.data._attachments) {\n      if (docInfo.data._attachments.hasOwnProperty(key)) {\n        preprocessAttachment(docInfo.data._attachments[key],\n          blobType, processedAttachment);\n      }\n    }\n  });\n\n  function done() {\n    docv++;\n    if (docInfos.length === docv) {\n      if (overallErr) {\n        callback(overallErr);\n      } else {\n        callback();\n      }\n    }\n  }\n}\n\nfunction updateDoc(revLimit, prev, docInfo, results,\n                   i, cb, writeDoc, newEdits) {\n\n  if (revExists(prev.rev_tree, docInfo.metadata.rev) && !newEdits) {\n    results[i] = docInfo;\n    return cb();\n  }\n\n  // sometimes this is pre-calculated. historically not always\n  var previousWinningRev = prev.winningRev || winningRev(prev);\n  var previouslyDeleted = 'deleted' in prev ? prev.deleted :\n    isDeleted(prev, previousWinningRev);\n  var deleted = 'deleted' in docInfo.metadata ? docInfo.metadata.deleted :\n    isDeleted(docInfo.metadata);\n  var isRoot = /^1-/.test(docInfo.metadata.rev);\n\n  if (previouslyDeleted && !deleted && newEdits && isRoot) {\n    var newDoc = docInfo.data;\n    newDoc._rev = previousWinningRev;\n    newDoc._id = docInfo.metadata.id;\n    docInfo = parseDoc(newDoc, newEdits);\n  }\n\n  var merged = merge(prev.rev_tree, docInfo.metadata.rev_tree[0], revLimit);\n\n  var inConflict = newEdits && ((\n    (previouslyDeleted && deleted && merged.conflicts !== 'new_leaf') ||\n    (!previouslyDeleted && merged.conflicts !== 'new_leaf') ||\n    (previouslyDeleted && !deleted && merged.conflicts === 'new_branch')));\n\n  if (inConflict) {\n    var err = createError(REV_CONFLICT);\n    results[i] = err;\n    return cb();\n  }\n\n  var newRev = docInfo.metadata.rev;\n  docInfo.metadata.rev_tree = merged.tree;\n  docInfo.stemmedRevs = merged.stemmedRevs || [];\n  /* istanbul ignore else */\n  if (prev.rev_map) {\n    docInfo.metadata.rev_map = prev.rev_map; // used only by leveldb\n  }\n\n  // recalculate\n  var winningRev$$1 = winningRev(docInfo.metadata);\n  var winningRevIsDeleted = isDeleted(docInfo.metadata, winningRev$$1);\n\n  // calculate the total number of documents that were added/removed,\n  // from the perspective of total_rows/doc_count\n  var delta = (previouslyDeleted === winningRevIsDeleted) ? 0 :\n    previouslyDeleted < winningRevIsDeleted ? -1 : 1;\n\n  var newRevIsDeleted;\n  if (newRev === winningRev$$1) {\n    // if the new rev is the same as the winning rev, we can reuse that value\n    newRevIsDeleted = winningRevIsDeleted;\n  } else {\n    // if they're not the same, then we need to recalculate\n    newRevIsDeleted = isDeleted(docInfo.metadata, newRev);\n  }\n\n  writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n    true, delta, i, cb);\n}\n\nfunction rootIsMissing(docInfo) {\n  return docInfo.metadata.rev_tree[0].ids[1].status === 'missing';\n}\n\nfunction processDocs(revLimit, docInfos, api, fetchedDocs, tx, results,\n                     writeDoc, opts, overallCallback) {\n\n  // Default to 1000 locally\n  revLimit = revLimit || 1000;\n\n  function insertDoc(docInfo, resultsIdx, callback) {\n    // Cant insert new deleted documents\n    var winningRev$$1 = winningRev(docInfo.metadata);\n    var deleted = isDeleted(docInfo.metadata, winningRev$$1);\n    if ('was_delete' in opts && deleted) {\n      results[resultsIdx] = createError(MISSING_DOC, 'deleted');\n      return callback();\n    }\n\n    // 4712 - detect whether a new document was inserted with a _rev\n    var inConflict = newEdits && rootIsMissing(docInfo);\n\n    if (inConflict) {\n      var err = createError(REV_CONFLICT);\n      results[resultsIdx] = err;\n      return callback();\n    }\n\n    var delta = deleted ? 0 : 1;\n\n    writeDoc(docInfo, winningRev$$1, deleted, deleted, false,\n      delta, resultsIdx, callback);\n  }\n\n  var newEdits = opts.new_edits;\n  var idsToDocs = new ExportedMap();\n\n  var docsDone = 0;\n  var docsToDo = docInfos.length;\n\n  function checkAllDocsDone() {\n    if (++docsDone === docsToDo && overallCallback) {\n      overallCallback();\n    }\n  }\n\n  docInfos.forEach(function (currentDoc, resultsIdx) {\n\n    if (currentDoc._id && isLocalId(currentDoc._id)) {\n      var fun = currentDoc._deleted ? '_removeLocal' : '_putLocal';\n      api[fun](currentDoc, {ctx: tx}, function (err, res) {\n        results[resultsIdx] = err || res;\n        checkAllDocsDone();\n      });\n      return;\n    }\n\n    var id = currentDoc.metadata.id;\n    if (idsToDocs.has(id)) {\n      docsToDo--; // duplicate\n      idsToDocs.get(id).push([currentDoc, resultsIdx]);\n    } else {\n      idsToDocs.set(id, [[currentDoc, resultsIdx]]);\n    }\n  });\n\n  // in the case of new_edits, the user can provide multiple docs\n  // with the same id. these need to be processed sequentially\n  idsToDocs.forEach(function (docs, id) {\n    var numDone = 0;\n\n    function docWritten() {\n      if (++numDone < docs.length) {\n        nextDoc();\n      } else {\n        checkAllDocsDone();\n      }\n    }\n    function nextDoc() {\n      var value = docs[numDone];\n      var currentDoc = value[0];\n      var resultsIdx = value[1];\n\n      if (fetchedDocs.has(id)) {\n        updateDoc(revLimit, fetchedDocs.get(id), currentDoc, results,\n          resultsIdx, docWritten, writeDoc, newEdits);\n      } else {\n        // Ensure stemming applies to new writes as well\n        var merged = merge([], currentDoc.metadata.rev_tree[0], revLimit);\n        currentDoc.metadata.rev_tree = merged.tree;\n        currentDoc.stemmedRevs = merged.stemmedRevs || [];\n        insertDoc(currentDoc, resultsIdx, docWritten);\n      }\n    }\n    nextDoc();\n  });\n}\n\n// IndexedDB requires a versioned database structure, so we use the\n// version here to manage migrations.\nvar ADAPTER_VERSION = 5;\n\n// The object stores created for each database\n// DOC_STORE stores the document meta data, its revision history and state\n// Keyed by document id\nvar DOC_STORE = 'document-store';\n// BY_SEQ_STORE stores a particular version of a document, keyed by its\n// sequence id\nvar BY_SEQ_STORE = 'by-sequence';\n// Where we store attachments\nvar ATTACH_STORE = 'attach-store';\n// Where we store many-to-many relations\n// between attachment digests and seqs\nvar ATTACH_AND_SEQ_STORE = 'attach-seq-store';\n\n// Where we store database-wide meta data in a single record\n// keyed by id: META_STORE\nvar META_STORE = 'meta-store';\n// Where we store local documents\nvar LOCAL_STORE = 'local-store';\n// Where we detect blob support\nvar DETECT_BLOB_SUPPORT_STORE = 'detect-blob-support';\n\nfunction safeJsonParse(str) {\n  // This try/catch guards against stack overflow errors.\n  // JSON.parse() is faster than vuvuzela.parse() but vuvuzela\n  // cannot overflow.\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.parse(str);\n  }\n}\n\nfunction safeJsonStringify(json) {\n  try {\n    return JSON.stringify(json);\n  } catch (e) {\n    /* istanbul ignore next */\n    return vuvuzela.stringify(json);\n  }\n}\n\nfunction idbError(callback) {\n  return function (evt) {\n    var message = 'unknown_error';\n    if (evt.target && evt.target.error) {\n      message = evt.target.error.name || evt.target.error.message;\n    }\n    callback(createError(IDB_ERROR, message, evt.type));\n  };\n}\n\n// Unfortunately, the metadata has to be stringified\n// when it is put into the database, because otherwise\n// IndexedDB can throw errors for deeply-nested objects.\n// Originally we just used JSON.parse/JSON.stringify; now\n// we use this custom vuvuzela library that avoids recursion.\n// If we could do it all over again, we'd probably use a\n// format for the revision trees other than JSON.\nfunction encodeMetadata(metadata, winningRev, deleted) {\n  return {\n    data: safeJsonStringify(metadata),\n    winningRev: winningRev,\n    deletedOrLocal: deleted ? '1' : '0',\n    seq: metadata.seq, // highest seq for this doc\n    id: metadata.id\n  };\n}\n\nfunction decodeMetadata(storedObject) {\n  if (!storedObject) {\n    return null;\n  }\n  var metadata = safeJsonParse(storedObject.data);\n  metadata.winningRev = storedObject.winningRev;\n  metadata.deleted = storedObject.deletedOrLocal === '1';\n  metadata.seq = storedObject.seq;\n  return metadata;\n}\n\n// read the doc back out from the database. we don't store the\n// _id or _rev because we already have _doc_id_rev.\nfunction decodeDoc(doc) {\n  if (!doc) {\n    return doc;\n  }\n  var idx = doc._doc_id_rev.lastIndexOf(':');\n  doc._id = doc._doc_id_rev.substring(0, idx - 1);\n  doc._rev = doc._doc_id_rev.substring(idx + 1);\n  delete doc._doc_id_rev;\n  return doc;\n}\n\n// Read a blob from the database, encoding as necessary\n// and translating from base64 if the IDB doesn't support\n// native Blobs\nfunction readBlobData(body, type, asBlob, callback) {\n  if (asBlob) {\n    if (!body) {\n      callback(createBlob([''], {type: type}));\n    } else if (typeof body !== 'string') { // we have blob support\n      callback(body);\n    } else { // no blob support\n      callback(b64ToBluffer(body, type));\n    }\n  } else { // as base64 string\n    if (!body) {\n      callback('');\n    } else if (typeof body !== 'string') { // we have blob support\n      readAsBinaryString(body, function (binary) {\n        callback(thisBtoa(binary));\n      });\n    } else { // no blob support\n      callback(body);\n    }\n  }\n}\n\nfunction fetchAttachmentsIfNecessary(doc, opts, txn, cb) {\n  var attachments = Object.keys(doc._attachments || {});\n  if (!attachments.length) {\n    return cb && cb();\n  }\n  var numDone = 0;\n\n  function checkDone() {\n    if (++numDone === attachments.length && cb) {\n      cb();\n    }\n  }\n\n  function fetchAttachment(doc, att) {\n    var attObj = doc._attachments[att];\n    var digest = attObj.digest;\n    var req = txn.objectStore(ATTACH_STORE).get(digest);\n    req.onsuccess = function (e) {\n      attObj.body = e.target.result.body;\n      checkDone();\n    };\n  }\n\n  attachments.forEach(function (att) {\n    if (opts.attachments && opts.include_docs) {\n      fetchAttachment(doc, att);\n    } else {\n      doc._attachments[att].stub = true;\n      checkDone();\n    }\n  });\n}\n\n// IDB-specific postprocessing necessary because\n// we don't know whether we stored a true Blob or\n// a base64-encoded string, and if it's a Blob it\n// needs to be read outside of the transaction context\nfunction postProcessAttachments(results, asBlob) {\n  return Promise.all(results.map(function (row) {\n    if (row.doc && row.doc._attachments) {\n      var attNames = Object.keys(row.doc._attachments);\n      return Promise.all(attNames.map(function (att) {\n        var attObj = row.doc._attachments[att];\n        if (!('body' in attObj)) { // already processed\n          return;\n        }\n        var body = attObj.body;\n        var type = attObj.content_type;\n        return new Promise(function (resolve) {\n          readBlobData(body, type, asBlob, function (data) {\n            row.doc._attachments[att] = $inject_Object_assign(\n              pick(attObj, ['digest', 'content_type']),\n              {data: data}\n            );\n            resolve();\n          });\n        });\n      }));\n    }\n  }));\n}\n\nfunction compactRevs(revs, docId, txn) {\n\n  var possiblyOrphanedDigests = [];\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var attStore = txn.objectStore(ATTACH_STORE);\n  var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n  var count = revs.length;\n\n  function checkDone() {\n    count--;\n    if (!count) { // done processing all revs\n      deleteOrphanedAttachments();\n    }\n  }\n\n  function deleteOrphanedAttachments() {\n    if (!possiblyOrphanedDigests.length) {\n      return;\n    }\n    possiblyOrphanedDigests.forEach(function (digest) {\n      var countReq = attAndSeqStore.index('digestSeq').count(\n        IDBKeyRange.bound(\n          digest + '::', digest + '::\\uffff', false, false));\n      countReq.onsuccess = function (e) {\n        var count = e.target.result;\n        if (!count) {\n          // orphaned\n          attStore.delete(digest);\n        }\n      };\n    });\n  }\n\n  revs.forEach(function (rev) {\n    var index = seqStore.index('_doc_id_rev');\n    var key = docId + \"::\" + rev;\n    index.getKey(key).onsuccess = function (e) {\n      var seq = e.target.result;\n      if (typeof seq !== 'number') {\n        return checkDone();\n      }\n      seqStore.delete(seq);\n\n      var cursor = attAndSeqStore.index('seq')\n        .openCursor(IDBKeyRange.only(seq));\n\n      cursor.onsuccess = function (event) {\n        var cursor = event.target.result;\n        if (cursor) {\n          var digest = cursor.value.digestSeq.split('::')[0];\n          possiblyOrphanedDigests.push(digest);\n          attAndSeqStore.delete(cursor.primaryKey);\n          cursor.continue();\n        } else { // done\n          checkDone();\n        }\n      };\n    };\n  });\n}\n\nfunction openTransactionSafely(idb, stores, mode) {\n  try {\n    return {\n      txn: idb.transaction(stores, mode)\n    };\n  } catch (err) {\n    return {\n      error: err\n    };\n  }\n}\n\nvar changesHandler = new Changes();\n\nfunction idbBulkDocs(dbOpts, req, opts, api, idb, callback) {\n  var docInfos = req.docs;\n  var txn;\n  var docStore;\n  var bySeqStore;\n  var attachStore;\n  var attachAndSeqStore;\n  var metaStore;\n  var docInfoError;\n  var metaDoc;\n\n  for (var i = 0, len = docInfos.length; i < len; i++) {\n    var doc = docInfos[i];\n    if (doc._id && isLocalId(doc._id)) {\n      continue;\n    }\n    doc = docInfos[i] = parseDoc(doc, opts.new_edits, dbOpts);\n    if (doc.error && !docInfoError) {\n      docInfoError = doc;\n    }\n  }\n\n  if (docInfoError) {\n    return callback(docInfoError);\n  }\n\n  var allDocsProcessed = false;\n  var docCountDelta = 0;\n  var results = new Array(docInfos.length);\n  var fetchedDocs = new ExportedMap();\n  var preconditionErrored = false;\n  var blobType = api._meta.blobSupport ? 'blob' : 'base64';\n\n  preprocessAttachments(docInfos, blobType, function (err) {\n    if (err) {\n      return callback(err);\n    }\n    startTransaction();\n  });\n\n  function startTransaction() {\n\n    var stores = [\n      DOC_STORE, BY_SEQ_STORE,\n      ATTACH_STORE,\n      LOCAL_STORE, ATTACH_AND_SEQ_STORE,\n      META_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    txn = txnResult.txn;\n    txn.onabort = idbError(callback);\n    txn.ontimeout = idbError(callback);\n    txn.oncomplete = complete;\n    docStore = txn.objectStore(DOC_STORE);\n    bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    attachStore = txn.objectStore(ATTACH_STORE);\n    attachAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n    metaStore = txn.objectStore(META_STORE);\n\n    metaStore.get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result;\n      updateDocCountIfReady();\n    };\n\n    verifyAttachments(function (err) {\n      if (err) {\n        preconditionErrored = true;\n        return callback(err);\n      }\n      fetchExistingDocs();\n    });\n  }\n\n  function onAllDocsProcessed() {\n    allDocsProcessed = true;\n    updateDocCountIfReady();\n  }\n\n  function idbProcessDocs() {\n    processDocs(dbOpts.revs_limit, docInfos, api, fetchedDocs,\n                txn, results, writeDoc, opts, onAllDocsProcessed);\n  }\n\n  function updateDocCountIfReady() {\n    if (!metaDoc || !allDocsProcessed) {\n      return;\n    }\n    // caching the docCount saves a lot of time in allDocs() and\n    // info(), which is why we go to all the trouble of doing this\n    metaDoc.docCount += docCountDelta;\n    metaStore.put(metaDoc);\n  }\n\n  function fetchExistingDocs() {\n\n    if (!docInfos.length) {\n      return;\n    }\n\n    var numFetched = 0;\n\n    function checkDone() {\n      if (++numFetched === docInfos.length) {\n        idbProcessDocs();\n      }\n    }\n\n    function readMetadata(event) {\n      var metadata = decodeMetadata(event.target.result);\n\n      if (metadata) {\n        fetchedDocs.set(metadata.id, metadata);\n      }\n      checkDone();\n    }\n\n    for (var i = 0, len = docInfos.length; i < len; i++) {\n      var docInfo = docInfos[i];\n      if (docInfo._id && isLocalId(docInfo._id)) {\n        checkDone(); // skip local docs\n        continue;\n      }\n      var req = docStore.get(docInfo.metadata.id);\n      req.onsuccess = readMetadata;\n    }\n  }\n\n  function complete() {\n    if (preconditionErrored) {\n      return;\n    }\n\n    changesHandler.notify(api._meta.name);\n    callback(null, results);\n  }\n\n  function verifyAttachment(digest, callback) {\n\n    var req = attachStore.get(digest);\n    req.onsuccess = function (e) {\n      if (!e.target.result) {\n        var err = createError(MISSING_STUB,\n          'unknown stub attachment with digest ' +\n          digest);\n        err.status = 412;\n        callback(err);\n      } else {\n        callback();\n      }\n    };\n  }\n\n  function verifyAttachments(finish) {\n\n\n    var digests = [];\n    docInfos.forEach(function (docInfo) {\n      if (docInfo.data && docInfo.data._attachments) {\n        Object.keys(docInfo.data._attachments).forEach(function (filename) {\n          var att = docInfo.data._attachments[filename];\n          if (att.stub) {\n            digests.push(att.digest);\n          }\n        });\n      }\n    });\n    if (!digests.length) {\n      return finish();\n    }\n    var numDone = 0;\n    var err;\n\n    function checkDone() {\n      if (++numDone === digests.length) {\n        finish(err);\n      }\n    }\n    digests.forEach(function (digest) {\n      verifyAttachment(digest, function (attErr) {\n        if (attErr && !err) {\n          err = attErr;\n        }\n        checkDone();\n      });\n    });\n  }\n\n  function writeDoc(docInfo, winningRev$$1, winningRevIsDeleted, newRevIsDeleted,\n                    isUpdate, delta, resultsIdx, callback) {\n\n    docInfo.metadata.winningRev = winningRev$$1;\n    docInfo.metadata.deleted = winningRevIsDeleted;\n\n    var doc = docInfo.data;\n    doc._id = docInfo.metadata.id;\n    doc._rev = docInfo.metadata.rev;\n\n    if (newRevIsDeleted) {\n      doc._deleted = true;\n    }\n\n    var hasAttachments = doc._attachments &&\n      Object.keys(doc._attachments).length;\n    if (hasAttachments) {\n      return writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n        isUpdate, resultsIdx, callback);\n    }\n\n    docCountDelta += delta;\n    updateDocCountIfReady();\n\n    finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n      isUpdate, resultsIdx, callback);\n  }\n\n  function finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n                     isUpdate, resultsIdx, callback) {\n\n    var doc = docInfo.data;\n    var metadata = docInfo.metadata;\n\n    doc._doc_id_rev = metadata.id + '::' + metadata.rev;\n    delete doc._id;\n    delete doc._rev;\n\n    function afterPutDoc(e) {\n      var revsToDelete = docInfo.stemmedRevs || [];\n\n      if (isUpdate && api.auto_compaction) {\n        revsToDelete = revsToDelete.concat(compactTree(docInfo.metadata));\n      }\n\n      if (revsToDelete && revsToDelete.length) {\n        compactRevs(revsToDelete, docInfo.metadata.id, txn);\n      }\n\n      metadata.seq = e.target.result;\n      // Current _rev is calculated from _rev_tree on read\n      // delete metadata.rev;\n      var metadataToStore = encodeMetadata(metadata, winningRev$$1,\n        winningRevIsDeleted);\n      var metaDataReq = docStore.put(metadataToStore);\n      metaDataReq.onsuccess = afterPutMetadata;\n    }\n\n    function afterPutDocError(e) {\n      // ConstraintError, need to update, not put (see #1638 for details)\n      e.preventDefault(); // avoid transaction abort\n      e.stopPropagation(); // avoid transaction onerror\n      var index = bySeqStore.index('_doc_id_rev');\n      var getKeyReq = index.getKey(doc._doc_id_rev);\n      getKeyReq.onsuccess = function (e) {\n        var putReq = bySeqStore.put(doc, e.target.result);\n        putReq.onsuccess = afterPutDoc;\n      };\n    }\n\n    function afterPutMetadata() {\n      results[resultsIdx] = {\n        ok: true,\n        id: metadata.id,\n        rev: metadata.rev\n      };\n      fetchedDocs.set(docInfo.metadata.id, docInfo.metadata);\n      insertAttachmentMappings(docInfo, metadata.seq, callback);\n    }\n\n    var putReq = bySeqStore.put(doc);\n\n    putReq.onsuccess = afterPutDoc;\n    putReq.onerror = afterPutDocError;\n  }\n\n  function writeAttachments(docInfo, winningRev$$1, winningRevIsDeleted,\n                            isUpdate, resultsIdx, callback) {\n\n\n    var doc = docInfo.data;\n\n    var numDone = 0;\n    var attachments = Object.keys(doc._attachments);\n\n    function collectResults() {\n      if (numDone === attachments.length) {\n        finishDoc(docInfo, winningRev$$1, winningRevIsDeleted,\n          isUpdate, resultsIdx, callback);\n      }\n    }\n\n    function attachmentSaved() {\n      numDone++;\n      collectResults();\n    }\n\n    attachments.forEach(function (key) {\n      var att = docInfo.data._attachments[key];\n      if (!att.stub) {\n        var data = att.data;\n        delete att.data;\n        att.revpos = parseInt(winningRev$$1, 10);\n        var digest = att.digest;\n        saveAttachment(digest, data, attachmentSaved);\n      } else {\n        numDone++;\n        collectResults();\n      }\n    });\n  }\n\n  // map seqs to attachment digests, which\n  // we will need later during compaction\n  function insertAttachmentMappings(docInfo, seq, callback) {\n\n    var attsAdded = 0;\n    var attsToAdd = Object.keys(docInfo.data._attachments || {});\n\n    if (!attsToAdd.length) {\n      return callback();\n    }\n\n    function checkDone() {\n      if (++attsAdded === attsToAdd.length) {\n        callback();\n      }\n    }\n\n    function add(att) {\n      var digest = docInfo.data._attachments[att].digest;\n      var req = attachAndSeqStore.put({\n        seq: seq,\n        digestSeq: digest + '::' + seq\n      });\n\n      req.onsuccess = checkDone;\n      req.onerror = function (e) {\n        // this callback is for a constaint error, which we ignore\n        // because this docid/rev has already been associated with\n        // the digest (e.g. when new_edits == false)\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n        checkDone();\n      };\n    }\n    for (var i = 0; i < attsToAdd.length; i++) {\n      add(attsToAdd[i]); // do in parallel\n    }\n  }\n\n  function saveAttachment(digest, data, callback) {\n\n\n    var getKeyReq = attachStore.count(digest);\n    getKeyReq.onsuccess = function (e) {\n      var count = e.target.result;\n      if (count) {\n        return callback(); // already exists\n      }\n      var newAtt = {\n        digest: digest,\n        body: data\n      };\n      var putReq = attachStore.put(newAtt);\n      putReq.onsuccess = callback;\n    };\n  }\n}\n\n// Abstraction over IDBCursor and getAll()/getAllKeys() that allows us to batch our operations\n// while falling back to a normal IDBCursor operation on browsers that don't support getAll() or\n// getAllKeys(). This allows for a much faster implementation than just straight-up cursors, because\n// we're not processing each document one-at-a-time.\nfunction runBatchedCursor(objectStore, keyRange, descending, batchSize, onBatch) {\n\n  if (batchSize === -1) {\n    batchSize = 1000;\n  }\n\n  // Bail out of getAll()/getAllKeys() in the following cases:\n  // 1) either method is unsupported - we need both\n  // 2) batchSize is 1 (might as well use IDBCursor)\n  // 3) descending – no real way to do this via getAll()/getAllKeys()\n\n  var useGetAll = typeof objectStore.getAll === 'function' &&\n    typeof objectStore.getAllKeys === 'function' &&\n    batchSize > 1 && !descending;\n\n  var keysBatch;\n  var valuesBatch;\n  var pseudoCursor;\n\n  function onGetAll(e) {\n    valuesBatch = e.target.result;\n    if (keysBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function onGetAllKeys(e) {\n    keysBatch = e.target.result;\n    if (valuesBatch) {\n      onBatch(keysBatch, valuesBatch, pseudoCursor);\n    }\n  }\n\n  function continuePseudoCursor() {\n    if (!keysBatch.length) { // no more results\n      return onBatch();\n    }\n    // fetch next batch, exclusive start\n    var lastKey = keysBatch[keysBatch.length - 1];\n    var newKeyRange;\n    if (keyRange && keyRange.upper) {\n      try {\n        newKeyRange = IDBKeyRange.bound(lastKey, keyRange.upper,\n          true, keyRange.upperOpen);\n      } catch (e) {\n        if (e.name === \"DataError\" && e.code === 0) {\n          return onBatch(); // we're done, startkey and endkey are equal\n        }\n      }\n    } else {\n      newKeyRange = IDBKeyRange.lowerBound(lastKey, true);\n    }\n    keyRange = newKeyRange;\n    keysBatch = null;\n    valuesBatch = null;\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  }\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (!cursor) { // done\n      return onBatch();\n    }\n    // regular IDBCursor acts like a batch where batch size is always 1\n    onBatch([cursor.key], [cursor.value], cursor);\n  }\n\n  if (useGetAll) {\n    pseudoCursor = {\"continue\": continuePseudoCursor};\n    objectStore.getAll(keyRange, batchSize).onsuccess = onGetAll;\n    objectStore.getAllKeys(keyRange, batchSize).onsuccess = onGetAllKeys;\n  } else if (descending) {\n    objectStore.openCursor(keyRange, 'prev').onsuccess = onCursor;\n  } else {\n    objectStore.openCursor(keyRange).onsuccess = onCursor;\n  }\n}\n\n// simple shim for objectStore.getAll(), falling back to IDBCursor\nfunction getAll(objectStore, keyRange, onSuccess) {\n  if (typeof objectStore.getAll === 'function') {\n    // use native getAll\n    objectStore.getAll(keyRange).onsuccess = onSuccess;\n    return;\n  }\n  // fall back to cursors\n  var values = [];\n\n  function onCursor(e) {\n    var cursor = e.target.result;\n    if (cursor) {\n      values.push(cursor.value);\n      cursor.continue();\n    } else {\n      onSuccess({\n        target: {\n          result: values\n        }\n      });\n    }\n  }\n\n  objectStore.openCursor(keyRange).onsuccess = onCursor;\n}\n\nfunction allDocsKeys(keys, docStore, onBatch) {\n  // It's not guaranted to be returned in right order  \n  var valuesBatch = new Array(keys.length);\n  var count = 0;\n  keys.forEach(function (key, index) {\n    docStore.get(key).onsuccess = function (event) {\n      if (event.target.result) {\n        valuesBatch[index] = event.target.result;\n      } else {\n        valuesBatch[index] = {key: key, error: 'not_found'};\n      }\n      count++;\n      if (count === keys.length) {\n        onBatch(keys, valuesBatch, {});\n      }\n    };\n  });\n}\n\nfunction createKeyRange(start, end, inclusiveEnd, key, descending) {\n  try {\n    if (start && end) {\n      if (descending) {\n        return IDBKeyRange.bound(end, start, !inclusiveEnd, false);\n      } else {\n        return IDBKeyRange.bound(start, end, false, !inclusiveEnd);\n      }\n    } else if (start) {\n      if (descending) {\n        return IDBKeyRange.upperBound(start);\n      } else {\n        return IDBKeyRange.lowerBound(start);\n      }\n    } else if (end) {\n      if (descending) {\n        return IDBKeyRange.lowerBound(end, !inclusiveEnd);\n      } else {\n        return IDBKeyRange.upperBound(end, !inclusiveEnd);\n      }\n    } else if (key) {\n      return IDBKeyRange.only(key);\n    }\n  } catch (e) {\n    return {error: e};\n  }\n  return null;\n}\n\nfunction idbAllDocs(opts, idb, callback) {\n  var start = 'startkey' in opts ? opts.startkey : false;\n  var end = 'endkey' in opts ? opts.endkey : false;\n  var key = 'key' in opts ? opts.key : false;\n  var keys = 'keys' in opts ? opts.keys : false; \n  var skip = opts.skip || 0;\n  var limit = typeof opts.limit === 'number' ? opts.limit : -1;\n  var inclusiveEnd = opts.inclusive_end !== false;\n\n  var keyRange ; \n  var keyRangeError;\n  if (!keys) {\n    keyRange = createKeyRange(start, end, inclusiveEnd, key, opts.descending);\n    keyRangeError = keyRange && keyRange.error;\n    if (keyRangeError && \n      !(keyRangeError.name === \"DataError\" && keyRangeError.code === 0)) {\n      // DataError with error code 0 indicates start is less than end, so\n      // can just do an empty query. Else need to throw\n      return callback(createError(IDB_ERROR,\n        keyRangeError.name, keyRangeError.message));\n    }\n  }\n\n  var stores = [DOC_STORE, BY_SEQ_STORE, META_STORE];\n\n  if (opts.attachments) {\n    stores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, stores, 'readonly');\n  if (txnResult.error) {\n    return callback(txnResult.error);\n  }\n  var txn = txnResult.txn;\n  txn.oncomplete = onTxnComplete;\n  txn.onabort = idbError(callback);\n  var docStore = txn.objectStore(DOC_STORE);\n  var seqStore = txn.objectStore(BY_SEQ_STORE);\n  var metaStore = txn.objectStore(META_STORE);\n  var docIdRevIndex = seqStore.index('_doc_id_rev');\n  var results = [];\n  var docCount;\n  var updateSeq;\n\n  metaStore.get(META_STORE).onsuccess = function (e) {\n    docCount = e.target.result.docCount;\n  };\n\n  /* istanbul ignore if */\n  if (opts.update_seq) {\n    getMaxUpdateSeq(seqStore, function (e) { \n      if (e.target.result && e.target.result.length > 0) {\n        updateSeq = e.target.result[0];\n      }\n    });\n  }\n\n  function getMaxUpdateSeq(objectStore, onSuccess) {\n    function onCursor(e) {\n      var cursor = e.target.result;\n      var maxKey = undefined;\n      if (cursor && cursor.key) {\n        maxKey = cursor.key;\n      } \n      return onSuccess({\n        target: {\n          result: [maxKey]\n        }\n      });\n    }\n    objectStore.openCursor(null, 'prev').onsuccess = onCursor;\n  }\n\n  // if the user specifies include_docs=true, then we don't\n  // want to block the main cursor while we're fetching the doc\n  function fetchDocAsynchronously(metadata, row, winningRev$$1) {\n    var key = metadata.id + \"::\" + winningRev$$1;\n    docIdRevIndex.get(key).onsuccess =  function onGetDoc(e) {\n      row.doc = decodeDoc(e.target.result) || {};\n      if (opts.conflicts) {\n        var conflicts = collectConflicts(metadata);\n        if (conflicts.length) {\n          row.doc._conflicts = conflicts;\n        }\n      }\n      fetchAttachmentsIfNecessary(row.doc, opts, txn);\n    };\n  }\n\n  function allDocsInner(winningRev$$1, metadata) {\n    var row = {\n      id: metadata.id,\n      key: metadata.id,\n      value: {\n        rev: winningRev$$1\n      }\n    };\n    var deleted = metadata.deleted;\n    if (deleted) {\n      if (keys) {\n        results.push(row);\n        // deleted docs are okay with \"keys\" requests\n        row.value.deleted = true;\n        row.doc = null;\n      }\n    } else if (skip-- <= 0) {\n      results.push(row);\n      if (opts.include_docs) {\n        fetchDocAsynchronously(metadata, row, winningRev$$1);\n      }\n    }\n  }\n\n  function processBatch(batchValues) {\n    for (var i = 0, len = batchValues.length; i < len; i++) {\n      if (results.length === limit) {\n        break;\n      }\n      var batchValue = batchValues[i];\n      if (batchValue.error && keys) {\n        // key was not found with \"keys\" requests\n        results.push(batchValue);\n        continue;\n      }\n      var metadata = decodeMetadata(batchValue);\n      var winningRev$$1 = metadata.winningRev;\n      allDocsInner(winningRev$$1, metadata);\n    }\n  }\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor) {\n      return;\n    }\n    processBatch(batchValues);\n    if (results.length < limit) {\n      cursor.continue();\n    }\n  }\n\n  function onGetAll(e) {\n    var values = e.target.result;\n    if (opts.descending) {\n      values = values.reverse();\n    }\n    processBatch(values);\n  }\n\n  function onResultsReady() {\n    var returnVal = {\n      total_rows: docCount,\n      offset: opts.skip,\n      rows: results\n    };\n    \n    /* istanbul ignore if */\n    if (opts.update_seq && updateSeq !== undefined) {\n      returnVal.update_seq = updateSeq;\n    }\n    callback(null, returnVal);\n  }\n\n  function onTxnComplete() {\n    if (opts.attachments) {\n      postProcessAttachments(results, opts.binary).then(onResultsReady);\n    } else {\n      onResultsReady();\n    }\n  }\n\n  // don't bother doing any requests if start > end or limit === 0\n  if (keyRangeError || limit === 0) {\n    return;\n  }\n  if (keys) {\n    return allDocsKeys(opts.keys, docStore, onBatch);\n  }\n  if (limit === -1) { // just fetch everything\n    return getAll(docStore, keyRange, onGetAll);\n  }\n  // else do a cursor\n  // choose a batch size based on the skip, since we'll need to skip that many\n  runBatchedCursor(docStore, keyRange, opts.descending, limit + skip, onBatch);\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\nfunction checkBlobSupport(txn) {\n  return new Promise(function (resolve) {\n    var blob$$1 = createBlob(['']);\n    var req = txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob$$1, 'key');\n\n    req.onsuccess = function () {\n      var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n      var matchedEdge = navigator.userAgent.match(/Edge\\//);\n      // MS Edge pretends to be Chrome 42:\n      // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n      resolve(matchedEdge || !matchedChrome ||\n        parseInt(matchedChrome[1], 10) >= 43);\n    };\n\n    req.onerror = txn.onabort = function (e) {\n      // If the transaction aborts now its due to not being able to\n      // write to the database, likely due to the disk being full\n      e.preventDefault();\n      e.stopPropagation();\n      resolve(false);\n    };\n  }).catch(function () {\n    return false; // error, so assume unsupported\n  });\n}\n\nfunction countDocs(txn, cb) {\n  var index = txn.objectStore(DOC_STORE).index('deletedOrLocal');\n  index.count(IDBKeyRange.only('0')).onsuccess = function (e) {\n    cb(e.target.result);\n  };\n}\n\n// This task queue ensures that IDB open calls are done in their own tick\n\nvar running = false;\nvar queue = [];\n\nfunction tryCode(fun, err, res, PouchDB) {\n  try {\n    fun(err, res);\n  } catch (err) {\n    // Shouldn't happen, but in some odd cases\n    // IndexedDB implementations might throw a sync\n    // error, in which case this will at least log it.\n    PouchDB.emit('error', err);\n  }\n}\n\nfunction applyNext() {\n  if (running || !queue.length) {\n    return;\n  }\n  running = true;\n  queue.shift()();\n}\n\nfunction enqueueTask(action, callback, PouchDB) {\n  queue.push(function runAction() {\n    action(function runCallback(err, res) {\n      tryCode(callback, err, res, PouchDB);\n      running = false;\n      nextTick(function runNext() {\n        applyNext(PouchDB);\n      });\n    });\n  });\n  applyNext();\n}\n\nfunction changes(opts, api, dbName, idb) {\n  opts = clone(opts);\n\n  if (opts.continuous) {\n    var id = dbName + ':' + uuid();\n    changesHandler.addListener(dbName, id, api, opts);\n    changesHandler.notify(dbName);\n    return {\n      cancel: function () {\n        changesHandler.removeListener(dbName, id);\n      }\n    };\n  }\n\n  var docIds = opts.doc_ids && new ExportedSet(opts.doc_ids);\n\n  opts.since = opts.since || 0;\n  var lastSeq = opts.since;\n\n  var limit = 'limit' in opts ? opts.limit : -1;\n  if (limit === 0) {\n    limit = 1; // per CouchDB _changes spec\n  }\n\n  var results = [];\n  var numResults = 0;\n  var filter = filterChange(opts);\n  var docIdsToMetadata = new ExportedMap();\n\n  var txn;\n  var bySeqStore;\n  var docStore;\n  var docIdRevIndex;\n\n  function onBatch(batchKeys, batchValues, cursor) {\n    if (!cursor || !batchKeys.length) { // done\n      return;\n    }\n\n    var winningDocs = new Array(batchKeys.length);\n    var metadatas = new Array(batchKeys.length);\n\n    function processMetadataAndWinningDoc(metadata, winningDoc) {\n      var change = opts.processChange(winningDoc, metadata, opts);\n      lastSeq = change.seq = metadata.seq;\n\n      var filtered = filter(change);\n      if (typeof filtered === 'object') { // anything but true/false indicates error\n        return Promise.reject(filtered);\n      }\n\n      if (!filtered) {\n        return Promise.resolve();\n      }\n      numResults++;\n      if (opts.return_docs) {\n        results.push(change);\n      }\n      // process the attachment immediately\n      // for the benefit of live listeners\n      if (opts.attachments && opts.include_docs) {\n        return new Promise(function (resolve) {\n          fetchAttachmentsIfNecessary(winningDoc, opts, txn, function () {\n            postProcessAttachments([change], opts.binary).then(function () {\n              resolve(change);\n            });\n          });\n        });\n      } else {\n        return Promise.resolve(change);\n      }\n    }\n\n    function onBatchDone() {\n      var promises = [];\n      for (var i = 0, len = winningDocs.length; i < len; i++) {\n        if (numResults === limit) {\n          break;\n        }\n        var winningDoc = winningDocs[i];\n        if (!winningDoc) {\n          continue;\n        }\n        var metadata = metadatas[i];\n        promises.push(processMetadataAndWinningDoc(metadata, winningDoc));\n      }\n\n      Promise.all(promises).then(function (changes) {\n        for (var i = 0, len = changes.length; i < len; i++) {\n          if (changes[i]) {\n            opts.onChange(changes[i]);\n          }\n        }\n      }).catch(opts.complete);\n\n      if (numResults !== limit) {\n        cursor.continue();\n      }\n    }\n\n    // Fetch all metadatas/winningdocs from this batch in parallel, then process\n    // them all only once all data has been collected. This is done in parallel\n    // because it's faster than doing it one-at-a-time.\n    var numDone = 0;\n    batchValues.forEach(function (value, i) {\n      var doc = decodeDoc(value);\n      var seq = batchKeys[i];\n      fetchWinningDocAndMetadata(doc, seq, function (metadata, winningDoc) {\n        metadatas[i] = metadata;\n        winningDocs[i] = winningDoc;\n        if (++numDone === batchKeys.length) {\n          onBatchDone();\n        }\n      });\n    });\n  }\n\n  function onGetMetadata(doc, seq, metadata, cb) {\n    if (metadata.seq !== seq) {\n      // some other seq is later\n      return cb();\n    }\n\n    if (metadata.winningRev === doc._rev) {\n      // this is the winning doc\n      return cb(metadata, doc);\n    }\n\n    // fetch winning doc in separate request\n    var docIdRev = doc._id + '::' + metadata.winningRev;\n    var req = docIdRevIndex.get(docIdRev);\n    req.onsuccess = function (e) {\n      cb(metadata, decodeDoc(e.target.result));\n    };\n  }\n\n  function fetchWinningDocAndMetadata(doc, seq, cb) {\n    if (docIds && !docIds.has(doc._id)) {\n      return cb();\n    }\n\n    var metadata = docIdsToMetadata.get(doc._id);\n    if (metadata) { // cached\n      return onGetMetadata(doc, seq, metadata, cb);\n    }\n    // metadata not cached, have to go fetch it\n    docStore.get(doc._id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      docIdsToMetadata.set(doc._id, metadata);\n      onGetMetadata(doc, seq, metadata, cb);\n    };\n  }\n\n  function finish() {\n    opts.complete(null, {\n      results: results,\n      last_seq: lastSeq\n    });\n  }\n\n  function onTxnComplete() {\n    if (!opts.continuous && opts.attachments) {\n      // cannot guarantee that postProcessing was already done,\n      // so do it again\n      postProcessAttachments(results).then(finish);\n    } else {\n      finish();\n    }\n  }\n\n  var objectStores = [DOC_STORE, BY_SEQ_STORE];\n  if (opts.attachments) {\n    objectStores.push(ATTACH_STORE);\n  }\n  var txnResult = openTransactionSafely(idb, objectStores, 'readonly');\n  if (txnResult.error) {\n    return opts.complete(txnResult.error);\n  }\n  txn = txnResult.txn;\n  txn.onabort = idbError(opts.complete);\n  txn.oncomplete = onTxnComplete;\n\n  bySeqStore = txn.objectStore(BY_SEQ_STORE);\n  docStore = txn.objectStore(DOC_STORE);\n  docIdRevIndex = bySeqStore.index('_doc_id_rev');\n\n  var keyRange = (opts.since && !opts.descending) ?\n    IDBKeyRange.lowerBound(opts.since, true) : null;\n\n  runBatchedCursor(bySeqStore, keyRange, opts.descending, limit, onBatch);\n}\n\nvar cachedDBs = new ExportedMap();\nvar blobSupportPromise;\nvar openReqList = new ExportedMap();\n\nfunction IdbPouch(opts, callback) {\n  var api = this;\n\n  enqueueTask(function (thisCallback) {\n    init(api, opts, thisCallback);\n  }, callback, api.constructor);\n}\n\nfunction init(api, opts, callback) {\n\n  var dbName = opts.name;\n\n  var idb = null;\n  api._meta = null;\n\n  // called when creating a fresh new database\n  function createSchema(db) {\n    var docStore = db.createObjectStore(DOC_STORE, {keyPath : 'id'});\n    db.createObjectStore(BY_SEQ_STORE, {autoIncrement: true})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n    db.createObjectStore(ATTACH_STORE, {keyPath: 'digest'});\n    db.createObjectStore(META_STORE, {keyPath: 'id', autoIncrement: false});\n    db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n\n    // added in v2\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    // added in v3\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'});\n\n    // added in v4\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 2\n  // unfortunately \"deletedOrLocal\" is a misnomer now that we no longer\n  // store local docs in the main doc-store, but whaddyagonnado\n  function addDeletedOrLocalIndex(txn, callback) {\n    var docStore = txn.objectStore(DOC_STORE);\n    docStore.createIndex('deletedOrLocal', 'deletedOrLocal', {unique : false});\n\n    docStore.openCursor().onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var deleted = isDeleted(metadata);\n        metadata.deletedOrLocal = deleted ? \"1\" : \"0\";\n        docStore.put(metadata);\n        cursor.continue();\n      } else {\n        callback();\n      }\n    };\n  }\n\n  // migration to version 3 (part 1)\n  function createLocalStoreSchema(db) {\n    db.createObjectStore(LOCAL_STORE, {keyPath: '_id'})\n      .createIndex('_doc_id_rev', '_doc_id_rev', {unique: true});\n  }\n\n  // migration to version 3 (part 2)\n  function migrateLocalStore(txn, cb) {\n    var localStore = txn.objectStore(LOCAL_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (event) {\n      var cursor = event.target.result;\n      if (cursor) {\n        var metadata = cursor.value;\n        var docId = metadata.id;\n        var local = isLocalId(docId);\n        var rev = winningRev(metadata);\n        if (local) {\n          var docIdRev = docId + \"::\" + rev;\n          // remove all seq entries\n          // associated with this docId\n          var start = docId + \"::\";\n          var end = docId + \"::~\";\n          var index = seqStore.index('_doc_id_rev');\n          var range = IDBKeyRange.bound(start, end, false, false);\n          var seqCursor = index.openCursor(range);\n          seqCursor.onsuccess = function (e) {\n            seqCursor = e.target.result;\n            if (!seqCursor) {\n              // done\n              docStore.delete(cursor.primaryKey);\n              cursor.continue();\n            } else {\n              var data = seqCursor.value;\n              if (data._doc_id_rev === docIdRev) {\n                localStore.put(data);\n              }\n              seqStore.delete(seqCursor.primaryKey);\n              seqCursor.continue();\n            }\n          };\n        } else {\n          cursor.continue();\n        }\n      } else if (cb) {\n        cb();\n      }\n    };\n  }\n\n  // migration to version 4 (part 1)\n  function addAttachAndSeqStore(db) {\n    var attAndSeqStore = db.createObjectStore(ATTACH_AND_SEQ_STORE,\n      {autoIncrement: true});\n    attAndSeqStore.createIndex('seq', 'seq');\n    attAndSeqStore.createIndex('digestSeq', 'digestSeq', {unique: true});\n  }\n\n  // migration to version 4 (part 2)\n  function migrateAttsAndSeqs(txn, callback) {\n    var seqStore = txn.objectStore(BY_SEQ_STORE);\n    var attStore = txn.objectStore(ATTACH_STORE);\n    var attAndSeqStore = txn.objectStore(ATTACH_AND_SEQ_STORE);\n\n    // need to actually populate the table. this is the expensive part,\n    // so as an optimization, check first that this database even\n    // contains attachments\n    var req = attStore.count();\n    req.onsuccess = function (e) {\n      var count = e.target.result;\n      if (!count) {\n        return callback(); // done\n      }\n\n      seqStore.openCursor().onsuccess = function (e) {\n        var cursor = e.target.result;\n        if (!cursor) {\n          return callback(); // done\n        }\n        var doc = cursor.value;\n        var seq = cursor.primaryKey;\n        var atts = Object.keys(doc._attachments || {});\n        var digestMap = {};\n        for (var j = 0; j < atts.length; j++) {\n          var att = doc._attachments[atts[j]];\n          digestMap[att.digest] = true; // uniq digests, just in case\n        }\n        var digests = Object.keys(digestMap);\n        for (j = 0; j < digests.length; j++) {\n          var digest = digests[j];\n          attAndSeqStore.put({\n            seq: seq,\n            digestSeq: digest + '::' + seq\n          });\n        }\n        cursor.continue();\n      };\n    };\n  }\n\n  // migration to version 5\n  // Instead of relying on on-the-fly migration of metadata,\n  // this brings the doc-store to its modern form:\n  // - metadata.winningrev\n  // - metadata.seq\n  // - stringify the metadata when storing it\n  function migrateMetadata(txn) {\n\n    function decodeMetadataCompat(storedObject) {\n      if (!storedObject.data) {\n        // old format, when we didn't store it stringified\n        storedObject.deleted = storedObject.deletedOrLocal === '1';\n        return storedObject;\n      }\n      return decodeMetadata(storedObject);\n    }\n\n    // ensure that every metadata has a winningRev and seq,\n    // which was previously created on-the-fly but better to migrate\n    var bySeqStore = txn.objectStore(BY_SEQ_STORE);\n    var docStore = txn.objectStore(DOC_STORE);\n    var cursor = docStore.openCursor();\n    cursor.onsuccess = function (e) {\n      var cursor = e.target.result;\n      if (!cursor) {\n        return; // done\n      }\n      var metadata = decodeMetadataCompat(cursor.value);\n\n      metadata.winningRev = metadata.winningRev ||\n        winningRev(metadata);\n\n      function fetchMetadataSeq() {\n        // metadata.seq was added post-3.2.0, so if it's missing,\n        // we need to fetch it manually\n        var start = metadata.id + '::';\n        var end = metadata.id + '::\\uffff';\n        var req = bySeqStore.index('_doc_id_rev').openCursor(\n          IDBKeyRange.bound(start, end));\n\n        var metadataSeq = 0;\n        req.onsuccess = function (e) {\n          var cursor = e.target.result;\n          if (!cursor) {\n            metadata.seq = metadataSeq;\n            return onGetMetadataSeq();\n          }\n          var seq = cursor.primaryKey;\n          if (seq > metadataSeq) {\n            metadataSeq = seq;\n          }\n          cursor.continue();\n        };\n      }\n\n      function onGetMetadataSeq() {\n        var metadataToStore = encodeMetadata(metadata,\n          metadata.winningRev, metadata.deleted);\n\n        var req = docStore.put(metadataToStore);\n        req.onsuccess = function () {\n          cursor.continue();\n        };\n      }\n\n      if (metadata.seq) {\n        return onGetMetadataSeq();\n      }\n\n      fetchMetadataSeq();\n    };\n\n  }\n\n  api._remote = false;\n  api.type = function () {\n    return 'idb';\n  };\n\n  api._id = toPromise(function (callback) {\n    callback(null, api._meta.instanceId);\n  });\n\n  api._bulkDocs = function idb_bulkDocs(req, reqOpts, callback) {\n    idbBulkDocs(opts, req, reqOpts, api, idb, callback);\n  };\n\n  // First we look up the metadata in the ids database, then we fetch the\n  // current revision(s) from the by sequence store\n  api._get = function idb_get(id, opts, callback) {\n    var doc;\n    var metadata;\n    var err;\n    var txn = opts.ctx;\n    if (!txn) {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n\n    function finish() {\n      callback(err, {doc: doc, metadata: metadata, ctx: txn});\n    }\n\n    txn.objectStore(DOC_STORE).get(id).onsuccess = function (e) {\n      metadata = decodeMetadata(e.target.result);\n      // we can determine the result here if:\n      // 1. there is no such document\n      // 2. the document is deleted and we don't ask about specific rev\n      // When we ask with opts.rev we expect the answer to be either\n      // doc (possibly with _deleted=true) or missing error\n      if (!metadata) {\n        err = createError(MISSING_DOC, 'missing');\n        return finish();\n      }\n\n      var rev;\n      if (!opts.rev) {\n        rev = metadata.winningRev;\n        var deleted = isDeleted(metadata);\n        if (deleted) {\n          err = createError(MISSING_DOC, \"deleted\");\n          return finish();\n        }\n      } else {\n        rev = opts.latest ? latest(opts.rev, metadata) : opts.rev;\n      }\n\n      var objectStore = txn.objectStore(BY_SEQ_STORE);\n      var key = metadata.id + '::' + rev;\n\n      objectStore.index('_doc_id_rev').get(key).onsuccess = function (e) {\n        doc = e.target.result;\n        if (doc) {\n          doc = decodeDoc(doc);\n        }\n        if (!doc) {\n          err = createError(MISSING_DOC, 'missing');\n          return finish();\n        }\n        finish();\n      };\n    };\n  };\n\n  api._getAttachment = function (docId, attachId, attachment, opts, callback) {\n    var txn;\n    if (opts.ctx) {\n      txn = opts.ctx;\n    } else {\n      var txnResult = openTransactionSafely(idb,\n        [DOC_STORE, BY_SEQ_STORE, ATTACH_STORE], 'readonly');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      txn = txnResult.txn;\n    }\n    var digest = attachment.digest;\n    var type = attachment.content_type;\n\n    txn.objectStore(ATTACH_STORE).get(digest).onsuccess = function (e) {\n      var body = e.target.result.body;\n      readBlobData(body, type, opts.binary, function (blobData) {\n        callback(null, blobData);\n      });\n    };\n  };\n\n  api._info = function idb_info(callback) {\n    var updateSeq;\n    var docCount;\n\n    var txnResult = openTransactionSafely(idb, [META_STORE, BY_SEQ_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      docCount = e.target.result.docCount;\n    };\n    txn.objectStore(BY_SEQ_STORE).openCursor(null, 'prev').onsuccess = function (e) {\n      var cursor = e.target.result;\n      updateSeq = cursor ? cursor.key : 0;\n    };\n\n    txn.oncomplete = function () {\n      callback(null, {\n        doc_count: docCount,\n        update_seq: updateSeq,\n        // for debugging\n        idb_attachment_format: (api._meta.blobSupport ? 'binary' : 'base64')\n      });\n    };\n  };\n\n  api._allDocs = function idb_allDocs(opts, callback) {\n    idbAllDocs(opts, idb, callback);\n  };\n\n  api._changes = function idbChanges(opts) {\n    return changes(opts, api, dbName, idb);\n  };\n\n  api._close = function (callback) {\n    // https://developer.mozilla.org/en-US/docs/IndexedDB/IDBDatabase#close\n    // \"Returns immediately and closes the connection in a separate thread...\"\n    idb.close();\n    cachedDBs.delete(dbName);\n    callback();\n  };\n\n  api._getRevisionTree = function (docId, callback) {\n    var txnResult = openTransactionSafely(idb, [DOC_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n    var req = txn.objectStore(DOC_STORE).get(docId);\n    req.onsuccess = function (event) {\n      var doc = decodeMetadata(event.target.result);\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        callback(null, doc.rev_tree);\n      }\n    };\n  };\n\n  // This function removes revisions of document docId\n  // which are listed in revs and sets this document\n  // revision to to rev_tree\n  api._doCompaction = function (docId, revs, callback) {\n    var stores = [\n      DOC_STORE,\n      BY_SEQ_STORE,\n      ATTACH_STORE,\n      ATTACH_AND_SEQ_STORE\n    ];\n    var txnResult = openTransactionSafely(idb, stores, 'readwrite');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var txn = txnResult.txn;\n\n    var docStore = txn.objectStore(DOC_STORE);\n\n    docStore.get(docId).onsuccess = function (event) {\n      var metadata = decodeMetadata(event.target.result);\n      traverseRevTree(metadata.rev_tree, function (isLeaf, pos,\n                                                         revHash, ctx, opts) {\n        var rev = pos + '-' + revHash;\n        if (revs.indexOf(rev) !== -1) {\n          opts.status = 'missing';\n        }\n      });\n      compactRevs(revs, docId, txn);\n      var winningRev$$1 = metadata.winningRev;\n      var deleted = metadata.deleted;\n      txn.objectStore(DOC_STORE).put(\n        encodeMetadata(metadata, winningRev$$1, deleted));\n    };\n    txn.onabort = idbError(callback);\n    txn.oncomplete = function () {\n      callback();\n    };\n  };\n\n\n  api._getLocal = function (id, callback) {\n    var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readonly');\n    if (txnResult.error) {\n      return callback(txnResult.error);\n    }\n    var tx = txnResult.txn;\n    var req = tx.objectStore(LOCAL_STORE).get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var doc = e.target.result;\n      if (!doc) {\n        callback(createError(MISSING_DOC));\n      } else {\n        delete doc['_doc_id_rev']; // for backwards compat\n        callback(null, doc);\n      }\n    };\n  };\n\n  api._putLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    delete doc._revisions; // ignore this, trust the rev\n    var oldRev = doc._rev;\n    var id = doc._id;\n    if (!oldRev) {\n      doc._rev = '0-1';\n    } else {\n      doc._rev = '0-' + (parseInt(oldRev.split('-')[1], 10) + 1);\n    }\n\n    var tx = opts.ctx;\n    var ret;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.onerror = idbError(callback);\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req;\n    if (oldRev) {\n      req = oStore.get(id);\n      req.onsuccess = function (e) {\n        var oldDoc = e.target.result;\n        if (!oldDoc || oldDoc._rev !== oldRev) {\n          callback(createError(REV_CONFLICT));\n        } else { // update\n          var req = oStore.put(doc);\n          req.onsuccess = function () {\n            ret = {ok: true, id: doc._id, rev: doc._rev};\n            if (opts.ctx) { // return immediately\n              callback(null, ret);\n            }\n          };\n        }\n      };\n    } else { // new doc\n      req = oStore.add(doc);\n      req.onerror = function (e) {\n        // constraint error, already exists\n        callback(createError(REV_CONFLICT));\n        e.preventDefault(); // avoid transaction abort\n        e.stopPropagation(); // avoid transaction onerror\n      };\n      req.onsuccess = function () {\n        ret = {ok: true, id: doc._id, rev: doc._rev};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      };\n    }\n  };\n\n  api._removeLocal = function (doc, opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var tx = opts.ctx;\n    if (!tx) {\n      var txnResult = openTransactionSafely(idb, [LOCAL_STORE], 'readwrite');\n      if (txnResult.error) {\n        return callback(txnResult.error);\n      }\n      tx = txnResult.txn;\n      tx.oncomplete = function () {\n        if (ret) {\n          callback(null, ret);\n        }\n      };\n    }\n    var ret;\n    var id = doc._id;\n    var oStore = tx.objectStore(LOCAL_STORE);\n    var req = oStore.get(id);\n\n    req.onerror = idbError(callback);\n    req.onsuccess = function (e) {\n      var oldDoc = e.target.result;\n      if (!oldDoc || oldDoc._rev !== doc._rev) {\n        callback(createError(MISSING_DOC));\n      } else {\n        oStore.delete(id);\n        ret = {ok: true, id: id, rev: '0-0'};\n        if (opts.ctx) { // return immediately\n          callback(null, ret);\n        }\n      }\n    };\n  };\n\n  api._destroy = function (opts, callback) {\n    changesHandler.removeAllListeners(dbName);\n\n    //Close open request for \"dbName\" database to fix ie delay.\n    var openReq = openReqList.get(dbName);\n    if (openReq && openReq.result) {\n      openReq.result.close();\n      cachedDBs.delete(dbName);\n    }\n    var req = indexedDB.deleteDatabase(dbName);\n\n    req.onsuccess = function () {\n      //Remove open request from the list.\n      openReqList.delete(dbName);\n      if (hasLocalStorage() && (dbName in localStorage)) {\n        delete localStorage[dbName];\n      }\n      callback(null, { 'ok': true });\n    };\n\n    req.onerror = idbError(callback);\n  };\n\n  var cached = cachedDBs.get(dbName);\n\n  if (cached) {\n    idb = cached.idb;\n    api._meta = cached.global;\n    return nextTick(function () {\n      callback(null, api);\n    });\n  }\n\n  var req = indexedDB.open(dbName, ADAPTER_VERSION);\n  openReqList.set(dbName, req);\n\n  req.onupgradeneeded = function (e) {\n    var db = e.target.result;\n    if (e.oldVersion < 1) {\n      return createSchema(db); // new db, initial schema\n    }\n    // do migrations\n\n    var txn = e.currentTarget.transaction;\n    // these migrations have to be done in this function, before\n    // control is returned to the event loop, because IndexedDB\n\n    if (e.oldVersion < 3) {\n      createLocalStoreSchema(db); // v2 -> v3\n    }\n    if (e.oldVersion < 4) {\n      addAttachAndSeqStore(db); // v3 -> v4\n    }\n\n    var migrations = [\n      addDeletedOrLocalIndex, // v1 -> v2\n      migrateLocalStore,      // v2 -> v3\n      migrateAttsAndSeqs,     // v3 -> v4\n      migrateMetadata         // v4 -> v5\n    ];\n\n    var i = e.oldVersion;\n\n    function next() {\n      var migration = migrations[i - 1];\n      i++;\n      if (migration) {\n        migration(txn, next);\n      }\n    }\n\n    next();\n  };\n\n  req.onsuccess = function (e) {\n\n    idb = e.target.result;\n\n    idb.onversionchange = function () {\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    idb.onabort = function (e) {\n      guardedConsole('error', 'Database has a global failure', e.target.error);\n      idb.close();\n      cachedDBs.delete(dbName);\n    };\n\n    // Do a few setup operations (in parallel as much as possible):\n    // 1. Fetch meta doc\n    // 2. Check blob support\n    // 3. Calculate docCount\n    // 4. Generate an instanceId if necessary\n    // 5. Store docCount and instanceId on meta doc\n\n    var txn = idb.transaction([\n      META_STORE,\n      DETECT_BLOB_SUPPORT_STORE,\n      DOC_STORE\n    ], 'readwrite');\n\n    var storedMetaDoc = false;\n    var metaDoc;\n    var docCount;\n    var blobSupport;\n    var instanceId;\n\n    function completeSetup() {\n      if (typeof blobSupport === 'undefined' || !storedMetaDoc) {\n        return;\n      }\n      api._meta = {\n        name: dbName,\n        instanceId: instanceId,\n        blobSupport: blobSupport\n      };\n\n      cachedDBs.set(dbName, {\n        idb: idb,\n        global: api._meta\n      });\n      callback(null, api);\n    }\n\n    function storeMetaDocIfReady() {\n      if (typeof docCount === 'undefined' || typeof metaDoc === 'undefined') {\n        return;\n      }\n      var instanceKey = dbName + '_id';\n      if (instanceKey in metaDoc) {\n        instanceId = metaDoc[instanceKey];\n      } else {\n        metaDoc[instanceKey] = instanceId = uuid();\n      }\n      metaDoc.docCount = docCount;\n      txn.objectStore(META_STORE).put(metaDoc);\n    }\n\n    //\n    // fetch or generate the instanceId\n    //\n    txn.objectStore(META_STORE).get(META_STORE).onsuccess = function (e) {\n      metaDoc = e.target.result || { id: META_STORE };\n      storeMetaDocIfReady();\n    };\n\n    //\n    // countDocs\n    //\n    countDocs(txn, function (count) {\n      docCount = count;\n      storeMetaDocIfReady();\n    });\n\n    //\n    // check blob support\n    //\n    if (!blobSupportPromise) {\n      // make sure blob support is only checked once\n      blobSupportPromise = checkBlobSupport(txn);\n    }\n\n    blobSupportPromise.then(function (val) {\n      blobSupport = val;\n      completeSetup();\n    });\n\n    // only when the metadata put transaction has completed,\n    // consider the setup done\n    txn.oncomplete = function () {\n      storedMetaDoc = true;\n      completeSetup();\n    };\n    txn.onabort = idbError(callback);\n  };\n\n  req.onerror = function () {\n    var msg = 'Failed to open indexedDB, are you in private browsing mode?';\n    guardedConsole('error', msg);\n    callback(createError(IDB_ERROR, msg));\n  };\n}\n\nIdbPouch.valid = function () {\n  // Following #7085 buggy idb versions (typically Safari < 10.1) are\n  // considered valid.\n\n  // On Firefox SecurityError is thrown while referencing indexedDB if cookies\n  // are not allowed. `typeof indexedDB` also triggers the error.\n  try {\n    // some outdated implementations of IDB that appear on Samsung\n    // and HTC Android devices <4.4 are missing IDBKeyRange\n    return typeof indexedDB !== 'undefined' && typeof IDBKeyRange !== 'undefined';\n  } catch (e) {\n    return false;\n  }\n};\n\nfunction IDBPouch (PouchDB) {\n  PouchDB.adapter('idb', IdbPouch, true);\n}\n\n// dead simple promise pool, inspired by https://github.com/timdp/es6-promise-pool\n// but much smaller in code size. limits the number of concurrent promises that are executed\n\n\nfunction pool(promiseFactories, limit) {\n  return new Promise(function (resolve, reject) {\n    var running = 0;\n    var current = 0;\n    var done = 0;\n    var len = promiseFactories.length;\n    var err;\n\n    function runNext() {\n      running++;\n      promiseFactories[current++]().then(onSuccess, onError);\n    }\n\n    function doNext() {\n      if (++done === len) {\n        /* istanbul ignore if */\n        if (err) {\n          reject(err);\n        } else {\n          resolve();\n        }\n      } else {\n        runNextBatch();\n      }\n    }\n\n    function onSuccess() {\n      running--;\n      doNext();\n    }\n\n    /* istanbul ignore next */\n    function onError(thisErr) {\n      running--;\n      err = err || thisErr;\n      doNext();\n    }\n\n    function runNextBatch() {\n      while (running < limit && current < len) {\n        runNext();\n      }\n    }\n\n    runNextBatch();\n  });\n}\n\nvar CHANGES_BATCH_SIZE = 25;\nvar MAX_SIMULTANEOUS_REVS = 50;\nvar CHANGES_TIMEOUT_BUFFER = 5000;\nvar DEFAULT_HEARTBEAT = 10000;\n\nvar supportsBulkGetMap = {};\n\nfunction readAttachmentsAsBlobOrBuffer(row) {\n  var doc = row.doc || row.ok;\n  var atts = doc._attachments;\n  if (!atts) {\n    return;\n  }\n  Object.keys(atts).forEach(function (filename) {\n    var att = atts[filename];\n    att.data = b64ToBluffer(att.data, att.content_type);\n  });\n}\n\nfunction encodeDocId(id) {\n  if (/^_design/.test(id)) {\n    return '_design/' + encodeURIComponent(id.slice(8));\n  }\n  if (/^_local/.test(id)) {\n    return '_local/' + encodeURIComponent(id.slice(7));\n  }\n  return encodeURIComponent(id);\n}\n\nfunction preprocessAttachments$1(doc) {\n  if (!doc._attachments || !Object.keys(doc._attachments)) {\n    return Promise.resolve();\n  }\n\n  return Promise.all(Object.keys(doc._attachments).map(function (key) {\n    var attachment = doc._attachments[key];\n    if (attachment.data && typeof attachment.data !== 'string') {\n      return new Promise(function (resolve) {\n        blobToBase64(attachment.data, resolve);\n      }).then(function (b64) {\n        attachment.data = b64;\n      });\n    }\n  }));\n}\n\nfunction hasUrlPrefix(opts) {\n  if (!opts.prefix) {\n    return false;\n  }\n  var protocol = parseUri(opts.prefix).protocol;\n  return protocol === 'http' || protocol === 'https';\n}\n\n// Get all the information you possibly can about the URI given by name and\n// return it as a suitable object.\nfunction getHost(name, opts) {\n  // encode db name if opts.prefix is a url (#5574)\n  if (hasUrlPrefix(opts)) {\n    var dbName = opts.name.substr(opts.prefix.length);\n    // Ensure prefix has a trailing slash\n    var prefix = opts.prefix.replace(/\\/?$/, '/');\n    name = prefix + encodeURIComponent(dbName);\n  }\n\n  var uri = parseUri(name);\n  if (uri.user || uri.password) {\n    uri.auth = {username: uri.user, password: uri.password};\n  }\n\n  // Split the path part of the URI into parts using '/' as the delimiter\n  // after removing any leading '/' and any trailing '/'\n  var parts = uri.path.replace(/(^\\/|\\/$)/g, '').split('/');\n\n  uri.db = parts.pop();\n  // Prevent double encoding of URI component\n  if (uri.db.indexOf('%') === -1) {\n    uri.db = encodeURIComponent(uri.db);\n  }\n\n  uri.path = parts.join('/');\n\n  return uri;\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genDBUrl(opts, path) {\n  return genUrl(opts, opts.db + '/' + path);\n}\n\n// Generate a URL with the host data given by opts and the given path\nfunction genUrl(opts, path) {\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  var pathDel = !opts.path ? '' : '/';\n\n  // If the host already has a path, then we need to have a path delimiter\n  // Otherwise, the path delimiter is the empty string\n  return opts.protocol + '://' + opts.host +\n         (opts.port ? (':' + opts.port) : '') +\n         '/' + opts.path + pathDel + path;\n}\n\nfunction paramsToStr(params) {\n  return '?' + Object.keys(params).map(function (k) {\n    return k + '=' + encodeURIComponent(params[k]);\n  }).join('&');\n}\n\nfunction shouldCacheBust(opts) {\n  var ua = (typeof navigator !== 'undefined' && navigator.userAgent) ?\n      navigator.userAgent.toLowerCase() : '';\n  var isIE = ua.indexOf('msie') !== -1;\n  var isTrident = ua.indexOf('trident') !== -1;\n  var isEdge = ua.indexOf('edge') !== -1;\n  var isGET = !('method' in opts) || opts.method === 'GET';\n  return (isIE || isTrident || isEdge) && isGET;\n}\n\n// Implements the PouchDB API for dealing with CouchDB instances over HTTP\nfunction HttpPouch(opts, callback) {\n\n  // The functions that will be publicly available for HttpPouch\n  var api = this;\n\n  var host = getHost(opts.name, opts);\n  var dbUrl = genDBUrl(host, '');\n\n  opts = clone(opts);\n\n  var ourFetch = function (url, options) {\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (opts.auth || host.auth) {\n      var nAuth = opts.auth || host.auth;\n      var str = nAuth.username + ':' + nAuth.password;\n      var token = thisBtoa(unescape(encodeURIComponent(str)));\n      options.headers.set('Authorization', 'Basic ' + token);\n    }\n\n    var headers = opts.headers || {};\n    Object.keys(headers).forEach(function (key) {\n      options.headers.append(key, headers[key]);\n    });\n\n    /* istanbul ignore if */\n    if (shouldCacheBust(options)) {\n      url += (url.indexOf('?') === -1 ? '?' : '&') + '_nonce=' + Date.now();\n    }\n\n    var fetchFun = opts.fetch || f$1;\n    return fetchFun(url, options);\n  };\n\n  function adapterFun$$1(name, fun) {\n    return adapterFun(name, getArguments(function (args) {\n      setup().then(function () {\n        return fun.apply(this, args);\n      }).catch(function (e) {\n        var callback = args.pop();\n        callback(e);\n      });\n    })).bind(api);\n  }\n\n  function fetchJSON(url, options, callback) {\n\n    var result = {};\n\n    options = options || {};\n    options.headers = options.headers || new h();\n\n    if (!options.headers.get('Content-Type')) {\n      options.headers.set('Content-Type', 'application/json');\n    }\n    if (!options.headers.get('Accept')) {\n      options.headers.set('Accept', 'application/json');\n    }\n\n    return ourFetch(url, options).then(function (response) {\n      result.ok = response.ok;\n      result.status = response.status;\n      return response.json();\n    }).then(function (json) {\n      result.data = json;\n      if (!result.ok) {\n        result.data.status = result.status;\n        var err = generateErrorFromResponse(result.data);\n        if (callback) {\n          return callback(err);\n        } else {\n          throw err;\n        }\n      }\n\n      if (Array.isArray(result.data)) {\n        result.data = result.data.map(function (v) {\n          if (v.error || v.missing) {\n            return generateErrorFromResponse(v);\n          } else {\n            return v;\n          }\n        });\n      }\n\n      if (callback) {\n        callback(null, result.data);\n      } else {\n        return result;\n      }\n    });\n  }\n\n  var setupPromise;\n\n  function setup() {\n    if (opts.skip_setup) {\n      return Promise.resolve();\n    }\n\n    // If there is a setup in process or previous successful setup\n    // done then we will use that\n    // If previous setups have been rejected we will try again\n    if (setupPromise) {\n      return setupPromise;\n    }\n\n    setupPromise = fetchJSON(dbUrl).catch(function (err) {\n      if (err && err.status && err.status === 404) {\n        // Doesnt exist, create it\n        explainError(404, 'PouchDB is just detecting if the remote exists.');\n        return fetchJSON(dbUrl, {method: 'PUT'});\n      } else {\n        return Promise.reject(err);\n      }\n    }).catch(function (err) {\n      // If we try to create a database that already exists, skipped in\n      // istanbul since its catching a race condition.\n      /* istanbul ignore if */\n      if (err && err.status && err.status === 412) {\n        return true;\n      }\n      return Promise.reject(err);\n    });\n\n    setupPromise.catch(function () {\n      setupPromise = null;\n    });\n\n    return setupPromise;\n  }\n\n  nextTick(function () {\n    callback(null, api);\n  });\n\n  api._remote = true;\n\n  /* istanbul ignore next */\n  api.type = function () {\n    return 'http';\n  };\n\n  api.id = adapterFun$$1('id', function (callback) {\n    ourFetch(genUrl(host, '')).then(function (response) {\n      return response.json();\n    }).then(function (result) {\n      var uuid$$1 = (result && result.uuid) ?\n          (result.uuid + host.db) : genDBUrl(host, '');\n      callback(null, uuid$$1);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Sends a POST request to the host calling the couchdb _compact function\n  //    version: The version of CouchDB it is running\n  api.compact = adapterFun$$1('compact', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    fetchJSON(genDBUrl(host, '_compact'), {method: 'POST'}).then(function () {\n      function ping() {\n        api.info(function (err, res) {\n          // CouchDB may send a \"compact_running:true\" if it's\n          // already compacting. PouchDB Server doesn't.\n          /* istanbul ignore else */\n          if (res && !res.compact_running) {\n            callback(null, {ok: true});\n          } else {\n            setTimeout(ping, opts.interval || 200);\n          }\n        });\n      }\n      // Ping the http if it's finished compaction\n      ping();\n    });\n  });\n\n  api.bulkGet = adapterFun('bulkGet', function (opts, callback) {\n    var self = this;\n\n    function doBulkGet(cb) {\n      var params = {};\n      if (opts.revs) {\n        params.revs = true;\n      }\n      if (opts.attachments) {\n        /* istanbul ignore next */\n        params.attachments = true;\n      }\n      if (opts.latest) {\n        params.latest = true;\n      }\n      fetchJSON(genDBUrl(host, '_bulk_get' + paramsToStr(params)), {\n        method: 'POST',\n        body: JSON.stringify({ docs: opts.docs})\n      }).then(function (result) {\n        if (opts.attachments && opts.binary) {\n          result.data.results.forEach(function (res) {\n            res.docs.forEach(readAttachmentsAsBlobOrBuffer);\n          });\n        }\n        cb(null, result.data);\n      }).catch(cb);\n    }\n\n    /* istanbul ignore next */\n    function doBulkGetShim() {\n      // avoid \"url too long error\" by splitting up into multiple requests\n      var batchSize = MAX_SIMULTANEOUS_REVS;\n      var numBatches = Math.ceil(opts.docs.length / batchSize);\n      var numDone = 0;\n      var results = new Array(numBatches);\n\n      function onResult(batchNum) {\n        return function (err, res) {\n          // err is impossible because shim returns a list of errs in that case\n          results[batchNum] = res.results;\n          if (++numDone === numBatches) {\n            callback(null, {results: flatten(results)});\n          }\n        };\n      }\n\n      for (var i = 0; i < numBatches; i++) {\n        var subOpts = pick(opts, ['revs', 'attachments', 'binary', 'latest']);\n        subOpts.docs = opts.docs.slice(i * batchSize,\n          Math.min(opts.docs.length, (i + 1) * batchSize));\n        bulkGet(self, subOpts, onResult(i));\n      }\n    }\n\n    // mark the whole database as either supporting or not supporting _bulk_get\n    var dbUrl = genUrl(host, '');\n    var supportsBulkGet = supportsBulkGetMap[dbUrl];\n\n    /* istanbul ignore next */\n    if (typeof supportsBulkGet !== 'boolean') {\n      // check if this database supports _bulk_get\n      doBulkGet(function (err, res) {\n        if (err) {\n          supportsBulkGetMap[dbUrl] = false;\n          explainError(\n            err.status,\n            'PouchDB is just detecting if the remote ' +\n            'supports the _bulk_get API.'\n          );\n          doBulkGetShim();\n        } else {\n          supportsBulkGetMap[dbUrl] = true;\n          callback(null, res);\n        }\n      });\n    } else if (supportsBulkGet) {\n      doBulkGet(callback);\n    } else {\n      doBulkGetShim();\n    }\n  });\n\n  // Calls GET on the host, which gets back a JSON string containing\n  //    couchdb: A welcome string\n  //    version: The version of CouchDB it is running\n  api._info = function (callback) {\n    setup().then(function () {\n      return ourFetch(genDBUrl(host, ''));\n    }).then(function (response) {\n      return response.json();\n    }).then(function (info) {\n      info.host = genDBUrl(host, '');\n      callback(null, info);\n    }).catch(callback);\n  };\n\n  api.fetch = function (path, options) {\n    return setup().then(function () {\n      return ourFetch(genDBUrl(host, path), options);\n    });\n  };\n\n  // Get the document with the given id from the database given by host.\n  // The id could be solely the _id in the database, or it may be a\n  // _design/ID or _local/ID path\n  api.get = adapterFun$$1('get', function (id, opts, callback) {\n    // If no options were given, set the callback to the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n\n    if (opts.revs) {\n      params.revs = true;\n    }\n\n    if (opts.revs_info) {\n      params.revs_info = true;\n    }\n\n    if (opts.latest) {\n      params.latest = true;\n    }\n\n    if (opts.open_revs) {\n      if (opts.open_revs !== \"all\") {\n        opts.open_revs = JSON.stringify(opts.open_revs);\n      }\n      params.open_revs = opts.open_revs;\n    }\n\n    if (opts.rev) {\n      params.rev = opts.rev;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = opts.conflicts;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = opts.update_seq;\n    }\n\n    id = encodeDocId(id);\n\n    function fetchAttachments(doc) {\n      var atts = doc._attachments;\n      var filenames = atts && Object.keys(atts);\n      if (!atts || !filenames.length) {\n        return;\n      }\n      // we fetch these manually in separate XHRs, because\n      // Sync Gateway would normally send it back as multipart/mixed,\n      // which we cannot parse. Also, this is more efficient than\n      // receiving attachments as base64-encoded strings.\n      function fetchData(filename) {\n        var att = atts[filename];\n        var path = encodeDocId(doc._id) + '/' + encodeAttachmentId(filename) +\n            '?rev=' + doc._rev;\n        return ourFetch(genDBUrl(host, path)).then(function (response) {\n          if (typeof process !== 'undefined' && !process.browser) {\n            return response.buffer();\n          } else {\n            /* istanbul ignore next */\n            return response.blob();\n          }\n        }).then(function (blob) {\n          if (opts.binary) {\n            // TODO: Can we remove this?\n            if (typeof process !== 'undefined' && !process.browser) {\n              blob.type = att.content_type;\n            }\n            return blob;\n          }\n          return new Promise(function (resolve) {\n            blobToBase64(blob, resolve);\n          });\n        }).then(function (data) {\n          delete att.stub;\n          delete att.length;\n          att.data = data;\n        });\n      }\n\n      var promiseFactories = filenames.map(function (filename) {\n        return function () {\n          return fetchData(filename);\n        };\n      });\n\n      // This limits the number of parallel xhr requests to 5 any time\n      // to avoid issues with maximum browser request limits\n      return pool(promiseFactories, 5);\n    }\n\n    function fetchAllAttachments(docOrDocs) {\n      if (Array.isArray(docOrDocs)) {\n        return Promise.all(docOrDocs.map(function (doc) {\n          if (doc.ok) {\n            return fetchAttachments(doc.ok);\n          }\n        }));\n      }\n      return fetchAttachments(docOrDocs);\n    }\n\n    var url = genDBUrl(host, id + paramsToStr(params));\n    fetchJSON(url).then(function (res) {\n      return Promise.resolve().then(function () {\n        if (opts.attachments) {\n          return fetchAllAttachments(res.data);\n        }\n      }).then(function () {\n        callback(null, res.data);\n      });\n    }).catch(function (e) {\n      e.docId = id;\n      callback(e);\n    });\n  });\n\n\n  // Delete the document given by doc from the database given by host.\n  api.remove = adapterFun$$1('remove', function (docOrId, optsOrRev, opts, cb) {\n    var doc;\n    if (typeof optsOrRev === 'string') {\n      // id, rev, opts, callback style\n      doc = {\n        _id: docOrId,\n        _rev: optsOrRev\n      };\n      if (typeof opts === 'function') {\n        cb = opts;\n        opts = {};\n      }\n    } else {\n      // doc, opts, callback style\n      doc = docOrId;\n      if (typeof optsOrRev === 'function') {\n        cb = optsOrRev;\n        opts = {};\n      } else {\n        cb = opts;\n        opts = optsOrRev;\n      }\n    }\n\n    var rev = (doc._rev || opts.rev);\n    var url = genDBUrl(host, encodeDocId(doc._id)) + '?rev=' + rev;\n\n    fetchJSON(url, {method: 'DELETE'}, cb).catch(cb);\n  });\n\n  function encodeAttachmentId(attachmentId) {\n    return attachmentId.split(\"/\").map(encodeURIComponent).join(\"/\");\n  }\n\n  // Get the attachment\n  api.getAttachment = adapterFun$$1('getAttachment', function (docId, attachmentId,\n                                                            opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    var params = opts.rev ? ('?rev=' + opts.rev) : '';\n    var url = genDBUrl(host, encodeDocId(docId)) + '/' +\n        encodeAttachmentId(attachmentId) + params;\n    var contentType;\n    ourFetch(url, {method: 'GET'}).then(function (response) {\n      contentType = response.headers.get('content-type');\n      if (!response.ok) {\n        throw response;\n      } else {\n        if (typeof process !== 'undefined' && !process.browser) {\n          return response.buffer();\n        } else {\n          /* istanbul ignore next */\n          return response.blob();\n        }\n      }\n    }).then(function (blob) {\n      // TODO: also remove\n      if (typeof process !== 'undefined' && !process.browser) {\n        blob.type = contentType;\n      }\n      callback(null, blob);\n    }).catch(function (err) {\n      callback(err);\n    });\n  });\n\n  // Remove the attachment given by the id and rev\n  api.removeAttachment =  adapterFun$$1('removeAttachment', function (docId,\n                                                                   attachmentId,\n                                                                   rev,\n                                                                   callback) {\n    var url = genDBUrl(host, encodeDocId(docId) + '/' +\n                       encodeAttachmentId(attachmentId)) + '?rev=' + rev;\n    fetchJSON(url, {method: 'DELETE'}, callback).catch(callback);\n  });\n\n  // Add the attachment given by blob and its contentType property\n  // to the document with the given id, the revision given by rev, and\n  // add it to the database given by host.\n  api.putAttachment = adapterFun$$1('putAttachment', function (docId, attachmentId,\n                                                            rev, blob,\n                                                            type, callback) {\n    if (typeof type === 'function') {\n      callback = type;\n      type = blob;\n      blob = rev;\n      rev = null;\n    }\n    var id = encodeDocId(docId) + '/' + encodeAttachmentId(attachmentId);\n    var url = genDBUrl(host, id);\n    if (rev) {\n      url += '?rev=' + rev;\n    }\n\n    if (typeof blob === 'string') {\n      // input is assumed to be a base64 string\n      var binary;\n      try {\n        binary = thisAtob(blob);\n      } catch (err) {\n        return callback(createError(BAD_ARG,\n                        'Attachment is not a valid base64 string'));\n      }\n      blob = binary ? binStringToBluffer(binary, type) : '';\n    }\n\n    // Add the attachment\n    fetchJSON(url, {\n      headers: new h({'Content-Type': type}),\n      method: 'PUT',\n      body: blob\n    }, callback).catch(callback);\n  });\n\n  // Update/create multiple documents given by req in the database\n  // given by host.\n  api._bulkDocs = function (req, opts, callback) {\n    // If new_edits=false then it prevents the database from creating\n    // new revision numbers for the documents. Instead it just uses\n    // the old ones. This is used in database replication.\n    req.new_edits = opts.new_edits;\n\n    setup().then(function () {\n      return Promise.all(req.docs.map(preprocessAttachments$1));\n    }).then(function () {\n      // Update/create the documents\n      return fetchJSON(genDBUrl(host, '_bulk_docs'), {\n        method: 'POST',\n        body: JSON.stringify(req)\n      }, callback);\n    }).catch(callback);\n  };\n\n\n  // Update/create document\n  api._put = function (doc, opts, callback) {\n    setup().then(function () {\n      return preprocessAttachments$1(doc);\n    }).then(function () {\n      return fetchJSON(genDBUrl(host, encodeDocId(doc._id)), {\n        method: 'PUT',\n        body: JSON.stringify(doc)\n      });\n    }).then(function (result) {\n      callback(null, result.data);\n    }).catch(function (err) {\n      err.docId = doc && doc._id;\n      callback(err);\n    });\n  };\n\n\n  // Get a listing of the documents in the database given\n  // by host and ordered by increasing id.\n  api.allDocs = adapterFun$$1('allDocs', function (opts, callback) {\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = clone(opts);\n\n    // List of parameters to add to the GET request\n    var params = {};\n    var body;\n    var method = 'GET';\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n\n    if (opts.include_docs) {\n      params.include_docs = true;\n    }\n\n    // added in CouchDB 1.6.0\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.key) {\n      params.key = JSON.stringify(opts.key);\n    }\n\n    if (opts.start_key) {\n      opts.startkey = opts.start_key;\n    }\n\n    if (opts.startkey) {\n      params.startkey = JSON.stringify(opts.startkey);\n    }\n\n    if (opts.end_key) {\n      opts.endkey = opts.end_key;\n    }\n\n    if (opts.endkey) {\n      params.endkey = JSON.stringify(opts.endkey);\n    }\n\n    if (typeof opts.inclusive_end !== 'undefined') {\n      params.inclusive_end = !!opts.inclusive_end;\n    }\n\n    if (typeof opts.limit !== 'undefined') {\n      params.limit = opts.limit;\n    }\n\n    if (typeof opts.skip !== 'undefined') {\n      params.skip = opts.skip;\n    }\n\n    var paramStr = paramsToStr(params);\n\n    if (typeof opts.keys !== 'undefined') {\n      method = 'POST';\n      body = {keys: opts.keys};\n    }\n\n    fetchJSON(genDBUrl(host, '_all_docs' + paramStr), {\n       method: method,\n      body: JSON.stringify(body)\n    }).then(function (result) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        result.data.rows.forEach(readAttachmentsAsBlobOrBuffer);\n      }\n      callback(null, result.data);\n    }).catch(callback);\n  });\n\n  // Get a list of changes made to documents in the database given by host.\n  // TODO According to the README, there should be two other methods here,\n  // api.changes.addListener and api.changes.removeListener.\n  api._changes = function (opts) {\n\n    // We internally page the results of a changes request, this means\n    // if there is a large set of changes to be returned we can start\n    // processing them quicker instead of waiting on the entire\n    // set of changes to return and attempting to process them at once\n    var batchSize = 'batch_size' in opts ? opts.batch_size : CHANGES_BATCH_SIZE;\n\n    opts = clone(opts);\n\n    if (opts.continuous && !('heartbeat' in opts)) {\n      opts.heartbeat = DEFAULT_HEARTBEAT;\n    }\n\n    var requestTimeout = ('timeout' in opts) ? opts.timeout : 30 * 1000;\n\n    // ensure CHANGES_TIMEOUT_BUFFER applies\n    if ('timeout' in opts && opts.timeout &&\n      (requestTimeout - opts.timeout) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.timeout + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    /* istanbul ignore if */\n    if ('heartbeat' in opts && opts.heartbeat &&\n       (requestTimeout - opts.heartbeat) < CHANGES_TIMEOUT_BUFFER) {\n        requestTimeout = opts.heartbeat + CHANGES_TIMEOUT_BUFFER;\n    }\n\n    var params = {};\n    if ('timeout' in opts && opts.timeout) {\n      params.timeout = opts.timeout;\n    }\n\n    var limit = (typeof opts.limit !== 'undefined') ? opts.limit : false;\n    var leftToFetch = limit;\n\n    if (opts.style) {\n      params.style = opts.style;\n    }\n\n    if (opts.include_docs || opts.filter && typeof opts.filter === 'function') {\n      params.include_docs = true;\n    }\n\n    if (opts.attachments) {\n      params.attachments = true;\n    }\n\n    if (opts.continuous) {\n      params.feed = 'longpoll';\n    }\n\n    if (opts.seq_interval) {\n      params.seq_interval = opts.seq_interval;\n    }\n\n    if (opts.conflicts) {\n      params.conflicts = true;\n    }\n\n    if (opts.descending) {\n      params.descending = true;\n    }\n    \n    /* istanbul ignore if */\n    if (opts.update_seq) {\n      params.update_seq = true;\n    }\n\n    if ('heartbeat' in opts) {\n      // If the heartbeat value is false, it disables the default heartbeat\n      if (opts.heartbeat) {\n        params.heartbeat = opts.heartbeat;\n      }\n    }\n\n    if (opts.filter && typeof opts.filter === 'string') {\n      params.filter = opts.filter;\n    }\n\n    if (opts.view && typeof opts.view === 'string') {\n      params.filter = '_view';\n      params.view = opts.view;\n    }\n\n    // If opts.query_params exists, pass it through to the changes request.\n    // These parameters may be used by the filter on the source database.\n    if (opts.query_params && typeof opts.query_params === 'object') {\n      for (var param_name in opts.query_params) {\n        /* istanbul ignore else */\n        if (opts.query_params.hasOwnProperty(param_name)) {\n          params[param_name] = opts.query_params[param_name];\n        }\n      }\n    }\n\n    var method = 'GET';\n    var body;\n\n    if (opts.doc_ids) {\n      // set this automagically for the user; it's annoying that couchdb\n      // requires both a \"filter\" and a \"doc_ids\" param.\n      params.filter = '_doc_ids';\n      method = 'POST';\n      body = {doc_ids: opts.doc_ids };\n    }\n    /* istanbul ignore next */\n    else if (opts.selector) {\n      // set this automagically for the user, similar to above\n      params.filter = '_selector';\n      method = 'POST';\n      body = {selector: opts.selector };\n    }\n\n    var controller = new a();\n    var lastFetchedSeq;\n\n    // Get all the changes starting wtih the one immediately after the\n    // sequence number given by since.\n    var fetchData = function (since, callback) {\n      if (opts.aborted) {\n        return;\n      }\n      params.since = since;\n      // \"since\" can be any kind of json object in Cloudant/CouchDB 2.x\n      /* istanbul ignore next */\n      if (typeof params.since === \"object\") {\n        params.since = JSON.stringify(params.since);\n      }\n\n      if (opts.descending) {\n        if (limit) {\n          params.limit = leftToFetch;\n        }\n      } else {\n        params.limit = (!limit || leftToFetch > batchSize) ?\n          batchSize : leftToFetch;\n      }\n\n      // Set the options for the ajax call\n      var url = genDBUrl(host, '_changes' + paramsToStr(params));\n      var fetchOpts = {\n        signal: controller.signal,\n        method: method,\n        body: JSON.stringify(body)\n      };\n      lastFetchedSeq = since;\n\n      /* istanbul ignore if */\n      if (opts.aborted) {\n        return;\n      }\n\n      // Get the changes\n      setup().then(function () {\n        return fetchJSON(url, fetchOpts, callback);\n      }).catch(callback);\n    };\n\n    // If opts.since exists, get all the changes from the sequence\n    // number given by opts.since. Otherwise, get all the changes\n    // from the sequence number 0.\n    var results = {results: []};\n\n    var fetched = function (err, res) {\n      if (opts.aborted) {\n        return;\n      }\n      var raw_results_length = 0;\n      // If the result of the ajax call (res) contains changes (res.results)\n      if (res && res.results) {\n        raw_results_length = res.results.length;\n        results.last_seq = res.last_seq;\n        var pending = null;\n        var lastSeq = null;\n        // Attach 'pending' property if server supports it (CouchDB 2.0+)\n        /* istanbul ignore if */\n        if (typeof res.pending === 'number') {\n          pending = res.pending;\n        }\n        if (typeof results.last_seq === 'string' || typeof results.last_seq === 'number') {\n          lastSeq = results.last_seq;\n        }\n        // For each change\n        var req = {};\n        req.query = opts.query_params;\n        res.results = res.results.filter(function (c) {\n          leftToFetch--;\n          var ret = filterChange(opts)(c);\n          if (ret) {\n            if (opts.include_docs && opts.attachments && opts.binary) {\n              readAttachmentsAsBlobOrBuffer(c);\n            }\n            if (opts.return_docs) {\n              results.results.push(c);\n            }\n            opts.onChange(c, pending, lastSeq);\n          }\n          return ret;\n        });\n      } else if (err) {\n        // In case of an error, stop listening for changes and call\n        // opts.complete\n        opts.aborted = true;\n        opts.complete(err);\n        return;\n      }\n\n      // The changes feed may have timed out with no results\n      // if so reuse last update sequence\n      if (res && res.last_seq) {\n        lastFetchedSeq = res.last_seq;\n      }\n\n      var finished = (limit && leftToFetch <= 0) ||\n        (res && raw_results_length < batchSize) ||\n        (opts.descending);\n\n      if ((opts.continuous && !(limit && leftToFetch <= 0)) || !finished) {\n        // Queue a call to fetch again with the newest sequence number\n        nextTick(function () { fetchData(lastFetchedSeq, fetched); });\n      } else {\n        // We're done, call the callback\n        opts.complete(null, results);\n      }\n    };\n\n    fetchData(opts.since || 0, fetched);\n\n    // Return a method to cancel this method from processing any more\n    return {\n      cancel: function () {\n        opts.aborted = true;\n        controller.abort();\n      }\n    };\n  };\n\n  // Given a set of document/revision IDs (given by req), tets the subset of\n  // those that do NOT correspond to revisions stored in the database.\n  // See http://wiki.apache.org/couchdb/HttpPostRevsDiff\n  api.revsDiff = adapterFun$$1('revsDiff', function (req, opts, callback) {\n    // If no options were given, set the callback to be the second parameter\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n\n    // Get the missing document/revision IDs\n    fetchJSON(genDBUrl(host, '_revs_diff'), {\n      method: 'POST',\n      body: JSON.stringify(req)\n    }, callback).catch(callback);\n  });\n\n  api._close = function (callback) {\n    callback();\n  };\n\n  api._destroy = function (options, callback) {\n    fetchJSON(genDBUrl(host, ''), {method: 'DELETE'}).then(function (json) {\n      callback(null, json);\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status === 404) {\n        callback(null, {ok: true});\n      } else {\n        callback(err);\n      }\n    });\n  };\n}\n\n// HttpPouch is a valid adapter.\nHttpPouch.valid = function () {\n  return true;\n};\n\nfunction HttpPouch$1 (PouchDB) {\n  PouchDB.adapter('http', HttpPouch, false);\n  PouchDB.adapter('https', HttpPouch, false);\n}\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      nextTick(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      nextTick(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new ExportedSet(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nfunction createBuiltInError(name) {\n  var message = 'builtin ' + name +\n    ' function requires map values to be numbers' +\n    ' or number arrays';\n  return new BuiltInError(message);\n}\n\nfunction sum(values) {\n  var result = 0;\n  for (var i = 0, len = values.length; i < len; i++) {\n    var num = values[i];\n    if (typeof num !== 'number') {\n      if (Array.isArray(num)) {\n        // lists of numbers are also allowed, sum them separately\n        result = typeof result === 'number' ? [result] : result;\n        for (var j = 0, jLen = num.length; j < jLen; j++) {\n          var jNum = num[j];\n          if (typeof jNum !== 'number') {\n            throw createBuiltInError('_sum');\n          } else if (typeof result[j] === 'undefined') {\n            result.push(jNum);\n          } else {\n            result[j] += jNum;\n          }\n        }\n      } else { // not array/number\n        throw createBuiltInError('_sum');\n      }\n    } else if (typeof result === 'number') {\n      result += num;\n    } else { // add number to array\n      result[0] += num;\n    }\n  }\n  return result;\n}\n\nvar log = guardedConsole.bind(null, 'log');\nvar isArray = Array.isArray;\nvar toJSON = JSON.parse;\n\nfunction evalFunctionWithEval(func, emit) {\n  return scopeEval(\n    \"return (\" + func.replace(/;\\s*$/, \"\") + \");\",\n    {\n      emit: emit,\n      sum: sum,\n      log: log,\n      isArray: isArray,\n      toJSON: toJSON\n    }\n  );\n}\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue$1() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue$1.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue$1.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue$1();\nvar CHANGES_BATCH_SIZE$1 = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = b64ToBluffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new h({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new ExportedSet();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue$1();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue$1();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE$1\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE$1) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new ExportedMap();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new ExportedMap();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new ExportedMap();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new h({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new ExportedMap();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new ExportedSet();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              nextTick(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nvar builtInReduce = {\n  _sum: function (keys, values) {\n    return sum(values);\n  },\n\n  _count: function (keys, values) {\n    return values.length;\n  },\n\n  _stats: function (keys, values) {\n    // no need to implement rereduce=true, because Pouch\n    // will never call it\n    function sumsqr(values) {\n      var _sumsqr = 0;\n      for (var i = 0, len = values.length; i < len; i++) {\n        var num = values[i];\n        _sumsqr += (num * num);\n      }\n      return _sumsqr;\n    }\n    return {\n      sum     : sum(values),\n      min     : Math.min.apply(null, values),\n      max     : Math.max.apply(null, values),\n      count   : values.length,\n      sumsqr : sumsqr(values)\n    };\n  }\n};\n\nfunction getBuiltIn(reduceFunString) {\n  if (/^_sum/.test(reduceFunString)) {\n    return builtInReduce._sum;\n  } else if (/^_count/.test(reduceFunString)) {\n    return builtInReduce._count;\n  } else if (/^_stats/.test(reduceFunString)) {\n    return builtInReduce._stats;\n  } else if (/^_/.test(reduceFunString)) {\n    throw new Error(reduceFunString + ' is not a supported reduce function.');\n  }\n}\n\nfunction mapper(mapFun, emit) {\n  // for temp_views one can use emit(doc, emit), see #38\n  if (typeof mapFun === \"function\" && mapFun.length === 2) {\n    var origMap = mapFun;\n    return function (doc) {\n      return origMap(doc, emit);\n    };\n  } else {\n    return evalFunctionWithEval(mapFun.toString(), emit);\n  }\n}\n\nfunction reducer(reduceFun) {\n  var reduceFunString = reduceFun.toString();\n  var builtIn = getBuiltIn(reduceFunString);\n  if (builtIn) {\n    return builtIn;\n  } else {\n    return evalFunctionWithEval(reduceFunString);\n  }\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var fun = ddoc.views && ddoc.views[viewName];\n  if (typeof fun.map !== 'string') {\n    throw new NotFoundError('ddoc ' + ddoc._id + ' has no string view named ' +\n      viewName + ', instead found object of type: ' + typeof fun.map);\n  }\n}\n\nvar localDocName = 'mrviews';\nvar abstract = createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator);\n\nfunction query(fun, opts, callback) {\n  return abstract.query.call(this, fun, opts, callback);\n}\n\nfunction viewCleanup(callback) {\n  return abstract.viewCleanup.call(this, callback);\n}\n\nvar mapreduce = {\n  query: query,\n  viewCleanup: viewCleanup\n};\n\nfunction isGenOne$1(rev) {\n  return /^1-/.test(rev);\n}\n\nfunction fileHasChanged(localDoc, remoteDoc, filename) {\n  return !localDoc._attachments ||\n         !localDoc._attachments[filename] ||\n         localDoc._attachments[filename].digest !== remoteDoc._attachments[filename].digest;\n}\n\nfunction getDocAttachments(db, doc) {\n  var filenames = Object.keys(doc._attachments);\n  return Promise.all(filenames.map(function (filename) {\n    return db.getAttachment(doc._id, filename, {rev: doc._rev});\n  }));\n}\n\nfunction getDocAttachmentsFromTargetOrSource(target, src, doc) {\n  var doCheckForLocalAttachments = isRemote(src) && !isRemote(target);\n  var filenames = Object.keys(doc._attachments);\n\n  if (!doCheckForLocalAttachments) {\n    return getDocAttachments(src, doc);\n  }\n\n  return target.get(doc._id).then(function (localDoc) {\n    return Promise.all(filenames.map(function (filename) {\n      if (fileHasChanged(localDoc, doc, filename)) {\n        return src.getAttachment(doc._id, filename);\n      }\n\n      return target.getAttachment(localDoc._id, filename);\n    }));\n  }).catch(function (error) {\n    /* istanbul ignore if */\n    if (error.status !== 404) {\n      throw error;\n    }\n\n    return getDocAttachments(src, doc);\n  });\n}\n\nfunction createBulkGetOpts(diffs) {\n  var requests = [];\n  Object.keys(diffs).forEach(function (id) {\n    var missingRevs = diffs[id].missing;\n    missingRevs.forEach(function (missingRev) {\n      requests.push({\n        id: id,\n        rev: missingRev\n      });\n    });\n  });\n\n  return {\n    docs: requests,\n    revs: true,\n    latest: true\n  };\n}\n\n//\n// Fetch all the documents from the src as described in the \"diffs\",\n// which is a mapping of docs IDs to revisions. If the state ever\n// changes to \"cancelled\", then the returned promise will be rejected.\n// Else it will be resolved with a list of fetched documents.\n//\nfunction getDocs(src, target, diffs, state) {\n  diffs = clone(diffs); // we do not need to modify this\n\n  var resultDocs = [],\n      ok = true;\n\n  function getAllDocs() {\n\n    var bulkGetOpts = createBulkGetOpts(diffs);\n\n    if (!bulkGetOpts.docs.length) { // optimization: skip empty requests\n      return;\n    }\n\n    return src.bulkGet(bulkGetOpts).then(function (bulkGetResponse) {\n      /* istanbul ignore if */\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      return Promise.all(bulkGetResponse.results.map(function (bulkGetInfo) {\n        return Promise.all(bulkGetInfo.docs.map(function (doc) {\n          var remoteDoc = doc.ok;\n\n          if (doc.error) {\n            // when AUTO_COMPACTION is set, docs can be returned which look\n            // like this: {\"missing\":\"1-7c3ac256b693c462af8442f992b83696\"}\n            ok = false;\n          }\n\n          if (!remoteDoc || !remoteDoc._attachments) {\n            return remoteDoc;\n          }\n\n          return getDocAttachmentsFromTargetOrSource(target, src, remoteDoc)\n                   .then(function (attachments) {\n                           var filenames = Object.keys(remoteDoc._attachments);\n                           attachments\n                             .forEach(function (attachment, i) {\n                                        var att = remoteDoc._attachments[filenames[i]];\n                                        delete att.stub;\n                                        delete att.length;\n                                        att.data = attachment;\n                                      });\n\n                                      return remoteDoc;\n                                    });\n        }));\n      }))\n\n      .then(function (results) {\n        resultDocs = resultDocs.concat(flatten(results).filter(Boolean));\n      });\n    });\n  }\n\n  function hasAttachments(doc) {\n    return doc._attachments && Object.keys(doc._attachments).length > 0;\n  }\n\n  function hasConflicts(doc) {\n    return doc._conflicts && doc._conflicts.length > 0;\n  }\n\n  function fetchRevisionOneDocs(ids) {\n    // Optimization: fetch gen-1 docs and attachments in\n    // a single request using _all_docs\n    return src.allDocs({\n      keys: ids,\n      include_docs: true,\n      conflicts: true\n    }).then(function (res) {\n      if (state.cancelled) {\n        throw new Error('cancelled');\n      }\n      res.rows.forEach(function (row) {\n        if (row.deleted || !row.doc || !isGenOne$1(row.value.rev) ||\n            hasAttachments(row.doc) || hasConflicts(row.doc)) {\n          // if any of these conditions apply, we need to fetch using get()\n          return;\n        }\n\n        // strip _conflicts array to appease CSG (#5793)\n        /* istanbul ignore if */\n        if (row.doc._conflicts) {\n          delete row.doc._conflicts;\n        }\n\n        // the doc we got back from allDocs() is sufficient\n        resultDocs.push(row.doc);\n        delete diffs[row.id];\n      });\n    });\n  }\n\n  function getRevisionOneDocs() {\n    // filter out the generation 1 docs and get them\n    // leaving the non-generation one docs to be got otherwise\n    var ids = Object.keys(diffs).filter(function (id) {\n      var missing = diffs[id].missing;\n      return missing.length === 1 && isGenOne$1(missing[0]);\n    });\n    if (ids.length > 0) {\n      return fetchRevisionOneDocs(ids);\n    }\n  }\n\n  function returnResult() {\n    return { ok:ok, docs:resultDocs };\n  }\n\n  return Promise.resolve()\n    .then(getRevisionOneDocs)\n    .then(getAllDocs)\n    .then(returnResult);\n}\n\nvar CHECKPOINT_VERSION = 1;\nvar REPLICATOR = \"pouchdb\";\n// This is an arbitrary number to limit the\n// amount of replication history we save in the checkpoint.\n// If we save too much, the checkpoing docs will become very big,\n// if we save fewer, we'll run a greater risk of having to\n// read all the changes from 0 when checkpoint PUTs fail\n// CouchDB 2.0 has a more involved history pruning,\n// but let's go for the simple version for now.\nvar CHECKPOINT_HISTORY_SIZE = 5;\nvar LOWEST_SEQ = 0;\n\nfunction updateCheckpoint(db, id, checkpoint, session, returnValue) {\n  return db.get(id).catch(function (err) {\n    if (err.status === 404) {\n      if (db.adapter === 'http' || db.adapter === 'https') {\n        explainError(\n          404, 'PouchDB is just checking if a remote checkpoint exists.'\n        );\n      }\n      return {\n        session_id: session,\n        _id: id,\n        history: [],\n        replicator: REPLICATOR,\n        version: CHECKPOINT_VERSION\n      };\n    }\n    throw err;\n  }).then(function (doc) {\n    if (returnValue.cancelled) {\n      return;\n    }\n\n    // if the checkpoint has not changed, do not update\n    if (doc.last_seq === checkpoint) {\n      return;\n    }\n\n    // Filter out current entry for this replication\n    doc.history = (doc.history || []).filter(function (item) {\n      return item.session_id !== session;\n    });\n\n    // Add the latest checkpoint to history\n    doc.history.unshift({\n      last_seq: checkpoint,\n      session_id: session\n    });\n\n    // Just take the last pieces in history, to\n    // avoid really big checkpoint docs.\n    // see comment on history size above\n    doc.history = doc.history.slice(0, CHECKPOINT_HISTORY_SIZE);\n\n    doc.version = CHECKPOINT_VERSION;\n    doc.replicator = REPLICATOR;\n\n    doc.session_id = session;\n    doc.last_seq = checkpoint;\n\n    return db.put(doc).catch(function (err) {\n      if (err.status === 409) {\n        // retry; someone is trying to write a checkpoint simultaneously\n        return updateCheckpoint(db, id, checkpoint, session, returnValue);\n      }\n      throw err;\n    });\n  });\n}\n\nfunction Checkpointer(src, target, id, returnValue, opts) {\n  this.src = src;\n  this.target = target;\n  this.id = id;\n  this.returnValue = returnValue;\n  this.opts = opts || {};\n}\n\nCheckpointer.prototype.writeCheckpoint = function (checkpoint, session) {\n  var self = this;\n  return this.updateTarget(checkpoint, session).then(function () {\n    return self.updateSource(checkpoint, session);\n  });\n};\n\nCheckpointer.prototype.updateTarget = function (checkpoint, session) {\n  if (this.opts.writeTargetCheckpoint) {\n    return updateCheckpoint(this.target, this.id, checkpoint,\n      session, this.returnValue);\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nCheckpointer.prototype.updateSource = function (checkpoint, session) {\n  if (this.opts.writeSourceCheckpoint) {\n    var self = this;\n    return updateCheckpoint(this.src, this.id, checkpoint,\n      session, this.returnValue)\n      .catch(function (err) {\n        if (isForbiddenError(err)) {\n          self.opts.writeSourceCheckpoint = false;\n          return true;\n        }\n        throw err;\n      });\n  } else {\n    return Promise.resolve(true);\n  }\n};\n\nvar comparisons = {\n  \"undefined\": function (targetDoc, sourceDoc) {\n    // This is the previous comparison function\n    if (collate(targetDoc.last_seq, sourceDoc.last_seq) === 0) {\n      return sourceDoc.last_seq;\n    }\n    /* istanbul ignore next */\n    return 0;\n  },\n  \"1\": function (targetDoc, sourceDoc) {\n    // This is the comparison function ported from CouchDB\n    return compareReplicationLogs(sourceDoc, targetDoc).last_seq;\n  }\n};\n\nCheckpointer.prototype.getCheckpoint = function () {\n  var self = this;\n\n  if (self.opts && self.opts.writeSourceCheckpoint && !self.opts.writeTargetCheckpoint) {\n    return self.src.get(self.id).then(function (sourceDoc) {\n      return sourceDoc.last_seq || LOWEST_SEQ;\n    }).catch(function (err) {\n      /* istanbul ignore if */\n      if (err.status !== 404) {\n        throw err;\n      }\n      return LOWEST_SEQ;\n    });\n  }\n\n  return self.target.get(self.id).then(function (targetDoc) {\n    if (self.opts && self.opts.writeTargetCheckpoint && !self.opts.writeSourceCheckpoint) {\n      return targetDoc.last_seq || LOWEST_SEQ;\n    }\n\n    return self.src.get(self.id).then(function (sourceDoc) {\n      // Since we can't migrate an old version doc to a new one\n      // (no session id), we just go with the lowest seq in this case\n      /* istanbul ignore if */\n      if (targetDoc.version !== sourceDoc.version) {\n        return LOWEST_SEQ;\n      }\n\n      var version;\n      if (targetDoc.version) {\n        version = targetDoc.version.toString();\n      } else {\n        version = \"undefined\";\n      }\n\n      if (version in comparisons) {\n        return comparisons[version](targetDoc, sourceDoc);\n      }\n      /* istanbul ignore next */\n      return LOWEST_SEQ;\n    }, function (err) {\n      if (err.status === 404 && targetDoc.last_seq) {\n        return self.src.put({\n          _id: self.id,\n          last_seq: LOWEST_SEQ\n        }).then(function () {\n          return LOWEST_SEQ;\n        }, function (err) {\n          if (isForbiddenError(err)) {\n            self.opts.writeSourceCheckpoint = false;\n            return targetDoc.last_seq;\n          }\n          /* istanbul ignore next */\n          return LOWEST_SEQ;\n        });\n      }\n      throw err;\n    });\n  }).catch(function (err) {\n    if (err.status !== 404) {\n      throw err;\n    }\n    return LOWEST_SEQ;\n  });\n};\n// This checkpoint comparison is ported from CouchDBs source\n// they come from here:\n// https://github.com/apache/couchdb-couch-replicator/blob/master/src/couch_replicator.erl#L863-L906\n\nfunction compareReplicationLogs(srcDoc, tgtDoc) {\n  if (srcDoc.session_id === tgtDoc.session_id) {\n    return {\n      last_seq: srcDoc.last_seq,\n      history: srcDoc.history\n    };\n  }\n\n  return compareReplicationHistory(srcDoc.history, tgtDoc.history);\n}\n\nfunction compareReplicationHistory(sourceHistory, targetHistory) {\n  // the erlang loop via function arguments is not so easy to repeat in JS\n  // therefore, doing this as recursion\n  var S = sourceHistory[0];\n  var sourceRest = sourceHistory.slice(1);\n  var T = targetHistory[0];\n  var targetRest = targetHistory.slice(1);\n\n  if (!S || targetHistory.length === 0) {\n    return {\n      last_seq: LOWEST_SEQ,\n      history: []\n    };\n  }\n\n  var sourceId = S.session_id;\n  /* istanbul ignore if */\n  if (hasSessionId(sourceId, targetHistory)) {\n    return {\n      last_seq: S.last_seq,\n      history: sourceHistory\n    };\n  }\n\n  var targetId = T.session_id;\n  if (hasSessionId(targetId, sourceRest)) {\n    return {\n      last_seq: T.last_seq,\n      history: targetRest\n    };\n  }\n\n  return compareReplicationHistory(sourceRest, targetRest);\n}\n\nfunction hasSessionId(sessionId, history) {\n  var props = history[0];\n  var rest = history.slice(1);\n\n  if (!sessionId || history.length === 0) {\n    return false;\n  }\n\n  if (sessionId === props.session_id) {\n    return true;\n  }\n\n  return hasSessionId(sessionId, rest);\n}\n\nfunction isForbiddenError(err) {\n  return typeof err.status === 'number' && Math.floor(err.status / 100) === 4;\n}\n\nvar STARTING_BACK_OFF = 0;\n\nfunction backOff(opts, returnValue, error, callback) {\n  if (opts.retry === false) {\n    returnValue.emit('error', error);\n    returnValue.removeAllListeners();\n    return;\n  }\n  /* istanbul ignore if */\n  if (typeof opts.back_off_function !== 'function') {\n    opts.back_off_function = defaultBackOff;\n  }\n  returnValue.emit('requestError', error);\n  if (returnValue.state === 'active' || returnValue.state === 'pending') {\n    returnValue.emit('paused', error);\n    returnValue.state = 'stopped';\n    var backOffSet = function backoffTimeSet() {\n      opts.current_back_off = STARTING_BACK_OFF;\n    };\n    var removeBackOffSetter = function removeBackOffTimeSet() {\n      returnValue.removeListener('active', backOffSet);\n    };\n    returnValue.once('paused', removeBackOffSetter);\n    returnValue.once('active', backOffSet);\n  }\n\n  opts.current_back_off = opts.current_back_off || STARTING_BACK_OFF;\n  opts.current_back_off = opts.back_off_function(opts.current_back_off);\n  setTimeout(callback, opts.current_back_off);\n}\n\nfunction sortObjectPropertiesByKey(queryParams) {\n  return Object.keys(queryParams).sort(collate).reduce(function (result, key) {\n    result[key] = queryParams[key];\n    return result;\n  }, {});\n}\n\n// Generate a unique id particular to this replication.\n// Not guaranteed to align perfectly with CouchDB's rep ids.\nfunction generateReplicationId(src, target, opts) {\n  var docIds = opts.doc_ids ? opts.doc_ids.sort(collate) : '';\n  var filterFun = opts.filter ? opts.filter.toString() : '';\n  var queryParams = '';\n  var filterViewName =  '';\n  var selector = '';\n\n  // possibility for checkpoints to be lost here as behaviour of\n  // JSON.stringify is not stable (see #6226)\n  /* istanbul ignore if */\n  if (opts.selector) {\n    selector = JSON.stringify(opts.selector);\n  }\n\n  if (opts.filter && opts.query_params) {\n    queryParams = JSON.stringify(sortObjectPropertiesByKey(opts.query_params));\n  }\n\n  if (opts.filter && opts.filter === '_view') {\n    filterViewName = opts.view.toString();\n  }\n\n  return Promise.all([src.id(), target.id()]).then(function (res) {\n    var queryData = res[0] + res[1] + filterFun + filterViewName +\n      queryParams + docIds + selector;\n    return new Promise(function (resolve) {\n      binaryMd5(queryData, resolve);\n    });\n  }).then(function (md5sum) {\n    // can't use straight-up md5 alphabet, because\n    // the char '/' is interpreted as being for attachments,\n    // and + is also not url-safe\n    md5sum = md5sum.replace(/\\//g, '.').replace(/\\+/g, '_');\n    return '_local/' + md5sum;\n  });\n}\n\nfunction replicate(src, target, opts, returnValue, result) {\n  var batches = [];               // list of batches to be processed\n  var currentBatch;               // the batch currently being processed\n  var pendingBatch = {\n    seq: 0,\n    changes: [],\n    docs: []\n  }; // next batch, not yet ready to be processed\n  var writingCheckpoint = false;  // true while checkpoint is being written\n  var changesCompleted = false;   // true when all changes received\n  var replicationCompleted = false; // true when replication has completed\n  var last_seq = 0;\n  var continuous = opts.continuous || opts.live || false;\n  var batch_size = opts.batch_size || 100;\n  var batches_limit = opts.batches_limit || 10;\n  var changesPending = false;     // true while src.changes is running\n  var doc_ids = opts.doc_ids;\n  var selector = opts.selector;\n  var repId;\n  var checkpointer;\n  var changedDocs = [];\n  // Like couchdb, every replication gets a unique session id\n  var session = uuid();\n\n  result = result || {\n    ok: true,\n    start_time: new Date().toISOString(),\n    docs_read: 0,\n    docs_written: 0,\n    doc_write_failures: 0,\n    errors: []\n  };\n\n  var changesOpts = {};\n  returnValue.ready(src, target);\n\n  function initCheckpointer() {\n    if (checkpointer) {\n      return Promise.resolve();\n    }\n    return generateReplicationId(src, target, opts).then(function (res) {\n      repId = res;\n\n      var checkpointOpts = {};\n      if (opts.checkpoint === false) {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'source') {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: false };\n      } else if (opts.checkpoint === 'target') {\n        checkpointOpts = { writeSourceCheckpoint: false, writeTargetCheckpoint: true };\n      } else {\n        checkpointOpts = { writeSourceCheckpoint: true, writeTargetCheckpoint: true };\n      }\n\n      checkpointer = new Checkpointer(src, target, repId, returnValue, checkpointOpts);\n    });\n  }\n\n  function writeDocs() {\n    changedDocs = [];\n\n    if (currentBatch.docs.length === 0) {\n      return;\n    }\n    var docs = currentBatch.docs;\n    var bulkOpts = {timeout: opts.timeout};\n    return target.bulkDocs({docs: docs, new_edits: false}, bulkOpts).then(function (res) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n\n      // `res` doesn't include full documents (which live in `docs`), so we create a map of \n      // (id -> error), and check for errors while iterating over `docs`\n      var errorsById = Object.create(null);\n      res.forEach(function (res) {\n        if (res.error) {\n          errorsById[res.id] = res;\n        }\n      });\n\n      var errorsNo = Object.keys(errorsById).length;\n      result.doc_write_failures += errorsNo;\n      result.docs_written += docs.length - errorsNo;\n\n      docs.forEach(function (doc) {\n        var error = errorsById[doc._id];\n        if (error) {\n          result.errors.push(error);\n          // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n          var errorName = (error.name || '').toLowerCase();\n          if (errorName === 'unauthorized' || errorName === 'forbidden') {\n            returnValue.emit('denied', clone(error));\n          } else {\n            throw error;\n          }\n        } else {\n          changedDocs.push(doc);\n        }\n      });\n\n    }, function (err) {\n      result.doc_write_failures += docs.length;\n      throw err;\n    });\n  }\n\n  function finishBatch() {\n    if (currentBatch.error) {\n      throw new Error('There was a problem getting docs.');\n    }\n    result.last_seq = last_seq = currentBatch.seq;\n    var outResult = clone(result);\n    if (changedDocs.length) {\n      outResult.docs = changedDocs;\n      // Attach 'pending' property if server supports it (CouchDB 2.0+)\n      /* istanbul ignore if */\n      if (typeof currentBatch.pending === 'number') {\n        outResult.pending = currentBatch.pending;\n        delete currentBatch.pending;\n      }\n      returnValue.emit('change', outResult);\n    }\n    writingCheckpoint = true;\n    return checkpointer.writeCheckpoint(currentBatch.seq,\n        session).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      currentBatch = undefined;\n      getChanges();\n    }).catch(function (err) {\n      onCheckpointError(err);\n      throw err;\n    });\n  }\n\n  function getDiffs() {\n    var diff = {};\n    currentBatch.changes.forEach(function (change) {\n      // Couchbase Sync Gateway emits these, but we can ignore them\n      /* istanbul ignore if */\n      if (change.id === \"_user/\") {\n        return;\n      }\n      diff[change.id] = change.changes.map(function (x) {\n        return x.rev;\n      });\n    });\n    return target.revsDiff(diff).then(function (diffs) {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        throw new Error('cancelled');\n      }\n      // currentBatch.diffs elements are deleted as the documents are written\n      currentBatch.diffs = diffs;\n    });\n  }\n\n  function getBatchDocs() {\n    return getDocs(src, target, currentBatch.diffs, returnValue).then(function (got) {\n      currentBatch.error = !got.ok;\n      got.docs.forEach(function (doc) {\n        delete currentBatch.diffs[doc._id];\n        result.docs_read++;\n        currentBatch.docs.push(doc);\n      });\n    });\n  }\n\n  function startNextBatch() {\n    if (returnValue.cancelled || currentBatch) {\n      return;\n    }\n    if (batches.length === 0) {\n      processPendingBatch(true);\n      return;\n    }\n    currentBatch = batches.shift();\n    getDiffs()\n      .then(getBatchDocs)\n      .then(writeDocs)\n      .then(finishBatch)\n      .then(startNextBatch)\n      .catch(function (err) {\n        abortReplication('batch processing terminated with error', err);\n      });\n  }\n\n\n  function processPendingBatch(immediate) {\n    if (pendingBatch.changes.length === 0) {\n      if (batches.length === 0 && !currentBatch) {\n        if ((continuous && changesOpts.live) || changesCompleted) {\n          returnValue.state = 'pending';\n          returnValue.emit('paused');\n        }\n        if (changesCompleted) {\n          completeReplication();\n        }\n      }\n      return;\n    }\n    if (\n      immediate ||\n      changesCompleted ||\n      pendingBatch.changes.length >= batch_size\n    ) {\n      batches.push(pendingBatch);\n      pendingBatch = {\n        seq: 0,\n        changes: [],\n        docs: []\n      };\n      if (returnValue.state === 'pending' || returnValue.state === 'stopped') {\n        returnValue.state = 'active';\n        returnValue.emit('active');\n      }\n      startNextBatch();\n    }\n  }\n\n\n  function abortReplication(reason, err) {\n    if (replicationCompleted) {\n      return;\n    }\n    if (!err.message) {\n      err.message = reason;\n    }\n    result.ok = false;\n    result.status = 'aborting';\n    batches = [];\n    pendingBatch = {\n      seq: 0,\n      changes: [],\n      docs: []\n    };\n    completeReplication(err);\n  }\n\n\n  function completeReplication(fatalError) {\n    if (replicationCompleted) {\n      return;\n    }\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      result.status = 'cancelled';\n      if (writingCheckpoint) {\n        return;\n      }\n    }\n    result.status = result.status || 'complete';\n    result.end_time = new Date().toISOString();\n    result.last_seq = last_seq;\n    replicationCompleted = true;\n\n    if (fatalError) {\n      // need to extend the error because Firefox considers \".result\" read-only\n      fatalError = createError(fatalError);\n      fatalError.result = result;\n\n      // Normalize error name. i.e. 'Unauthorized' -> 'unauthorized' (eg Sync Gateway)\n      var errorName = (fatalError.name || '').toLowerCase();\n      if (errorName === 'unauthorized' || errorName === 'forbidden') {\n        returnValue.emit('error', fatalError);\n        returnValue.removeAllListeners();\n      } else {\n        backOff(opts, returnValue, fatalError, function () {\n          replicate(src, target, opts, returnValue);\n        });\n      }\n    } else {\n      returnValue.emit('complete', result);\n      returnValue.removeAllListeners();\n    }\n  }\n\n\n  function onChange(change, pending, lastSeq) {\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    // Attach 'pending' property if server supports it (CouchDB 2.0+)\n    /* istanbul ignore if */\n    if (typeof pending === 'number') {\n      pendingBatch.pending = pending;\n    }\n\n    var filter = filterChange(opts)(change);\n    if (!filter) {\n      return;\n    }\n    pendingBatch.seq = change.seq || lastSeq;\n    pendingBatch.changes.push(change);\n    nextTick(function () {\n      processPendingBatch(batches.length === 0 && changesOpts.live);\n    });\n  }\n\n\n  function onChangesComplete(changes) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n\n    // if no results were returned then we're done,\n    // else fetch more\n    if (changes.results.length > 0) {\n      changesOpts.since = changes.results[changes.results.length - 1].seq;\n      getChanges();\n      processPendingBatch(true);\n    } else {\n\n      var complete = function () {\n        if (continuous) {\n          changesOpts.live = true;\n          getChanges();\n        } else {\n          changesCompleted = true;\n        }\n        processPendingBatch(true);\n      };\n\n      // update the checkpoint so we start from the right seq next time\n      if (!currentBatch && changes.results.length === 0) {\n        writingCheckpoint = true;\n        checkpointer.writeCheckpoint(changes.last_seq,\n            session).then(function () {\n          writingCheckpoint = false;\n          result.last_seq = last_seq = changes.last_seq;\n          complete();\n        })\n        .catch(onCheckpointError);\n      } else {\n        complete();\n      }\n    }\n  }\n\n\n  function onChangesError(err) {\n    changesPending = false;\n    /* istanbul ignore if */\n    if (returnValue.cancelled) {\n      return completeReplication();\n    }\n    abortReplication('changes rejected', err);\n  }\n\n\n  function getChanges() {\n    if (!(\n      !changesPending &&\n      !changesCompleted &&\n      batches.length < batches_limit\n      )) {\n      return;\n    }\n    changesPending = true;\n    function abortChanges() {\n      changes.cancel();\n    }\n    function removeListener() {\n      returnValue.removeListener('cancel', abortChanges);\n    }\n\n    if (returnValue._changes) { // remove old changes() and listeners\n      returnValue.removeListener('cancel', returnValue._abortChanges);\n      returnValue._changes.cancel();\n    }\n    returnValue.once('cancel', abortChanges);\n\n    var changes = src.changes(changesOpts)\n      .on('change', onChange);\n    changes.then(removeListener, removeListener);\n    changes.then(onChangesComplete)\n      .catch(onChangesError);\n\n    if (opts.retry) {\n      // save for later so we can cancel if necessary\n      returnValue._changes = changes;\n      returnValue._abortChanges = abortChanges;\n    }\n  }\n\n\n  function startChanges() {\n    initCheckpointer().then(function () {\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      return checkpointer.getCheckpoint().then(function (checkpoint) {\n        last_seq = checkpoint;\n        changesOpts = {\n          since: last_seq,\n          limit: batch_size,\n          batch_size: batch_size,\n          style: 'all_docs',\n          doc_ids: doc_ids,\n          selector: selector,\n          return_docs: true // required so we know when we're done\n        };\n        if (opts.filter) {\n          if (typeof opts.filter !== 'string') {\n            // required for the client-side filter in onChange\n            changesOpts.include_docs = true;\n          } else { // ddoc filter\n            changesOpts.filter = opts.filter;\n          }\n        }\n        if ('heartbeat' in opts) {\n          changesOpts.heartbeat = opts.heartbeat;\n        }\n        if ('timeout' in opts) {\n          changesOpts.timeout = opts.timeout;\n        }\n        if (opts.query_params) {\n          changesOpts.query_params = opts.query_params;\n        }\n        if (opts.view) {\n          changesOpts.view = opts.view;\n        }\n        getChanges();\n      });\n    }).catch(function (err) {\n      abortReplication('getCheckpoint rejected with ', err);\n    });\n  }\n\n  /* istanbul ignore next */\n  function onCheckpointError(err) {\n    writingCheckpoint = false;\n    abortReplication('writeCheckpoint completed with error', err);\n  }\n\n  /* istanbul ignore if */\n  if (returnValue.cancelled) { // cancelled immediately\n    completeReplication();\n    return;\n  }\n\n  if (!returnValue._addedListeners) {\n    returnValue.once('cancel', completeReplication);\n\n    if (typeof opts.complete === 'function') {\n      returnValue.once('error', opts.complete);\n      returnValue.once('complete', function (result) {\n        opts.complete(null, result);\n      });\n    }\n    returnValue._addedListeners = true;\n  }\n\n  if (typeof opts.since === 'undefined') {\n    startChanges();\n  } else {\n    initCheckpointer().then(function () {\n      writingCheckpoint = true;\n      return checkpointer.writeCheckpoint(opts.since, session);\n    }).then(function () {\n      writingCheckpoint = false;\n      /* istanbul ignore if */\n      if (returnValue.cancelled) {\n        completeReplication();\n        return;\n      }\n      last_seq = opts.since;\n      startChanges();\n    }).catch(onCheckpointError);\n  }\n}\n\n// We create a basic promise so the caller can cancel the replication possibly\n// before we have actually started listening to changes etc\ninherits(Replication, EventEmitter);\nfunction Replication() {\n  EventEmitter.call(this);\n  this.cancelled = false;\n  this.state = 'pending';\n  var self = this;\n  var promise = new Promise(function (fulfill, reject) {\n    self.once('complete', fulfill);\n    self.once('error', reject);\n  });\n  self.then = function (resolve, reject) {\n    return promise.then(resolve, reject);\n  };\n  self.catch = function (reject) {\n    return promise.catch(reject);\n  };\n  // As we allow error handling via \"error\" event as well,\n  // put a stub in here so that rejecting never throws UnhandledError.\n  self.catch(function () {});\n}\n\nReplication.prototype.cancel = function () {\n  this.cancelled = true;\n  this.state = 'cancelled';\n  this.emit('cancel');\n};\n\nReplication.prototype.ready = function (src, target) {\n  var self = this;\n  if (self._readyCalled) {\n    return;\n  }\n  self._readyCalled = true;\n\n  function onDestroy() {\n    self.cancel();\n  }\n  src.once('destroyed', onDestroy);\n  target.once('destroyed', onDestroy);\n  function cleanup() {\n    src.removeListener('destroyed', onDestroy);\n    target.removeListener('destroyed', onDestroy);\n  }\n  self.once('complete', cleanup);\n};\n\nfunction toPouch(db, opts) {\n  var PouchConstructor = opts.PouchConstructor;\n  if (typeof db === 'string') {\n    return new PouchConstructor(db, opts);\n  } else {\n    return db;\n  }\n}\n\nfunction replicateWrapper(src, target, opts, callback) {\n\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n\n  if (opts.doc_ids && !Array.isArray(opts.doc_ids)) {\n    throw createError(BAD_REQUEST,\n                       \"`doc_ids` filter parameter is not a list.\");\n  }\n\n  opts.complete = callback;\n  opts = clone(opts);\n  opts.continuous = opts.continuous || opts.live;\n  opts.retry = ('retry' in opts) ? opts.retry : false;\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  var replicateRet = new Replication(opts);\n  var srcPouch = toPouch(src, opts);\n  var targetPouch = toPouch(target, opts);\n  replicate(srcPouch, targetPouch, opts, replicateRet);\n  return replicateRet;\n}\n\ninherits(Sync, EventEmitter);\nfunction sync(src, target, opts, callback) {\n  if (typeof opts === 'function') {\n    callback = opts;\n    opts = {};\n  }\n  if (typeof opts === 'undefined') {\n    opts = {};\n  }\n  opts = clone(opts);\n  /*jshint validthis:true */\n  opts.PouchConstructor = opts.PouchConstructor || this;\n  src = toPouch(src, opts);\n  target = toPouch(target, opts);\n  return new Sync(src, target, opts, callback);\n}\n\nfunction Sync(src, target, opts, callback) {\n  var self = this;\n  this.canceled = false;\n\n  var optsPush = opts.push ? $inject_Object_assign({}, opts, opts.push) : opts;\n  var optsPull = opts.pull ? $inject_Object_assign({}, opts, opts.pull) : opts;\n\n  this.push = replicateWrapper(src, target, optsPush);\n  this.pull = replicateWrapper(target, src, optsPull);\n\n  this.pushPaused = true;\n  this.pullPaused = true;\n\n  function pullChange(change) {\n    self.emit('change', {\n      direction: 'pull',\n      change: change\n    });\n  }\n  function pushChange(change) {\n    self.emit('change', {\n      direction: 'push',\n      change: change\n    });\n  }\n  function pushDenied(doc) {\n    self.emit('denied', {\n      direction: 'push',\n      doc: doc\n    });\n  }\n  function pullDenied(doc) {\n    self.emit('denied', {\n      direction: 'pull',\n      doc: doc\n    });\n  }\n  function pushPaused() {\n    self.pushPaused = true;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('paused');\n    }\n  }\n  function pullPaused() {\n    self.pullPaused = true;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('paused');\n    }\n  }\n  function pushActive() {\n    self.pushPaused = false;\n    /* istanbul ignore if */\n    if (self.pullPaused) {\n      self.emit('active', {\n        direction: 'push'\n      });\n    }\n  }\n  function pullActive() {\n    self.pullPaused = false;\n    /* istanbul ignore if */\n    if (self.pushPaused) {\n      self.emit('active', {\n        direction: 'pull'\n      });\n    }\n  }\n\n  var removed = {};\n\n  function removeAll(type) { // type is 'push' or 'pull'\n    return function (event, func) {\n      var isChange = event === 'change' &&\n        (func === pullChange || func === pushChange);\n      var isDenied = event === 'denied' &&\n        (func === pullDenied || func === pushDenied);\n      var isPaused = event === 'paused' &&\n        (func === pullPaused || func === pushPaused);\n      var isActive = event === 'active' &&\n        (func === pullActive || func === pushActive);\n\n      if (isChange || isDenied || isPaused || isActive) {\n        if (!(event in removed)) {\n          removed[event] = {};\n        }\n        removed[event][type] = true;\n        if (Object.keys(removed[event]).length === 2) {\n          // both push and pull have asked to be removed\n          self.removeAllListeners(event);\n        }\n      }\n    };\n  }\n\n  if (opts.live) {\n    this.push.on('complete', self.pull.cancel.bind(self.pull));\n    this.pull.on('complete', self.push.cancel.bind(self.push));\n  }\n\n  function addOneListener(ee, event, listener) {\n    if (ee.listeners(event).indexOf(listener) == -1) {\n      ee.on(event, listener);\n    }\n  }\n\n  this.on('newListener', function (event) {\n    if (event === 'change') {\n      addOneListener(self.pull, 'change', pullChange);\n      addOneListener(self.push, 'change', pushChange);\n    } else if (event === 'denied') {\n      addOneListener(self.pull, 'denied', pullDenied);\n      addOneListener(self.push, 'denied', pushDenied);\n    } else if (event === 'active') {\n      addOneListener(self.pull, 'active', pullActive);\n      addOneListener(self.push, 'active', pushActive);\n    } else if (event === 'paused') {\n      addOneListener(self.pull, 'paused', pullPaused);\n      addOneListener(self.push, 'paused', pushPaused);\n    }\n  });\n\n  this.on('removeListener', function (event) {\n    if (event === 'change') {\n      self.pull.removeListener('change', pullChange);\n      self.push.removeListener('change', pushChange);\n    } else if (event === 'denied') {\n      self.pull.removeListener('denied', pullDenied);\n      self.push.removeListener('denied', pushDenied);\n    } else if (event === 'active') {\n      self.pull.removeListener('active', pullActive);\n      self.push.removeListener('active', pushActive);\n    } else if (event === 'paused') {\n      self.pull.removeListener('paused', pullPaused);\n      self.push.removeListener('paused', pushPaused);\n    }\n  });\n\n  this.pull.on('removeListener', removeAll('pull'));\n  this.push.on('removeListener', removeAll('push'));\n\n  var promise = Promise.all([\n    this.push,\n    this.pull\n  ]).then(function (resp) {\n    var out = {\n      push: resp[0],\n      pull: resp[1]\n    };\n    self.emit('complete', out);\n    if (callback) {\n      callback(null, out);\n    }\n    self.removeAllListeners();\n    return out;\n  }, function (err) {\n    self.cancel();\n    if (callback) {\n      // if there's a callback, then the callback can receive\n      // the error event\n      callback(err);\n    } else {\n      // if there's no callback, then we're safe to emit an error\n      // event, which would otherwise throw an unhandled error\n      // due to 'error' being a special event in EventEmitters\n      self.emit('error', err);\n    }\n    self.removeAllListeners();\n    if (callback) {\n      // no sense throwing if we're already emitting an 'error' event\n      throw err;\n    }\n  });\n\n  this.then = function (success, err) {\n    return promise.then(success, err);\n  };\n\n  this.catch = function (err) {\n    return promise.catch(err);\n  };\n}\n\nSync.prototype.cancel = function () {\n  if (!this.canceled) {\n    this.canceled = true;\n    this.push.cancel();\n    this.pull.cancel();\n  }\n};\n\nfunction replication(PouchDB) {\n  PouchDB.replicate = replicateWrapper;\n  PouchDB.sync = sync;\n\n  Object.defineProperty(PouchDB.prototype, 'replicate', {\n    get: function () {\n      var self = this;\n      if (typeof this.replicateMethods === 'undefined') {\n        this.replicateMethods = {\n          from: function (other, opts, callback) {\n            return self.constructor.replicate(other, self, opts, callback);\n          },\n          to: function (other, opts, callback) {\n            return self.constructor.replicate(self, other, opts, callback);\n          }\n        };\n      }\n      return this.replicateMethods;\n    }\n  });\n\n  PouchDB.prototype.sync = function (dbName, opts, callback) {\n    return this.constructor.sync(this, dbName, opts, callback);\n  };\n}\n\nPouchDB.plugin(IDBPouch)\n  .plugin(HttpPouch$1)\n  .plugin(mapreduce)\n  .plugin(replication);\n\nexport default PouchDB;\n","'use strict';\n\nvar Buffer = require('buffer').Buffer;\n\nfunction hasFrom() {\n  // Node versions 5.x below 5.10 seem to have a `from` method\n  // However, it doesn't clone Buffers\n  // Luckily, it reports as `false` to hasOwnProperty\n  return (Buffer.hasOwnProperty('from') && typeof Buffer.from === 'function');\n}\n\nfunction cloneBuffer(buf) {\n  if (!Buffer.isBuffer(buf)) {\n    throw new Error('Can only clone Buffer.');\n  }\n\n  if (hasFrom()) {\n    return Buffer.from(buf);\n  }\n\n  var copy = new Buffer(buf.length);\n  buf.copy(copy);\n  return copy;\n}\n\ncloneBuffer.hasFrom = hasFrom;\n\nmodule.exports = cloneBuffer;\n","function mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nexport { ExportedSet as Set, ExportedMap as Map };\n","import inherits from 'inherits';\n\ninherits(PouchError, Error);\n\nfunction PouchError(status, error, reason) {\n  Error.call(this, reason);\n  this.status = status;\n  this.name = error;\n  this.message = reason;\n  this.error = true;\n}\n\nPouchError.prototype.toString = function () {\n  return JSON.stringify({\n    status: this.status,\n    name: this.name,\n    message: this.message,\n    reason: this.reason\n  });\n};\n\nvar UNAUTHORIZED = new PouchError(401, 'unauthorized', \"Name or password is incorrect.\");\nvar MISSING_BULK_DOCS = new PouchError(400, 'bad_request', \"Missing JSON list of 'docs'\");\nvar MISSING_DOC = new PouchError(404, 'not_found', 'missing');\nvar REV_CONFLICT = new PouchError(409, 'conflict', 'Document update conflict');\nvar INVALID_ID = new PouchError(400, 'bad_request', '_id field must contain a string');\nvar MISSING_ID = new PouchError(412, 'missing_id', '_id is required for puts');\nvar RESERVED_ID = new PouchError(400, 'bad_request', 'Only reserved document ids may start with underscore.');\nvar NOT_OPEN = new PouchError(412, 'precondition_failed', 'Database not open');\nvar UNKNOWN_ERROR = new PouchError(500, 'unknown_error', 'Database encountered an unknown error');\nvar BAD_ARG = new PouchError(500, 'badarg', 'Some query argument is invalid');\nvar INVALID_REQUEST = new PouchError(400, 'invalid_request', 'Request was invalid');\nvar QUERY_PARSE_ERROR = new PouchError(400, 'query_parse_error', 'Some query parameter is invalid');\nvar DOC_VALIDATION = new PouchError(500, 'doc_validation', 'Bad special document member');\nvar BAD_REQUEST = new PouchError(400, 'bad_request', 'Something wrong with the request');\nvar NOT_AN_OBJECT = new PouchError(400, 'bad_request', 'Document must be a JSON object');\nvar DB_MISSING = new PouchError(404, 'not_found', 'Database not found');\nvar IDB_ERROR = new PouchError(500, 'indexed_db_went_bad', 'unknown');\nvar WSQ_ERROR = new PouchError(500, 'web_sql_went_bad', 'unknown');\nvar LDB_ERROR = new PouchError(500, 'levelDB_went_went_bad', 'unknown');\nvar FORBIDDEN = new PouchError(403, 'forbidden', 'Forbidden by design doc validate_doc_update function');\nvar INVALID_REV = new PouchError(400, 'bad_request', 'Invalid rev format');\nvar FILE_EXISTS = new PouchError(412, 'file_exists', 'The database could not be created, the file already exists.');\nvar MISSING_STUB = new PouchError(412, 'missing_stub', 'A pre-existing attachment stub wasn\\'t found');\nvar INVALID_URL = new PouchError(413, 'invalid_url', 'Provided URL is invalid');\n\nfunction createError(error, reason) {\n  function CustomPouchError(reason) {\n    // inherit error properties from our parent error manually\n    // so as to allow proper JSON parsing.\n    /* jshint ignore:start */\n    for (var p in error) {\n      if (typeof error[p] !== 'function') {\n        this[p] = error[p];\n      }\n    }\n    /* jshint ignore:end */\n    if (reason !== undefined) {\n      this.reason = reason;\n    }\n  }\n  CustomPouchError.prototype = PouchError.prototype;\n  return new CustomPouchError(reason);\n}\n\nfunction generateErrorFromResponse(err) {\n\n  if (typeof err !== 'object') {\n    var data = err;\n    err = UNKNOWN_ERROR;\n    err.data = data;\n  }\n\n  if ('error' in err && err.error === 'conflict') {\n    err.name = 'conflict';\n    err.status = 409;\n  }\n\n  if (!('name' in err)) {\n    err.name = err.error || 'unknown';\n  }\n\n  if (!('status' in err)) {\n    err.status = 500;\n  }\n\n  if (!('message' in err)) {\n    err.message = err.message || err.reason;\n  }\n\n  return err;\n}\n\nexport { UNAUTHORIZED, MISSING_BULK_DOCS, MISSING_DOC, REV_CONFLICT, INVALID_ID, MISSING_ID, RESERVED_ID, NOT_OPEN, UNKNOWN_ERROR, BAD_ARG, INVALID_REQUEST, QUERY_PARSE_ERROR, DOC_VALIDATION, BAD_REQUEST, NOT_AN_OBJECT, DB_MISSING, WSQ_ERROR, LDB_ERROR, FORBIDDEN, INVALID_REV, FILE_EXISTS, MISSING_STUB, IDB_ERROR, INVALID_URL, createError, generateErrorFromResponse };\n","import crypto from 'crypto';\n\nfunction binaryMd5(data, callback) {\n  var base64 = crypto.createHash('md5').update(data, 'binary').digest('base64');\n  callback(base64);\n}\n\nfunction stringMd5(string) {\n  return crypto.createHash('md5').update(string, 'binary').digest('hex');\n}\n\nexport { binaryMd5, stringMd5 };\n","import cloneBuffer from 'clone-buffer';\nimport getArguments from 'argsarray';\nimport { Map } from 'pouchdb-collections';\nimport { EventEmitter } from 'events';\nimport inherits from 'inherits';\nimport { createError, BAD_REQUEST, INVALID_ID, MISSING_ID, RESERVED_ID } from 'pouchdb-errors';\nimport uuidV4 from 'uuid';\nimport { stringMd5 } from 'pouchdb-md5';\nimport { clone } from 'pouchdb-utils';\n\nfunction isBinaryObject(object) {\n  return object instanceof Buffer;\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone$1(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone$1(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBuffer(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone$1(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone$1(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new Map();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\n// in Node of course this is false\nfunction hasLocalStorage() {\n  return false;\n}\n\nfunction nextTick(fn) {\n  process.nextTick(fn);\n}\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        nextTick(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// We assume Node users don't need to see this warning\nvar res = function () {};\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar assign$1 = assign;\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n// for browsers that don't support it like IE\n\n/* istanbul ignore next */\nfunction f() {}\n\nvar hasName = f.name;\nvar res$1;\n\n// We dont run coverage in IE\n/* istanbul ignore else */\nif (hasName) {\n  res$1 = function (fun) {\n    return fun.name;\n  };\n} else {\n  res$1 = function (fun) {\n    var match = fun.toString().match(/^\\s*function\\s*(?:(\\S+)\\s*)?\\(/);\n    if (match && match[1]) {\n      return match[1];\n    }\n    else {\n      return '';\n    }\n  };\n}\n\nvar res$2 = res$1;\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\nexport { adapterFun, assign$1 as assign, bulkGet as bulkGetShim, Changes as changesHandler, clone$1 as clone, defaultBackOff, res as explainError, filterChange, flatten, res$2 as functionName, guardedConsole, hasLocalStorage, invalidIdError, isRemote, listenerCount, nextTick, normalizeDesignDocFunctionName as normalizeDdocFunctionName, once, parseDesignDocFunctionName as parseDdocFunctionName, parseUri, pick, rev, scopeEval, toPromise, upsert, uuid };\n","\"use strict\";\n\nmodule.exports = exports = self.fetch;\n\n// Needed for TypeScript and Webpack.\nexports.default = self.fetch.bind(self);\n\nexports.Headers = self.Headers;\nexports.Request = self.Request;\nexports.Response = self.Response;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports[\"default\"] = function () {\n  var PromiseArg = arguments[0] === undefined ? Promise : arguments[0];\n  return function (f) {\n    return function () {\n      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return new PromiseArg(function (resolve, reject) {\n        return f.apply(undefined, args.concat([function (err, val) {\n          return err ? reject(err) : resolve(val);\n        }]));\n      });\n    };\n  };\n};\n\nmodule.exports = exports[\"default\"];\n\n","/*! https://mths.be/punycode v1.4.1 by @mathias */\n;(function(root) {\n\n\t/** Detect free variables */\n\tvar freeExports = typeof exports == 'object' && exports &&\n\t\t!exports.nodeType && exports;\n\tvar freeModule = typeof module == 'object' && module &&\n\t\t!module.nodeType && module;\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (\n\t\tfreeGlobal.global === freeGlobal ||\n\t\tfreeGlobal.window === freeGlobal ||\n\t\tfreeGlobal.self === freeGlobal\n\t) {\n\t\troot = freeGlobal;\n\t}\n\n\t/**\n\t * The `punycode` object.\n\t * @name punycode\n\t * @type Object\n\t */\n\tvar punycode,\n\n\t/** Highest positive signed 32-bit float value */\n\tmaxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1\n\n\t/** Bootstring parameters */\n\tbase = 36,\n\ttMin = 1,\n\ttMax = 26,\n\tskew = 38,\n\tdamp = 700,\n\tinitialBias = 72,\n\tinitialN = 128, // 0x80\n\tdelimiter = '-', // '\\x2D'\n\n\t/** Regular expressions */\n\tregexPunycode = /^xn--/,\n\tregexNonASCII = /[^\\x20-\\x7E]/, // unprintable ASCII chars + non-ASCII chars\n\tregexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g, // RFC 3490 separators\n\n\t/** Error messages */\n\terrors = {\n\t\t'overflow': 'Overflow: input needs wider integers to process',\n\t\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t\t'invalid-input': 'Invalid input'\n\t},\n\n\t/** Convenience shortcuts */\n\tbaseMinusTMin = base - tMin,\n\tfloor = Math.floor,\n\tstringFromCharCode = String.fromCharCode,\n\n\t/** Temporary variable */\n\tkey;\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/**\n\t * A generic error utility function.\n\t * @private\n\t * @param {String} type The error type.\n\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t */\n\tfunction error(type) {\n\t\tthrow new RangeError(errors[type]);\n\t}\n\n\t/**\n\t * A generic `Array#map` utility function.\n\t * @private\n\t * @param {Array} array The array to iterate over.\n\t * @param {Function} callback The function that gets called for every array\n\t * item.\n\t * @returns {Array} A new array of values returned by the callback function.\n\t */\n\tfunction map(array, fn) {\n\t\tvar length = array.length;\n\t\tvar result = [];\n\t\twhile (length--) {\n\t\t\tresult[length] = fn(array[length]);\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * A simple `Array#map`-like wrapper to work with domain name strings or email\n\t * addresses.\n\t * @private\n\t * @param {String} domain The domain name or email address.\n\t * @param {Function} callback The function that gets called for every\n\t * character.\n\t * @returns {Array} A new string of characters returned by the callback\n\t * function.\n\t */\n\tfunction mapDomain(string, fn) {\n\t\tvar parts = string.split('@');\n\t\tvar result = '';\n\t\tif (parts.length > 1) {\n\t\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t\t// the local part (i.e. everything up to `@`) intact.\n\t\t\tresult = parts[0] + '@';\n\t\t\tstring = parts[1];\n\t\t}\n\t\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\t\tstring = string.replace(regexSeparators, '\\x2E');\n\t\tvar labels = string.split('.');\n\t\tvar encoded = map(labels, fn).join('.');\n\t\treturn result + encoded;\n\t}\n\n\t/**\n\t * Creates an array containing the numeric code points of each Unicode\n\t * character in the string. While JavaScript uses UCS-2 internally,\n\t * this function will convert a pair of surrogate halves (each of which\n\t * UCS-2 exposes as separate characters) into a single code point,\n\t * matching UTF-16.\n\t * @see `punycode.ucs2.encode`\n\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode.ucs2\n\t * @name decode\n\t * @param {String} string The Unicode input string (UCS-2).\n\t * @returns {Array} The new array of code points.\n\t */\n\tfunction ucs2decode(string) {\n\t\tvar output = [],\n\t\t    counter = 0,\n\t\t    length = string.length,\n\t\t    value,\n\t\t    extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Creates a string based on an array of numeric code points.\n\t * @see `punycode.ucs2.decode`\n\t * @memberOf punycode.ucs2\n\t * @name encode\n\t * @param {Array} codePoints The array of numeric code points.\n\t * @returns {String} The new Unicode string (UCS-2).\n\t */\n\tfunction ucs2encode(array) {\n\t\treturn map(array, function(value) {\n\t\t\tvar output = '';\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t\treturn output;\n\t\t}).join('');\n\t}\n\n\t/**\n\t * Converts a basic code point into a digit/integer.\n\t * @see `digitToBasic()`\n\t * @private\n\t * @param {Number} codePoint The basic numeric code point value.\n\t * @returns {Number} The numeric value of a basic code point (for use in\n\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t * the code point does not represent a value.\n\t */\n\tfunction basicToDigit(codePoint) {\n\t\tif (codePoint - 48 < 10) {\n\t\t\treturn codePoint - 22;\n\t\t}\n\t\tif (codePoint - 65 < 26) {\n\t\t\treturn codePoint - 65;\n\t\t}\n\t\tif (codePoint - 97 < 26) {\n\t\t\treturn codePoint - 97;\n\t\t}\n\t\treturn base;\n\t}\n\n\t/**\n\t * Converts a digit/integer into a basic code point.\n\t * @see `basicToDigit()`\n\t * @private\n\t * @param {Number} digit The numeric value of a basic code point.\n\t * @returns {Number} The basic code point whose value (when used for\n\t * representing integers) is `digit`, which needs to be in the range\n\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t * used; else, the lowercase form is used. The behavior is undefined\n\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t */\n\tfunction digitToBasic(digit, flag) {\n\t\t//  0..25 map to ASCII a..z or A..Z\n\t\t// 26..35 map to ASCII 0..9\n\t\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n\t}\n\n\t/**\n\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t * https://tools.ietf.org/html/rfc3492#section-3.4\n\t * @private\n\t */\n\tfunction adapt(delta, numPoints, firstTime) {\n\t\tvar k = 0;\n\t\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\t\tdelta += floor(delta / numPoints);\n\t\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\t\tdelta = floor(delta / baseMinusTMin);\n\t\t}\n\t\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n\t}\n\n\t/**\n\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t * @returns {String} The resulting string of Unicode symbols.\n\t */\n\tfunction decode(input) {\n\t\t// Don't use UCS-2\n\t\tvar output = [],\n\t\t    inputLength = input.length,\n\t\t    out,\n\t\t    i = 0,\n\t\t    n = initialN,\n\t\t    bias = initialBias,\n\t\t    basic,\n\t\t    j,\n\t\t    index,\n\t\t    oldi,\n\t\t    w,\n\t\t    k,\n\t\t    digit,\n\t\t    t,\n\t\t    /** Cached calculation results */\n\t\t    baseMinusT;\n\n\t\t// Handle the basic code points: let `basic` be the number of input code\n\t\t// points before the last delimiter, or `0` if there is none, then copy\n\t\t// the first basic code points to the output.\n\n\t\tbasic = input.lastIndexOf(delimiter);\n\t\tif (basic < 0) {\n\t\t\tbasic = 0;\n\t\t}\n\n\t\tfor (j = 0; j < basic; ++j) {\n\t\t\t// if it's not a basic code point\n\t\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\t\terror('not-basic');\n\t\t\t}\n\t\t\toutput.push(input.charCodeAt(j));\n\t\t}\n\n\t\t// Main decoding loop: start just after the last delimiter if any basic code\n\t\t// points were copied; start at the beginning otherwise.\n\n\t\tfor (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t\t// `index` is the index of the next character to be consumed.\n\t\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t\t// which gets added to `i`. The overflow checking is easier\n\t\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t\t// value at the end to obtain `delta`.\n\t\t\tfor (oldi = i, w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\t\tif (index >= inputLength) {\n\t\t\t\t\terror('invalid-input');\n\t\t\t\t}\n\n\t\t\t\tdigit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\ti += digit * w;\n\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\t\tif (digit < t) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbaseMinusT = base - t;\n\t\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tw *= baseMinusT;\n\n\t\t\t}\n\n\t\t\tout = output.length + 1;\n\t\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t\t// incrementing `n` each time, so we'll fix that now:\n\t\t\tif (floor(i / out) > maxInt - n) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tn += floor(i / out);\n\t\t\ti %= out;\n\n\t\t\t// Insert `n` at position `i` of the output\n\t\t\toutput.splice(i++, 0, n);\n\n\t\t}\n\n\t\treturn ucs2encode(output);\n\t}\n\n\t/**\n\t * Converts a string of Unicode symbols (e.g. a domain name label) to a\n\t * Punycode string of ASCII-only symbols.\n\t * @memberOf punycode\n\t * @param {String} input The string of Unicode symbols.\n\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t */\n\tfunction encode(input) {\n\t\tvar n,\n\t\t    delta,\n\t\t    handledCPCount,\n\t\t    basicLength,\n\t\t    bias,\n\t\t    j,\n\t\t    m,\n\t\t    q,\n\t\t    k,\n\t\t    t,\n\t\t    currentValue,\n\t\t    output = [],\n\t\t    /** `inputLength` will hold the number of code points in `input`. */\n\t\t    inputLength,\n\t\t    /** Cached calculation results */\n\t\t    handledCPCountPlusOne,\n\t\t    baseMinusT,\n\t\t    qMinusT;\n\n\t\t// Convert the input in UCS-2 to Unicode\n\t\tinput = ucs2decode(input);\n\n\t\t// Cache the length\n\t\tinputLength = input.length;\n\n\t\t// Initialize the state\n\t\tn = initialN;\n\t\tdelta = 0;\n\t\tbias = initialBias;\n\n\t\t// Handle the basic code points\n\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\tcurrentValue = input[j];\n\t\t\tif (currentValue < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t\t}\n\t\t}\n\n\t\thandledCPCount = basicLength = output.length;\n\n\t\t// `handledCPCount` is the number of code points that have been handled;\n\t\t// `basicLength` is the number of basic code points.\n\n\t\t// Finish the basic string - if it is not empty - with a delimiter\n\t\tif (basicLength) {\n\t\t\toutput.push(delimiter);\n\t\t}\n\n\t\t// Main encoding loop:\n\t\twhile (handledCPCount < inputLength) {\n\n\t\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t\t// larger one:\n\t\t\tfor (m = maxInt, j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow\n\t\t\thandledCPCountPlusOne = handledCPCount + 1;\n\t\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\t\tn = m;\n\n\t\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\n\t\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tif (currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer\n\t\t\t\t\tfor (q = delta, k = base; /* no condition */; k += base) {\n\t\t\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqMinusT = q - t;\n\t\t\t\t\t\tbaseMinusT = base - t;\n\t\t\t\t\t\toutput.push(\n\t\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t\t);\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t++delta;\n\t\t\t++n;\n\n\t\t}\n\t\treturn output.join('');\n\t}\n\n\t/**\n\t * Converts a Punycode string representing a domain name or an email address\n\t * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n\t * it doesn't matter if you call it on a string that has already been\n\t * converted to Unicode.\n\t * @memberOf punycode\n\t * @param {String} input The Punycoded domain name or email address to\n\t * convert to Unicode.\n\t * @returns {String} The Unicode representation of the given Punycode\n\t * string.\n\t */\n\tfunction toUnicode(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexPunycode.test(string)\n\t\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/**\n\t * Converts a Unicode string representing a domain name or an email address to\n\t * Punycode. Only the non-ASCII parts of the domain name will be converted,\n\t * i.e. it doesn't matter if you call it with a domain that's already in\n\t * ASCII.\n\t * @memberOf punycode\n\t * @param {String} input The domain name or email address to convert, as a\n\t * Unicode string.\n\t * @returns {String} The Punycode representation of the given domain name or\n\t * email address.\n\t */\n\tfunction toASCII(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexNonASCII.test(string)\n\t\t\t\t? 'xn--' + encode(string)\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/** Define the public API */\n\tpunycode = {\n\t\t/**\n\t\t * A string representing the current Punycode.js version number.\n\t\t * @memberOf punycode\n\t\t * @type String\n\t\t */\n\t\t'version': '1.4.1',\n\t\t/**\n\t\t * An object of methods to convert from JavaScript's internal character\n\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode\n\t\t * @type Object\n\t\t */\n\t\t'ucs2': {\n\t\t\t'decode': ucs2decode,\n\t\t\t'encode': ucs2encode\n\t\t},\n\t\t'decode': decode,\n\t\t'encode': encode,\n\t\t'toASCII': toASCII,\n\t\t'toUnicode': toUnicode\n\t};\n\n\t/** Expose `punycode` */\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine('punycode', function() {\n\t\t\treturn punycode;\n\t\t});\n\t} else if (freeExports && freeModule) {\n\t\tif (module.exports == freeExports) {\n\t\t\t// in Node.js, io.js, or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = punycode;\n\t\t} else {\n\t\t\t// in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (key in punycode) {\n\t\t\t\tpunycode.hasOwnProperty(key) && (freeExports[key] = punycode[key]);\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// in Rhino or a web browser\n\t\troot.punycode = punycode;\n\t}\n\n}(this));\n","'use strict';\n\nmodule.exports = {\n  isString: function(arg) {\n    return typeof(arg) === 'string';\n  },\n  isObject: function(arg) {\n    return typeof(arg) === 'object' && arg !== null;\n  },\n  isNull: function(arg) {\n    return arg === null;\n  },\n  isNullOrUndefined: function(arg) {\n    return arg == null;\n  }\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return map(objectKeys(obj), function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (isArray(obj[k])) {\n        return map(obj[k], function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction map (xs, f) {\n  if (xs.map) return xs.map(f);\n  var res = [];\n  for (var i = 0; i < xs.length; i++) {\n    res.push(f(xs[i], i));\n  }\n  return res;\n}\n\nvar objectKeys = Object.keys || function (obj) {\n  var res = [];\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);\n  }\n  return res;\n};\n","'use strict';\n\nexports.decode = exports.parse = require('./decode');\nexports.encode = exports.stringify = require('./encode');\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar punycode = require('punycode');\nvar util = require('./util');\n\nexports.parse = urlParse;\nexports.resolve = urlResolve;\nexports.resolveObject = urlResolveObject;\nexports.format = urlFormat;\n\nexports.Url = Url;\n\nfunction Url() {\n  this.protocol = null;\n  this.slashes = null;\n  this.auth = null;\n  this.host = null;\n  this.port = null;\n  this.hostname = null;\n  this.hash = null;\n  this.search = null;\n  this.query = null;\n  this.pathname = null;\n  this.path = null;\n  this.href = null;\n}\n\n// Reference: RFC 3986, RFC 1808, RFC 2396\n\n// define these here so at least they only have to be\n// compiled once on the first module load.\nvar protocolPattern = /^([a-z0-9.+-]+:)/i,\n    portPattern = /:[0-9]*$/,\n\n    // Special case for a simple path URL\n    simplePathPattern = /^(\\/\\/?(?!\\/)[^\\?\\s]*)(\\?[^\\s]*)?$/,\n\n    // RFC 2396: characters reserved for delimiting URLs.\n    // We actually just auto-escape these.\n    delims = ['<', '>', '\"', '`', ' ', '\\r', '\\n', '\\t'],\n\n    // RFC 2396: characters not allowed for various reasons.\n    unwise = ['{', '}', '|', '\\\\', '^', '`'].concat(delims),\n\n    // Allowed by RFCs, but cause of XSS attacks.  Always escape these.\n    autoEscape = ['\\''].concat(unwise),\n    // Characters that are never ever allowed in a hostname.\n    // Note that any invalid chars are also handled, but these\n    // are the ones that are *expected* to be seen, so we fast-path\n    // them.\n    nonHostChars = ['%', '/', '?', ';', '#'].concat(autoEscape),\n    hostEndingChars = ['/', '?', '#'],\n    hostnameMaxLen = 255,\n    hostnamePartPattern = /^[+a-z0-9A-Z_-]{0,63}$/,\n    hostnamePartStart = /^([+a-z0-9A-Z_-]{0,63})(.*)$/,\n    // protocols that can allow \"unsafe\" and \"unwise\" chars.\n    unsafeProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that never have a hostname.\n    hostlessProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that always contain a // bit.\n    slashedProtocol = {\n      'http': true,\n      'https': true,\n      'ftp': true,\n      'gopher': true,\n      'file': true,\n      'http:': true,\n      'https:': true,\n      'ftp:': true,\n      'gopher:': true,\n      'file:': true\n    },\n    querystring = require('querystring');\n\nfunction urlParse(url, parseQueryString, slashesDenoteHost) {\n  if (url && util.isObject(url) && url instanceof Url) return url;\n\n  var u = new Url;\n  u.parse(url, parseQueryString, slashesDenoteHost);\n  return u;\n}\n\nUrl.prototype.parse = function(url, parseQueryString, slashesDenoteHost) {\n  if (!util.isString(url)) {\n    throw new TypeError(\"Parameter 'url' must be a string, not \" + typeof url);\n  }\n\n  // Copy chrome, IE, opera backslash-handling behavior.\n  // Back slashes before the query string get converted to forward slashes\n  // See: https://code.google.com/p/chromium/issues/detail?id=25916\n  var queryIndex = url.indexOf('?'),\n      splitter =\n          (queryIndex !== -1 && queryIndex < url.indexOf('#')) ? '?' : '#',\n      uSplit = url.split(splitter),\n      slashRegex = /\\\\/g;\n  uSplit[0] = uSplit[0].replace(slashRegex, '/');\n  url = uSplit.join(splitter);\n\n  var rest = url;\n\n  // trim before proceeding.\n  // This is to support parse stuff like \"  http://foo.com  \\n\"\n  rest = rest.trim();\n\n  if (!slashesDenoteHost && url.split('#').length === 1) {\n    // Try fast path regexp\n    var simplePath = simplePathPattern.exec(rest);\n    if (simplePath) {\n      this.path = rest;\n      this.href = rest;\n      this.pathname = simplePath[1];\n      if (simplePath[2]) {\n        this.search = simplePath[2];\n        if (parseQueryString) {\n          this.query = querystring.parse(this.search.substr(1));\n        } else {\n          this.query = this.search.substr(1);\n        }\n      } else if (parseQueryString) {\n        this.search = '';\n        this.query = {};\n      }\n      return this;\n    }\n  }\n\n  var proto = protocolPattern.exec(rest);\n  if (proto) {\n    proto = proto[0];\n    var lowerProto = proto.toLowerCase();\n    this.protocol = lowerProto;\n    rest = rest.substr(proto.length);\n  }\n\n  // figure out if it's got a host\n  // user@server is *always* interpreted as a hostname, and url\n  // resolution will treat //foo/bar as host=foo,path=bar because that's\n  // how the browser resolves relative URLs.\n  if (slashesDenoteHost || proto || rest.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)) {\n    var slashes = rest.substr(0, 2) === '//';\n    if (slashes && !(proto && hostlessProtocol[proto])) {\n      rest = rest.substr(2);\n      this.slashes = true;\n    }\n  }\n\n  if (!hostlessProtocol[proto] &&\n      (slashes || (proto && !slashedProtocol[proto]))) {\n\n    // there's a hostname.\n    // the first instance of /, ?, ;, or # ends the host.\n    //\n    // If there is an @ in the hostname, then non-host chars *are* allowed\n    // to the left of the last @ sign, unless some host-ending character\n    // comes *before* the @-sign.\n    // URLs are obnoxious.\n    //\n    // ex:\n    // http://a@b@c/ => user:a@b host:c\n    // http://a@b?@c => user:a host:c path:/?@c\n\n    // v0.12 TODO(isaacs): This is not quite how Chrome does things.\n    // Review our test case against browsers more comprehensively.\n\n    // find the first instance of any hostEndingChars\n    var hostEnd = -1;\n    for (var i = 0; i < hostEndingChars.length; i++) {\n      var hec = rest.indexOf(hostEndingChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n\n    // at this point, either we have an explicit point where the\n    // auth portion cannot go past, or the last @ char is the decider.\n    var auth, atSign;\n    if (hostEnd === -1) {\n      // atSign can be anywhere.\n      atSign = rest.lastIndexOf('@');\n    } else {\n      // atSign must be in auth portion.\n      // http://a@b/c@d => host:b auth:a path:/c@d\n      atSign = rest.lastIndexOf('@', hostEnd);\n    }\n\n    // Now we have a portion which is definitely the auth.\n    // Pull that off.\n    if (atSign !== -1) {\n      auth = rest.slice(0, atSign);\n      rest = rest.slice(atSign + 1);\n      this.auth = decodeURIComponent(auth);\n    }\n\n    // the host is the remaining to the left of the first non-host char\n    hostEnd = -1;\n    for (var i = 0; i < nonHostChars.length; i++) {\n      var hec = rest.indexOf(nonHostChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n    // if we still have not hit it, then the entire thing is a host.\n    if (hostEnd === -1)\n      hostEnd = rest.length;\n\n    this.host = rest.slice(0, hostEnd);\n    rest = rest.slice(hostEnd);\n\n    // pull out port.\n    this.parseHost();\n\n    // we've indicated that there is a hostname,\n    // so even if it's empty, it has to be present.\n    this.hostname = this.hostname || '';\n\n    // if hostname begins with [ and ends with ]\n    // assume that it's an IPv6 address.\n    var ipv6Hostname = this.hostname[0] === '[' &&\n        this.hostname[this.hostname.length - 1] === ']';\n\n    // validate a little.\n    if (!ipv6Hostname) {\n      var hostparts = this.hostname.split(/\\./);\n      for (var i = 0, l = hostparts.length; i < l; i++) {\n        var part = hostparts[i];\n        if (!part) continue;\n        if (!part.match(hostnamePartPattern)) {\n          var newpart = '';\n          for (var j = 0, k = part.length; j < k; j++) {\n            if (part.charCodeAt(j) > 127) {\n              // we replace non-ASCII char with a temporary placeholder\n              // we need this to make sure size of hostname is not\n              // broken by replacing non-ASCII by nothing\n              newpart += 'x';\n            } else {\n              newpart += part[j];\n            }\n          }\n          // we test again with ASCII char only\n          if (!newpart.match(hostnamePartPattern)) {\n            var validParts = hostparts.slice(0, i);\n            var notHost = hostparts.slice(i + 1);\n            var bit = part.match(hostnamePartStart);\n            if (bit) {\n              validParts.push(bit[1]);\n              notHost.unshift(bit[2]);\n            }\n            if (notHost.length) {\n              rest = '/' + notHost.join('.') + rest;\n            }\n            this.hostname = validParts.join('.');\n            break;\n          }\n        }\n      }\n    }\n\n    if (this.hostname.length > hostnameMaxLen) {\n      this.hostname = '';\n    } else {\n      // hostnames are always lower case.\n      this.hostname = this.hostname.toLowerCase();\n    }\n\n    if (!ipv6Hostname) {\n      // IDNA Support: Returns a punycoded representation of \"domain\".\n      // It only converts parts of the domain name that\n      // have non-ASCII characters, i.e. it doesn't matter if\n      // you call it with a domain that already is ASCII-only.\n      this.hostname = punycode.toASCII(this.hostname);\n    }\n\n    var p = this.port ? ':' + this.port : '';\n    var h = this.hostname || '';\n    this.host = h + p;\n    this.href += this.host;\n\n    // strip [ and ] from the hostname\n    // the host field still retains them, though\n    if (ipv6Hostname) {\n      this.hostname = this.hostname.substr(1, this.hostname.length - 2);\n      if (rest[0] !== '/') {\n        rest = '/' + rest;\n      }\n    }\n  }\n\n  // now rest is set to the post-host stuff.\n  // chop off any delim chars.\n  if (!unsafeProtocol[lowerProto]) {\n\n    // First, make 100% sure that any \"autoEscape\" chars get\n    // escaped, even if encodeURIComponent doesn't think they\n    // need to be.\n    for (var i = 0, l = autoEscape.length; i < l; i++) {\n      var ae = autoEscape[i];\n      if (rest.indexOf(ae) === -1)\n        continue;\n      var esc = encodeURIComponent(ae);\n      if (esc === ae) {\n        esc = escape(ae);\n      }\n      rest = rest.split(ae).join(esc);\n    }\n  }\n\n\n  // chop off from the tail first.\n  var hash = rest.indexOf('#');\n  if (hash !== -1) {\n    // got a fragment string.\n    this.hash = rest.substr(hash);\n    rest = rest.slice(0, hash);\n  }\n  var qm = rest.indexOf('?');\n  if (qm !== -1) {\n    this.search = rest.substr(qm);\n    this.query = rest.substr(qm + 1);\n    if (parseQueryString) {\n      this.query = querystring.parse(this.query);\n    }\n    rest = rest.slice(0, qm);\n  } else if (parseQueryString) {\n    // no query string, but parseQueryString still requested\n    this.search = '';\n    this.query = {};\n  }\n  if (rest) this.pathname = rest;\n  if (slashedProtocol[lowerProto] &&\n      this.hostname && !this.pathname) {\n    this.pathname = '/';\n  }\n\n  //to support http.request\n  if (this.pathname || this.search) {\n    var p = this.pathname || '';\n    var s = this.search || '';\n    this.path = p + s;\n  }\n\n  // finally, reconstruct the href based on what has been validated.\n  this.href = this.format();\n  return this;\n};\n\n// format a parsed object into a url string\nfunction urlFormat(obj) {\n  // ensure it's an object, and not a string url.\n  // If it's an obj, this is a no-op.\n  // this way, you can call url_format() on strings\n  // to clean up potentially wonky urls.\n  if (util.isString(obj)) obj = urlParse(obj);\n  if (!(obj instanceof Url)) return Url.prototype.format.call(obj);\n  return obj.format();\n}\n\nUrl.prototype.format = function() {\n  var auth = this.auth || '';\n  if (auth) {\n    auth = encodeURIComponent(auth);\n    auth = auth.replace(/%3A/i, ':');\n    auth += '@';\n  }\n\n  var protocol = this.protocol || '',\n      pathname = this.pathname || '',\n      hash = this.hash || '',\n      host = false,\n      query = '';\n\n  if (this.host) {\n    host = auth + this.host;\n  } else if (this.hostname) {\n    host = auth + (this.hostname.indexOf(':') === -1 ?\n        this.hostname :\n        '[' + this.hostname + ']');\n    if (this.port) {\n      host += ':' + this.port;\n    }\n  }\n\n  if (this.query &&\n      util.isObject(this.query) &&\n      Object.keys(this.query).length) {\n    query = querystring.stringify(this.query);\n  }\n\n  var search = this.search || (query && ('?' + query)) || '';\n\n  if (protocol && protocol.substr(-1) !== ':') protocol += ':';\n\n  // only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.\n  // unless they had them to begin with.\n  if (this.slashes ||\n      (!protocol || slashedProtocol[protocol]) && host !== false) {\n    host = '//' + (host || '');\n    if (pathname && pathname.charAt(0) !== '/') pathname = '/' + pathname;\n  } else if (!host) {\n    host = '';\n  }\n\n  if (hash && hash.charAt(0) !== '#') hash = '#' + hash;\n  if (search && search.charAt(0) !== '?') search = '?' + search;\n\n  pathname = pathname.replace(/[?#]/g, function(match) {\n    return encodeURIComponent(match);\n  });\n  search = search.replace('#', '%23');\n\n  return protocol + host + pathname + search + hash;\n};\n\nfunction urlResolve(source, relative) {\n  return urlParse(source, false, true).resolve(relative);\n}\n\nUrl.prototype.resolve = function(relative) {\n  return this.resolveObject(urlParse(relative, false, true)).format();\n};\n\nfunction urlResolveObject(source, relative) {\n  if (!source) return relative;\n  return urlParse(source, false, true).resolveObject(relative);\n}\n\nUrl.prototype.resolveObject = function(relative) {\n  if (util.isString(relative)) {\n    var rel = new Url();\n    rel.parse(relative, false, true);\n    relative = rel;\n  }\n\n  var result = new Url();\n  var tkeys = Object.keys(this);\n  for (var tk = 0; tk < tkeys.length; tk++) {\n    var tkey = tkeys[tk];\n    result[tkey] = this[tkey];\n  }\n\n  // hash is always overridden, no matter what.\n  // even href=\"\" will remove it.\n  result.hash = relative.hash;\n\n  // if the relative url is empty, then there's nothing left to do here.\n  if (relative.href === '') {\n    result.href = result.format();\n    return result;\n  }\n\n  // hrefs like //foo/bar always cut to the protocol.\n  if (relative.slashes && !relative.protocol) {\n    // take everything except the protocol from relative\n    var rkeys = Object.keys(relative);\n    for (var rk = 0; rk < rkeys.length; rk++) {\n      var rkey = rkeys[rk];\n      if (rkey !== 'protocol')\n        result[rkey] = relative[rkey];\n    }\n\n    //urlParse appends trailing / to urls like http://www.example.com\n    if (slashedProtocol[result.protocol] &&\n        result.hostname && !result.pathname) {\n      result.path = result.pathname = '/';\n    }\n\n    result.href = result.format();\n    return result;\n  }\n\n  if (relative.protocol && relative.protocol !== result.protocol) {\n    // if it's a known url protocol, then changing\n    // the protocol does weird things\n    // first, if it's not file:, then we MUST have a host,\n    // and if there was a path\n    // to begin with, then we MUST have a path.\n    // if it is file:, then the host is dropped,\n    // because that's known to be hostless.\n    // anything else is assumed to be absolute.\n    if (!slashedProtocol[relative.protocol]) {\n      var keys = Object.keys(relative);\n      for (var v = 0; v < keys.length; v++) {\n        var k = keys[v];\n        result[k] = relative[k];\n      }\n      result.href = result.format();\n      return result;\n    }\n\n    result.protocol = relative.protocol;\n    if (!relative.host && !hostlessProtocol[relative.protocol]) {\n      var relPath = (relative.pathname || '').split('/');\n      while (relPath.length && !(relative.host = relPath.shift()));\n      if (!relative.host) relative.host = '';\n      if (!relative.hostname) relative.hostname = '';\n      if (relPath[0] !== '') relPath.unshift('');\n      if (relPath.length < 2) relPath.unshift('');\n      result.pathname = relPath.join('/');\n    } else {\n      result.pathname = relative.pathname;\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    result.host = relative.host || '';\n    result.auth = relative.auth;\n    result.hostname = relative.hostname || relative.host;\n    result.port = relative.port;\n    // to support http.request\n    if (result.pathname || result.search) {\n      var p = result.pathname || '';\n      var s = result.search || '';\n      result.path = p + s;\n    }\n    result.slashes = result.slashes || relative.slashes;\n    result.href = result.format();\n    return result;\n  }\n\n  var isSourceAbs = (result.pathname && result.pathname.charAt(0) === '/'),\n      isRelAbs = (\n          relative.host ||\n          relative.pathname && relative.pathname.charAt(0) === '/'\n      ),\n      mustEndAbs = (isRelAbs || isSourceAbs ||\n                    (result.host && relative.pathname)),\n      removeAllDots = mustEndAbs,\n      srcPath = result.pathname && result.pathname.split('/') || [],\n      relPath = relative.pathname && relative.pathname.split('/') || [],\n      psychotic = result.protocol && !slashedProtocol[result.protocol];\n\n  // if the url is a non-slashed url, then relative\n  // links like ../.. should be able\n  // to crawl up to the hostname, as well.  This is strange.\n  // result.protocol has already been set by now.\n  // Later on, put the first path part into the host field.\n  if (psychotic) {\n    result.hostname = '';\n    result.port = null;\n    if (result.host) {\n      if (srcPath[0] === '') srcPath[0] = result.host;\n      else srcPath.unshift(result.host);\n    }\n    result.host = '';\n    if (relative.protocol) {\n      relative.hostname = null;\n      relative.port = null;\n      if (relative.host) {\n        if (relPath[0] === '') relPath[0] = relative.host;\n        else relPath.unshift(relative.host);\n      }\n      relative.host = null;\n    }\n    mustEndAbs = mustEndAbs && (relPath[0] === '' || srcPath[0] === '');\n  }\n\n  if (isRelAbs) {\n    // it's absolute.\n    result.host = (relative.host || relative.host === '') ?\n                  relative.host : result.host;\n    result.hostname = (relative.hostname || relative.hostname === '') ?\n                      relative.hostname : result.hostname;\n    result.search = relative.search;\n    result.query = relative.query;\n    srcPath = relPath;\n    // fall through to the dot-handling below.\n  } else if (relPath.length) {\n    // it's relative\n    // throw away the existing file, and take the new path instead.\n    if (!srcPath) srcPath = [];\n    srcPath.pop();\n    srcPath = srcPath.concat(relPath);\n    result.search = relative.search;\n    result.query = relative.query;\n  } else if (!util.isNullOrUndefined(relative.search)) {\n    // just pull out the search.\n    // like href='?foo'.\n    // Put this after the other two cases because it simplifies the booleans\n    if (psychotic) {\n      result.hostname = result.host = srcPath.shift();\n      //occationaly the auth can get stuck only in host\n      //this especially happens in cases like\n      //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n      var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                       result.host.split('@') : false;\n      if (authInHost) {\n        result.auth = authInHost.shift();\n        result.host = result.hostname = authInHost.shift();\n      }\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    //to support http.request\n    if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n      result.path = (result.pathname ? result.pathname : '') +\n                    (result.search ? result.search : '');\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  if (!srcPath.length) {\n    // no path at all.  easy.\n    // we've already handled the other stuff above.\n    result.pathname = null;\n    //to support http.request\n    if (result.search) {\n      result.path = '/' + result.search;\n    } else {\n      result.path = null;\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  // if a url ENDs in . or .., then it must get a trailing slash.\n  // however, if it ends in anything else non-slashy,\n  // then it must NOT get a trailing slash.\n  var last = srcPath.slice(-1)[0];\n  var hasTrailingSlash = (\n      (result.host || relative.host || srcPath.length > 1) &&\n      (last === '.' || last === '..') || last === '');\n\n  // strip single dots, resolve double dots to parent dir\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = srcPath.length; i >= 0; i--) {\n    last = srcPath[i];\n    if (last === '.') {\n      srcPath.splice(i, 1);\n    } else if (last === '..') {\n      srcPath.splice(i, 1);\n      up++;\n    } else if (up) {\n      srcPath.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (!mustEndAbs && !removeAllDots) {\n    for (; up--; up) {\n      srcPath.unshift('..');\n    }\n  }\n\n  if (mustEndAbs && srcPath[0] !== '' &&\n      (!srcPath[0] || srcPath[0].charAt(0) !== '/')) {\n    srcPath.unshift('');\n  }\n\n  if (hasTrailingSlash && (srcPath.join('/').substr(-1) !== '/')) {\n    srcPath.push('');\n  }\n\n  var isAbsolute = srcPath[0] === '' ||\n      (srcPath[0] && srcPath[0].charAt(0) === '/');\n\n  // put the host back\n  if (psychotic) {\n    result.hostname = result.host = isAbsolute ? '' :\n                                    srcPath.length ? srcPath.shift() : '';\n    //occationaly the auth can get stuck only in host\n    //this especially happens in cases like\n    //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n    var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                     result.host.split('@') : false;\n    if (authInHost) {\n      result.auth = authInHost.shift();\n      result.host = result.hostname = authInHost.shift();\n    }\n  }\n\n  mustEndAbs = mustEndAbs || (result.host && srcPath.length);\n\n  if (mustEndAbs && !isAbsolute) {\n    srcPath.unshift('');\n  }\n\n  if (!srcPath.length) {\n    result.pathname = null;\n    result.path = null;\n  } else {\n    result.pathname = srcPath.join('/');\n  }\n\n  //to support request.http\n  if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n    result.path = (result.pathname ? result.pathname : '') +\n                  (result.search ? result.search : '');\n  }\n  result.auth = relative.auth || result.auth;\n  result.slashes = result.slashes || relative.slashes;\n  result.href = result.format();\n  return result;\n};\n\nUrl.prototype.parseHost = function() {\n  var host = this.host;\n  var port = portPattern.exec(host);\n  if (port) {\n    port = port[0];\n    if (port !== ':') {\n      this.port = port.substr(1);\n    }\n    host = host.substr(0, host.length - port.length);\n  }\n  if (host) this.hostname = host;\n};\n","module.exports = function isBuffer(arg) {\n  return arg instanceof Buffer;\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  // Allow for deprecating things in the process of starting up.\n  if (isUndefined(global.process)) {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  if (process.noDeprecation === true) {\n    return fn;\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n","/*eslint no-var:0, prefer-arrow-callback: 0, object-shorthand: 0 */\n'use strict';\n\n\nvar Punycode = require('punycode');\n\n\nvar internals = {};\n\n\n//\n// Read rules from file.\n//\ninternals.rules = require('./data/rules.json').map(function (rule) {\n\n  return {\n    rule: rule,\n    suffix: rule.replace(/^(\\*\\.|\\!)/, ''),\n    punySuffix: -1,\n    wildcard: rule.charAt(0) === '*',\n    exception: rule.charAt(0) === '!'\n  };\n});\n\n\n//\n// Check is given string ends with `suffix`.\n//\ninternals.endsWith = function (str, suffix) {\n\n  return str.indexOf(suffix, str.length - suffix.length) !== -1;\n};\n\n\n//\n// Find rule for a given domain.\n//\ninternals.findRule = function (domain) {\n\n  var punyDomain = Punycode.toASCII(domain);\n  return internals.rules.reduce(function (memo, rule) {\n\n    if (rule.punySuffix === -1){\n      rule.punySuffix = Punycode.toASCII(rule.suffix);\n    }\n    if (!internals.endsWith(punyDomain, '.' + rule.punySuffix) && punyDomain !== rule.punySuffix) {\n      return memo;\n    }\n    // This has been commented out as it never seems to run. This is because\n    // sub tlds always appear after their parents and we never find a shorter\n    // match.\n    //if (memo) {\n    //  var memoSuffix = Punycode.toASCII(memo.suffix);\n    //  if (memoSuffix.length >= punySuffix.length) {\n    //    return memo;\n    //  }\n    //}\n    return rule;\n  }, null);\n};\n\n\n//\n// Error codes and messages.\n//\nexports.errorCodes = {\n  DOMAIN_TOO_SHORT: 'Domain name too short.',\n  DOMAIN_TOO_LONG: 'Domain name too long. It should be no more than 255 chars.',\n  LABEL_STARTS_WITH_DASH: 'Domain name label can not start with a dash.',\n  LABEL_ENDS_WITH_DASH: 'Domain name label can not end with a dash.',\n  LABEL_TOO_LONG: 'Domain name label should be at most 63 chars long.',\n  LABEL_TOO_SHORT: 'Domain name label should be at least 1 character long.',\n  LABEL_INVALID_CHARS: 'Domain name label can only contain alphanumeric characters or dashes.'\n};\n\n\n//\n// Validate domain name and throw if not valid.\n//\n// From wikipedia:\n//\n// Hostnames are composed of series of labels concatenated with dots, as are all\n// domain names. Each label must be between 1 and 63 characters long, and the\n// entire hostname (including the delimiting dots) has a maximum of 255 chars.\n//\n// Allowed chars:\n//\n// * `a-z`\n// * `0-9`\n// * `-` but not as a starting or ending character\n// * `.` as a separator for the textual portions of a domain name\n//\n// * http://en.wikipedia.org/wiki/Domain_name\n// * http://en.wikipedia.org/wiki/Hostname\n//\ninternals.validate = function (input) {\n\n  // Before we can validate we need to take care of IDNs with unicode chars.\n  var ascii = Punycode.toASCII(input);\n\n  if (ascii.length < 1) {\n    return 'DOMAIN_TOO_SHORT';\n  }\n  if (ascii.length > 255) {\n    return 'DOMAIN_TOO_LONG';\n  }\n\n  // Check each part's length and allowed chars.\n  var labels = ascii.split('.');\n  var label;\n\n  for (var i = 0; i < labels.length; ++i) {\n    label = labels[i];\n    if (!label.length) {\n      return 'LABEL_TOO_SHORT';\n    }\n    if (label.length > 63) {\n      return 'LABEL_TOO_LONG';\n    }\n    if (label.charAt(0) === '-') {\n      return 'LABEL_STARTS_WITH_DASH';\n    }\n    if (label.charAt(label.length - 1) === '-') {\n      return 'LABEL_ENDS_WITH_DASH';\n    }\n    if (!/^[a-z0-9\\-]+$/.test(label)) {\n      return 'LABEL_INVALID_CHARS';\n    }\n  }\n};\n\n\n//\n// Public API\n//\n\n\n//\n// Parse domain.\n//\nexports.parse = function (input) {\n\n  if (typeof input !== 'string') {\n    throw new TypeError('Domain name must be a string.');\n  }\n\n  // Force domain to lowercase.\n  var domain = input.slice(0).toLowerCase();\n\n  // Handle FQDN.\n  // TODO: Simply remove trailing dot?\n  if (domain.charAt(domain.length - 1) === '.') {\n    domain = domain.slice(0, domain.length - 1);\n  }\n\n  // Validate and sanitise input.\n  var error = internals.validate(domain);\n  if (error) {\n    return {\n      input: input,\n      error: {\n        message: exports.errorCodes[error],\n        code: error\n      }\n    };\n  }\n\n  var parsed = {\n    input: input,\n    tld: null,\n    sld: null,\n    domain: null,\n    subdomain: null,\n    listed: false\n  };\n\n  var domainParts = domain.split('.');\n\n  // Non-Internet TLD\n  if (domainParts[domainParts.length - 1] === 'local') {\n    return parsed;\n  }\n\n  var handlePunycode = function () {\n\n    if (!/xn--/.test(domain)) {\n      return parsed;\n    }\n    if (parsed.domain) {\n      parsed.domain = Punycode.toASCII(parsed.domain);\n    }\n    if (parsed.subdomain) {\n      parsed.subdomain = Punycode.toASCII(parsed.subdomain);\n    }\n    return parsed;\n  };\n\n  var rule = internals.findRule(domain);\n\n  // Unlisted tld.\n  if (!rule) {\n    if (domainParts.length < 2) {\n      return parsed;\n    }\n    parsed.tld = domainParts.pop();\n    parsed.sld = domainParts.pop();\n    parsed.domain = [parsed.sld, parsed.tld].join('.');\n    if (domainParts.length) {\n      parsed.subdomain = domainParts.pop();\n    }\n    return handlePunycode();\n  }\n\n  // At this point we know the public suffix is listed.\n  parsed.listed = true;\n\n  var tldParts = rule.suffix.split('.');\n  var privateParts = domainParts.slice(0, domainParts.length - tldParts.length);\n\n  if (rule.exception) {\n    privateParts.push(tldParts.shift());\n  }\n\n  parsed.tld = tldParts.join('.');\n\n  if (!privateParts.length) {\n    return handlePunycode();\n  }\n\n  if (rule.wildcard) {\n    tldParts.unshift(privateParts.pop());\n    parsed.tld = tldParts.join('.');\n  }\n\n  if (!privateParts.length) {\n    return handlePunycode();\n  }\n\n  parsed.sld = privateParts.pop();\n  parsed.domain = [parsed.sld,  parsed.tld].join('.');\n\n  if (privateParts.length) {\n    parsed.subdomain = privateParts.join('.');\n  }\n\n  return handlePunycode();\n};\n\n\n//\n// Get domain.\n//\nexports.get = function (domain) {\n\n  if (!domain) {\n    return null;\n  }\n  return exports.parse(domain).domain || null;\n};\n\n\n//\n// Check whether domain belongs to a known public suffix.\n//\nexports.isValid = function (domain) {\n\n  var parsed = exports.parse(domain);\n  return Boolean(parsed.domain && parsed.listed);\n};\n","/*!\n * Copyright (c) 2018, Salesforce.com, Inc.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice,\n * this list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n * this list of conditions and the following disclaimer in the documentation\n * and/or other materials provided with the distribution.\n *\n * 3. Neither the name of Salesforce.com nor the names of its contributors may\n * be used to endorse or promote products derived from this software without\n * specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n'use strict';\nvar psl = require('psl');\n\nfunction getPublicSuffix(domain) {\n  return psl.get(domain);\n}\n\nexports.getPublicSuffix = getPublicSuffix;\n","/*!\n * Copyright (c) 2015, Salesforce.com, Inc.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice,\n * this list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n * this list of conditions and the following disclaimer in the documentation\n * and/or other materials provided with the distribution.\n *\n * 3. Neither the name of Salesforce.com nor the names of its contributors may\n * be used to endorse or promote products derived from this software without\n * specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n'use strict';\n/*jshint unused:false */\n\nfunction Store() {\n}\nexports.Store = Store;\n\n// Stores may be synchronous, but are still required to use a\n// Continuation-Passing Style API.  The CookieJar itself will expose a \"*Sync\"\n// API that converts from synchronous-callbacks to imperative style.\nStore.prototype.synchronous = false;\n\nStore.prototype.findCookie = function(domain, path, key, cb) {\n  throw new Error('findCookie is not implemented');\n};\n\nStore.prototype.findCookies = function(domain, path, cb) {\n  throw new Error('findCookies is not implemented');\n};\n\nStore.prototype.putCookie = function(cookie, cb) {\n  throw new Error('putCookie is not implemented');\n};\n\nStore.prototype.updateCookie = function(oldCookie, newCookie, cb) {\n  // recommended default implementation:\n  // return this.putCookie(newCookie, cb);\n  throw new Error('updateCookie is not implemented');\n};\n\nStore.prototype.removeCookie = function(domain, path, key, cb) {\n  throw new Error('removeCookie is not implemented');\n};\n\nStore.prototype.removeCookies = function(domain, path, cb) {\n  throw new Error('removeCookies is not implemented');\n};\n\nStore.prototype.getAllCookies = function(cb) {\n  throw new Error('getAllCookies is not implemented (therefore jar cannot be serialized)');\n};\n","/*!\n * Copyright (c) 2015, Salesforce.com, Inc.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice,\n * this list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n * this list of conditions and the following disclaimer in the documentation\n * and/or other materials provided with the distribution.\n *\n * 3. Neither the name of Salesforce.com nor the names of its contributors may\n * be used to endorse or promote products derived from this software without\n * specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n\"use strict\";\nvar pubsuffix = require('./pubsuffix-psl');\n\n// Gives the permutation of all possible domainMatch()es of a given domain. The\n// array is in shortest-to-longest order.  Handy for indexing.\nfunction permuteDomain (domain) {\n  var pubSuf = pubsuffix.getPublicSuffix(domain);\n  if (!pubSuf) {\n    return null;\n  }\n  if (pubSuf == domain) {\n    return [domain];\n  }\n\n  var prefix = domain.slice(0, -(pubSuf.length + 1)); // \".example.com\"\n  var parts = prefix.split('.').reverse();\n  var cur = pubSuf;\n  var permutations = [cur];\n  while (parts.length) {\n    cur = parts.shift() + '.' + cur;\n    permutations.push(cur);\n  }\n  return permutations;\n}\n\nexports.permuteDomain = permuteDomain;\n","/*!\n * Copyright (c) 2015, Salesforce.com, Inc.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice,\n * this list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n * this list of conditions and the following disclaimer in the documentation\n * and/or other materials provided with the distribution.\n *\n * 3. Neither the name of Salesforce.com nor the names of its contributors may\n * be used to endorse or promote products derived from this software without\n * specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n\"use strict\";\n/*\n * \"A request-path path-matches a given cookie-path if at least one of the\n * following conditions holds:\"\n */\nfunction pathMatch (reqPath, cookiePath) {\n  // \"o  The cookie-path and the request-path are identical.\"\n  if (cookiePath === reqPath) {\n    return true;\n  }\n\n  var idx = reqPath.indexOf(cookiePath);\n  if (idx === 0) {\n    // \"o  The cookie-path is a prefix of the request-path, and the last\n    // character of the cookie-path is %x2F (\"/\").\"\n    if (cookiePath.substr(-1) === \"/\") {\n      return true;\n    }\n\n    // \" o  The cookie-path is a prefix of the request-path, and the first\n    // character of the request-path that is not included in the cookie- path\n    // is a %x2F (\"/\") character.\"\n    if (reqPath.substr(cookiePath.length, 1) === \"/\") {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nexports.pathMatch = pathMatch;\n","/*!\n * Copyright (c) 2015, Salesforce.com, Inc.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice,\n * this list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n * this list of conditions and the following disclaimer in the documentation\n * and/or other materials provided with the distribution.\n *\n * 3. Neither the name of Salesforce.com nor the names of its contributors may\n * be used to endorse or promote products derived from this software without\n * specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n'use strict';\nvar Store = require('./store').Store;\nvar permuteDomain = require('./permuteDomain').permuteDomain;\nvar pathMatch = require('./pathMatch').pathMatch;\nvar util = require('util');\n\nfunction MemoryCookieStore() {\n  Store.call(this);\n  this.idx = {};\n}\nutil.inherits(MemoryCookieStore, Store);\nexports.MemoryCookieStore = MemoryCookieStore;\nMemoryCookieStore.prototype.idx = null;\n\n// Since it's just a struct in RAM, this Store is synchronous\nMemoryCookieStore.prototype.synchronous = true;\n\n// force a default depth:\nMemoryCookieStore.prototype.inspect = function() {\n  return \"{ idx: \"+util.inspect(this.idx, false, 2)+' }';\n};\n\n// Use the new custom inspection symbol to add the custom inspect function if\n// available.\nif (util.inspect.custom) {\n  MemoryCookieStore.prototype[util.inspect.custom] = MemoryCookieStore.prototype.inspect;\n}\n\nMemoryCookieStore.prototype.findCookie = function(domain, path, key, cb) {\n  if (!this.idx[domain]) {\n    return cb(null,undefined);\n  }\n  if (!this.idx[domain][path]) {\n    return cb(null,undefined);\n  }\n  return cb(null,this.idx[domain][path][key]||null);\n};\n\nMemoryCookieStore.prototype.findCookies = function(domain, path, cb) {\n  var results = [];\n  if (!domain) {\n    return cb(null,[]);\n  }\n\n  var pathMatcher;\n  if (!path) {\n    // null means \"all paths\"\n    pathMatcher = function matchAll(domainIndex) {\n      for (var curPath in domainIndex) {\n        var pathIndex = domainIndex[curPath];\n        for (var key in pathIndex) {\n          results.push(pathIndex[key]);\n        }\n      }\n    };\n\n  } else {\n    pathMatcher = function matchRFC(domainIndex) {\n       //NOTE: we should use path-match algorithm from S5.1.4 here\n       //(see : https://github.com/ChromiumWebApps/chromium/blob/b3d3b4da8bb94c1b2e061600df106d590fda3620/net/cookies/canonical_cookie.cc#L299)\n       Object.keys(domainIndex).forEach(function (cookiePath) {\n         if (pathMatch(path, cookiePath)) {\n           var pathIndex = domainIndex[cookiePath];\n\n           for (var key in pathIndex) {\n             results.push(pathIndex[key]);\n           }\n         }\n       });\n     };\n  }\n\n  var domains = permuteDomain(domain) || [domain];\n  var idx = this.idx;\n  domains.forEach(function(curDomain) {\n    var domainIndex = idx[curDomain];\n    if (!domainIndex) {\n      return;\n    }\n    pathMatcher(domainIndex);\n  });\n\n  cb(null,results);\n};\n\nMemoryCookieStore.prototype.putCookie = function(cookie, cb) {\n  if (!this.idx[cookie.domain]) {\n    this.idx[cookie.domain] = {};\n  }\n  if (!this.idx[cookie.domain][cookie.path]) {\n    this.idx[cookie.domain][cookie.path] = {};\n  }\n  this.idx[cookie.domain][cookie.path][cookie.key] = cookie;\n  cb(null);\n};\n\nMemoryCookieStore.prototype.updateCookie = function(oldCookie, newCookie, cb) {\n  // updateCookie() may avoid updating cookies that are identical.  For example,\n  // lastAccessed may not be important to some stores and an equality\n  // comparison could exclude that field.\n  this.putCookie(newCookie,cb);\n};\n\nMemoryCookieStore.prototype.removeCookie = function(domain, path, key, cb) {\n  if (this.idx[domain] && this.idx[domain][path] && this.idx[domain][path][key]) {\n    delete this.idx[domain][path][key];\n  }\n  cb(null);\n};\n\nMemoryCookieStore.prototype.removeCookies = function(domain, path, cb) {\n  if (this.idx[domain]) {\n    if (path) {\n      delete this.idx[domain][path];\n    } else {\n      delete this.idx[domain];\n    }\n  }\n  return cb(null);\n};\n\nMemoryCookieStore.prototype.getAllCookies = function(cb) {\n  var cookies = [];\n  var idx = this.idx;\n\n  var domains = Object.keys(idx);\n  domains.forEach(function(domain) {\n    var paths = Object.keys(idx[domain]);\n    paths.forEach(function(path) {\n      var keys = Object.keys(idx[domain][path]);\n      keys.forEach(function(key) {\n        if (key !== null) {\n          cookies.push(idx[domain][path][key]);\n        }\n      });\n    });\n  });\n\n  // Sort by creationIndex so deserializing retains the creation order.\n  // When implementing your own store, this SHOULD retain the order too\n  cookies.sort(function(a,b) {\n    return (a.creationIndex||0) - (b.creationIndex||0);\n  });\n\n  cb(null, cookies);\n};\n","/*!\n * Copyright (c) 2015, Salesforce.com, Inc.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice,\n * this list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n * this list of conditions and the following disclaimer in the documentation\n * and/or other materials provided with the distribution.\n *\n * 3. Neither the name of Salesforce.com nor the names of its contributors may\n * be used to endorse or promote products derived from this software without\n * specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE\n * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\n * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGE.\n */\n'use strict';\nvar net = require('net');\nvar urlParse = require('url').parse;\nvar util = require('util');\nvar pubsuffix = require('./pubsuffix-psl');\nvar Store = require('./store').Store;\nvar MemoryCookieStore = require('./memstore').MemoryCookieStore;\nvar pathMatch = require('./pathMatch').pathMatch;\nvar VERSION = require('../package.json').version;\n\nvar punycode;\ntry {\n  punycode = require('punycode');\n} catch(e) {\n  console.warn(\"tough-cookie: can't load punycode; won't use punycode for domain normalization\");\n}\n\n// From RFC6265 S4.1.1\n// note that it excludes \\x3B \";\"\nvar COOKIE_OCTETS = /^[\\x21\\x23-\\x2B\\x2D-\\x3A\\x3C-\\x5B\\x5D-\\x7E]+$/;\n\nvar CONTROL_CHARS = /[\\x00-\\x1F]/;\n\n// From Chromium // '\\r', '\\n' and '\\0' should be treated as a terminator in\n// the \"relaxed\" mode, see:\n// https://github.com/ChromiumWebApps/chromium/blob/b3d3b4da8bb94c1b2e061600df106d590fda3620/net/cookies/parsed_cookie.cc#L60\nvar TERMINATORS = ['\\n', '\\r', '\\0'];\n\n// RFC6265 S4.1.1 defines path value as 'any CHAR except CTLs or \";\"'\n// Note ';' is \\x3B\nvar PATH_VALUE = /[\\x20-\\x3A\\x3C-\\x7E]+/;\n\n// date-time parsing constants (RFC6265 S5.1.1)\n\nvar DATE_DELIM = /[\\x09\\x20-\\x2F\\x3B-\\x40\\x5B-\\x60\\x7B-\\x7E]/;\n\nvar MONTH_TO_NUM = {\n  jan:0, feb:1, mar:2, apr:3, may:4, jun:5,\n  jul:6, aug:7, sep:8, oct:9, nov:10, dec:11\n};\nvar NUM_TO_MONTH = [\n  'Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'\n];\nvar NUM_TO_DAY = [\n  'Sun','Mon','Tue','Wed','Thu','Fri','Sat'\n];\n\nvar MAX_TIME = 2147483647000; // 31-bit max\nvar MIN_TIME = 0; // 31-bit min\n\n/*\n * Parses a Natural number (i.e., non-negative integer) with either the\n *    <min>*<max>DIGIT ( non-digit *OCTET )\n * or\n *    <min>*<max>DIGIT\n * grammar (RFC6265 S5.1.1).\n *\n * The \"trailingOK\" boolean controls if the grammar accepts a\n * \"( non-digit *OCTET )\" trailer.\n */\nfunction parseDigits(token, minDigits, maxDigits, trailingOK) {\n  var count = 0;\n  while (count < token.length) {\n    var c = token.charCodeAt(count);\n    // \"non-digit = %x00-2F / %x3A-FF\"\n    if (c <= 0x2F || c >= 0x3A) {\n      break;\n    }\n    count++;\n  }\n\n  // constrain to a minimum and maximum number of digits.\n  if (count < minDigits || count > maxDigits) {\n    return null;\n  }\n\n  if (!trailingOK && count != token.length) {\n    return null;\n  }\n\n  return parseInt(token.substr(0,count), 10);\n}\n\nfunction parseTime(token) {\n  var parts = token.split(':');\n  var result = [0,0,0];\n\n  /* RF6256 S5.1.1:\n   *      time            = hms-time ( non-digit *OCTET )\n   *      hms-time        = time-field \":\" time-field \":\" time-field\n   *      time-field      = 1*2DIGIT\n   */\n\n  if (parts.length !== 3) {\n    return null;\n  }\n\n  for (var i = 0; i < 3; i++) {\n    // \"time-field\" must be strictly \"1*2DIGIT\", HOWEVER, \"hms-time\" can be\n    // followed by \"( non-digit *OCTET )\" so therefore the last time-field can\n    // have a trailer\n    var trailingOK = (i == 2);\n    var num = parseDigits(parts[i], 1, 2, trailingOK);\n    if (num === null) {\n      return null;\n    }\n    result[i] = num;\n  }\n\n  return result;\n}\n\nfunction parseMonth(token) {\n  token = String(token).substr(0,3).toLowerCase();\n  var num = MONTH_TO_NUM[token];\n  return num >= 0 ? num : null;\n}\n\n/*\n * RFC6265 S5.1.1 date parser (see RFC for full grammar)\n */\nfunction parseDate(str) {\n  if (!str) {\n    return;\n  }\n\n  /* RFC6265 S5.1.1:\n   * 2. Process each date-token sequentially in the order the date-tokens\n   * appear in the cookie-date\n   */\n  var tokens = str.split(DATE_DELIM);\n  if (!tokens) {\n    return;\n  }\n\n  var hour = null;\n  var minute = null;\n  var second = null;\n  var dayOfMonth = null;\n  var month = null;\n  var year = null;\n\n  for (var i=0; i<tokens.length; i++) {\n    var token = tokens[i].trim();\n    if (!token.length) {\n      continue;\n    }\n\n    var result;\n\n    /* 2.1. If the found-time flag is not set and the token matches the time\n     * production, set the found-time flag and set the hour- value,\n     * minute-value, and second-value to the numbers denoted by the digits in\n     * the date-token, respectively.  Skip the remaining sub-steps and continue\n     * to the next date-token.\n     */\n    if (second === null) {\n      result = parseTime(token);\n      if (result) {\n        hour = result[0];\n        minute = result[1];\n        second = result[2];\n        continue;\n      }\n    }\n\n    /* 2.2. If the found-day-of-month flag is not set and the date-token matches\n     * the day-of-month production, set the found-day-of- month flag and set\n     * the day-of-month-value to the number denoted by the date-token.  Skip\n     * the remaining sub-steps and continue to the next date-token.\n     */\n    if (dayOfMonth === null) {\n      // \"day-of-month = 1*2DIGIT ( non-digit *OCTET )\"\n      result = parseDigits(token, 1, 2, true);\n      if (result !== null) {\n        dayOfMonth = result;\n        continue;\n      }\n    }\n\n    /* 2.3. If the found-month flag is not set and the date-token matches the\n     * month production, set the found-month flag and set the month-value to\n     * the month denoted by the date-token.  Skip the remaining sub-steps and\n     * continue to the next date-token.\n     */\n    if (month === null) {\n      result = parseMonth(token);\n      if (result !== null) {\n        month = result;\n        continue;\n      }\n    }\n\n    /* 2.4. If the found-year flag is not set and the date-token matches the\n     * year production, set the found-year flag and set the year-value to the\n     * number denoted by the date-token.  Skip the remaining sub-steps and\n     * continue to the next date-token.\n     */\n    if (year === null) {\n      // \"year = 2*4DIGIT ( non-digit *OCTET )\"\n      result = parseDigits(token, 2, 4, true);\n      if (result !== null) {\n        year = result;\n        /* From S5.1.1:\n         * 3.  If the year-value is greater than or equal to 70 and less\n         * than or equal to 99, increment the year-value by 1900.\n         * 4.  If the year-value is greater than or equal to 0 and less\n         * than or equal to 69, increment the year-value by 2000.\n         */\n        if (year >= 70 && year <= 99) {\n          year += 1900;\n        } else if (year >= 0 && year <= 69) {\n          year += 2000;\n        }\n      }\n    }\n  }\n\n  /* RFC 6265 S5.1.1\n   * \"5. Abort these steps and fail to parse the cookie-date if:\n   *     *  at least one of the found-day-of-month, found-month, found-\n   *        year, or found-time flags is not set,\n   *     *  the day-of-month-value is less than 1 or greater than 31,\n   *     *  the year-value is less than 1601,\n   *     *  the hour-value is greater than 23,\n   *     *  the minute-value is greater than 59, or\n   *     *  the second-value is greater than 59.\n   *     (Note that leap seconds cannot be represented in this syntax.)\"\n   *\n   * So, in order as above:\n   */\n  if (\n    dayOfMonth === null || month === null || year === null || second === null ||\n    dayOfMonth < 1 || dayOfMonth > 31 ||\n    year < 1601 ||\n    hour > 23 ||\n    minute > 59 ||\n    second > 59\n  ) {\n    return;\n  }\n\n  return new Date(Date.UTC(year, month, dayOfMonth, hour, minute, second));\n}\n\nfunction formatDate(date) {\n  var d = date.getUTCDate(); d = d >= 10 ? d : '0'+d;\n  var h = date.getUTCHours(); h = h >= 10 ? h : '0'+h;\n  var m = date.getUTCMinutes(); m = m >= 10 ? m : '0'+m;\n  var s = date.getUTCSeconds(); s = s >= 10 ? s : '0'+s;\n  return NUM_TO_DAY[date.getUTCDay()] + ', ' +\n    d+' '+ NUM_TO_MONTH[date.getUTCMonth()] +' '+ date.getUTCFullYear() +' '+\n    h+':'+m+':'+s+' GMT';\n}\n\n// S5.1.2 Canonicalized Host Names\nfunction canonicalDomain(str) {\n  if (str == null) {\n    return null;\n  }\n  str = str.trim().replace(/^\\./,''); // S4.1.2.3 & S5.2.3: ignore leading .\n\n  // convert to IDN if any non-ASCII characters\n  if (punycode && /[^\\u0001-\\u007f]/.test(str)) {\n    str = punycode.toASCII(str);\n  }\n\n  return str.toLowerCase();\n}\n\n// S5.1.3 Domain Matching\nfunction domainMatch(str, domStr, canonicalize) {\n  if (str == null || domStr == null) {\n    return null;\n  }\n  if (canonicalize !== false) {\n    str = canonicalDomain(str);\n    domStr = canonicalDomain(domStr);\n  }\n\n  /*\n   * \"The domain string and the string are identical. (Note that both the\n   * domain string and the string will have been canonicalized to lower case at\n   * this point)\"\n   */\n  if (str == domStr) {\n    return true;\n  }\n\n  /* \"All of the following [three] conditions hold:\" (order adjusted from the RFC) */\n\n  /* \"* The string is a host name (i.e., not an IP address).\" */\n  if (net.isIP(str)) {\n    return false;\n  }\n\n  /* \"* The domain string is a suffix of the string\" */\n  var idx = str.indexOf(domStr);\n  if (idx <= 0) {\n    return false; // it's a non-match (-1) or prefix (0)\n  }\n\n  // e.g \"a.b.c\".indexOf(\"b.c\") === 2\n  // 5 === 3+2\n  if (str.length !== domStr.length + idx) { // it's not a suffix\n    return false;\n  }\n\n  /* \"* The last character of the string that is not included in the domain\n  * string is a %x2E (\".\") character.\" */\n  if (str.substr(idx-1,1) !== '.') {\n    return false;\n  }\n\n  return true;\n}\n\n\n// RFC6265 S5.1.4 Paths and Path-Match\n\n/*\n * \"The user agent MUST use an algorithm equivalent to the following algorithm\n * to compute the default-path of a cookie:\"\n *\n * Assumption: the path (and not query part or absolute uri) is passed in.\n */\nfunction defaultPath(path) {\n  // \"2. If the uri-path is empty or if the first character of the uri-path is not\n  // a %x2F (\"/\") character, output %x2F (\"/\") and skip the remaining steps.\n  if (!path || path.substr(0,1) !== \"/\") {\n    return \"/\";\n  }\n\n  // \"3. If the uri-path contains no more than one %x2F (\"/\") character, output\n  // %x2F (\"/\") and skip the remaining step.\"\n  if (path === \"/\") {\n    return path;\n  }\n\n  var rightSlash = path.lastIndexOf(\"/\");\n  if (rightSlash === 0) {\n    return \"/\";\n  }\n\n  // \"4. Output the characters of the uri-path from the first character up to,\n  // but not including, the right-most %x2F (\"/\").\"\n  return path.slice(0, rightSlash);\n}\n\nfunction trimTerminator(str) {\n  for (var t = 0; t < TERMINATORS.length; t++) {\n    var terminatorIdx = str.indexOf(TERMINATORS[t]);\n    if (terminatorIdx !== -1) {\n      str = str.substr(0,terminatorIdx);\n    }\n  }\n\n  return str;\n}\n\nfunction parseCookiePair(cookiePair, looseMode) {\n  cookiePair = trimTerminator(cookiePair);\n\n  var firstEq = cookiePair.indexOf('=');\n  if (looseMode) {\n    if (firstEq === 0) { // '=' is immediately at start\n      cookiePair = cookiePair.substr(1);\n      firstEq = cookiePair.indexOf('='); // might still need to split on '='\n    }\n  } else { // non-loose mode\n    if (firstEq <= 0) { // no '=' or is at start\n      return; // needs to have non-empty \"cookie-name\"\n    }\n  }\n\n  var cookieName, cookieValue;\n  if (firstEq <= 0) {\n    cookieName = \"\";\n    cookieValue = cookiePair.trim();\n  } else {\n    cookieName = cookiePair.substr(0, firstEq).trim();\n    cookieValue = cookiePair.substr(firstEq+1).trim();\n  }\n\n  if (CONTROL_CHARS.test(cookieName) || CONTROL_CHARS.test(cookieValue)) {\n    return;\n  }\n\n  var c = new Cookie();\n  c.key = cookieName;\n  c.value = cookieValue;\n  return c;\n}\n\nfunction parse(str, options) {\n  if (!options || typeof options !== 'object') {\n    options = {};\n  }\n  str = str.trim();\n\n  // We use a regex to parse the \"name-value-pair\" part of S5.2\n  var firstSemi = str.indexOf(';'); // S5.2 step 1\n  var cookiePair = (firstSemi === -1) ? str : str.substr(0, firstSemi);\n  var c = parseCookiePair(cookiePair, !!options.loose);\n  if (!c) {\n    return;\n  }\n\n  if (firstSemi === -1) {\n    return c;\n  }\n\n  // S5.2.3 \"unparsed-attributes consist of the remainder of the set-cookie-string\n  // (including the %x3B (\";\") in question).\" plus later on in the same section\n  // \"discard the first \";\" and trim\".\n  var unparsed = str.slice(firstSemi + 1).trim();\n\n  // \"If the unparsed-attributes string is empty, skip the rest of these\n  // steps.\"\n  if (unparsed.length === 0) {\n    return c;\n  }\n\n  /*\n   * S5.2 says that when looping over the items \"[p]rocess the attribute-name\n   * and attribute-value according to the requirements in the following\n   * subsections\" for every item.  Plus, for many of the individual attributes\n   * in S5.3 it says to use the \"attribute-value of the last attribute in the\n   * cookie-attribute-list\".  Therefore, in this implementation, we overwrite\n   * the previous value.\n   */\n  var cookie_avs = unparsed.split(';');\n  while (cookie_avs.length) {\n    var av = cookie_avs.shift().trim();\n    if (av.length === 0) { // happens if \";;\" appears\n      continue;\n    }\n    var av_sep = av.indexOf('=');\n    var av_key, av_value;\n\n    if (av_sep === -1) {\n      av_key = av;\n      av_value = null;\n    } else {\n      av_key = av.substr(0,av_sep);\n      av_value = av.substr(av_sep+1);\n    }\n\n    av_key = av_key.trim().toLowerCase();\n\n    if (av_value) {\n      av_value = av_value.trim();\n    }\n\n    switch(av_key) {\n    case 'expires': // S5.2.1\n      if (av_value) {\n        var exp = parseDate(av_value);\n        // \"If the attribute-value failed to parse as a cookie date, ignore the\n        // cookie-av.\"\n        if (exp) {\n          // over and underflow not realistically a concern: V8's getTime() seems to\n          // store something larger than a 32-bit time_t (even with 32-bit node)\n          c.expires = exp;\n        }\n      }\n      break;\n\n    case 'max-age': // S5.2.2\n      if (av_value) {\n        // \"If the first character of the attribute-value is not a DIGIT or a \"-\"\n        // character ...[or]... If the remainder of attribute-value contains a\n        // non-DIGIT character, ignore the cookie-av.\"\n        if (/^-?[0-9]+$/.test(av_value)) {\n          var delta = parseInt(av_value, 10);\n          // \"If delta-seconds is less than or equal to zero (0), let expiry-time\n          // be the earliest representable date and time.\"\n          c.setMaxAge(delta);\n        }\n      }\n      break;\n\n    case 'domain': // S5.2.3\n      // \"If the attribute-value is empty, the behavior is undefined.  However,\n      // the user agent SHOULD ignore the cookie-av entirely.\"\n      if (av_value) {\n        // S5.2.3 \"Let cookie-domain be the attribute-value without the leading %x2E\n        // (\".\") character.\"\n        var domain = av_value.trim().replace(/^\\./, '');\n        if (domain) {\n          // \"Convert the cookie-domain to lower case.\"\n          c.domain = domain.toLowerCase();\n        }\n      }\n      break;\n\n    case 'path': // S5.2.4\n      /*\n       * \"If the attribute-value is empty or if the first character of the\n       * attribute-value is not %x2F (\"/\"):\n       *   Let cookie-path be the default-path.\n       * Otherwise:\n       *   Let cookie-path be the attribute-value.\"\n       *\n       * We'll represent the default-path as null since it depends on the\n       * context of the parsing.\n       */\n      c.path = av_value && av_value[0] === \"/\" ? av_value : null;\n      break;\n\n    case 'secure': // S5.2.5\n      /*\n       * \"If the attribute-name case-insensitively matches the string \"Secure\",\n       * the user agent MUST append an attribute to the cookie-attribute-list\n       * with an attribute-name of Secure and an empty attribute-value.\"\n       */\n      c.secure = true;\n      break;\n\n    case 'httponly': // S5.2.6 -- effectively the same as 'secure'\n      c.httpOnly = true;\n      break;\n\n    default:\n      c.extensions = c.extensions || [];\n      c.extensions.push(av);\n      break;\n    }\n  }\n\n  return c;\n}\n\n// avoid the V8 deoptimization monster!\nfunction jsonParse(str) {\n  var obj;\n  try {\n    obj = JSON.parse(str);\n  } catch (e) {\n    return e;\n  }\n  return obj;\n}\n\nfunction fromJSON(str) {\n  if (!str) {\n    return null;\n  }\n\n  var obj;\n  if (typeof str === 'string') {\n    obj = jsonParse(str);\n    if (obj instanceof Error) {\n      return null;\n    }\n  } else {\n    // assume it's an Object\n    obj = str;\n  }\n\n  var c = new Cookie();\n  for (var i=0; i<Cookie.serializableProperties.length; i++) {\n    var prop = Cookie.serializableProperties[i];\n    if (obj[prop] === undefined ||\n        obj[prop] === Cookie.prototype[prop])\n    {\n      continue; // leave as prototype default\n    }\n\n    if (prop === 'expires' ||\n        prop === 'creation' ||\n        prop === 'lastAccessed')\n    {\n      if (obj[prop] === null) {\n        c[prop] = null;\n      } else {\n        c[prop] = obj[prop] == \"Infinity\" ?\n          \"Infinity\" : new Date(obj[prop]);\n      }\n    } else {\n      c[prop] = obj[prop];\n    }\n  }\n\n  return c;\n}\n\n/* Section 5.4 part 2:\n * \"*  Cookies with longer paths are listed before cookies with\n *     shorter paths.\n *\n *  *  Among cookies that have equal-length path fields, cookies with\n *     earlier creation-times are listed before cookies with later\n *     creation-times.\"\n */\n\nfunction cookieCompare(a,b) {\n  var cmp = 0;\n\n  // descending for length: b CMP a\n  var aPathLen = a.path ? a.path.length : 0;\n  var bPathLen = b.path ? b.path.length : 0;\n  cmp = bPathLen - aPathLen;\n  if (cmp !== 0) {\n    return cmp;\n  }\n\n  // ascending for time: a CMP b\n  var aTime = a.creation ? a.creation.getTime() : MAX_TIME;\n  var bTime = b.creation ? b.creation.getTime() : MAX_TIME;\n  cmp = aTime - bTime;\n  if (cmp !== 0) {\n    return cmp;\n  }\n\n  // break ties for the same millisecond (precision of JavaScript's clock)\n  cmp = a.creationIndex - b.creationIndex;\n\n  return cmp;\n}\n\n// Gives the permutation of all possible pathMatch()es of a given path. The\n// array is in longest-to-shortest order.  Handy for indexing.\nfunction permutePath(path) {\n  if (path === '/') {\n    return ['/'];\n  }\n  if (path.lastIndexOf('/') === path.length-1) {\n    path = path.substr(0,path.length-1);\n  }\n  var permutations = [path];\n  while (path.length > 1) {\n    var lindex = path.lastIndexOf('/');\n    if (lindex === 0) {\n      break;\n    }\n    path = path.substr(0,lindex);\n    permutations.push(path);\n  }\n  permutations.push('/');\n  return permutations;\n}\n\nfunction getCookieContext(url) {\n  if (url instanceof Object) {\n    return url;\n  }\n  // NOTE: decodeURI will throw on malformed URIs (see GH-32).\n  // Therefore, we will just skip decoding for such URIs.\n  try {\n    url = decodeURI(url);\n  }\n  catch(err) {\n    // Silently swallow error\n  }\n\n  return urlParse(url);\n}\n\nfunction Cookie(options) {\n  options = options || {};\n\n  Object.keys(options).forEach(function(prop) {\n    if (Cookie.prototype.hasOwnProperty(prop) &&\n        Cookie.prototype[prop] !== options[prop] &&\n        prop.substr(0,1) !== '_')\n    {\n      this[prop] = options[prop];\n    }\n  }, this);\n\n  this.creation = this.creation || new Date();\n\n  // used to break creation ties in cookieCompare():\n  Object.defineProperty(this, 'creationIndex', {\n    configurable: false,\n    enumerable: false, // important for assert.deepEqual checks\n    writable: true,\n    value: ++Cookie.cookiesCreated\n  });\n}\n\nCookie.cookiesCreated = 0; // incremented each time a cookie is created\n\nCookie.parse = parse;\nCookie.fromJSON = fromJSON;\n\nCookie.prototype.key = \"\";\nCookie.prototype.value = \"\";\n\n// the order in which the RFC has them:\nCookie.prototype.expires = \"Infinity\"; // coerces to literal Infinity\nCookie.prototype.maxAge = null; // takes precedence over expires for TTL\nCookie.prototype.domain = null;\nCookie.prototype.path = null;\nCookie.prototype.secure = false;\nCookie.prototype.httpOnly = false;\nCookie.prototype.extensions = null;\n\n// set by the CookieJar:\nCookie.prototype.hostOnly = null; // boolean when set\nCookie.prototype.pathIsDefault = null; // boolean when set\nCookie.prototype.creation = null; // Date when set; defaulted by Cookie.parse\nCookie.prototype.lastAccessed = null; // Date when set\nObject.defineProperty(Cookie.prototype, 'creationIndex', {\n  configurable: true,\n  enumerable: false,\n  writable: true,\n  value: 0\n});\n\nCookie.serializableProperties = Object.keys(Cookie.prototype)\n  .filter(function(prop) {\n    return !(\n      Cookie.prototype[prop] instanceof Function ||\n      prop === 'creationIndex' ||\n      prop.substr(0,1) === '_'\n    );\n  });\n\nCookie.prototype.inspect = function inspect() {\n  var now = Date.now();\n  return 'Cookie=\"'+this.toString() +\n    '; hostOnly='+(this.hostOnly != null ? this.hostOnly : '?') +\n    '; aAge='+(this.lastAccessed ? (now-this.lastAccessed.getTime())+'ms' : '?') +\n    '; cAge='+(this.creation ? (now-this.creation.getTime())+'ms' : '?') +\n    '\"';\n};\n\n// Use the new custom inspection symbol to add the custom inspect function if\n// available.\nif (util.inspect.custom) {\n  Cookie.prototype[util.inspect.custom] = Cookie.prototype.inspect;\n}\n\nCookie.prototype.toJSON = function() {\n  var obj = {};\n\n  var props = Cookie.serializableProperties;\n  for (var i=0; i<props.length; i++) {\n    var prop = props[i];\n    if (this[prop] === Cookie.prototype[prop]) {\n      continue; // leave as prototype default\n    }\n\n    if (prop === 'expires' ||\n        prop === 'creation' ||\n        prop === 'lastAccessed')\n    {\n      if (this[prop] === null) {\n        obj[prop] = null;\n      } else {\n        obj[prop] = this[prop] == \"Infinity\" ? // intentionally not ===\n          \"Infinity\" : this[prop].toISOString();\n      }\n    } else if (prop === 'maxAge') {\n      if (this[prop] !== null) {\n        // again, intentionally not ===\n        obj[prop] = (this[prop] == Infinity || this[prop] == -Infinity) ?\n          this[prop].toString() : this[prop];\n      }\n    } else {\n      if (this[prop] !== Cookie.prototype[prop]) {\n        obj[prop] = this[prop];\n      }\n    }\n  }\n\n  return obj;\n};\n\nCookie.prototype.clone = function() {\n  return fromJSON(this.toJSON());\n};\n\nCookie.prototype.validate = function validate() {\n  if (!COOKIE_OCTETS.test(this.value)) {\n    return false;\n  }\n  if (this.expires != Infinity && !(this.expires instanceof Date) && !parseDate(this.expires)) {\n    return false;\n  }\n  if (this.maxAge != null && this.maxAge <= 0) {\n    return false; // \"Max-Age=\" non-zero-digit *DIGIT\n  }\n  if (this.path != null && !PATH_VALUE.test(this.path)) {\n    return false;\n  }\n\n  var cdomain = this.cdomain();\n  if (cdomain) {\n    if (cdomain.match(/\\.$/)) {\n      return false; // S4.1.2.3 suggests that this is bad. domainMatch() tests confirm this\n    }\n    var suffix = pubsuffix.getPublicSuffix(cdomain);\n    if (suffix == null) { // it's a public suffix\n      return false;\n    }\n  }\n  return true;\n};\n\nCookie.prototype.setExpires = function setExpires(exp) {\n  if (exp instanceof Date) {\n    this.expires = exp;\n  } else {\n    this.expires = parseDate(exp) || \"Infinity\";\n  }\n};\n\nCookie.prototype.setMaxAge = function setMaxAge(age) {\n  if (age === Infinity || age === -Infinity) {\n    this.maxAge = age.toString(); // so JSON.stringify() works\n  } else {\n    this.maxAge = age;\n  }\n};\n\n// gives Cookie header format\nCookie.prototype.cookieString = function cookieString() {\n  var val = this.value;\n  if (val == null) {\n    val = '';\n  }\n  if (this.key === '') {\n    return val;\n  }\n  return this.key+'='+val;\n};\n\n// gives Set-Cookie header format\nCookie.prototype.toString = function toString() {\n  var str = this.cookieString();\n\n  if (this.expires != Infinity) {\n    if (this.expires instanceof Date) {\n      str += '; Expires='+formatDate(this.expires);\n    } else {\n      str += '; Expires='+this.expires;\n    }\n  }\n\n  if (this.maxAge != null && this.maxAge != Infinity) {\n    str += '; Max-Age='+this.maxAge;\n  }\n\n  if (this.domain && !this.hostOnly) {\n    str += '; Domain='+this.domain;\n  }\n  if (this.path) {\n    str += '; Path='+this.path;\n  }\n\n  if (this.secure) {\n    str += '; Secure';\n  }\n  if (this.httpOnly) {\n    str += '; HttpOnly';\n  }\n  if (this.extensions) {\n    this.extensions.forEach(function(ext) {\n      str += '; '+ext;\n    });\n  }\n\n  return str;\n};\n\n// TTL() partially replaces the \"expiry-time\" parts of S5.3 step 3 (setCookie()\n// elsewhere)\n// S5.3 says to give the \"latest representable date\" for which we use Infinity\n// For \"expired\" we use 0\nCookie.prototype.TTL = function TTL(now) {\n  /* RFC6265 S4.1.2.2 If a cookie has both the Max-Age and the Expires\n   * attribute, the Max-Age attribute has precedence and controls the\n   * expiration date of the cookie.\n   * (Concurs with S5.3 step 3)\n   */\n  if (this.maxAge != null) {\n    return this.maxAge<=0 ? 0 : this.maxAge*1000;\n  }\n\n  var expires = this.expires;\n  if (expires != Infinity) {\n    if (!(expires instanceof Date)) {\n      expires = parseDate(expires) || Infinity;\n    }\n\n    if (expires == Infinity) {\n      return Infinity;\n    }\n\n    return expires.getTime() - (now || Date.now());\n  }\n\n  return Infinity;\n};\n\n// expiryTime() replaces the \"expiry-time\" parts of S5.3 step 3 (setCookie()\n// elsewhere)\nCookie.prototype.expiryTime = function expiryTime(now) {\n  if (this.maxAge != null) {\n    var relativeTo = now || this.creation || new Date();\n    var age = (this.maxAge <= 0) ? -Infinity : this.maxAge*1000;\n    return relativeTo.getTime() + age;\n  }\n\n  if (this.expires == Infinity) {\n    return Infinity;\n  }\n  return this.expires.getTime();\n};\n\n// expiryDate() replaces the \"expiry-time\" parts of S5.3 step 3 (setCookie()\n// elsewhere), except it returns a Date\nCookie.prototype.expiryDate = function expiryDate(now) {\n  var millisec = this.expiryTime(now);\n  if (millisec == Infinity) {\n    return new Date(MAX_TIME);\n  } else if (millisec == -Infinity) {\n    return new Date(MIN_TIME);\n  } else {\n    return new Date(millisec);\n  }\n};\n\n// This replaces the \"persistent-flag\" parts of S5.3 step 3\nCookie.prototype.isPersistent = function isPersistent() {\n  return (this.maxAge != null || this.expires != Infinity);\n};\n\n// Mostly S5.1.2 and S5.2.3:\nCookie.prototype.cdomain =\nCookie.prototype.canonicalizedDomain = function canonicalizedDomain() {\n  if (this.domain == null) {\n    return null;\n  }\n  return canonicalDomain(this.domain);\n};\n\nfunction CookieJar(store, options) {\n  if (typeof options === \"boolean\") {\n    options = {rejectPublicSuffixes: options};\n  } else if (options == null) {\n    options = {};\n  }\n  if (options.rejectPublicSuffixes != null) {\n    this.rejectPublicSuffixes = options.rejectPublicSuffixes;\n  }\n  if (options.looseMode != null) {\n    this.enableLooseMode = options.looseMode;\n  }\n\n  if (!store) {\n    store = new MemoryCookieStore();\n  }\n  this.store = store;\n}\nCookieJar.prototype.store = null;\nCookieJar.prototype.rejectPublicSuffixes = true;\nCookieJar.prototype.enableLooseMode = false;\nvar CAN_BE_SYNC = [];\n\nCAN_BE_SYNC.push('setCookie');\nCookieJar.prototype.setCookie = function(cookie, url, options, cb) {\n  var err;\n  var context = getCookieContext(url);\n  if (options instanceof Function) {\n    cb = options;\n    options = {};\n  }\n\n  var host = canonicalDomain(context.hostname);\n  var loose = this.enableLooseMode;\n  if (options.loose != null) {\n    loose = options.loose;\n  }\n\n  // S5.3 step 1\n  if (!(cookie instanceof Cookie)) {\n    cookie = Cookie.parse(cookie, { loose: loose });\n  }\n  if (!cookie) {\n    err = new Error(\"Cookie failed to parse\");\n    return cb(options.ignoreError ? null : err);\n  }\n\n  // S5.3 step 2\n  var now = options.now || new Date(); // will assign later to save effort in the face of errors\n\n  // S5.3 step 3: NOOP; persistent-flag and expiry-time is handled by getCookie()\n\n  // S5.3 step 4: NOOP; domain is null by default\n\n  // S5.3 step 5: public suffixes\n  if (this.rejectPublicSuffixes && cookie.domain) {\n    var suffix = pubsuffix.getPublicSuffix(cookie.cdomain());\n    if (suffix == null) { // e.g. \"com\"\n      err = new Error(\"Cookie has domain set to a public suffix\");\n      return cb(options.ignoreError ? null : err);\n    }\n  }\n\n  // S5.3 step 6:\n  if (cookie.domain) {\n    if (!domainMatch(host, cookie.cdomain(), false)) {\n      err = new Error(\"Cookie not in this host's domain. Cookie:\"+cookie.cdomain()+\" Request:\"+host);\n      return cb(options.ignoreError ? null : err);\n    }\n\n    if (cookie.hostOnly == null) { // don't reset if already set\n      cookie.hostOnly = false;\n    }\n\n  } else {\n    cookie.hostOnly = true;\n    cookie.domain = host;\n  }\n\n  //S5.2.4 If the attribute-value is empty or if the first character of the\n  //attribute-value is not %x2F (\"/\"):\n  //Let cookie-path be the default-path.\n  if (!cookie.path || cookie.path[0] !== '/') {\n    cookie.path = defaultPath(context.pathname);\n    cookie.pathIsDefault = true;\n  }\n\n  // S5.3 step 8: NOOP; secure attribute\n  // S5.3 step 9: NOOP; httpOnly attribute\n\n  // S5.3 step 10\n  if (options.http === false && cookie.httpOnly) {\n    err = new Error(\"Cookie is HttpOnly and this isn't an HTTP API\");\n    return cb(options.ignoreError ? null : err);\n  }\n\n  var store = this.store;\n\n  if (!store.updateCookie) {\n    store.updateCookie = function(oldCookie, newCookie, cb) {\n      this.putCookie(newCookie, cb);\n    };\n  }\n\n  function withCookie(err, oldCookie) {\n    if (err) {\n      return cb(err);\n    }\n\n    var next = function(err) {\n      if (err) {\n        return cb(err);\n      } else {\n        cb(null, cookie);\n      }\n    };\n\n    if (oldCookie) {\n      // S5.3 step 11 - \"If the cookie store contains a cookie with the same name,\n      // domain, and path as the newly created cookie:\"\n      if (options.http === false && oldCookie.httpOnly) { // step 11.2\n        err = new Error(\"old Cookie is HttpOnly and this isn't an HTTP API\");\n        return cb(options.ignoreError ? null : err);\n      }\n      cookie.creation = oldCookie.creation; // step 11.3\n      cookie.creationIndex = oldCookie.creationIndex; // preserve tie-breaker\n      cookie.lastAccessed = now;\n      // Step 11.4 (delete cookie) is implied by just setting the new one:\n      store.updateCookie(oldCookie, cookie, next); // step 12\n\n    } else {\n      cookie.creation = cookie.lastAccessed = now;\n      store.putCookie(cookie, next); // step 12\n    }\n  }\n\n  store.findCookie(cookie.domain, cookie.path, cookie.key, withCookie);\n};\n\n// RFC6365 S5.4\nCAN_BE_SYNC.push('getCookies');\nCookieJar.prototype.getCookies = function(url, options, cb) {\n  var context = getCookieContext(url);\n  if (options instanceof Function) {\n    cb = options;\n    options = {};\n  }\n\n  var host = canonicalDomain(context.hostname);\n  var path = context.pathname || '/';\n\n  var secure = options.secure;\n  if (secure == null && context.protocol &&\n      (context.protocol == 'https:' || context.protocol == 'wss:'))\n  {\n    secure = true;\n  }\n\n  var http = options.http;\n  if (http == null) {\n    http = true;\n  }\n\n  var now = options.now || Date.now();\n  var expireCheck = options.expire !== false;\n  var allPaths = !!options.allPaths;\n  var store = this.store;\n\n  function matchingCookie(c) {\n    // \"Either:\n    //   The cookie's host-only-flag is true and the canonicalized\n    //   request-host is identical to the cookie's domain.\n    // Or:\n    //   The cookie's host-only-flag is false and the canonicalized\n    //   request-host domain-matches the cookie's domain.\"\n    if (c.hostOnly) {\n      if (c.domain != host) {\n        return false;\n      }\n    } else {\n      if (!domainMatch(host, c.domain, false)) {\n        return false;\n      }\n    }\n\n    // \"The request-uri's path path-matches the cookie's path.\"\n    if (!allPaths && !pathMatch(path, c.path)) {\n      return false;\n    }\n\n    // \"If the cookie's secure-only-flag is true, then the request-uri's\n    // scheme must denote a \"secure\" protocol\"\n    if (c.secure && !secure) {\n      return false;\n    }\n\n    // \"If the cookie's http-only-flag is true, then exclude the cookie if the\n    // cookie-string is being generated for a \"non-HTTP\" API\"\n    if (c.httpOnly && !http) {\n      return false;\n    }\n\n    // deferred from S5.3\n    // non-RFC: allow retention of expired cookies by choice\n    if (expireCheck && c.expiryTime() <= now) {\n      store.removeCookie(c.domain, c.path, c.key, function(){}); // result ignored\n      return false;\n    }\n\n    return true;\n  }\n\n  store.findCookies(host, allPaths ? null : path, function(err,cookies) {\n    if (err) {\n      return cb(err);\n    }\n\n    cookies = cookies.filter(matchingCookie);\n\n    // sorting of S5.4 part 2\n    if (options.sort !== false) {\n      cookies = cookies.sort(cookieCompare);\n    }\n\n    // S5.4 part 3\n    var now = new Date();\n    cookies.forEach(function(c) {\n      c.lastAccessed = now;\n    });\n    // TODO persist lastAccessed\n\n    cb(null,cookies);\n  });\n};\n\nCAN_BE_SYNC.push('getCookieString');\nCookieJar.prototype.getCookieString = function(/*..., cb*/) {\n  var args = Array.prototype.slice.call(arguments,0);\n  var cb = args.pop();\n  var next = function(err,cookies) {\n    if (err) {\n      cb(err);\n    } else {\n      cb(null, cookies\n        .sort(cookieCompare)\n        .map(function(c){\n          return c.cookieString();\n        })\n        .join('; '));\n    }\n  };\n  args.push(next);\n  this.getCookies.apply(this,args);\n};\n\nCAN_BE_SYNC.push('getSetCookieStrings');\nCookieJar.prototype.getSetCookieStrings = function(/*..., cb*/) {\n  var args = Array.prototype.slice.call(arguments,0);\n  var cb = args.pop();\n  var next = function(err,cookies) {\n    if (err) {\n      cb(err);\n    } else {\n      cb(null, cookies.map(function(c){\n        return c.toString();\n      }));\n    }\n  };\n  args.push(next);\n  this.getCookies.apply(this,args);\n};\n\nCAN_BE_SYNC.push('serialize');\nCookieJar.prototype.serialize = function(cb) {\n  var type = this.store.constructor.name;\n  if (type === 'Object') {\n    type = null;\n  }\n\n  // update README.md \"Serialization Format\" if you change this, please!\n  var serialized = {\n    // The version of tough-cookie that serialized this jar. Generally a good\n    // practice since future versions can make data import decisions based on\n    // known past behavior. When/if this matters, use `semver`.\n    version: 'tough-cookie@'+VERSION,\n\n    // add the store type, to make humans happy:\n    storeType: type,\n\n    // CookieJar configuration:\n    rejectPublicSuffixes: !!this.rejectPublicSuffixes,\n\n    // this gets filled from getAllCookies:\n    cookies: []\n  };\n\n  if (!(this.store.getAllCookies &&\n        typeof this.store.getAllCookies === 'function'))\n  {\n    return cb(new Error('store does not support getAllCookies and cannot be serialized'));\n  }\n\n  this.store.getAllCookies(function(err,cookies) {\n    if (err) {\n      return cb(err);\n    }\n\n    serialized.cookies = cookies.map(function(cookie) {\n      // convert to serialized 'raw' cookies\n      cookie = (cookie instanceof Cookie) ? cookie.toJSON() : cookie;\n\n      // Remove the index so new ones get assigned during deserialization\n      delete cookie.creationIndex;\n\n      return cookie;\n    });\n\n    return cb(null, serialized);\n  });\n};\n\n// well-known name that JSON.stringify calls\nCookieJar.prototype.toJSON = function() {\n  return this.serializeSync();\n};\n\n// use the class method CookieJar.deserialize instead of calling this directly\nCAN_BE_SYNC.push('_importCookies');\nCookieJar.prototype._importCookies = function(serialized, cb) {\n  var jar = this;\n  var cookies = serialized.cookies;\n  if (!cookies || !Array.isArray(cookies)) {\n    return cb(new Error('serialized jar has no cookies array'));\n  }\n  cookies = cookies.slice(); // do not modify the original\n\n  function putNext(err) {\n    if (err) {\n      return cb(err);\n    }\n\n    if (!cookies.length) {\n      return cb(err, jar);\n    }\n\n    var cookie;\n    try {\n      cookie = fromJSON(cookies.shift());\n    } catch (e) {\n      return cb(e);\n    }\n\n    if (cookie === null) {\n      return putNext(null); // skip this cookie\n    }\n\n    jar.store.putCookie(cookie, putNext);\n  }\n\n  putNext();\n};\n\nCookieJar.deserialize = function(strOrObj, store, cb) {\n  if (arguments.length !== 3) {\n    // store is optional\n    cb = store;\n    store = null;\n  }\n\n  var serialized;\n  if (typeof strOrObj === 'string') {\n    serialized = jsonParse(strOrObj);\n    if (serialized instanceof Error) {\n      return cb(serialized);\n    }\n  } else {\n    serialized = strOrObj;\n  }\n\n  var jar = new CookieJar(store, serialized.rejectPublicSuffixes);\n  jar._importCookies(serialized, function(err) {\n    if (err) {\n      return cb(err);\n    }\n    cb(null, jar);\n  });\n};\n\nCookieJar.deserializeSync = function(strOrObj, store) {\n  var serialized = typeof strOrObj === 'string' ?\n    JSON.parse(strOrObj) : strOrObj;\n  var jar = new CookieJar(store, serialized.rejectPublicSuffixes);\n\n  // catch this mistake early:\n  if (!jar.store.synchronous) {\n    throw new Error('CookieJar store is not synchronous; use async API instead.');\n  }\n\n  jar._importCookiesSync(serialized);\n  return jar;\n};\nCookieJar.fromJSON = CookieJar.deserializeSync;\n\nCAN_BE_SYNC.push('clone');\nCookieJar.prototype.clone = function(newStore, cb) {\n  if (arguments.length === 1) {\n    cb = newStore;\n    newStore = null;\n  }\n\n  this.serialize(function(err,serialized) {\n    if (err) {\n      return cb(err);\n    }\n    CookieJar.deserialize(newStore, serialized, cb);\n  });\n};\n\n// Use a closure to provide a true imperative API for synchronous stores.\nfunction syncWrap(method) {\n  return function() {\n    if (!this.store.synchronous) {\n      throw new Error('CookieJar store is not synchronous; use async API instead.');\n    }\n\n    var args = Array.prototype.slice.call(arguments);\n    var syncErr, syncResult;\n    args.push(function syncCb(err, result) {\n      syncErr = err;\n      syncResult = result;\n    });\n    this[method].apply(this, args);\n\n    if (syncErr) {\n      throw syncErr;\n    }\n    return syncResult;\n  };\n}\n\n// wrap all declared CAN_BE_SYNC methods in the sync wrapper\nCAN_BE_SYNC.forEach(function(method) {\n  CookieJar.prototype[method+'Sync'] = syncWrap(method);\n});\n\nexports.CookieJar = CookieJar;\nexports.Cookie = Cookie;\nexports.Store = Store;\nexports.MemoryCookieStore = MemoryCookieStore;\nexports.parseDate = parseDate;\nexports.formatDate = formatDate;\nexports.parse = parse;\nexports.fromJSON = fromJSON;\nexports.domainMatch = domainMatch;\nexports.defaultPath = defaultPath;\nexports.pathMatch = pathMatch;\nexports.getPublicSuffix = pubsuffix.getPublicSuffix;\nexports.cookieCompare = cookieCompare;\nexports.permuteDomain = require('./permuteDomain').permuteDomain;\nexports.permutePath = permutePath;\nexports.canonicalDomain = canonicalDomain;\n","var denodeify = require('es6-denodeify')(Promise)\nvar tough = require('tough-cookie')\n\nmodule.exports = function fetchCookieDecorator (fetch, jar) {\n  fetch = fetch || window.fetch\n  jar = jar || new tough.CookieJar()\n\n  var getCookieString = denodeify(jar.getCookieString.bind(jar))\n  var setCookie = denodeify(jar.setCookie.bind(jar))\n\n  return function fetchCookie (url, opts) {\n    opts = opts || {}\n\n    return getCookieString(url)\n      .then(function (cookie) {\n        return fetch(url, Object.assign(opts, {\n          headers: Object.assign(opts.headers || {}, (cookie ? { cookie: cookie } : {}))\n        }))\n      })\n      .then(function (res) {\n        var cookies\n\n        if (res.headers.getAll) {\n          // node-fetch v1\n          cookies = res.headers.getAll('set-cookie')\n        } else {\n          // node-fetch v2\n          var cookie = res.headers.get('set-cookie')\n          cookies = cookie && cookie.split(',') || []\n        }\n\n        if (!cookies.length) {\n          return res\n        }\n\n        return Promise.all(cookies.map(function (cookie) {\n          return setCookie(cookie, res.url)\n        })).then(function () {\n          return res\n        })\n      })\n  }\n}\n","import nodeFetch from 'node-fetch';\nimport fetchCookie from 'fetch-cookie';\n\nvar fetch = fetchCookie(nodeFetch);\n\n/* We can fake the abort, the http adapter keeps track\n   of ignoring the result */\nfunction AbortController() {\n  return {abort: function () {}};\n}\n\nvar Headers = nodeFetch.Headers;\n\nexport { fetch, Headers, AbortController };\n","function pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\nexport { collate, normalizeKey, toIndexableString, parseIndexableString };\n","import { clone } from 'pouchdb-utils';\nimport { collate } from 'pouchdb-collate';\n\n// this would just be \"return doc[field]\", but fields\n// can be \"deep\" due to dot notation\nfunction getFieldFromDoc(doc, parsedField) {\n  var value = doc;\n  for (var i = 0, len = parsedField.length; i < len; i++) {\n    var key = parsedField[i];\n    value = value[key];\n    if (!value) {\n      break;\n    }\n  }\n  return value;\n}\n\nfunction setFieldInDoc(doc, parsedField, value) {\n  for (var i = 0, len = parsedField.length; i < len-1; i++) {\n    var elem = parsedField[i];\n    doc = doc[elem] = {};\n  }\n  doc[parsedField[len-1]] = value;\n}\n\nfunction compare(left, right) {\n  return left < right ? -1 : left > right ? 1 : 0;\n}\n\n// Converts a string in dot notation to an array of its components, with backslash escaping\nfunction parseField(fieldName) {\n  // fields may be deep (e.g. \"foo.bar.baz\"), so parse\n  var fields = [];\n  var current = '';\n  for (var i = 0, len = fieldName.length; i < len; i++) {\n    var ch = fieldName[i];\n    if (ch === '.') {\n      if (i > 0 && fieldName[i - 1] === '\\\\') { // escaped delimiter\n        current = current.substring(0, current.length - 1) + '.';\n      } else { // not escaped, so delimiter\n        fields.push(current);\n        current = '';\n      }\n    } else { // normal character\n      current += ch;\n    }\n  }\n  fields.push(current);\n  return fields;\n}\n\nvar combinationFields = ['$or', '$nor', '$not'];\nfunction isCombinationalField(field) {\n  return combinationFields.indexOf(field) > -1;\n}\n\nfunction getKey(obj) {\n  return Object.keys(obj)[0];\n}\n\nfunction getValue(obj) {\n  return obj[getKey(obj)];\n}\n\n\n// flatten an array of selectors joined by an $and operator\nfunction mergeAndedSelectors(selectors) {\n\n  // sort to ensure that e.g. if the user specified\n  // $and: [{$gt: 'a'}, {$gt: 'b'}], then it's collapsed into\n  // just {$gt: 'b'}\n  var res = {};\n\n  selectors.forEach(function (selector) {\n    Object.keys(selector).forEach(function (field) {\n      var matcher = selector[field];\n      if (typeof matcher !== 'object') {\n        matcher = {$eq: matcher};\n      }\n\n      if (isCombinationalField(field)) {\n        if (matcher instanceof Array) {\n          res[field] = matcher.map(function (m) {\n            return mergeAndedSelectors([m]);\n          });\n        } else {\n          res[field] = mergeAndedSelectors([matcher]);\n        }\n      } else {\n        var fieldMatchers = res[field] = res[field] || {};\n        Object.keys(matcher).forEach(function (operator) {\n          var value = matcher[operator];\n\n          if (operator === '$gt' || operator === '$gte') {\n            return mergeGtGte(operator, value, fieldMatchers);\n          } else if (operator === '$lt' || operator === '$lte') {\n            return mergeLtLte(operator, value, fieldMatchers);\n          } else if (operator === '$ne') {\n            return mergeNe(value, fieldMatchers);\n          } else if (operator === '$eq') {\n            return mergeEq(value, fieldMatchers);\n          }\n          fieldMatchers[operator] = value;\n        });\n      }\n    });\n  });\n\n  return res;\n}\n\n\n\n// collapse logically equivalent gt/gte values\nfunction mergeGtGte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$gte !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gte) { // more specificity\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value >= fieldMatchers.$gte) { // more specificity\n        delete fieldMatchers.$gte;\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$gt !== 'undefined') {\n    if (operator === '$gte') {\n      if (value > fieldMatchers.$gt) { // more specificity\n        delete fieldMatchers.$gt;\n        fieldMatchers.$gte = value;\n      }\n    } else { // operator === '$gt'\n      if (value > fieldMatchers.$gt) { // more specificity\n        fieldMatchers.$gt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// collapse logically equivalent lt/lte values\nfunction mergeLtLte(operator, value, fieldMatchers) {\n  if (typeof fieldMatchers.$eq !== 'undefined') {\n    return; // do nothing\n  }\n  if (typeof fieldMatchers.$lte !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lte) { // more specificity\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value <= fieldMatchers.$lte) { // more specificity\n        delete fieldMatchers.$lte;\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else if (typeof fieldMatchers.$lt !== 'undefined') {\n    if (operator === '$lte') {\n      if (value < fieldMatchers.$lt) { // more specificity\n        delete fieldMatchers.$lt;\n        fieldMatchers.$lte = value;\n      }\n    } else { // operator === '$gt'\n      if (value < fieldMatchers.$lt) { // more specificity\n        fieldMatchers.$lt = value;\n      }\n    }\n  } else {\n    fieldMatchers[operator] = value;\n  }\n}\n\n// combine $ne values into one array\nfunction mergeNe(value, fieldMatchers) {\n  if ('$ne' in fieldMatchers) {\n    // there are many things this could \"not\" be\n    fieldMatchers.$ne.push(value);\n  } else { // doesn't exist yet\n    fieldMatchers.$ne = [value];\n  }\n}\n\n// add $eq into the mix\nfunction mergeEq(value, fieldMatchers) {\n  // these all have less specificity than the $eq\n  // TODO: check for user errors here\n  delete fieldMatchers.$gt;\n  delete fieldMatchers.$gte;\n  delete fieldMatchers.$lt;\n  delete fieldMatchers.$lte;\n  delete fieldMatchers.$ne;\n  fieldMatchers.$eq = value;\n}\n\n\n//\n// normalize the selector\n//\nfunction massageSelector(input) {\n  var result = clone(input);\n  var wasAnded = false;\n  if ('$and' in result) {\n    result = mergeAndedSelectors(result['$and']);\n    wasAnded = true;\n  }\n\n  ['$or', '$nor'].forEach(function (orOrNor) {\n    if (orOrNor in result) {\n      // message each individual selector\n      // e.g. {foo: 'bar'} becomes {foo: {$eq: 'bar'}}\n      result[orOrNor].forEach(function (subSelector) {\n        var fields = Object.keys(subSelector);\n        for (var i = 0; i < fields.length; i++) {\n          var field = fields[i];\n          var matcher = subSelector[field];\n          if (typeof matcher !== 'object' || matcher === null) {\n            subSelector[field] = {$eq: matcher};\n          }\n        }\n      });\n    }\n  });\n\n  if ('$not' in result) {\n    //This feels a little like forcing, but it will work for now,\n    //I would like to come back to this and make the merging of selectors a little more generic\n    result['$not'] = mergeAndedSelectors([result['$not']]);\n  }\n\n  var fields = Object.keys(result);\n\n  for (var i = 0; i < fields.length; i++) {\n    var field = fields[i];\n    var matcher = result[field];\n\n    if (typeof matcher !== 'object' || matcher === null) {\n      matcher = {$eq: matcher};\n    } else if ('$ne' in matcher && !wasAnded) {\n      // I put these in an array, since there may be more than one\n      // but in the \"mergeAnded\" operation, I already take care of that\n      matcher.$ne = [matcher.$ne];\n    }\n    result[field] = matcher;\n  }\n\n  return result;\n}\n\n// create a comparator based on the sort object\nfunction createFieldSorter(sort) {\n\n  function getFieldValuesAsArray(doc) {\n    return sort.map(function (sorting) {\n      var fieldName = getKey(sorting);\n      var parsedField = parseField(fieldName);\n      var docFieldValue = getFieldFromDoc(doc, parsedField);\n      return docFieldValue;\n    });\n  }\n\n  return function (aRow, bRow) {\n    var aFieldValues = getFieldValuesAsArray(aRow.doc);\n    var bFieldValues = getFieldValuesAsArray(bRow.doc);\n    var collation = collate(aFieldValues, bFieldValues);\n    if (collation !== 0) {\n      return collation;\n    }\n    // this is what mango seems to do\n    return compare(aRow.doc._id, bRow.doc._id);\n  };\n}\n\nfunction filterInMemoryFields(rows, requestDef, inMemoryFields) {\n  rows = rows.filter(function (row) {\n    return rowFilter(row.doc, requestDef.selector, inMemoryFields);\n  });\n\n  if (requestDef.sort) {\n    // in-memory sort\n    var fieldSorter = createFieldSorter(requestDef.sort);\n    rows = rows.sort(fieldSorter);\n    if (typeof requestDef.sort[0] !== 'string' &&\n        getValue(requestDef.sort[0]) === 'desc') {\n      rows = rows.reverse();\n    }\n  }\n\n  if ('limit' in requestDef || 'skip' in requestDef) {\n    // have to do the limit in-memory\n    var skip = requestDef.skip || 0;\n    var limit = ('limit' in requestDef ? requestDef.limit : rows.length) + skip;\n    rows = rows.slice(skip, limit);\n  }\n  return rows;\n}\n\nfunction rowFilter(doc, selector, inMemoryFields) {\n  return inMemoryFields.every(function (field) {\n    var matcher = selector[field];\n    var parsedField = parseField(field);\n    var docFieldValue = getFieldFromDoc(doc, parsedField);\n    if (isCombinationalField(field)) {\n      return matchCominationalSelector(field, matcher, doc);\n    }\n\n    return matchSelector(matcher, doc, parsedField, docFieldValue);\n  });\n}\n\nfunction matchSelector(matcher, doc, parsedField, docFieldValue) {\n  if (!matcher) {\n    // no filtering necessary; this field is just needed for sorting\n    return true;\n  }\n\n  return Object.keys(matcher).every(function (userOperator) {\n    var userValue = matcher[userOperator];\n    return match(userOperator, doc, userValue, parsedField, docFieldValue);\n  });\n}\n\nfunction matchCominationalSelector(field, matcher, doc) {\n\n  if (field === '$or') {\n    return matcher.some(function (orMatchers) {\n      return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n    });\n  }\n\n  if (field === '$not') {\n    return !rowFilter(doc, matcher, Object.keys(matcher));\n  }\n\n  //`$nor`\n  return !matcher.find(function (orMatchers) {\n    return rowFilter(doc, orMatchers, Object.keys(orMatchers));\n  });\n\n}\n\nfunction match(userOperator, doc, userValue, parsedField, docFieldValue) {\n  if (!matchers[userOperator]) {\n    throw new Error('unknown operator \"' + userOperator +\n      '\" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, ' +\n      '$nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');\n  }\n  return matchers[userOperator](doc, userValue, parsedField, docFieldValue);\n}\n\nfunction fieldExists(docFieldValue) {\n  return typeof docFieldValue !== 'undefined' && docFieldValue !== null;\n}\n\nfunction fieldIsNotUndefined(docFieldValue) {\n  return typeof docFieldValue !== 'undefined';\n}\n\nfunction modField(docFieldValue, userValue) {\n  var divisor = userValue[0];\n  var mod = userValue[1];\n  if (divisor === 0) {\n    throw new Error('Bad divisor, cannot divide by zero');\n  }\n\n  if (parseInt(divisor, 10) !== divisor ) {\n    throw new Error('Divisor is not an integer');\n  }\n\n  if (parseInt(mod, 10) !== mod ) {\n    throw new Error('Modulus is not an integer');\n  }\n\n  if (parseInt(docFieldValue, 10) !== docFieldValue) {\n    return false;\n  }\n\n  return docFieldValue % divisor === mod;\n}\n\nfunction arrayContainsValue(docFieldValue, userValue) {\n  return userValue.some(function (val) {\n    if (docFieldValue instanceof Array) {\n      return docFieldValue.indexOf(val) > -1;\n    }\n\n    return docFieldValue === val;\n  });\n}\n\nfunction arrayContainsAllValues(docFieldValue, userValue) {\n  return userValue.every(function (val) {\n    return docFieldValue.indexOf(val) > -1;\n  });\n}\n\nfunction arraySize(docFieldValue, userValue) {\n  return docFieldValue.length === userValue;\n}\n\nfunction regexMatch(docFieldValue, userValue) {\n  var re = new RegExp(userValue);\n\n  return re.test(docFieldValue);\n}\n\nfunction typeMatch(docFieldValue, userValue) {\n\n  switch (userValue) {\n    case 'null':\n      return docFieldValue === null;\n    case 'boolean':\n      return typeof (docFieldValue) === 'boolean';\n    case 'number':\n      return typeof (docFieldValue) === 'number';\n    case 'string':\n      return typeof (docFieldValue) === 'string';\n    case 'array':\n      return docFieldValue instanceof Array;\n    case 'object':\n      return ({}).toString.call(docFieldValue) === '[object Object]';\n  }\n\n  throw new Error(userValue + ' not supported as a type.' +\n                  'Please use one of object, string, array, number, boolean or null.');\n\n}\n\nvar matchers = {\n\n  '$elemMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.some(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.some(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$allMatch': function (doc, userValue, parsedField, docFieldValue) {\n    if (!Array.isArray(docFieldValue)) {\n      return false;\n    }\n\n    /* istanbul ignore next */\n    if (docFieldValue.length === 0) {\n      return false;\n    }\n\n    if (typeof docFieldValue[0] === 'object') {\n      return docFieldValue.every(function (val) {\n        return rowFilter(val, userValue, Object.keys(userValue));\n      });\n    }\n\n    return docFieldValue.every(function (val) {\n      return matchSelector(userValue, doc, parsedField, val);\n    });\n  },\n\n  '$eq': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) === 0;\n  },\n\n  '$gte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) >= 0;\n  },\n\n  '$gt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) > 0;\n  },\n\n  '$lte': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) <= 0;\n  },\n\n  '$lt': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldIsNotUndefined(docFieldValue) && collate(docFieldValue, userValue) < 0;\n  },\n\n  '$exists': function (doc, userValue, parsedField, docFieldValue) {\n    //a field that is null is still considered to exist\n    if (userValue) {\n      return fieldIsNotUndefined(docFieldValue);\n    }\n\n    return !fieldIsNotUndefined(docFieldValue);\n  },\n\n  '$mod': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && modField(docFieldValue, userValue);\n  },\n\n  '$ne': function (doc, userValue, parsedField, docFieldValue) {\n    return userValue.every(function (neValue) {\n      return collate(docFieldValue, neValue) !== 0;\n    });\n  },\n  '$in': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$nin': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && !arrayContainsValue(docFieldValue, userValue);\n  },\n\n  '$size': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && arraySize(docFieldValue, userValue);\n  },\n\n  '$all': function (doc, userValue, parsedField, docFieldValue) {\n    return Array.isArray(docFieldValue) && arrayContainsAllValues(docFieldValue, userValue);\n  },\n\n  '$regex': function (doc, userValue, parsedField, docFieldValue) {\n    return fieldExists(docFieldValue) && regexMatch(docFieldValue, userValue);\n  },\n\n  '$type': function (doc, userValue, parsedField, docFieldValue) {\n    return typeMatch(docFieldValue, userValue);\n  }\n};\n\n// return true if the given doc matches the supplied selector\nfunction matchesSelector(doc, selector) {\n  /* istanbul ignore if */\n  if (typeof selector !== 'object') {\n    // match the CouchDB error message\n    throw new Error('Selector error: expected a JSON object');\n  }\n\n  selector = massageSelector(selector);\n  var row = {\n    'doc': doc\n  };\n\n  var rowsMatched = filterInMemoryFields([row], { 'selector': selector }, Object.keys(selector));\n  return rowsMatched && rowsMatched.length === 1;\n}\n\nexport { massageSelector, matchesSelector, filterInMemoryFields, createFieldSorter, rowFilter, isCombinationalField, getKey, getValue, getFieldFromDoc, setFieldInDoc, compare, parseField };\n","function mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nexport { ExportedSet as Set, ExportedMap as Map };\n","import cloneBuffer from 'clone-buffer';\nimport getArguments from 'argsarray';\nimport { Map } from 'pouchdb-collections';\nimport { EventEmitter } from 'events';\nimport inherits from 'inherits';\nimport { createError, BAD_REQUEST, INVALID_ID, MISSING_ID, RESERVED_ID } from 'pouchdb-errors';\nimport uuidV4 from 'uuid';\nimport { stringMd5 } from 'pouchdb-md5';\nimport { clone } from 'pouchdb-utils';\n\nfunction isBinaryObject(object) {\n  return object instanceof Buffer;\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone$1(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone$1(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBuffer(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone$1(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone$1(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new Map();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\n// in Node of course this is false\nfunction hasLocalStorage() {\n  return false;\n}\n\nfunction nextTick(fn) {\n  process.nextTick(fn);\n}\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        nextTick(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// We assume Node users don't need to see this warning\nvar res = function () {};\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar assign$1 = assign;\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n// for browsers that don't support it like IE\n\n/* istanbul ignore next */\nfunction f() {}\n\nvar hasName = f.name;\nvar res$1;\n\n// We dont run coverage in IE\n/* istanbul ignore else */\nif (hasName) {\n  res$1 = function (fun) {\n    return fun.name;\n  };\n} else {\n  res$1 = function (fun) {\n    var match = fun.toString().match(/^\\s*function\\s*(?:(\\S+)\\s*)?\\(/);\n    if (match && match[1]) {\n      return match[1];\n    }\n    else {\n      return '';\n    }\n  };\n}\n\nvar res$2 = res$1;\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\nexport { adapterFun, assign$1 as assign, bulkGet as bulkGetShim, Changes as changesHandler, clone$1 as clone, defaultBackOff, res as explainError, filterChange, flatten, res$2 as functionName, guardedConsole, hasLocalStorage, invalidIdError, isRemote, listenerCount, nextTick, normalizeDesignDocFunctionName as normalizeDdocFunctionName, once, parseDesignDocFunctionName as parseDdocFunctionName, parseUri, pick, rev, scopeEval, toPromise, upsert, uuid };\n","var toString = Object.prototype.toString\n\nvar isModern = (\n  typeof Buffer.alloc === 'function' &&\n  typeof Buffer.allocUnsafe === 'function' &&\n  typeof Buffer.from === 'function'\n)\n\nfunction isArrayBuffer (input) {\n  return toString.call(input).slice(8, -1) === 'ArrayBuffer'\n}\n\nfunction fromArrayBuffer (obj, byteOffset, length) {\n  byteOffset >>>= 0\n\n  var maxLength = obj.byteLength - byteOffset\n\n  if (maxLength < 0) {\n    throw new RangeError(\"'offset' is out of bounds\")\n  }\n\n  if (length === undefined) {\n    length = maxLength\n  } else {\n    length >>>= 0\n\n    if (length > maxLength) {\n      throw new RangeError(\"'length' is out of bounds\")\n    }\n  }\n\n  return isModern\n    ? Buffer.from(obj.slice(byteOffset, byteOffset + length))\n    : new Buffer(new Uint8Array(obj.slice(byteOffset, byteOffset + length)))\n}\n\nfunction fromString (string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('\"encoding\" must be a valid string encoding')\n  }\n\n  return isModern\n    ? Buffer.from(string, encoding)\n    : new Buffer(string, encoding)\n}\n\nfunction bufferFrom (value, encodingOrOffset, length) {\n  if (typeof value === 'number') {\n    throw new TypeError('\"value\" argument must not be a number')\n  }\n\n  if (isArrayBuffer(value)) {\n    return fromArrayBuffer(value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'string') {\n    return fromString(value, encodingOrOffset)\n  }\n\n  return isModern\n    ? Buffer.from(value)\n    : new Buffer(value)\n}\n\nmodule.exports = bufferFrom\n","import bufferFrom from 'buffer-from';\n\nfunction thisAtob(str) {\n  var base64 = new Buffer(str, 'base64');\n  // Node.js will just skip the characters it can't decode instead of\n  // throwing an exception\n  if (base64.toString('base64') !== str) {\n    throw new Error(\"attachment is not a valid base64 string\");\n  }\n  return base64.toString('binary');\n}\n\nfunction thisBtoa(str) {\n  return bufferFrom(str, 'binary').toString('base64');\n}\n\nfunction typedBuffer(binString, buffType, type) {\n  // buffType is either 'binary' or 'base64'\n  var buff = bufferFrom(binString, buffType);\n  buff.type = type; // non-standard, but used for consistency with the browser\n  return buff;\n}\n\nfunction b64ToBluffer(b64, type) {\n  return typedBuffer(b64, 'base64', type);\n}\n\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction binaryStringToArrayBuffer(bin) {\n  var length = bin.length;\n  var buf = new ArrayBuffer(length);\n  var arr = new Uint8Array(buf);\n  for (var i = 0; i < length; i++) {\n    arr[i] = bin.charCodeAt(i);\n  }\n  return buf;\n}\n\nfunction binStringToBluffer(binString, type) {\n  return typedBuffer(binString, 'binary', type);\n}\n\n// This function is unused in Node\n/* istanbul ignore next */\nfunction createBlob() {\n}\n\nfunction blobToBase64(blobOrBuffer, callback) {\n  callback(blobOrBuffer.toString('base64'));\n}\n\n// not used in Node, but here for completeness\nfunction blobToBase64$1(blobOrBuffer, callback) {\n  callback(blobOrBuffer.toString('binary'));\n}\n\n// simplified API. universal browser support is assumed\nfunction readAsArrayBuffer(blob, callback) {\n  var reader = new FileReader();\n  reader.onloadend = function (e) {\n    var result = e.target.result || new ArrayBuffer(0);\n    callback(result);\n  };\n  reader.readAsArrayBuffer(blob);\n}\n\n//Can't find original post, but this is close\n//http://stackoverflow.com/questions/6965107/ (continues on next line)\n//converting-between-strings-and-arraybuffers\nfunction arrayBufferToBinaryString(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var length = bytes.byteLength;\n  for (var i = 0; i < length; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return binary;\n}\n\n// shim for browsers that don't support it\nfunction readAsBinaryString(blob, callback) {\n  var reader = new FileReader();\n  var hasBinaryString = typeof reader.readAsBinaryString === 'function';\n  reader.onloadend = function (e) {\n    var result = e.target.result || '';\n    if (hasBinaryString) {\n      return callback(result);\n    }\n    callback(arrayBufferToBinaryString(result));\n  };\n  if (hasBinaryString) {\n    reader.readAsBinaryString(blob);\n  } else {\n    reader.readAsArrayBuffer(blob);\n  }\n}\n\nexport { thisAtob as atob, thisBtoa as btoa, b64ToBluffer as base64StringToBlobOrBuffer, binaryStringToArrayBuffer, binStringToBluffer as binaryStringToBlobOrBuffer, createBlob as blob, blobToBase64 as blobOrBufferToBase64, blobToBase64$1 as blobOrBufferToBinaryString, readAsArrayBuffer, readAsBinaryString, typedBuffer };\n","function pad(str, padWith, upToLength) {\n  var padding = '';\n  var targetLength = upToLength - str.length;\n  /* istanbul ignore next */\n  while (padding.length < targetLength) {\n    padding += padWith;\n  }\n  return padding;\n}\n\nfunction padLeft(str, padWith, upToLength) {\n  var padding = pad(str, padWith, upToLength);\n  return padding + str;\n}\n\nvar MIN_MAGNITUDE = -324; // verified by -Number.MIN_VALUE\nvar MAGNITUDE_DIGITS = 3; // ditto\nvar SEP = ''; // set to '_' for easier debugging \n\nfunction collate(a, b) {\n\n  if (a === b) {\n    return 0;\n  }\n\n  a = normalizeKey(a);\n  b = normalizeKey(b);\n\n  var ai = collationIndex(a);\n  var bi = collationIndex(b);\n  if ((ai - bi) !== 0) {\n    return ai - bi;\n  }\n  switch (typeof a) {\n    case 'number':\n      return a - b;\n    case 'boolean':\n      return a < b ? -1 : 1;\n    case 'string':\n      return stringCollate(a, b);\n  }\n  return Array.isArray(a) ? arrayCollate(a, b) : objectCollate(a, b);\n}\n\n// couch considers null/NaN/Infinity/-Infinity === undefined,\n// for the purposes of mapreduce indexes. also, dates get stringified.\nfunction normalizeKey(key) {\n  switch (typeof key) {\n    case 'undefined':\n      return null;\n    case 'number':\n      if (key === Infinity || key === -Infinity || isNaN(key)) {\n        return null;\n      }\n      return key;\n    case 'object':\n      var origKey = key;\n      if (Array.isArray(key)) {\n        var len = key.length;\n        key = new Array(len);\n        for (var i = 0; i < len; i++) {\n          key[i] = normalizeKey(origKey[i]);\n        }\n      /* istanbul ignore next */\n      } else if (key instanceof Date) {\n        return key.toJSON();\n      } else if (key !== null) { // generic object\n        key = {};\n        for (var k in origKey) {\n          if (origKey.hasOwnProperty(k)) {\n            var val = origKey[k];\n            if (typeof val !== 'undefined') {\n              key[k] = normalizeKey(val);\n            }\n          }\n        }\n      }\n  }\n  return key;\n}\n\nfunction indexify(key) {\n  if (key !== null) {\n    switch (typeof key) {\n      case 'boolean':\n        return key ? 1 : 0;\n      case 'number':\n        return numToIndexableString(key);\n      case 'string':\n        // We've to be sure that key does not contain \\u0000\n        // Do order-preserving replacements:\n        // 0 -> 1, 1\n        // 1 -> 1, 2\n        // 2 -> 2, 2\n        /* eslint-disable no-control-regex */\n        return key\n          .replace(/\\u0002/g, '\\u0002\\u0002')\n          .replace(/\\u0001/g, '\\u0001\\u0002')\n          .replace(/\\u0000/g, '\\u0001\\u0001');\n        /* eslint-enable no-control-regex */\n      case 'object':\n        var isArray = Array.isArray(key);\n        var arr = isArray ? key : Object.keys(key);\n        var i = -1;\n        var len = arr.length;\n        var result = '';\n        if (isArray) {\n          while (++i < len) {\n            result += toIndexableString(arr[i]);\n          }\n        } else {\n          while (++i < len) {\n            var objKey = arr[i];\n            result += toIndexableString(objKey) +\n                toIndexableString(key[objKey]);\n          }\n        }\n        return result;\n    }\n  }\n  return '';\n}\n\n// convert the given key to a string that would be appropriate\n// for lexical sorting, e.g. within a database, where the\n// sorting is the same given by the collate() function.\nfunction toIndexableString(key) {\n  var zero = '\\u0000';\n  key = normalizeKey(key);\n  return collationIndex(key) + SEP + indexify(key) + zero;\n}\n\nfunction parseNumber(str, i) {\n  var originalIdx = i;\n  var num;\n  var zero = str[i] === '1';\n  if (zero) {\n    num = 0;\n    i++;\n  } else {\n    var neg = str[i] === '0';\n    i++;\n    var numAsString = '';\n    var magAsString = str.substring(i, i + MAGNITUDE_DIGITS);\n    var magnitude = parseInt(magAsString, 10) + MIN_MAGNITUDE;\n    /* istanbul ignore next */\n    if (neg) {\n      magnitude = -magnitude;\n    }\n    i += MAGNITUDE_DIGITS;\n    while (true) {\n      var ch = str[i];\n      if (ch === '\\u0000') {\n        break;\n      } else {\n        numAsString += ch;\n      }\n      i++;\n    }\n    numAsString = numAsString.split('.');\n    if (numAsString.length === 1) {\n      num = parseInt(numAsString, 10);\n    } else {\n      /* istanbul ignore next */\n      num = parseFloat(numAsString[0] + '.' + numAsString[1]);\n    }\n    /* istanbul ignore next */\n    if (neg) {\n      num = num - 10;\n    }\n    /* istanbul ignore next */\n    if (magnitude !== 0) {\n      // parseFloat is more reliable than pow due to rounding errors\n      // e.g. Number.MAX_VALUE would return Infinity if we did\n      // num * Math.pow(10, magnitude);\n      num = parseFloat(num + 'e' + magnitude);\n    }\n  }\n  return {num: num, length : i - originalIdx};\n}\n\n// move up the stack while parsing\n// this function moved outside of parseIndexableString for performance\nfunction pop(stack, metaStack) {\n  var obj = stack.pop();\n\n  if (metaStack.length) {\n    var lastMetaElement = metaStack[metaStack.length - 1];\n    if (obj === lastMetaElement.element) {\n      // popping a meta-element, e.g. an object whose value is another object\n      metaStack.pop();\n      lastMetaElement = metaStack[metaStack.length - 1];\n    }\n    var element = lastMetaElement.element;\n    var lastElementIndex = lastMetaElement.index;\n    if (Array.isArray(element)) {\n      element.push(obj);\n    } else if (lastElementIndex === stack.length - 2) { // obj with key+value\n      var key = stack.pop();\n      element[key] = obj;\n    } else {\n      stack.push(obj); // obj with key only\n    }\n  }\n}\n\nfunction parseIndexableString(str) {\n  var stack = [];\n  var metaStack = []; // stack for arrays and objects\n  var i = 0;\n\n  /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n  while (true) {\n    var collationIndex = str[i++];\n    if (collationIndex === '\\u0000') {\n      if (stack.length === 1) {\n        return stack.pop();\n      } else {\n        pop(stack, metaStack);\n        continue;\n      }\n    }\n    switch (collationIndex) {\n      case '1':\n        stack.push(null);\n        break;\n      case '2':\n        stack.push(str[i] === '1');\n        i++;\n        break;\n      case '3':\n        var parsedNum = parseNumber(str, i);\n        stack.push(parsedNum.num);\n        i += parsedNum.length;\n        break;\n      case '4':\n        var parsedStr = '';\n        /*eslint no-constant-condition: [\"error\", { \"checkLoops\": false }]*/\n        while (true) {\n          var ch = str[i];\n          if (ch === '\\u0000') {\n            break;\n          }\n          parsedStr += ch;\n          i++;\n        }\n        // perform the reverse of the order-preserving replacement\n        // algorithm (see above)\n        /* eslint-disable no-control-regex */\n        parsedStr = parsedStr.replace(/\\u0001\\u0001/g, '\\u0000')\n          .replace(/\\u0001\\u0002/g, '\\u0001')\n          .replace(/\\u0002\\u0002/g, '\\u0002');\n        /* eslint-enable no-control-regex */\n        stack.push(parsedStr);\n        break;\n      case '5':\n        var arrayElement = { element: [], index: stack.length };\n        stack.push(arrayElement.element);\n        metaStack.push(arrayElement);\n        break;\n      case '6':\n        var objElement = { element: {}, index: stack.length };\n        stack.push(objElement.element);\n        metaStack.push(objElement);\n        break;\n      /* istanbul ignore next */\n      default:\n        throw new Error(\n          'bad collationIndex or unexpectedly reached end of input: ' +\n            collationIndex);\n    }\n  }\n}\n\nfunction arrayCollate(a, b) {\n  var len = Math.min(a.length, b.length);\n  for (var i = 0; i < len; i++) {\n    var sort = collate(a[i], b[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n  }\n  return (a.length === b.length) ? 0 :\n    (a.length > b.length) ? 1 : -1;\n}\nfunction stringCollate(a, b) {\n  // See: https://github.com/daleharvey/pouchdb/issues/40\n  // This is incompatible with the CouchDB implementation, but its the\n  // best we can do for now\n  return (a === b) ? 0 : ((a > b) ? 1 : -1);\n}\nfunction objectCollate(a, b) {\n  var ak = Object.keys(a), bk = Object.keys(b);\n  var len = Math.min(ak.length, bk.length);\n  for (var i = 0; i < len; i++) {\n    // First sort the keys\n    var sort = collate(ak[i], bk[i]);\n    if (sort !== 0) {\n      return sort;\n    }\n    // if the keys are equal sort the values\n    sort = collate(a[ak[i]], b[bk[i]]);\n    if (sort !== 0) {\n      return sort;\n    }\n\n  }\n  return (ak.length === bk.length) ? 0 :\n    (ak.length > bk.length) ? 1 : -1;\n}\n// The collation is defined by erlangs ordered terms\n// the atoms null, true, false come first, then numbers, strings,\n// arrays, then objects\n// null/undefined/NaN/Infinity/-Infinity are all considered null\nfunction collationIndex(x) {\n  var id = ['boolean', 'number', 'string', 'object'];\n  var idx = id.indexOf(typeof x);\n  //false if -1 otherwise true, but fast!!!!1\n  if (~idx) {\n    if (x === null) {\n      return 1;\n    }\n    if (Array.isArray(x)) {\n      return 5;\n    }\n    return idx < 3 ? (idx + 2) : (idx + 3);\n  }\n  /* istanbul ignore next */\n  if (Array.isArray(x)) {\n    return 5;\n  }\n}\n\n// conversion:\n// x yyy zz...zz\n// x = 0 for negative, 1 for 0, 2 for positive\n// y = exponent (for negative numbers negated) moved so that it's >= 0\n// z = mantisse\nfunction numToIndexableString(num) {\n\n  if (num === 0) {\n    return '1';\n  }\n\n  // convert number to exponential format for easier and\n  // more succinct string sorting\n  var expFormat = num.toExponential().split(/e\\+?/);\n  var magnitude = parseInt(expFormat[1], 10);\n\n  var neg = num < 0;\n\n  var result = neg ? '0' : '2';\n\n  // first sort by magnitude\n  // it's easier if all magnitudes are positive\n  var magForComparison = ((neg ? -magnitude : magnitude) - MIN_MAGNITUDE);\n  var magString = padLeft((magForComparison).toString(), '0', MAGNITUDE_DIGITS);\n\n  result += SEP + magString;\n\n  // then sort by the factor\n  var factor = Math.abs(parseFloat(expFormat[0])); // [1..10)\n  /* istanbul ignore next */\n  if (neg) { // for negative reverse ordering\n    factor = 10 - factor;\n  }\n\n  var factorStr = factor.toFixed(20);\n\n  // strip zeros from the end\n  factorStr = factorStr.replace(/\\.?0+$/, '');\n\n  result += SEP + factorStr;\n\n  return result;\n}\n\nexport { collate, normalizeKey, toIndexableString, parseIndexableString };\n","function mangle(key) {\n  return '$' + key;\n}\nfunction unmangle(key) {\n  return key.substring(1);\n}\nfunction Map$1() {\n  this._store = {};\n}\nMap$1.prototype.get = function (key) {\n  var mangled = mangle(key);\n  return this._store[mangled];\n};\nMap$1.prototype.set = function (key, value) {\n  var mangled = mangle(key);\n  this._store[mangled] = value;\n  return true;\n};\nMap$1.prototype.has = function (key) {\n  var mangled = mangle(key);\n  return mangled in this._store;\n};\nMap$1.prototype.delete = function (key) {\n  var mangled = mangle(key);\n  var res = mangled in this._store;\n  delete this._store[mangled];\n  return res;\n};\nMap$1.prototype.forEach = function (cb) {\n  var keys = Object.keys(this._store);\n  for (var i = 0, len = keys.length; i < len; i++) {\n    var key = keys[i];\n    var value = this._store[key];\n    key = unmangle(key);\n    cb(value, key);\n  }\n};\nObject.defineProperty(Map$1.prototype, 'size', {\n  get: function () {\n    return Object.keys(this._store).length;\n  }\n});\n\nfunction Set$1(array) {\n  this._store = new Map$1();\n\n  // init with an array\n  if (array && Array.isArray(array)) {\n    for (var i = 0, len = array.length; i < len; i++) {\n      this.add(array[i]);\n    }\n  }\n}\nSet$1.prototype.add = function (key) {\n  return this._store.set(key, true);\n};\nSet$1.prototype.has = function (key) {\n  return this._store.has(key);\n};\nSet$1.prototype.forEach = function (cb) {\n  this._store.forEach(function (value, key) {\n    cb(key);\n  });\n};\nObject.defineProperty(Set$1.prototype, 'size', {\n  get: function () {\n    return this._store.size;\n  }\n});\n\n/* global Map,Set,Symbol */\n// Based on https://kangax.github.io/compat-table/es6/ we can sniff out\n// incomplete Map/Set implementations which would otherwise cause our tests to fail.\n// Notably they fail in IE11 and iOS 8.4, which this prevents.\nfunction supportsMapAndSet() {\n  if (typeof Symbol === 'undefined' || typeof Map === 'undefined' || typeof Set === 'undefined') {\n    return false;\n  }\n  var prop = Object.getOwnPropertyDescriptor(Map, Symbol.species);\n  return prop && 'get' in prop && Map[Symbol.species] === Map;\n}\n\n// based on https://github.com/montagejs/collections\n\nvar ExportedSet;\nvar ExportedMap;\n\n{\n  if (supportsMapAndSet()) { // prefer built-in Map/Set\n    ExportedSet = Set;\n    ExportedMap = Map;\n  } else { // fall back to our polyfill\n    ExportedSet = Set$1;\n    ExportedMap = Map$1;\n  }\n}\n\nexport { ExportedSet as Set, ExportedMap as Map };\n","import cloneBuffer from 'clone-buffer';\nimport getArguments from 'argsarray';\nimport { Map } from 'pouchdb-collections';\nimport { EventEmitter } from 'events';\nimport inherits from 'inherits';\nimport { createError, BAD_REQUEST, INVALID_ID, MISSING_ID, RESERVED_ID } from 'pouchdb-errors';\nimport uuidV4 from 'uuid';\nimport { stringMd5 } from 'pouchdb-md5';\nimport { clone } from 'pouchdb-utils';\n\nfunction isBinaryObject(object) {\n  return object instanceof Buffer;\n}\n\n// most of this is borrowed from lodash.isPlainObject:\n// https://github.com/fis-components/lodash.isplainobject/\n// blob/29c358140a74f252aeb08c9eb28bef86f2217d4a/index.js\n\nvar funcToString = Function.prototype.toString;\nvar objectCtorString = funcToString.call(Object);\n\nfunction isPlainObject(value) {\n  var proto = Object.getPrototypeOf(value);\n  /* istanbul ignore if */\n  if (proto === null) { // not sure when this happens, but I guess it can\n    return true;\n  }\n  var Ctor = proto.constructor;\n  return (typeof Ctor == 'function' &&\n    Ctor instanceof Ctor && funcToString.call(Ctor) == objectCtorString);\n}\n\nfunction clone$1(object) {\n  var newObject;\n  var i;\n  var len;\n\n  if (!object || typeof object !== 'object') {\n    return object;\n  }\n\n  if (Array.isArray(object)) {\n    newObject = [];\n    for (i = 0, len = object.length; i < len; i++) {\n      newObject[i] = clone$1(object[i]);\n    }\n    return newObject;\n  }\n\n  // special case: to avoid inconsistencies between IndexedDB\n  // and other backends, we automatically stringify Dates\n  if (object instanceof Date) {\n    return object.toISOString();\n  }\n\n  if (isBinaryObject(object)) {\n    return cloneBuffer(object);\n  }\n\n  if (!isPlainObject(object)) {\n    return object; // don't clone objects like Workers\n  }\n\n  newObject = {};\n  for (i in object) {\n    /* istanbul ignore else */\n    if (Object.prototype.hasOwnProperty.call(object, i)) {\n      var value = clone$1(object[i]);\n      if (typeof value !== 'undefined') {\n        newObject[i] = value;\n      }\n    }\n  }\n  return newObject;\n}\n\nfunction once(fun) {\n  var called = false;\n  return getArguments(function (args) {\n    /* istanbul ignore if */\n    if (called) {\n      // this is a smoke test and should never actually happen\n      throw new Error('once called more than once');\n    } else {\n      called = true;\n      fun.apply(this, args);\n    }\n  });\n}\n\nfunction toPromise(func) {\n  //create the function we will be returning\n  return getArguments(function (args) {\n    // Clone arguments\n    args = clone$1(args);\n    var self = this;\n    // if the last argument is a function, assume its a callback\n    var usedCB = (typeof args[args.length - 1] === 'function') ? args.pop() : false;\n    var promise = new Promise(function (fulfill, reject) {\n      var resp;\n      try {\n        var callback = once(function (err, mesg) {\n          if (err) {\n            reject(err);\n          } else {\n            fulfill(mesg);\n          }\n        });\n        // create a callback for this invocation\n        // apply the function in the orig context\n        args.push(callback);\n        resp = func.apply(self, args);\n        if (resp && typeof resp.then === 'function') {\n          fulfill(resp);\n        }\n      } catch (e) {\n        reject(e);\n      }\n    });\n    // if there is a callback, call it back\n    if (usedCB) {\n      promise.then(function (result) {\n        usedCB(null, result);\n      }, usedCB);\n    }\n    return promise;\n  });\n}\n\nfunction logApiCall(self, name, args) {\n  /* istanbul ignore if */\n  if (self.constructor.listeners('debug').length) {\n    var logArgs = ['api', self.name, name];\n    for (var i = 0; i < args.length - 1; i++) {\n      logArgs.push(args[i]);\n    }\n    self.constructor.emit('debug', logArgs);\n\n    // override the callback itself to log the response\n    var origCallback = args[args.length - 1];\n    args[args.length - 1] = function (err, res) {\n      var responseArgs = ['api', self.name, name];\n      responseArgs = responseArgs.concat(\n        err ? ['error', err] : ['success', res]\n      );\n      self.constructor.emit('debug', responseArgs);\n      origCallback(err, res);\n    };\n  }\n}\n\nfunction adapterFun(name, callback) {\n  return toPromise(getArguments(function (args) {\n    if (this._closed) {\n      return Promise.reject(new Error('database is closed'));\n    }\n    if (this._destroyed) {\n      return Promise.reject(new Error('database is destroyed'));\n    }\n    var self = this;\n    logApiCall(self, name, args);\n    if (!this.taskqueue.isReady) {\n      return new Promise(function (fulfill, reject) {\n        self.taskqueue.addTask(function (failed) {\n          if (failed) {\n            reject(failed);\n          } else {\n            fulfill(self[name].apply(self, args));\n          }\n        });\n      });\n    }\n    return callback.apply(this, args);\n  }));\n}\n\n// like underscore/lodash _.pick()\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var prop = arr[i];\n    if (prop in obj) {\n      res[prop] = obj[prop];\n    }\n  }\n  return res;\n}\n\n// Most browsers throttle concurrent requests at 6, so it's silly\n// to shim _bulk_get by trying to launch potentially hundreds of requests\n// and then letting the majority time out. We can handle this ourselves.\nvar MAX_NUM_CONCURRENT_REQUESTS = 6;\n\nfunction identityFunction(x) {\n  return x;\n}\n\nfunction formatResultForOpenRevsGet(result) {\n  return [{\n    ok: result\n  }];\n}\n\n// shim for P/CouchDB adapters that don't directly implement _bulk_get\nfunction bulkGet(db, opts, callback) {\n  var requests = opts.docs;\n\n  // consolidate into one request per doc if possible\n  var requestsById = new Map();\n  requests.forEach(function (request) {\n    if (requestsById.has(request.id)) {\n      requestsById.get(request.id).push(request);\n    } else {\n      requestsById.set(request.id, [request]);\n    }\n  });\n\n  var numDocs = requestsById.size;\n  var numDone = 0;\n  var perDocResults = new Array(numDocs);\n\n  function collapseResultsAndFinish() {\n    var results = [];\n    perDocResults.forEach(function (res) {\n      res.docs.forEach(function (info) {\n        results.push({\n          id: res.id,\n          docs: [info]\n        });\n      });\n    });\n    callback(null, {results: results});\n  }\n\n  function checkDone() {\n    if (++numDone === numDocs) {\n      collapseResultsAndFinish();\n    }\n  }\n\n  function gotResult(docIndex, id, docs) {\n    perDocResults[docIndex] = {id: id, docs: docs};\n    checkDone();\n  }\n\n  var allRequests = [];\n  requestsById.forEach(function (value, key) {\n    allRequests.push(key);\n  });\n\n  var i = 0;\n\n  function nextBatch() {\n\n    if (i >= allRequests.length) {\n      return;\n    }\n\n    var upTo = Math.min(i + MAX_NUM_CONCURRENT_REQUESTS, allRequests.length);\n    var batch = allRequests.slice(i, upTo);\n    processBatch(batch, i);\n    i += batch.length;\n  }\n\n  function processBatch(batch, offset) {\n    batch.forEach(function (docId, j) {\n      var docIdx = offset + j;\n      var docRequests = requestsById.get(docId);\n\n      // just use the first request as the \"template\"\n      // TODO: The _bulk_get API allows for more subtle use cases than this,\n      // but for now it is unlikely that there will be a mix of different\n      // \"atts_since\" or \"attachments\" in the same request, since it's just\n      // replicate.js that is using this for the moment.\n      // Also, atts_since is aspirational, since we don't support it yet.\n      var docOpts = pick(docRequests[0], ['atts_since', 'attachments']);\n      docOpts.open_revs = docRequests.map(function (request) {\n        // rev is optional, open_revs disallowed\n        return request.rev;\n      });\n\n      // remove falsey / undefined revisions\n      docOpts.open_revs = docOpts.open_revs.filter(identityFunction);\n\n      var formatResult = identityFunction;\n\n      if (docOpts.open_revs.length === 0) {\n        delete docOpts.open_revs;\n\n        // when fetching only the \"winning\" leaf,\n        // transform the result so it looks like an open_revs\n        // request\n        formatResult = formatResultForOpenRevsGet;\n      }\n\n      // globally-supplied options\n      ['revs', 'attachments', 'binary', 'ajax', 'latest'].forEach(function (param) {\n        if (param in opts) {\n          docOpts[param] = opts[param];\n        }\n      });\n      db.get(docId, docOpts, function (err, res) {\n        var result;\n        /* istanbul ignore if */\n        if (err) {\n          result = [{error: err}];\n        } else {\n          result = formatResult(res);\n        }\n        gotResult(docIdx, docId, result);\n        nextBatch();\n      });\n    });\n  }\n\n  nextBatch();\n\n}\n\n// in Node of course this is false\nfunction hasLocalStorage() {\n  return false;\n}\n\nfunction nextTick(fn) {\n  process.nextTick(fn);\n}\n\ninherits(Changes, EventEmitter);\n\n/* istanbul ignore next */\nfunction attachBrowserEvents(self) {\n  if (hasLocalStorage()) {\n    addEventListener(\"storage\", function (e) {\n      self.emit(e.key);\n    });\n  }\n}\n\nfunction Changes() {\n  EventEmitter.call(this);\n  this._listeners = {};\n\n  attachBrowserEvents(this);\n}\nChanges.prototype.addListener = function (dbName, id, db, opts) {\n  /* istanbul ignore if */\n  if (this._listeners[id]) {\n    return;\n  }\n  var self = this;\n  var inprogress = false;\n  function eventFunction() {\n    /* istanbul ignore if */\n    if (!self._listeners[id]) {\n      return;\n    }\n    if (inprogress) {\n      inprogress = 'waiting';\n      return;\n    }\n    inprogress = true;\n    var changesOpts = pick(opts, [\n      'style', 'include_docs', 'attachments', 'conflicts', 'filter',\n      'doc_ids', 'view', 'since', 'query_params', 'binary', 'return_docs'\n    ]);\n\n    /* istanbul ignore next */\n    function onError() {\n      inprogress = false;\n    }\n\n    db.changes(changesOpts).on('change', function (c) {\n      if (c.seq > opts.since && !opts.cancelled) {\n        opts.since = c.seq;\n        opts.onChange(c);\n      }\n    }).on('complete', function () {\n      if (inprogress === 'waiting') {\n        nextTick(eventFunction);\n      }\n      inprogress = false;\n    }).on('error', onError);\n  }\n  this._listeners[id] = eventFunction;\n  this.on(dbName, eventFunction);\n};\n\nChanges.prototype.removeListener = function (dbName, id) {\n  /* istanbul ignore if */\n  if (!(id in this._listeners)) {\n    return;\n  }\n  EventEmitter.prototype.removeListener.call(this, dbName,\n    this._listeners[id]);\n  delete this._listeners[id];\n};\n\n\n/* istanbul ignore next */\nChanges.prototype.notifyLocalWindows = function (dbName) {\n  //do a useless change on a storage thing\n  //in order to get other windows's listeners to activate\n  if (hasLocalStorage()) {\n    localStorage[dbName] = (localStorage[dbName] === \"a\") ? \"b\" : \"a\";\n  }\n};\n\nChanges.prototype.notify = function (dbName) {\n  this.emit(dbName);\n  this.notifyLocalWindows(dbName);\n};\n\nfunction guardedConsole(method) {\n  /* istanbul ignore else */\n  if (typeof console !== 'undefined' && typeof console[method] === 'function') {\n    var args = Array.prototype.slice.call(arguments, 1);\n    console[method].apply(console, args);\n  }\n}\n\nfunction randomNumber(min, max) {\n  var maxTimeout = 600000; // Hard-coded default of 10 minutes\n  min = parseInt(min, 10) || 0;\n  max = parseInt(max, 10);\n  if (max !== max || max <= min) {\n    max = (min || 1) << 1; //doubling\n  } else {\n    max = max + 1;\n  }\n  // In order to not exceed maxTimeout, pick a random value between half of maxTimeout and maxTimeout\n  if (max > maxTimeout) {\n    min = maxTimeout >> 1; // divide by two\n    max = maxTimeout;\n  }\n  var ratio = Math.random();\n  var range = max - min;\n\n  return ~~(range * ratio + min); // ~~ coerces to an int, but fast.\n}\n\nfunction defaultBackOff(min) {\n  var max = 0;\n  if (!min) {\n    max = 2000;\n  }\n  return randomNumber(min, max);\n}\n\n// We assume Node users don't need to see this warning\nvar res = function () {};\n\nvar assign;\n{\n  if (typeof Object.assign === 'function') {\n    assign = Object.assign;\n  } else {\n    // lite Object.assign polyfill based on\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n    assign = function (target) {\n      var to = Object(target);\n\n      for (var index = 1; index < arguments.length; index++) {\n        var nextSource = arguments[index];\n\n        if (nextSource != null) { // Skip over if undefined or null\n          for (var nextKey in nextSource) {\n            // Avoid bugs when hasOwnProperty is shadowed\n            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n              to[nextKey] = nextSource[nextKey];\n            }\n          }\n        }\n      }\n      return to;\n    };\n  }\n}\n\nvar assign$1 = assign;\n\nfunction tryFilter(filter, doc, req) {\n  try {\n    return !filter(doc, req);\n  } catch (err) {\n    var msg = 'Filter function threw: ' + err.toString();\n    return createError(BAD_REQUEST, msg);\n  }\n}\n\nfunction filterChange(opts) {\n  var req = {};\n  var hasFilter = opts.filter && typeof opts.filter === 'function';\n  req.query = opts.query_params;\n\n  return function filter(change) {\n    if (!change.doc) {\n      // CSG sends events on the changes feed that don't have documents,\n      // this hack makes a whole lot of existing code robust.\n      change.doc = {};\n    }\n\n    var filterReturn = hasFilter && tryFilter(opts.filter, change.doc, req);\n\n    if (typeof filterReturn === 'object') {\n      return filterReturn;\n    }\n\n    if (filterReturn) {\n      return false;\n    }\n\n    if (!opts.include_docs) {\n      delete change.doc;\n    } else if (!opts.attachments) {\n      for (var att in change.doc._attachments) {\n        /* istanbul ignore else */\n        if (change.doc._attachments.hasOwnProperty(att)) {\n          change.doc._attachments[att].stub = true;\n        }\n      }\n    }\n    return true;\n  };\n}\n\nfunction flatten(arrs) {\n  var res = [];\n  for (var i = 0, len = arrs.length; i < len; i++) {\n    res = res.concat(arrs[i]);\n  }\n  return res;\n}\n\n// shim for Function.prototype.name,\n// for browsers that don't support it like IE\n\n/* istanbul ignore next */\nfunction f() {}\n\nvar hasName = f.name;\nvar res$1;\n\n// We dont run coverage in IE\n/* istanbul ignore else */\nif (hasName) {\n  res$1 = function (fun) {\n    return fun.name;\n  };\n} else {\n  res$1 = function (fun) {\n    var match = fun.toString().match(/^\\s*function\\s*(?:(\\S+)\\s*)?\\(/);\n    if (match && match[1]) {\n      return match[1];\n    }\n    else {\n      return '';\n    }\n  };\n}\n\nvar res$2 = res$1;\n\n// Determine id an ID is valid\n//   - invalid IDs begin with an underescore that does not begin '_design' or\n//     '_local'\n//   - any other string value is a valid id\n// Returns the specific error object for each case\nfunction invalidIdError(id) {\n  var err;\n  if (!id) {\n    err = createError(MISSING_ID);\n  } else if (typeof id !== 'string') {\n    err = createError(INVALID_ID);\n  } else if (/^_/.test(id) && !(/^_(design|local)/).test(id)) {\n    err = createError(RESERVED_ID);\n  }\n  if (err) {\n    throw err;\n  }\n}\n\n// Checks if a PouchDB object is \"remote\" or not. This is\n\nfunction isRemote(db) {\n  if (typeof db._remote === 'boolean') {\n    return db._remote;\n  }\n  /* istanbul ignore next */\n  if (typeof db.type === 'function') {\n    guardedConsole('warn',\n      'db.type() is deprecated and will be removed in ' +\n      'a future version of PouchDB');\n    return db.type() === 'http';\n  }\n  /* istanbul ignore next */\n  return false;\n}\n\nfunction listenerCount(ee, type) {\n  return 'listenerCount' in ee ? ee.listenerCount(type) :\n                                 EventEmitter.listenerCount(ee, type);\n}\n\nfunction parseDesignDocFunctionName(s) {\n  if (!s) {\n    return null;\n  }\n  var parts = s.split('/');\n  if (parts.length === 2) {\n    return parts;\n  }\n  if (parts.length === 1) {\n    return [s, s];\n  }\n  return null;\n}\n\nfunction normalizeDesignDocFunctionName(s) {\n  var normalized = parseDesignDocFunctionName(s);\n  return normalized ? normalized.join('/') : null;\n}\n\n// originally parseUri 1.2.2, now patched by us\n// (c) Steven Levithan <stevenlevithan.com>\n// MIT License\nvar keys = [\"source\", \"protocol\", \"authority\", \"userInfo\", \"user\", \"password\",\n    \"host\", \"port\", \"relative\", \"path\", \"directory\", \"file\", \"query\", \"anchor\"];\nvar qName =\"queryKey\";\nvar qParser = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\n// use the \"loose\" parser\n/* eslint maxlen: 0, no-useless-escape: 0 */\nvar parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nfunction parseUri(str) {\n  var m = parser.exec(str);\n  var uri = {};\n  var i = 14;\n\n  while (i--) {\n    var key = keys[i];\n    var value = m[i] || \"\";\n    var encoded = ['user', 'password'].indexOf(key) !== -1;\n    uri[key] = encoded ? decodeURIComponent(value) : value;\n  }\n\n  uri[qName] = {};\n  uri[keys[12]].replace(qParser, function ($0, $1, $2) {\n    if ($1) {\n      uri[qName][$1] = $2;\n    }\n  });\n\n  return uri;\n}\n\n// Based on https://github.com/alexdavid/scope-eval v0.0.3\n// (source: https://unpkg.com/scope-eval@0.0.3/scope_eval.js)\n// This is basically just a wrapper around new Function()\n\nfunction scopeEval(source, scope) {\n  var keys = [];\n  var values = [];\n  for (var key in scope) {\n    if (scope.hasOwnProperty(key)) {\n      keys.push(key);\n      values.push(scope[key]);\n    }\n  }\n  keys.push(source);\n  return Function.apply(null, keys).apply(null, values);\n}\n\n// this is essentially the \"update sugar\" function from daleharvey/pouchdb#1388\n// the diffFun tells us what delta to apply to the doc.  it either returns\n// the doc, or false if it doesn't need to do an update after all\nfunction upsert(db, docId, diffFun) {\n  return new Promise(function (fulfill, reject) {\n    db.get(docId, function (err, doc) {\n      if (err) {\n        /* istanbul ignore next */\n        if (err.status !== 404) {\n          return reject(err);\n        }\n        doc = {};\n      }\n\n      // the user might change the _rev, so save it for posterity\n      var docRev = doc._rev;\n      var newDoc = diffFun(doc);\n\n      if (!newDoc) {\n        // if the diffFun returns falsy, we short-circuit as\n        // an optimization\n        return fulfill({updated: false, rev: docRev});\n      }\n\n      // users aren't allowed to modify these values,\n      // so reset them here\n      newDoc._id = docId;\n      newDoc._rev = docRev;\n      fulfill(tryAndPut(db, newDoc, diffFun));\n    });\n  });\n}\n\nfunction tryAndPut(db, doc, diffFun) {\n  return db.put(doc).then(function (res) {\n    return {\n      updated: true,\n      rev: res.rev\n    };\n  }, function (err) {\n    /* istanbul ignore next */\n    if (err.status !== 409) {\n      throw err;\n    }\n    return upsert(db, doc._id, diffFun);\n  });\n}\n\nfunction rev(doc, deterministic_revs) {\n  var clonedDoc = clone(doc);\n  if (!deterministic_revs) {\n    return uuidV4.v4().replace(/-/g, '').toLowerCase();\n  }\n\n  delete clonedDoc._rev_tree;\n  return stringMd5(JSON.stringify(clonedDoc));\n}\n\nvar uuid = uuidV4.v4;\n\nexport { adapterFun, assign$1 as assign, bulkGet as bulkGetShim, Changes as changesHandler, clone$1 as clone, defaultBackOff, res as explainError, filterChange, flatten, res$2 as functionName, guardedConsole, hasLocalStorage, invalidIdError, isRemote, listenerCount, nextTick, normalizeDesignDocFunctionName as normalizeDdocFunctionName, once, parseDesignDocFunctionName as parseDdocFunctionName, parseUri, pick, rev, scopeEval, toPromise, upsert, uuid };\n","import inherits from 'inherits';\nimport { Set } from 'pouchdb-collections';\nimport argsarray from 'argsarray';\nimport { nextTick } from 'pouchdb-utils';\n\nfunction QueryParseError(message) {\n  this.status = 400;\n  this.name = 'query_parse_error';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, QueryParseError);\n  } catch (e) {}\n}\n\ninherits(QueryParseError, Error);\n\nfunction NotFoundError(message) {\n  this.status = 404;\n  this.name = 'not_found';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, NotFoundError);\n  } catch (e) {}\n}\n\ninherits(NotFoundError, Error);\n\nfunction BuiltInError(message) {\n  this.status = 500;\n  this.name = 'invalid_value';\n  this.message = message;\n  this.error = true;\n  try {\n    Error.captureStackTrace(this, BuiltInError);\n  } catch (e) {}\n}\n\ninherits(BuiltInError, Error);\n\nfunction promisedCallback(promise, callback) {\n  if (callback) {\n    promise.then(function (res) {\n      nextTick(function () {\n        callback(null, res);\n      });\n    }, function (reason) {\n      nextTick(function () {\n        callback(reason);\n      });\n    });\n  }\n  return promise;\n}\n\nfunction callbackify(fun) {\n  return argsarray(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    if (typeof cb === 'function') {\n      promisedCallback(promise, cb);\n    }\n    return promise;\n  });\n}\n\n// Promise finally util similar to Q.finally\nfunction fin(promise, finalPromiseFactory) {\n  return promise.then(function (res) {\n    return finalPromiseFactory().then(function () {\n      return res;\n    });\n  }, function (reason) {\n    return finalPromiseFactory().then(function () {\n      throw reason;\n    });\n  });\n}\n\nfunction sequentialize(queue, promiseFactory) {\n  return function () {\n    var args = arguments;\n    var that = this;\n    return queue.add(function () {\n      return promiseFactory.apply(that, args);\n    });\n  };\n}\n\n// uniq an array of strings, order not guaranteed\n// similar to underscore/lodash _.uniq\nfunction uniq(arr) {\n  var theSet = new Set(arr);\n  var result = new Array(theSet.size);\n  var index = -1;\n  theSet.forEach(function (value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\nfunction mapToKeysArray(map) {\n  var result = new Array(map.size);\n  var index = -1;\n  map.forEach(function (value, key) {\n    result[++index] = key;\n  });\n  return result;\n}\n\nexport { uniq, sequentialize, fin, callbackify, promisedCallback, mapToKeysArray, QueryParseError, NotFoundError, BuiltInError };\n","import { upsert, flatten, guardedConsole, nextTick, isRemote } from 'pouchdb-utils';\nimport { stringMd5 } from 'pouchdb-md5';\nimport { Set, Map } from 'pouchdb-collections';\nimport { base64StringToBlobOrBuffer } from 'pouchdb-binary-utils';\nimport { collate, toIndexableString, normalizeKey, parseIndexableString } from 'pouchdb-collate';\nimport { generateErrorFromResponse } from 'pouchdb-errors';\nimport { Headers } from 'pouchdb-fetch';\nimport { callbackify, sequentialize, uniq, fin, promisedCallback, mapToKeysArray, QueryParseError, NotFoundError, BuiltInError } from 'pouchdb-mapreduce-utils';\n\n/*\n * Simple task queue to sequentialize actions. Assumes\n * callbacks will eventually fire (once).\n */\n\n\nfunction TaskQueue() {\n  this.promise = new Promise(function (fulfill) {fulfill(); });\n}\nTaskQueue.prototype.add = function (promiseFactory) {\n  this.promise = this.promise.catch(function () {\n    // just recover\n  }).then(function () {\n    return promiseFactory();\n  });\n  return this.promise;\n};\nTaskQueue.prototype.finish = function () {\n  return this.promise;\n};\n\nfunction stringify(input) {\n  if (!input) {\n    return 'undefined'; // backwards compat for empty reduce\n  }\n  // for backwards compat with mapreduce, functions/strings are stringified\n  // as-is. everything else is JSON-stringified.\n  switch (typeof input) {\n    case 'function':\n      // e.g. a mapreduce map\n      return input.toString();\n    case 'string':\n      // e.g. a mapreduce built-in _reduce function\n      return input.toString();\n    default:\n      // e.g. a JSON object in the case of mango queries\n      return JSON.stringify(input);\n  }\n}\n\n/* create a string signature for a view so we can cache it and uniq it */\nfunction createViewSignature(mapFun, reduceFun) {\n  // the \"undefined\" part is for backwards compatibility\n  return stringify(mapFun) + stringify(reduceFun) + 'undefined';\n}\n\nfunction createView(sourceDB, viewName, mapFun, reduceFun, temporary, localDocName) {\n  var viewSignature = createViewSignature(mapFun, reduceFun);\n\n  var cachedViews;\n  if (!temporary) {\n    // cache this to ensure we don't try to update the same view twice\n    cachedViews = sourceDB._cachedViews = sourceDB._cachedViews || {};\n    if (cachedViews[viewSignature]) {\n      return cachedViews[viewSignature];\n    }\n  }\n\n  var promiseForView = sourceDB.info().then(function (info) {\n\n    var depDbName = info.db_name + '-mrview-' +\n      (temporary ? 'temp' : stringMd5(viewSignature));\n\n    // save the view name in the source db so it can be cleaned up if necessary\n    // (e.g. when the _design doc is deleted, remove all associated view data)\n    function diffFunction(doc) {\n      doc.views = doc.views || {};\n      var fullViewName = viewName;\n      if (fullViewName.indexOf('/') === -1) {\n        fullViewName = viewName + '/' + viewName;\n      }\n      var depDbs = doc.views[fullViewName] = doc.views[fullViewName] || {};\n      /* istanbul ignore if */\n      if (depDbs[depDbName]) {\n        return; // no update necessary\n      }\n      depDbs[depDbName] = true;\n      return doc;\n    }\n    return upsert(sourceDB, '_local/' + localDocName, diffFunction).then(function () {\n      return sourceDB.registerDependentDatabase(depDbName).then(function (res) {\n        var db = res.db;\n        db.auto_compaction = true;\n        var view = {\n          name: depDbName,\n          db: db,\n          sourceDB: sourceDB,\n          adapter: sourceDB.adapter,\n          mapFun: mapFun,\n          reduceFun: reduceFun\n        };\n        return view.db.get('_local/lastSeq').catch(function (err) {\n          /* istanbul ignore if */\n          if (err.status !== 404) {\n            throw err;\n          }\n        }).then(function (lastSeqDoc) {\n          view.seq = lastSeqDoc ? lastSeqDoc.seq : 0;\n          if (cachedViews) {\n            view.db.once('destroyed', function () {\n              delete cachedViews[viewSignature];\n            });\n          }\n          return view;\n        });\n      });\n    });\n  });\n\n  if (cachedViews) {\n    cachedViews[viewSignature] = promiseForView;\n  }\n  return promiseForView;\n}\n\nvar persistentQueues = {};\nvar tempViewQueue = new TaskQueue();\nvar CHANGES_BATCH_SIZE = 50;\n\nfunction parseViewName(name) {\n  // can be either 'ddocname/viewname' or just 'viewname'\n  // (where the ddoc name is the same)\n  return name.indexOf('/') === -1 ? [name, name] : name.split('/');\n}\n\nfunction isGenOne(changes) {\n  // only return true if the current change is 1-\n  // and there are no other leafs\n  return changes.length === 1 && /^1-/.test(changes[0].rev);\n}\n\nfunction emitError(db, e) {\n  try {\n    db.emit('error', e);\n  } catch (err) {\n    guardedConsole('error',\n      'The user\\'s map/reduce function threw an uncaught error.\\n' +\n      'You can debug this error by doing:\\n' +\n      'myDatabase.on(\\'error\\', function (err) { debugger; });\\n' +\n      'Please double-check your map/reduce function.');\n    guardedConsole('error', e);\n  }\n}\n\n/**\n * Returns an \"abstract\" mapreduce object of the form:\n *\n *   {\n *     query: queryFun,\n *     viewCleanup: viewCleanupFun\n *   }\n *\n * Arguments are:\n *\n * localDoc: string\n *   This is for the local doc that gets saved in order to track the\n *   \"dependent\" DBs and clean them up for viewCleanup. It should be\n *   unique, so that indexer plugins don't collide with each other.\n * mapper: function (mapFunDef, emit)\n *   Returns a map function based on the mapFunDef, which in the case of\n *   normal map/reduce is just the de-stringified function, but may be\n *   something else, such as an object in the case of pouchdb-find.\n * reducer: function (reduceFunDef)\n *   Ditto, but for reducing. Modules don't have to support reducing\n *   (e.g. pouchdb-find).\n * ddocValidator: function (ddoc, viewName)\n *   Throws an error if the ddoc or viewName is not valid.\n *   This could be a way to communicate to the user that the configuration for the\n *   indexer is invalid.\n */\nfunction createAbstractMapReduce(localDocName, mapper, reducer, ddocValidator) {\n\n  function tryMap(db, fun, doc) {\n    // emit an event if there was an error thrown by a map function.\n    // putting try/catches in a single function also avoids deoptimizations.\n    try {\n      fun(doc);\n    } catch (e) {\n      emitError(db, e);\n    }\n  }\n\n  function tryReduce(db, fun, keys, values, rereduce) {\n    // same as above, but returning the result or an error. there are two separate\n    // functions to avoid extra memory allocations since the tryCode() case is used\n    // for custom map functions (common) vs this function, which is only used for\n    // custom reduce functions (rare)\n    try {\n      return {output : fun(keys, values, rereduce)};\n    } catch (e) {\n      emitError(db, e);\n      return {error: e};\n    }\n  }\n\n  function sortByKeyThenValue(x, y) {\n    var keyCompare = collate(x.key, y.key);\n    return keyCompare !== 0 ? keyCompare : collate(x.value, y.value);\n  }\n\n  function sliceResults(results, limit, skip) {\n    skip = skip || 0;\n    if (typeof limit === 'number') {\n      return results.slice(skip, limit + skip);\n    } else if (skip > 0) {\n      return results.slice(skip);\n    }\n    return results;\n  }\n\n  function rowToDocId(row) {\n    var val = row.value;\n    // Users can explicitly specify a joined doc _id, or it\n    // defaults to the doc _id that emitted the key/value.\n    var docId = (val && typeof val === 'object' && val._id) || row.id;\n    return docId;\n  }\n\n  function readAttachmentsAsBlobOrBuffer(res) {\n    res.rows.forEach(function (row) {\n      var atts = row.doc && row.doc._attachments;\n      if (!atts) {\n        return;\n      }\n      Object.keys(atts).forEach(function (filename) {\n        var att = atts[filename];\n        atts[filename].data = base64StringToBlobOrBuffer(att.data, att.content_type);\n      });\n    });\n  }\n\n  function postprocessAttachments(opts) {\n    return function (res) {\n      if (opts.include_docs && opts.attachments && opts.binary) {\n        readAttachmentsAsBlobOrBuffer(res);\n      }\n      return res;\n    };\n  }\n\n  function addHttpParam(paramName, opts, params, asJson) {\n    // add an http param from opts to params, optionally json-encoded\n    var val = opts[paramName];\n    if (typeof val !== 'undefined') {\n      if (asJson) {\n        val = encodeURIComponent(JSON.stringify(val));\n      }\n      params.push(paramName + '=' + val);\n    }\n  }\n\n  function coerceInteger(integerCandidate) {\n    if (typeof integerCandidate !== 'undefined') {\n      var asNumber = Number(integerCandidate);\n      // prevents e.g. '1foo' or '1.1' being coerced to 1\n      if (!isNaN(asNumber) && asNumber === parseInt(integerCandidate, 10)) {\n        return asNumber;\n      } else {\n        return integerCandidate;\n      }\n    }\n  }\n\n  function coerceOptions(opts) {\n    opts.group_level = coerceInteger(opts.group_level);\n    opts.limit = coerceInteger(opts.limit);\n    opts.skip = coerceInteger(opts.skip);\n    return opts;\n  }\n\n  function checkPositiveInteger(number) {\n    if (number) {\n      if (typeof number !== 'number') {\n        return  new QueryParseError('Invalid value for integer: \"' +\n          number + '\"');\n      }\n      if (number < 0) {\n        return new QueryParseError('Invalid value for positive integer: ' +\n          '\"' + number + '\"');\n      }\n    }\n  }\n\n  function checkQueryParseError(options, fun) {\n    var startkeyName = options.descending ? 'endkey' : 'startkey';\n    var endkeyName = options.descending ? 'startkey' : 'endkey';\n\n    if (typeof options[startkeyName] !== 'undefined' &&\n      typeof options[endkeyName] !== 'undefined' &&\n      collate(options[startkeyName], options[endkeyName]) > 0) {\n      throw new QueryParseError('No rows can match your key range, ' +\n        'reverse your start_key and end_key or set {descending : true}');\n    } else if (fun.reduce && options.reduce !== false) {\n      if (options.include_docs) {\n        throw new QueryParseError('{include_docs:true} is invalid for reduce');\n      } else if (options.keys && options.keys.length > 1 &&\n        !options.group && !options.group_level) {\n        throw new QueryParseError('Multi-key fetches for reduce views must use ' +\n          '{group: true}');\n      }\n    }\n    ['group_level', 'limit', 'skip'].forEach(function (optionName) {\n      var error = checkPositiveInteger(options[optionName]);\n      if (error) {\n        throw error;\n      }\n    });\n  }\n\n  function httpQuery(db, fun, opts) {\n    // List of parameters to add to the PUT request\n    var params = [];\n    var body;\n    var method = 'GET';\n    var ok, status;\n\n    // If opts.reduce exists and is defined, then add it to the list\n    // of parameters.\n    // If reduce=false then the results are that of only the map function\n    // not the final result of map and reduce.\n    addHttpParam('reduce', opts, params);\n    addHttpParam('include_docs', opts, params);\n    addHttpParam('attachments', opts, params);\n    addHttpParam('limit', opts, params);\n    addHttpParam('descending', opts, params);\n    addHttpParam('group', opts, params);\n    addHttpParam('group_level', opts, params);\n    addHttpParam('skip', opts, params);\n    addHttpParam('stale', opts, params);\n    addHttpParam('conflicts', opts, params);\n    addHttpParam('startkey', opts, params, true);\n    addHttpParam('start_key', opts, params, true);\n    addHttpParam('endkey', opts, params, true);\n    addHttpParam('end_key', opts, params, true);\n    addHttpParam('inclusive_end', opts, params);\n    addHttpParam('key', opts, params, true);\n    addHttpParam('update_seq', opts, params);\n\n    // Format the list of parameters into a valid URI query string\n    params = params.join('&');\n    params = params === '' ? '' : '?' + params;\n\n    // If keys are supplied, issue a POST to circumvent GET query string limits\n    // see http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options\n    if (typeof opts.keys !== 'undefined') {\n      var MAX_URL_LENGTH = 2000;\n      // according to http://stackoverflow.com/a/417184/680742,\n      // the de facto URL length limit is 2000 characters\n\n      var keysAsString =\n        'keys=' + encodeURIComponent(JSON.stringify(opts.keys));\n      if (keysAsString.length + params.length + 1 <= MAX_URL_LENGTH) {\n        // If the keys are short enough, do a GET. we do this to work around\n        // Safari not understanding 304s on POSTs (see pouchdb/pouchdb#1239)\n        params += (params[0] === '?' ? '&' : '?') + keysAsString;\n      } else {\n        method = 'POST';\n        if (typeof fun === 'string') {\n          body = {keys: opts.keys};\n        } else { // fun is {map : mapfun}, so append to this\n          fun.keys = opts.keys;\n        }\n      }\n    }\n\n    // We are referencing a query defined in the design doc\n    if (typeof fun === 'string') {\n      var parts = parseViewName(fun);\n      return db.fetch('_design/' + parts[0] + '/_view/' + parts[1] + params, {\n        headers: new Headers({'Content-Type': 'application/json'}),\n        method: method,\n        body: JSON.stringify(body)\n      }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n        return response.json();\n      }).then(function (result) {\n        if (!ok) {\n          result.status = status;\n          throw generateErrorFromResponse(result);\n        }\n        // fail the entire request if the result contains an error\n        result.rows.forEach(function (row) {\n          /* istanbul ignore if */\n          if (row.value && row.value.error && row.value.error === \"builtin_reduce_error\") {\n            throw new Error(row.reason);\n          }\n        });\n        return result;\n      }).then(postprocessAttachments(opts));\n    }\n\n    // We are using a temporary view, terrible for performance, good for testing\n    body = body || {};\n    Object.keys(fun).forEach(function (key) {\n      if (Array.isArray(fun[key])) {\n        body[key] = fun[key];\n      } else {\n        body[key] = fun[key].toString();\n      }\n    });\n\n    return db.fetch('_temp_view' + params, {\n      headers: new Headers({'Content-Type': 'application/json'}),\n      method: 'POST',\n      body: JSON.stringify(body)\n    }).then(function (response) {\n        ok = response.ok;\n        status = response.status;\n      return response.json();\n    }).then(function (result) {\n      if (!ok) {\n        result.status = status;\n        throw generateErrorFromResponse(result);\n      }\n      return result;\n    }).then(postprocessAttachments(opts));\n  }\n\n  // custom adapters can define their own api._query\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customQuery(db, fun, opts) {\n    return new Promise(function (resolve, reject) {\n      db._query(fun, opts, function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  // custom adapters can define their own api._viewCleanup\n  // and override the default behavior\n  /* istanbul ignore next */\n  function customViewCleanup(db) {\n    return new Promise(function (resolve, reject) {\n      db._viewCleanup(function (err, res) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(res);\n      });\n    });\n  }\n\n  function defaultsTo(value) {\n    return function (reason) {\n      /* istanbul ignore else */\n      if (reason.status === 404) {\n        return value;\n      } else {\n        throw reason;\n      }\n    };\n  }\n\n  // returns a promise for a list of docs to update, based on the input docId.\n  // the order doesn't matter, because post-3.2.0, bulkDocs\n  // is an atomic operation in all three adapters.\n  function getDocsToPersist(docId, view, docIdsToChangesAndEmits) {\n    var metaDocId = '_local/doc_' + docId;\n    var defaultMetaDoc = {_id: metaDocId, keys: []};\n    var docData = docIdsToChangesAndEmits.get(docId);\n    var indexableKeysToKeyValues = docData[0];\n    var changes = docData[1];\n\n    function getMetaDoc() {\n      if (isGenOne(changes)) {\n        // generation 1, so we can safely assume initial state\n        // for performance reasons (avoids unnecessary GETs)\n        return Promise.resolve(defaultMetaDoc);\n      }\n      return view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc));\n    }\n\n    function getKeyValueDocs(metaDoc) {\n      if (!metaDoc.keys.length) {\n        // no keys, no need for a lookup\n        return Promise.resolve({rows: []});\n      }\n      return view.db.allDocs({\n        keys: metaDoc.keys,\n        include_docs: true\n      });\n    }\n\n    function processKeyValueDocs(metaDoc, kvDocsRes) {\n      var kvDocs = [];\n      var oldKeys = new Set();\n\n      for (var i = 0, len = kvDocsRes.rows.length; i < len; i++) {\n        var row = kvDocsRes.rows[i];\n        var doc = row.doc;\n        if (!doc) { // deleted\n          continue;\n        }\n        kvDocs.push(doc);\n        oldKeys.add(doc._id);\n        doc._deleted = !indexableKeysToKeyValues.has(doc._id);\n        if (!doc._deleted) {\n          var keyValue = indexableKeysToKeyValues.get(doc._id);\n          if ('value' in keyValue) {\n            doc.value = keyValue.value;\n          }\n        }\n      }\n      var newKeys = mapToKeysArray(indexableKeysToKeyValues);\n      newKeys.forEach(function (key) {\n        if (!oldKeys.has(key)) {\n          // new doc\n          var kvDoc = {\n            _id: key\n          };\n          var keyValue = indexableKeysToKeyValues.get(key);\n          if ('value' in keyValue) {\n            kvDoc.value = keyValue.value;\n          }\n          kvDocs.push(kvDoc);\n        }\n      });\n      metaDoc.keys = uniq(newKeys.concat(metaDoc.keys));\n      kvDocs.push(metaDoc);\n\n      return kvDocs;\n    }\n\n    return getMetaDoc().then(function (metaDoc) {\n      return getKeyValueDocs(metaDoc).then(function (kvDocsRes) {\n        return processKeyValueDocs(metaDoc, kvDocsRes);\n      });\n    });\n  }\n\n  // updates all emitted key/value docs and metaDocs in the mrview database\n  // for the given batch of documents from the source database\n  function saveKeyValues(view, docIdsToChangesAndEmits, seq) {\n    var seqDocId = '_local/lastSeq';\n    return view.db.get(seqDocId)\n      .catch(defaultsTo({_id: seqDocId, seq: 0}))\n      .then(function (lastSeqDoc) {\n        var docIds = mapToKeysArray(docIdsToChangesAndEmits);\n        return Promise.all(docIds.map(function (docId) {\n          return getDocsToPersist(docId, view, docIdsToChangesAndEmits);\n        })).then(function (listOfDocsToPersist) {\n          var docsToPersist = flatten(listOfDocsToPersist);\n          lastSeqDoc.seq = seq;\n          docsToPersist.push(lastSeqDoc);\n          // write all docs in a single operation, update the seq once\n          return view.db.bulkDocs({docs : docsToPersist});\n        });\n      });\n  }\n\n  function getQueue(view) {\n    var viewName = typeof view === 'string' ? view : view.name;\n    var queue = persistentQueues[viewName];\n    if (!queue) {\n      queue = persistentQueues[viewName] = new TaskQueue();\n    }\n    return queue;\n  }\n\n  function updateView(view) {\n    return sequentialize(getQueue(view), function () {\n      return updateViewInQueue(view);\n    })();\n  }\n\n  function updateViewInQueue(view) {\n    // bind the emit function once\n    var mapResults;\n    var doc;\n\n    function emit(key, value) {\n      var output = {id: doc._id, key: normalizeKey(key)};\n      // Don't explicitly store the value unless it's defined and non-null.\n      // This saves on storage space, because often people don't use it.\n      if (typeof value !== 'undefined' && value !== null) {\n        output.value = normalizeKey(value);\n      }\n      mapResults.push(output);\n    }\n\n    var mapFun = mapper(view.mapFun, emit);\n\n    var currentSeq = view.seq || 0;\n\n    function processChange(docIdsToChangesAndEmits, seq) {\n      return function () {\n        return saveKeyValues(view, docIdsToChangesAndEmits, seq);\n      };\n    }\n\n    var queue = new TaskQueue();\n\n    function processNextBatch() {\n      return view.sourceDB.changes({\n        return_docs: true,\n        conflicts: true,\n        include_docs: true,\n        style: 'all_docs',\n        since: currentSeq,\n        limit: CHANGES_BATCH_SIZE\n      }).then(processBatch);\n    }\n\n    function processBatch(response) {\n      var results = response.results;\n      if (!results.length) {\n        return;\n      }\n      var docIdsToChangesAndEmits = createDocIdsToChangesAndEmits(results);\n      queue.add(processChange(docIdsToChangesAndEmits, currentSeq));\n      if (results.length < CHANGES_BATCH_SIZE) {\n        return;\n      }\n      return processNextBatch();\n    }\n\n    function createDocIdsToChangesAndEmits(results) {\n      var docIdsToChangesAndEmits = new Map();\n      for (var i = 0, len = results.length; i < len; i++) {\n        var change = results[i];\n        if (change.doc._id[0] !== '_') {\n          mapResults = [];\n          doc = change.doc;\n\n          if (!doc._deleted) {\n            tryMap(view.sourceDB, mapFun, doc);\n          }\n          mapResults.sort(sortByKeyThenValue);\n\n          var indexableKeysToKeyValues = createIndexableKeysToKeyValues(mapResults);\n          docIdsToChangesAndEmits.set(change.doc._id, [\n            indexableKeysToKeyValues,\n            change.changes\n          ]);\n        }\n        currentSeq = change.seq;\n      }\n      return docIdsToChangesAndEmits;\n    }\n\n    function createIndexableKeysToKeyValues(mapResults) {\n      var indexableKeysToKeyValues = new Map();\n      var lastKey;\n      for (var i = 0, len = mapResults.length; i < len; i++) {\n        var emittedKeyValue = mapResults[i];\n        var complexKey = [emittedKeyValue.key, emittedKeyValue.id];\n        if (i > 0 && collate(emittedKeyValue.key, lastKey) === 0) {\n          complexKey.push(i); // dup key+id, so make it unique\n        }\n        indexableKeysToKeyValues.set(toIndexableString(complexKey), emittedKeyValue);\n        lastKey = emittedKeyValue.key;\n      }\n      return indexableKeysToKeyValues;\n    }\n\n    return processNextBatch().then(function () {\n      return queue.finish();\n    }).then(function () {\n      view.seq = currentSeq;\n    });\n  }\n\n  function reduceView(view, results, options) {\n    if (options.group_level === 0) {\n      delete options.group_level;\n    }\n\n    var shouldGroup = options.group || options.group_level;\n\n    var reduceFun = reducer(view.reduceFun);\n\n    var groups = [];\n    var lvl = isNaN(options.group_level) ? Number.POSITIVE_INFINITY :\n      options.group_level;\n    results.forEach(function (e) {\n      var last = groups[groups.length - 1];\n      var groupKey = shouldGroup ? e.key : null;\n\n      // only set group_level for array keys\n      if (shouldGroup && Array.isArray(groupKey)) {\n        groupKey = groupKey.slice(0, lvl);\n      }\n\n      if (last && collate(last.groupKey, groupKey) === 0) {\n        last.keys.push([e.key, e.id]);\n        last.values.push(e.value);\n        return;\n      }\n      groups.push({\n        keys: [[e.key, e.id]],\n        values: [e.value],\n        groupKey: groupKey\n      });\n    });\n    results = [];\n    for (var i = 0, len = groups.length; i < len; i++) {\n      var e = groups[i];\n      var reduceTry = tryReduce(view.sourceDB, reduceFun, e.keys, e.values, false);\n      if (reduceTry.error && reduceTry.error instanceof BuiltInError) {\n        // CouchDB returns an error if a built-in errors out\n        throw reduceTry.error;\n      }\n      results.push({\n        // CouchDB just sets the value to null if a non-built-in errors out\n        value: reduceTry.error ? null : reduceTry.output,\n        key: e.groupKey\n      });\n    }\n    // no total_rows/offset when reducing\n    return {rows: sliceResults(results, options.limit, options.skip)};\n  }\n\n  function queryView(view, opts) {\n    return sequentialize(getQueue(view), function () {\n      return queryViewInQueue(view, opts);\n    })();\n  }\n\n  function queryViewInQueue(view, opts) {\n    var totalRows;\n    var shouldReduce = view.reduceFun && opts.reduce !== false;\n    var skip = opts.skip || 0;\n    if (typeof opts.keys !== 'undefined' && !opts.keys.length) {\n      // equivalent query\n      opts.limit = 0;\n      delete opts.keys;\n    }\n\n    function fetchFromView(viewOpts) {\n      viewOpts.include_docs = true;\n      return view.db.allDocs(viewOpts).then(function (res) {\n        totalRows = res.total_rows;\n        return res.rows.map(function (result) {\n\n          // implicit migration - in older versions of PouchDB,\n          // we explicitly stored the doc as {id: ..., key: ..., value: ...}\n          // this is tested in a migration test\n          /* istanbul ignore next */\n          if ('value' in result.doc && typeof result.doc.value === 'object' &&\n            result.doc.value !== null) {\n            var keys = Object.keys(result.doc.value).sort();\n            // this detection method is not perfect, but it's unlikely the user\n            // emitted a value which was an object with these 3 exact keys\n            var expectedKeys = ['id', 'key', 'value'];\n            if (!(keys < expectedKeys || keys > expectedKeys)) {\n              return result.doc.value;\n            }\n          }\n\n          var parsedKeyAndDocId = parseIndexableString(result.doc._id);\n          return {\n            key: parsedKeyAndDocId[0],\n            id: parsedKeyAndDocId[1],\n            value: ('value' in result.doc ? result.doc.value : null)\n          };\n        });\n      });\n    }\n\n    function onMapResultsReady(rows) {\n      var finalResults;\n      if (shouldReduce) {\n        finalResults = reduceView(view, rows, opts);\n      } else {\n        finalResults = {\n          total_rows: totalRows,\n          offset: skip,\n          rows: rows\n        };\n      }\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        finalResults.update_seq = view.seq;\n      }\n      if (opts.include_docs) {\n        var docIds = uniq(rows.map(rowToDocId));\n\n        return view.sourceDB.allDocs({\n          keys: docIds,\n          include_docs: true,\n          conflicts: opts.conflicts,\n          attachments: opts.attachments,\n          binary: opts.binary\n        }).then(function (allDocsRes) {\n          var docIdsToDocs = new Map();\n          allDocsRes.rows.forEach(function (row) {\n            docIdsToDocs.set(row.id, row.doc);\n          });\n          rows.forEach(function (row) {\n            var docId = rowToDocId(row);\n            var doc = docIdsToDocs.get(docId);\n            if (doc) {\n              row.doc = doc;\n            }\n          });\n          return finalResults;\n        });\n      } else {\n        return finalResults;\n      }\n    }\n\n    if (typeof opts.keys !== 'undefined') {\n      var keys = opts.keys;\n      var fetchPromises = keys.map(function (key) {\n        var viewOpts = {\n          startkey : toIndexableString([key]),\n          endkey   : toIndexableString([key, {}])\n        };\n        /* istanbul ignore if */\n        if (opts.update_seq) {\n          viewOpts.update_seq = true;\n        }\n        return fetchFromView(viewOpts);\n      });\n      return Promise.all(fetchPromises).then(flatten).then(onMapResultsReady);\n    } else { // normal query, no 'keys'\n      var viewOpts = {\n        descending : opts.descending\n      };\n      /* istanbul ignore if */\n      if (opts.update_seq) {\n        viewOpts.update_seq = true;\n      }\n      var startkey;\n      var endkey;\n      if ('start_key' in opts) {\n        startkey = opts.start_key;\n      }\n      if ('startkey' in opts) {\n        startkey = opts.startkey;\n      }\n      if ('end_key' in opts) {\n        endkey = opts.end_key;\n      }\n      if ('endkey' in opts) {\n        endkey = opts.endkey;\n      }\n      if (typeof startkey !== 'undefined') {\n        viewOpts.startkey = opts.descending ?\n          toIndexableString([startkey, {}]) :\n          toIndexableString([startkey]);\n      }\n      if (typeof endkey !== 'undefined') {\n        var inclusiveEnd = opts.inclusive_end !== false;\n        if (opts.descending) {\n          inclusiveEnd = !inclusiveEnd;\n        }\n\n        viewOpts.endkey = toIndexableString(\n          inclusiveEnd ? [endkey, {}] : [endkey]);\n      }\n      if (typeof opts.key !== 'undefined') {\n        var keyStart = toIndexableString([opts.key]);\n        var keyEnd = toIndexableString([opts.key, {}]);\n        if (viewOpts.descending) {\n          viewOpts.endkey = keyStart;\n          viewOpts.startkey = keyEnd;\n        } else {\n          viewOpts.startkey = keyStart;\n          viewOpts.endkey = keyEnd;\n        }\n      }\n      if (!shouldReduce) {\n        if (typeof opts.limit === 'number') {\n          viewOpts.limit = opts.limit;\n        }\n        viewOpts.skip = skip;\n      }\n      return fetchFromView(viewOpts).then(onMapResultsReady);\n    }\n  }\n\n  function httpViewCleanup(db) {\n    return db.fetch('_view_cleanup', {\n      headers: new Headers({'Content-Type': 'application/json'}),\n      method: 'POST'\n    }).then(function (response) {\n      return response.json();\n    });\n  }\n\n  function localViewCleanup(db) {\n    return db.get('_local/' + localDocName).then(function (metaDoc) {\n      var docsToViews = new Map();\n      Object.keys(metaDoc.views).forEach(function (fullViewName) {\n        var parts = parseViewName(fullViewName);\n        var designDocName = '_design/' + parts[0];\n        var viewName = parts[1];\n        var views = docsToViews.get(designDocName);\n        if (!views) {\n          views = new Set();\n          docsToViews.set(designDocName, views);\n        }\n        views.add(viewName);\n      });\n      var opts = {\n        keys : mapToKeysArray(docsToViews),\n        include_docs : true\n      };\n      return db.allDocs(opts).then(function (res) {\n        var viewsToStatus = {};\n        res.rows.forEach(function (row) {\n          var ddocName = row.key.substring(8); // cuts off '_design/'\n          docsToViews.get(row.key).forEach(function (viewName) {\n            var fullViewName = ddocName + '/' + viewName;\n            /* istanbul ignore if */\n            if (!metaDoc.views[fullViewName]) {\n              // new format, without slashes, to support PouchDB 2.2.0\n              // migration test in pouchdb's browser.migration.js verifies this\n              fullViewName = viewName;\n            }\n            var viewDBNames = Object.keys(metaDoc.views[fullViewName]);\n            // design doc deleted, or view function nonexistent\n            var statusIsGood = row.doc && row.doc.views &&\n              row.doc.views[viewName];\n            viewDBNames.forEach(function (viewDBName) {\n              viewsToStatus[viewDBName] =\n                viewsToStatus[viewDBName] || statusIsGood;\n            });\n          });\n        });\n        var dbsToDelete = Object.keys(viewsToStatus).filter(\n          function (viewDBName) { return !viewsToStatus[viewDBName]; });\n        var destroyPromises = dbsToDelete.map(function (viewDBName) {\n          return sequentialize(getQueue(viewDBName), function () {\n            return new db.constructor(viewDBName, db.__opts).destroy();\n          })();\n        });\n        return Promise.all(destroyPromises).then(function () {\n          return {ok: true};\n        });\n      });\n    }, defaultsTo({ok: true}));\n  }\n\n  function queryPromised(db, fun, opts) {\n    /* istanbul ignore next */\n    if (typeof db._query === 'function') {\n      return customQuery(db, fun, opts);\n    }\n    if (isRemote(db)) {\n      return httpQuery(db, fun, opts);\n    }\n\n    if (typeof fun !== 'string') {\n      // temp_view\n      checkQueryParseError(opts, fun);\n\n      tempViewQueue.add(function () {\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ 'temp_view/temp_view',\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ true,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          return fin(updateView(view).then(function () {\n            return queryView(view, opts);\n          }), function () {\n            return view.db.destroy();\n          });\n        });\n      });\n      return tempViewQueue.finish();\n    } else {\n      // persistent view\n      var fullViewName = fun;\n      var parts = parseViewName(fullViewName);\n      var designDocName = parts[0];\n      var viewName = parts[1];\n      return db.get('_design/' + designDocName).then(function (doc) {\n        var fun = doc.views && doc.views[viewName];\n\n        if (!fun) {\n          // basic validator; it's assumed that every subclass would want this\n          throw new NotFoundError('ddoc ' + doc._id + ' has no view named ' +\n            viewName);\n        }\n\n        ddocValidator(doc, viewName);\n        checkQueryParseError(opts, fun);\n\n        var createViewPromise = createView(\n          /* sourceDB */ db,\n          /* viewName */ fullViewName,\n          /* mapFun */ fun.map,\n          /* reduceFun */ fun.reduce,\n          /* temporary */ false,\n          /* localDocName */ localDocName);\n        return createViewPromise.then(function (view) {\n          if (opts.stale === 'ok' || opts.stale === 'update_after') {\n            if (opts.stale === 'update_after') {\n              nextTick(function () {\n                updateView(view);\n              });\n            }\n            return queryView(view, opts);\n          } else { // stale not ok\n            return updateView(view).then(function () {\n              return queryView(view, opts);\n            });\n          }\n        });\n      });\n    }\n  }\n\n  function abstractQuery(fun, opts, callback) {\n    var db = this;\n    if (typeof opts === 'function') {\n      callback = opts;\n      opts = {};\n    }\n    opts = opts ? coerceOptions(opts) : {};\n\n    if (typeof fun === 'function') {\n      fun = {map : fun};\n    }\n\n    var promise = Promise.resolve().then(function () {\n      return queryPromised(db, fun, opts);\n    });\n    promisedCallback(promise, callback);\n    return promise;\n  }\n\n  var abstractViewCleanup = callbackify(function () {\n    var db = this;\n    /* istanbul ignore next */\n    if (typeof db._viewCleanup === 'function') {\n      return customViewCleanup(db);\n    }\n    if (isRemote(db)) {\n      return httpViewCleanup(db);\n    }\n    return localViewCleanup(db);\n  });\n\n  return {\n    query: abstractQuery,\n    viewCleanup: abstractViewCleanup\n  };\n}\n\nexport default createAbstractMapReduce;\n","import { clone, assign, nextTick, upsert, toPromise, isRemote } from 'pouchdb-utils';\nimport { generateErrorFromResponse } from 'pouchdb-errors';\nimport { Headers } from 'pouchdb-fetch';\nimport { getFieldFromDoc, setFieldInDoc, parseField, getKey, getValue, compare, massageSelector, filterInMemoryFields } from 'pouchdb-selector-core';\nimport abstractMapReduce from 'pouchdb-abstract-mapreduce';\nimport { collate } from 'pouchdb-collate';\nimport { stringMd5 } from 'pouchdb-md5';\n\n// we restucture the supplied JSON considerably, because the official\n// Mango API is very particular about a lot of this stuff, but we like\n// to be liberal with what we accept in order to prevent mental\n// breakdowns in our users\nfunction massageCreateIndexRequest(requestDef) {\n  requestDef = clone(requestDef);\n\n  if (!requestDef.index) {\n    requestDef.index = {};\n  }\n\n  ['type', 'name', 'ddoc'].forEach(function (key) {\n    if (requestDef.index[key]) {\n      requestDef[key] = requestDef.index[key];\n      delete requestDef.index[key];\n    }\n  });\n\n  if (requestDef.fields) {\n    requestDef.index.fields = requestDef.fields;\n    delete requestDef.fields;\n  }\n\n  if (!requestDef.type) {\n    requestDef.type = 'json';\n  }\n  return requestDef;\n}\n\nfunction dbFetch(db, path, opts, callback) {\n  var status, ok;\n  opts.headers = new Headers({'Content-type': 'application/json'});\n  db.fetch(path, opts).then(function (response) {\n    status = response.status;\n    ok = response.ok;\n    return response.json();\n  }).then(function (json) {\n    if (!ok) {\n      json.status = status;\n      var err = generateErrorFromResponse(json);\n      callback(err);\n    } else {\n      callback(null, json);\n    }\n  }).catch(callback);\n}\n\nfunction createIndex(db, requestDef, callback) {\n  requestDef = massageCreateIndexRequest(requestDef);\n  dbFetch(db, '_index', {\n    method: 'POST',\n    body: JSON.stringify(requestDef)\n  }, callback);\n}\n\nfunction find(db, requestDef, callback) {\n  dbFetch(db, '_find', {\n    method: 'POST',\n    body: JSON.stringify(requestDef)\n  }, callback);\n}\n\nfunction explain(db, requestDef, callback) {\n  dbFetch(db, '_explain', {\n    method: 'POST',\n    body: JSON.stringify(requestDef)\n  }, callback);\n}\n\nfunction getIndexes(db, callback) {\n  dbFetch(db, '_index', {\n    method: 'GET'\n  }, callback);\n}\n\nfunction deleteIndex(db, indexDef, callback) {\n\n\n  var ddoc = indexDef.ddoc;\n  var type = indexDef.type || 'json';\n  var name = indexDef.name;\n\n  if (!ddoc) {\n    return callback(new Error('you must provide an index\\'s ddoc'));\n  }\n\n  if (!name) {\n    return callback(new Error('you must provide an index\\'s name'));\n  }\n\n  var url = '_index/' + [ddoc, type, name].map(encodeURIComponent).join('/');\n\n  dbFetch(db, url, {method: 'DELETE'}, callback);\n}\n\nfunction getArguments(fun) {\n  return function () {\n    var len = arguments.length;\n    var args = new Array(len);\n    var i = -1;\n    while (++i < len) {\n      args[i] = arguments[i];\n    }\n    return fun.call(this, args);\n  };\n}\n\nfunction callbackify(fun) {\n  return getArguments(function (args) {\n    var cb = args.pop();\n    var promise = fun.apply(this, args);\n    promisedCallback(promise, cb);\n    return promise;\n  });\n}\n\nfunction promisedCallback(promise, callback) {\n  promise.then(function (res) {\n    nextTick(function () {\n      callback(null, res);\n    });\n  }, function (reason) {\n    nextTick(function () {\n      callback(reason);\n    });\n  });\n  return promise;\n}\n\nvar flatten = getArguments(function (args) {\n  var res = [];\n  for (var i = 0, len = args.length; i < len; i++) {\n    var subArr = args[i];\n    if (Array.isArray(subArr)) {\n      res = res.concat(flatten.apply(null, subArr));\n    } else {\n      res.push(subArr);\n    }\n  }\n  return res;\n});\n\nfunction mergeObjects(arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    res = assign(res, arr[i]);\n  }\n  return res;\n}\n\n// Selects a list of fields defined in dot notation from one doc\n// and copies them to a new doc. Like underscore _.pick but supports nesting.\nfunction pick(obj, arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var parsedField = parseField(arr[i]);\n    var value = getFieldFromDoc(obj, parsedField);\n    if (typeof value !== 'undefined') {\n      setFieldInDoc(res, parsedField, value);\n    }\n  }\n  return res;\n}\n\n// e.g. ['a'], ['a', 'b'] is true, but ['b'], ['a', 'b'] is false\nfunction oneArrayIsSubArrayOfOther(left, right) {\n\n  for (var i = 0, len = Math.min(left.length, right.length); i < len; i++) {\n    if (left[i] !== right[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n// e.g.['a', 'b', 'c'], ['a', 'b'] is false\nfunction oneArrayIsStrictSubArrayOfOther(left, right) {\n\n  if (left.length > right.length) {\n    return false;\n  }\n\n  return oneArrayIsSubArrayOfOther(left, right);\n}\n\n// same as above, but treat the left array as an unordered set\n// e.g. ['b', 'a'], ['a', 'b', 'c'] is true, but ['c'], ['a', 'b', 'c'] is false\nfunction oneSetIsSubArrayOfOther(left, right) {\n  left = left.slice();\n  for (var i = 0, len = right.length; i < len; i++) {\n    var field = right[i];\n    if (!left.length) {\n      break;\n    }\n    var leftIdx = left.indexOf(field);\n    if (leftIdx === -1) {\n      return false;\n    } else {\n      left.splice(leftIdx, 1);\n    }\n  }\n  return true;\n}\n\nfunction arrayToObject(arr) {\n  var res = {};\n  for (var i = 0, len = arr.length; i < len; i++) {\n    res[arr[i]] = true;\n  }\n  return res;\n}\n\nfunction max(arr, fun) {\n  var max = null;\n  var maxScore = -1;\n  for (var i = 0, len = arr.length; i < len; i++) {\n    var element = arr[i];\n    var score = fun(element);\n    if (score > maxScore) {\n      maxScore = score;\n      max = element;\n    }\n  }\n  return max;\n}\n\nfunction arrayEquals(arr1, arr2) {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  for (var i = 0, len = arr1.length; i < len; i++) {\n    if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction uniq(arr) {\n  var obj = {};\n  for (var i = 0; i < arr.length; i++) {\n    obj['$' + arr[i]] = true;\n  }\n  return Object.keys(obj).map(function (key) {\n    return key.substring(1);\n  });\n}\n\n//\n// One thing about these mappers:\n//\n// Per the advice of John-David Dalton (http://youtu.be/NthmeLEhDDM),\n// what you want to do in this case is optimize for the smallest possible\n// function, since that's the thing that gets run over and over again.\n//\n// This code would be a lot simpler if all the if/elses were inside\n// the function, but it would also be a lot less performant.\n//\n\n\nfunction createDeepMultiMapper(fields, emit) {\n  return function (doc) {\n    var toEmit = [];\n    for (var i = 0, iLen = fields.length; i < iLen; i++) {\n      var parsedField = parseField(fields[i]);\n      var value = doc;\n      for (var j = 0, jLen = parsedField.length; j < jLen; j++) {\n        var key = parsedField[j];\n        value = value[key];\n        if (typeof value === 'undefined') {\n          return; // don't emit\n        }\n      }\n      toEmit.push(value);\n    }\n    emit(toEmit);\n  };\n}\n\nfunction createDeepSingleMapper(field, emit) {\n  var parsedField = parseField(field);\n  return function (doc) {\n    var value = doc;\n    for (var i = 0, len = parsedField.length; i < len; i++) {\n      var key = parsedField[i];\n      value = value[key];\n      if (typeof value === 'undefined') {\n        return; // do nothing\n      }\n    }\n    emit(value);\n  };\n}\n\nfunction createShallowSingleMapper(field, emit) {\n  return function (doc) {\n    emit(doc[field]);\n  };\n}\n\nfunction createShallowMultiMapper(fields, emit) {\n  return function (doc) {\n    var toEmit = [];\n    for (var i = 0, len = fields.length; i < len; i++) {\n      toEmit.push(doc[fields[i]]);\n    }\n    emit(toEmit);\n  };\n}\n\nfunction checkShallow(fields) {\n  for (var i = 0, len = fields.length; i < len; i++) {\n    var field = fields[i];\n    if (field.indexOf('.') !== -1) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction createMapper(fields, emit) {\n  var isShallow = checkShallow(fields);\n  var isSingle = fields.length === 1;\n\n  // notice we try to optimize for the most common case,\n  // i.e. single shallow indexes\n  if (isShallow) {\n    if (isSingle) {\n      return createShallowSingleMapper(fields[0], emit);\n    } else { // multi\n      return createShallowMultiMapper(fields, emit);\n    }\n  } else { // deep\n    if (isSingle) {\n      return createDeepSingleMapper(fields[0], emit);\n    } else { // multi\n      return createDeepMultiMapper(fields, emit);\n    }\n  }\n}\n\nfunction mapper(mapFunDef, emit) {\n  // mapFunDef is a list of fields\n\n  var fields = Object.keys(mapFunDef.fields);\n\n  return createMapper(fields, emit);\n}\n\n/* istanbul ignore next */\nfunction reducer(/*reduceFunDef*/) {\n  throw new Error('reduce not supported');\n}\n\nfunction ddocValidator(ddoc, viewName) {\n  var view = ddoc.views[viewName];\n  // This doesn't actually need to be here apparently, but\n  // I feel safer keeping it.\n  /* istanbul ignore if */\n  if (!view.map || !view.map.fields) {\n    throw new Error('ddoc ' + ddoc._id +' with view ' + viewName +\n      ' doesn\\'t have map.fields defined. ' +\n      'maybe it wasn\\'t created by this plugin?');\n  }\n}\n\nvar abstractMapper = abstractMapReduce(\n  /* localDocName */ 'indexes',\n  mapper,\n  reducer,\n  ddocValidator\n);\n\n// normalize the \"sort\" value\nfunction massageSort(sort) {\n  if (!Array.isArray(sort)) {\n    throw new Error('invalid sort json - should be an array');\n  }\n  return sort.map(function (sorting) {\n    if (typeof sorting === 'string') {\n      var obj = {};\n      obj[sorting] = 'asc';\n      return obj;\n    } else {\n      return sorting;\n    }\n  });\n}\n\nfunction massageUseIndex(useIndex) {\n  var cleanedUseIndex = [];\n  if (typeof useIndex === 'string') {\n    cleanedUseIndex.push(useIndex);\n  } else {\n    cleanedUseIndex = useIndex;\n  }\n\n  return cleanedUseIndex.map(function (name) {\n    return name.replace('_design/', '');\n  });\n}\n\nfunction massageIndexDef(indexDef) {\n  indexDef.fields = indexDef.fields.map(function (field) {\n    if (typeof field === 'string') {\n      var obj = {};\n      obj[field] = 'asc';\n      return obj;\n    }\n    return field;\n  });\n  return indexDef;\n}\n\nfunction getKeyFromDoc(doc, index) {\n  var res = [];\n  for (var i = 0; i < index.def.fields.length; i++) {\n    var field = getKey(index.def.fields[i]);\n    res.push(doc[field]);\n  }\n  return res;\n}\n\n// have to do this manually because REASONS. I don't know why\n// CouchDB didn't implement inclusive_start\nfunction filterInclusiveStart(rows, targetValue, index) {\n  var indexFields = index.def.fields;\n  for (var i = 0, len = rows.length; i < len; i++) {\n    var row = rows[i];\n\n    // shave off any docs at the beginning that are <= the\n    // target value\n\n    var docKey = getKeyFromDoc(row.doc, index);\n    if (indexFields.length === 1) {\n      docKey = docKey[0]; // only one field, not multi-field\n    } else { // more than one field in index\n      // in the case where e.g. the user is searching {$gt: {a: 1}}\n      // but the index is [a, b], then we need to shorten the doc key\n      while (docKey.length > targetValue.length) {\n        docKey.pop();\n      }\n    }\n    //ABS as we just looking for values that don't match\n    if (Math.abs(collate(docKey, targetValue)) > 0) {\n      // no need to filter any further; we're past the key\n      break;\n    }\n  }\n  return i > 0 ? rows.slice(i) : rows;\n}\n\nfunction reverseOptions(opts) {\n  var newOpts = clone(opts);\n  delete newOpts.startkey;\n  delete newOpts.endkey;\n  delete newOpts.inclusive_start;\n  delete newOpts.inclusive_end;\n\n  if ('endkey' in opts) {\n    newOpts.startkey = opts.endkey;\n  }\n  if ('startkey' in opts) {\n    newOpts.endkey = opts.startkey;\n  }\n  if ('inclusive_start' in opts) {\n    newOpts.inclusive_end = opts.inclusive_start;\n  }\n  if ('inclusive_end' in opts) {\n    newOpts.inclusive_start = opts.inclusive_end;\n  }\n  return newOpts;\n}\n\nfunction validateIndex(index) {\n  var ascFields = index.fields.filter(function (field) {\n    return getValue(field) === 'asc';\n  });\n  if (ascFields.length !== 0 && ascFields.length !== index.fields.length) {\n    throw new Error('unsupported mixed sorting');\n  }\n}\n\nfunction validateSort(requestDef, index) {\n  if (index.defaultUsed && requestDef.sort) {\n    var noneIdSorts = requestDef.sort.filter(function (sortItem) {\n      return Object.keys(sortItem)[0] !== '_id';\n    }).map(function (sortItem) {\n      return Object.keys(sortItem)[0];\n    });\n\n    if (noneIdSorts.length > 0) {\n      throw new Error('Cannot sort on field(s) \"' + noneIdSorts.join(',') +\n      '\" when using the default index');\n    }\n  }\n\n  if (index.defaultUsed) {\n    return;\n  }\n}\n\nfunction validateFindRequest(requestDef) {\n  if (typeof requestDef.selector !== 'object') {\n    throw new Error('you must provide a selector when you find()');\n  }\n\n  /*var selectors = requestDef.selector['$and'] || [requestDef.selector];\n  for (var i = 0; i < selectors.length; i++) {\n    var selector = selectors[i];\n    var keys = Object.keys(selector);\n    if (keys.length === 0) {\n      throw new Error('invalid empty selector');\n    }\n    //var selection = selector[keys[0]];\n    /*if (Object.keys(selection).length !== 1) {\n      throw new Error('invalid selector: ' + JSON.stringify(selection) +\n        ' - it must have exactly one key/value');\n    }\n  }*/\n}\n\n// determine the maximum number of fields\n// we're going to need to query, e.g. if the user\n// has selection ['a'] and sorting ['a', 'b'], then we\n// need to use the longer of the two: ['a', 'b']\nfunction getUserFields(selector, sort) {\n  var selectorFields = Object.keys(selector);\n  var sortFields = sort? sort.map(getKey) : [];\n  var userFields;\n  if (selectorFields.length >= sortFields.length) {\n    userFields = selectorFields;\n  } else {\n    userFields = sortFields;\n  }\n\n  if (sortFields.length === 0) {\n    return {\n      fields: userFields\n    };\n  }\n\n  // sort according to the user's preferred sorting\n  userFields = userFields.sort(function (left, right) {\n    var leftIdx = sortFields.indexOf(left);\n    if (leftIdx === -1) {\n      leftIdx = Number.MAX_VALUE;\n    }\n    var rightIdx = sortFields.indexOf(right);\n    if (rightIdx === -1) {\n      rightIdx = Number.MAX_VALUE;\n    }\n    return leftIdx < rightIdx ? -1 : leftIdx > rightIdx ? 1 : 0;\n  });\n\n  return {\n    fields: userFields,\n    sortOrder: sort.map(getKey)\n  };\n}\n\nfunction createIndex$1(db, requestDef) {\n  requestDef = massageCreateIndexRequest(requestDef);\n  var originalIndexDef = clone(requestDef.index);\n  requestDef.index = massageIndexDef(requestDef.index);\n\n  validateIndex(requestDef.index);\n\n  // calculating md5 is expensive - memoize and only\n  // run if required\n  var md5;\n  function getMd5() {\n    return md5 || (md5 = stringMd5(JSON.stringify(requestDef)));\n  }\n\n  var viewName = requestDef.name || ('idx-' + getMd5());\n\n  var ddocName = requestDef.ddoc || ('idx-' + getMd5());\n  var ddocId = '_design/' + ddocName;\n\n  var hasInvalidLanguage = false;\n  var viewExists = false;\n\n  function updateDdoc(doc) {\n    if (doc._rev && doc.language !== 'query') {\n      hasInvalidLanguage = true;\n    }\n    doc.language = 'query';\n    doc.views = doc.views || {};\n\n    viewExists = !!doc.views[viewName];\n\n    if (viewExists) {\n      return false;\n    }\n\n    doc.views[viewName] = {\n      map: {\n        fields: mergeObjects(requestDef.index.fields)\n      },\n      reduce: '_count',\n      options: {\n        def: originalIndexDef\n      }\n    };\n\n    return doc;\n  }\n\n  db.constructor.emit('debug', ['find', 'creating index', ddocId]);\n\n  return upsert(db, ddocId, updateDdoc).then(function () {\n    if (hasInvalidLanguage) {\n      throw new Error('invalid language for ddoc with id \"' +\n      ddocId +\n      '\" (should be \"query\")');\n    }\n  }).then(function () {\n    // kick off a build\n    // TODO: abstract-pouchdb-mapreduce should support auto-updating\n    // TODO: should also use update_after, but pouchdb/pouchdb#3415 blocks me\n    var signature = ddocName + '/' + viewName;\n    return abstractMapper.query.call(db, signature, {\n      limit: 0,\n      reduce: false\n    }).then(function () {\n      return {\n        id: ddocId,\n        name: viewName,\n        result: viewExists ? 'exists' : 'created'\n      };\n    });\n  });\n}\n\nfunction getIndexes$1(db) {\n  // just search through all the design docs and filter in-memory.\n  // hopefully there aren't that many ddocs.\n  return db.allDocs({\n    startkey: '_design/',\n    endkey: '_design/\\uffff',\n    include_docs: true\n  }).then(function (allDocsRes) {\n    var res = {\n      indexes: [{\n        ddoc: null,\n        name: '_all_docs',\n        type: 'special',\n        def: {\n          fields: [{_id: 'asc'}]\n        }\n      }]\n    };\n\n    res.indexes = flatten(res.indexes, allDocsRes.rows.filter(function (row) {\n      return row.doc.language === 'query';\n    }).map(function (row) {\n      var viewNames = row.doc.views !== undefined ? Object.keys(row.doc.views) : [];\n\n      return viewNames.map(function (viewName) {\n        var view = row.doc.views[viewName];\n        return {\n          ddoc: row.id,\n          name: viewName,\n          type: 'json',\n          def: massageIndexDef(view.options.def)\n        };\n      });\n    }));\n\n    // these are sorted by view name for some reason\n    res.indexes.sort(function (left, right) {\n      return compare(left.name, right.name);\n    });\n    res.total_rows = res.indexes.length;\n    return res;\n  });\n}\n\n// couchdb lowest collation value\nvar COLLATE_LO = null;\n\n// couchdb highest collation value (TODO: well not really, but close enough amirite)\nvar COLLATE_HI = {\"\\uffff\": {}};\n\n// couchdb second-lowest collation value\n\nfunction checkFieldInIndex(index, field) {\n  var indexFields = index.def.fields.map(getKey);\n  for (var i = 0, len = indexFields.length; i < len; i++) {\n    var indexField = indexFields[i];\n    if (field === indexField) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// so when you do e.g. $eq/$eq, we can do it entirely in the database.\n// but when you do e.g. $gt/$eq, the first part can be done\n// in the database, but the second part has to be done in-memory,\n// because $gt has forced us to lose precision.\n// so that's what this determines\nfunction userOperatorLosesPrecision(selector, field) {\n  var matcher = selector[field];\n  var userOperator = getKey(matcher);\n\n  return userOperator !== '$eq';\n}\n\n// sort the user fields by their position in the index,\n// if they're in the index\nfunction sortFieldsByIndex(userFields, index) {\n  var indexFields = index.def.fields.map(getKey);\n\n  return userFields.slice().sort(function (a, b) {\n    var aIdx = indexFields.indexOf(a);\n    var bIdx = indexFields.indexOf(b);\n    if (aIdx === -1) {\n      aIdx = Number.MAX_VALUE;\n    }\n    if (bIdx === -1) {\n      bIdx = Number.MAX_VALUE;\n    }\n    return compare(aIdx, bIdx);\n  });\n}\n\n// first pass to try to find fields that will need to be sorted in-memory\nfunction getBasicInMemoryFields(index, selector, userFields) {\n\n  userFields = sortFieldsByIndex(userFields, index);\n\n  // check if any of the user selectors lose precision\n  var needToFilterInMemory = false;\n  for (var i = 0, len = userFields.length; i < len; i++) {\n    var field = userFields[i];\n    if (needToFilterInMemory || !checkFieldInIndex(index, field)) {\n      return userFields.slice(i);\n    }\n    if (i < len - 1 && userOperatorLosesPrecision(selector, field)) {\n      needToFilterInMemory = true;\n    }\n  }\n  return [];\n}\n\nfunction getInMemoryFieldsFromNe(selector) {\n  var fields = [];\n  Object.keys(selector).forEach(function (field) {\n    var matcher = selector[field];\n    Object.keys(matcher).forEach(function (operator) {\n      if (operator === '$ne') {\n        fields.push(field);\n      }\n    });\n  });\n  return fields;\n}\n\nfunction getInMemoryFields(coreInMemoryFields, index, selector, userFields) {\n  var result = flatten(\n    // in-memory fields reported as necessary by the query planner\n    coreInMemoryFields,\n    // combine with another pass that checks for any we may have missed\n    getBasicInMemoryFields(index, selector, userFields),\n    // combine with another pass that checks for $ne's\n    getInMemoryFieldsFromNe(selector)\n  );\n\n  return sortFieldsByIndex(uniq(result), index);\n}\n\n// check that at least one field in the user's query is represented\n// in the index. order matters in the case of sorts\nfunction checkIndexFieldsMatch(indexFields, sortOrder, fields) {\n  if (sortOrder) {\n    // array has to be a strict subarray of index array. furthermore,\n    // the sortOrder fields need to all be represented in the index\n    var sortMatches = oneArrayIsStrictSubArrayOfOther(sortOrder, indexFields);\n    var selectorMatches = oneArrayIsSubArrayOfOther(fields, indexFields);\n\n    return sortMatches && selectorMatches;\n  }\n\n  // all of the user's specified fields still need to be\n  // on the left side of the index array, although the order\n  // doesn't matter\n  return oneSetIsSubArrayOfOther(fields, indexFields);\n}\n\nvar logicalMatchers = ['$eq', '$gt', '$gte', '$lt', '$lte'];\nfunction isNonLogicalMatcher(matcher) {\n  return logicalMatchers.indexOf(matcher) === -1;\n}\n\n// check all the index fields for usages of '$ne'\n// e.g. if the user queries {foo: {$ne: 'foo'}, bar: {$eq: 'bar'}},\n// then we can neither use an index on ['foo'] nor an index on\n// ['foo', 'bar'], but we can use an index on ['bar'] or ['bar', 'foo']\nfunction checkFieldsLogicallySound(indexFields, selector) {\n  var firstField = indexFields[0];\n  var matcher = selector[firstField];\n\n  if (typeof matcher === 'undefined') {\n    /* istanbul ignore next */\n    return true;\n  }\n\n  var hasLogicalOperator = Object.keys(matcher).some(function (matcherKey) {\n    return !(isNonLogicalMatcher(matcherKey));\n  });\n\n  if (!hasLogicalOperator) {\n    return false;\n  }\n\n  var isInvalidNe = Object.keys(matcher).length === 1 &&\n    getKey(matcher) === '$ne';\n\n  return !isInvalidNe;\n}\n\nfunction checkIndexMatches(index, sortOrder, fields, selector) {\n\n  var indexFields = index.def.fields.map(getKey);\n\n  var fieldsMatch = checkIndexFieldsMatch(indexFields, sortOrder, fields);\n\n  if (!fieldsMatch) {\n    return false;\n  }\n\n  return checkFieldsLogicallySound(indexFields, selector);\n}\n\n//\n// the algorithm is very simple:\n// take all the fields the user supplies, and if those fields\n// are a strict subset of the fields in some index,\n// then use that index\n//\n//\nfunction findMatchingIndexes(selector, userFields, sortOrder, indexes) {\n\n  return indexes.reduce(function (res, index) {\n    var indexMatches = checkIndexMatches(index, sortOrder, userFields, selector);\n    if (indexMatches) {\n      res.push(index);\n    }\n    return res;\n  }, []);\n}\n\n// find the best index, i.e. the one that matches the most fields\n// in the user's query\nfunction findBestMatchingIndex(selector, userFields, sortOrder, indexes, useIndex) {\n\n  var matchingIndexes = findMatchingIndexes(selector, userFields, sortOrder, indexes);\n\n  if (matchingIndexes.length === 0) {\n    if (useIndex) {\n      throw {\n        error: \"no_usable_index\",\n        message: \"There is no index available for this selector.\"\n      };\n    }\n    //return `all_docs` as a default index;\n    //I'm assuming that _all_docs is always first\n    var defaultIndex = indexes[0];\n    defaultIndex.defaultUsed = true;\n    return defaultIndex;\n  }\n  if (matchingIndexes.length === 1 && !useIndex) {\n    return matchingIndexes[0];\n  }\n\n  var userFieldsMap = arrayToObject(userFields);\n\n  function scoreIndex(index) {\n    var indexFields = index.def.fields.map(getKey);\n    var score = 0;\n    for (var i = 0, len = indexFields.length; i < len; i++) {\n      var indexField = indexFields[i];\n      if (userFieldsMap[indexField]) {\n        score++;\n      }\n    }\n    return score;\n  }\n\n  if (useIndex) {\n    var useIndexDdoc = '_design/' + useIndex[0];\n    var useIndexName = useIndex.length === 2 ? useIndex[1] : false;\n    var index = matchingIndexes.find(function (index) {\n      if (useIndexName && index.ddoc === useIndexDdoc && useIndexName === index.name) {\n        return true;\n      }\n\n      if (index.ddoc === useIndexDdoc) {\n        /* istanbul ignore next */\n        return true;\n      }\n\n      return false;\n    });\n\n    if (!index) {\n      throw {\n        error: \"unknown_error\",\n        message: \"Could not find that index or could not use that index for the query\"\n      };\n    }\n    return index;\n  }\n\n  return max(matchingIndexes, scoreIndex);\n}\n\nfunction getSingleFieldQueryOptsFor(userOperator, userValue) {\n  switch (userOperator) {\n    case '$eq':\n      return {key: userValue};\n    case '$lte':\n      return {endkey: userValue};\n    case '$gte':\n      return {startkey: userValue};\n    case '$lt':\n      return {\n        endkey: userValue,\n        inclusive_end: false\n      };\n    case '$gt':\n      return {\n        startkey: userValue,\n        inclusive_start: false\n      };\n  }\n}\n\nfunction getSingleFieldCoreQueryPlan(selector, index) {\n  var field = getKey(index.def.fields[0]);\n  //ignoring this because the test to exercise the branch is skipped at the moment\n  /* istanbul ignore next */\n  var matcher = selector[field] || {};\n  var inMemoryFields = [];\n\n  var userOperators = Object.keys(matcher);\n\n  var combinedOpts;\n\n  userOperators.forEach(function (userOperator) {\n\n    if (isNonLogicalMatcher(userOperator)) {\n      inMemoryFields.push(field);\n      return;\n    }\n\n    var userValue = matcher[userOperator];\n\n    var newQueryOpts = getSingleFieldQueryOptsFor(userOperator, userValue);\n\n    if (combinedOpts) {\n      combinedOpts = mergeObjects([combinedOpts, newQueryOpts]);\n    } else {\n      combinedOpts = newQueryOpts;\n    }\n  });\n\n  return {\n    queryOpts: combinedOpts,\n    inMemoryFields: inMemoryFields\n  };\n}\n\nfunction getMultiFieldCoreQueryPlan(userOperator, userValue) {\n  switch (userOperator) {\n    case '$eq':\n      return {\n        startkey: userValue,\n        endkey: userValue\n      };\n    case '$lte':\n      return {\n        endkey: userValue\n      };\n    case '$gte':\n      return {\n        startkey: userValue\n      };\n    case '$lt':\n      return {\n        endkey: userValue,\n        inclusive_end: false\n      };\n    case '$gt':\n      return {\n        startkey: userValue,\n        inclusive_start: false\n      };\n  }\n}\n\nfunction getMultiFieldQueryOpts(selector, index) {\n\n  var indexFields = index.def.fields.map(getKey);\n\n  var inMemoryFields = [];\n  var startkey = [];\n  var endkey = [];\n  var inclusiveStart;\n  var inclusiveEnd;\n\n\n  function finish(i) {\n\n    if (inclusiveStart !== false) {\n      startkey.push(COLLATE_LO);\n    }\n    if (inclusiveEnd !== false) {\n      endkey.push(COLLATE_HI);\n    }\n    // keep track of the fields where we lost specificity,\n    // and therefore need to filter in-memory\n    inMemoryFields = indexFields.slice(i);\n  }\n\n  for (var i = 0, len = indexFields.length; i < len; i++) {\n    var indexField = indexFields[i];\n\n    var matcher = selector[indexField];\n\n    if (!matcher || !Object.keys(matcher).length) { // fewer fields in user query than in index\n      finish(i);\n      break;\n    } else if (i > 0) {\n      if (Object.keys(matcher).some(isNonLogicalMatcher)) { // non-logical are ignored\n        finish(i);\n        break;\n      }\n      var usingGtlt = (\n        '$gt' in matcher || '$gte' in matcher ||\n        '$lt' in matcher || '$lte' in matcher);\n      var previousKeys = Object.keys(selector[indexFields[i - 1]]);\n      var previousWasEq = arrayEquals(previousKeys, ['$eq']);\n      var previousWasSame = arrayEquals(previousKeys, Object.keys(matcher));\n      var gtltLostSpecificity = usingGtlt && !previousWasEq && !previousWasSame;\n      if (gtltLostSpecificity) {\n        finish(i);\n        break;\n      }\n    }\n\n    var userOperators = Object.keys(matcher);\n\n    var combinedOpts = null;\n\n    for (var j = 0; j < userOperators.length; j++) {\n      var userOperator = userOperators[j];\n      var userValue = matcher[userOperator];\n\n      var newOpts = getMultiFieldCoreQueryPlan(userOperator, userValue);\n\n      if (combinedOpts) {\n        combinedOpts = mergeObjects([combinedOpts, newOpts]);\n      } else {\n        combinedOpts = newOpts;\n      }\n    }\n\n    startkey.push('startkey' in combinedOpts ? combinedOpts.startkey : COLLATE_LO);\n    endkey.push('endkey' in combinedOpts ? combinedOpts.endkey : COLLATE_HI);\n    if ('inclusive_start' in combinedOpts) {\n      inclusiveStart = combinedOpts.inclusive_start;\n    }\n    if ('inclusive_end' in combinedOpts) {\n      inclusiveEnd = combinedOpts.inclusive_end;\n    }\n  }\n\n  var res = {\n    startkey: startkey,\n    endkey: endkey\n  };\n\n  if (typeof inclusiveStart !== 'undefined') {\n    res.inclusive_start = inclusiveStart;\n  }\n  if (typeof inclusiveEnd !== 'undefined') {\n    res.inclusive_end = inclusiveEnd;\n  }\n\n  return {\n    queryOpts: res,\n    inMemoryFields: inMemoryFields\n  };\n}\n\nfunction getDefaultQueryPlan(selector) {\n  //using default index, so all fields need to be done in memory\n  return {\n    queryOpts: {startkey: null},\n    inMemoryFields: [Object.keys(selector)]\n  };\n}\n\nfunction getCoreQueryPlan(selector, index) {\n  if (index.defaultUsed) {\n    return getDefaultQueryPlan(selector, index);\n  }\n\n  if (index.def.fields.length === 1) {\n    // one field in index, so the value was indexed as a singleton\n    return getSingleFieldCoreQueryPlan(selector, index);\n  }\n  // else index has multiple fields, so the value was indexed as an array\n  return getMultiFieldQueryOpts(selector, index);\n}\n\nfunction planQuery(request, indexes) {\n\n  var selector = request.selector;\n  var sort = request.sort;\n\n  var userFieldsRes = getUserFields(selector, sort);\n\n  var userFields = userFieldsRes.fields;\n  var sortOrder = userFieldsRes.sortOrder;\n  var index = findBestMatchingIndex(selector, userFields, sortOrder, indexes, request.use_index);\n\n  var coreQueryPlan = getCoreQueryPlan(selector, index);\n  var queryOpts = coreQueryPlan.queryOpts;\n  var coreInMemoryFields = coreQueryPlan.inMemoryFields;\n\n  var inMemoryFields = getInMemoryFields(coreInMemoryFields, index, selector, userFields);\n\n  var res = {\n    queryOpts: queryOpts,\n    index: index,\n    inMemoryFields: inMemoryFields\n  };\n  return res;\n}\n\nfunction indexToSignature(index) {\n  // remove '_design/'\n  return index.ddoc.substring(8) + '/' + index.name;\n}\n\nfunction doAllDocs(db, originalOpts) {\n  var opts = clone(originalOpts);\n\n  // CouchDB responds in weird ways when you provide a non-string to _id;\n  // we mimic the behavior for consistency. See issue66 tests for details.\n\n  if (opts.descending) {\n    if ('endkey' in opts && typeof opts.endkey !== 'string') {\n      opts.endkey = '';\n    }\n    if ('startkey' in opts && typeof opts.startkey !== 'string') {\n      opts.limit = 0;\n    }\n  } else {\n    if ('startkey' in opts && typeof opts.startkey !== 'string') {\n      opts.startkey = '';\n    }\n    if ('endkey' in opts && typeof opts.endkey !== 'string') {\n      opts.limit = 0;\n    }\n  }\n  if ('key' in opts && typeof opts.key !== 'string') {\n    opts.limit = 0;\n  }\n\n  return db.allDocs(opts)\n  .then(function (res) {\n    // filter out any design docs that _all_docs might return\n    res.rows = res.rows.filter(function (row) {\n      return !/^_design\\//.test(row.id);\n    });\n    return res;\n  });\n}\n\nfunction find$1(db, requestDef, explain) {\n  if (requestDef.selector) {\n    requestDef.selector = massageSelector(requestDef.selector);\n  }\n\n  if (requestDef.sort) {\n    requestDef.sort = massageSort(requestDef.sort);\n  }\n\n  if (requestDef.use_index) {\n    requestDef.use_index = massageUseIndex(requestDef.use_index);\n  }\n\n  validateFindRequest(requestDef);\n\n  return getIndexes$1(db).then(function (getIndexesRes) {\n\n    db.constructor.emit('debug', ['find', 'planning query', requestDef]);\n    var queryPlan = planQuery(requestDef, getIndexesRes.indexes);\n    db.constructor.emit('debug', ['find', 'query plan', queryPlan]);\n\n    var indexToUse = queryPlan.index;\n\n    validateSort(requestDef, indexToUse);\n\n    var opts = assign({\n      include_docs: true,\n      reduce: false\n    }, queryPlan.queryOpts);\n\n    if ('startkey' in opts && 'endkey' in opts &&\n        collate(opts.startkey, opts.endkey) > 0) {\n      // can't possibly return any results, startkey > endkey\n      /* istanbul ignore next */\n      return {docs: []};\n    }\n\n    var isDescending = requestDef.sort &&\n      typeof requestDef.sort[0] !== 'string' &&\n      getValue(requestDef.sort[0]) === 'desc';\n\n    if (isDescending) {\n      // either all descending or all ascending\n      opts.descending = true;\n      opts = reverseOptions(opts);\n    }\n\n    if (!queryPlan.inMemoryFields.length) {\n      // no in-memory filtering necessary, so we can let the\n      // database do the limit/skip for us\n      if ('limit' in requestDef) {\n        opts.limit = requestDef.limit;\n      }\n      if ('skip' in requestDef) {\n        opts.skip = requestDef.skip;\n      }\n    }\n\n    if (explain) {\n      return Promise.resolve(queryPlan, opts);\n    }\n\n    return Promise.resolve().then(function () {\n      if (indexToUse.name === '_all_docs') {\n        return doAllDocs(db, opts);\n      } else {\n        var signature = indexToSignature(indexToUse);\n        return abstractMapper.query.call(db, signature, opts);\n      }\n    }).then(function (res) {\n      if (opts.inclusive_start === false) {\n        // may have to manually filter the first one,\n        // since couchdb has no true inclusive_start option\n        res.rows = filterInclusiveStart(res.rows, opts.startkey, indexToUse);\n      }\n\n      if (queryPlan.inMemoryFields.length) {\n        // need to filter some stuff in-memory\n        res.rows = filterInMemoryFields(res.rows, requestDef, queryPlan.inMemoryFields);\n      }\n\n      var resp = {\n        docs: res.rows.map(function (row) {\n          var doc = row.doc;\n          if (requestDef.fields) {\n            return pick(doc, requestDef.fields);\n          }\n          return doc;\n        })\n      };\n\n      if (indexToUse.defaultUsed) {\n        resp.warning = 'no matching index found, create an index to optimize query time';\n      }\n\n      return resp;\n    });\n  });\n}\n\nfunction explain$1(db, requestDef) {\n  return find$1(db, requestDef, true)\n  .then(function (queryPlan) {\n    return {\n      dbname: db.name,\n      index: queryPlan.index,\n      selector: requestDef.selector,\n      range: {\n        start_key: queryPlan.queryOpts.startkey,\n        end_key: queryPlan.queryOpts.endkey,\n      },\n      opts: {\n        use_index: requestDef.use_index || [],\n        bookmark: \"nil\", //hardcoded to match CouchDB since its not supported,\n        limit: requestDef.limit,\n        skip: requestDef.skip,\n        sort: requestDef.sort || {},\n        fields: requestDef.fields,\n        conflicts: false, //hardcoded to match CouchDB since its not supported,\n        r: [49], // hardcoded to match CouchDB since its not support\n      },\n      limit: requestDef.limit,\n      skip: requestDef.skip || 0,\n      fields: requestDef.fields,\n    };\n  });\n}\n\nfunction deleteIndex$1(db, index) {\n\n  if (!index.ddoc) {\n    throw new Error('you must supply an index.ddoc when deleting');\n  }\n\n  if (!index.name) {\n    throw new Error('you must supply an index.name when deleting');\n  }\n\n  var docId = index.ddoc;\n  var viewName = index.name;\n\n  function deltaFun(doc) {\n    if (Object.keys(doc.views).length === 1 && doc.views[viewName]) {\n      // only one view in this ddoc, delete the whole ddoc\n      return {_id: docId, _deleted: true};\n    }\n    // more than one view here, just remove the view\n    delete doc.views[viewName];\n    return doc;\n  }\n\n  return upsert(db, docId, deltaFun).then(function () {\n    return abstractMapper.viewCleanup.apply(db);\n  }).then(function () {\n    return {ok: true};\n  });\n}\n\nvar createIndexAsCallback = callbackify(createIndex$1);\nvar findAsCallback = callbackify(find$1);\nvar explainAsCallback = callbackify(explain$1);\nvar getIndexesAsCallback = callbackify(getIndexes$1);\nvar deleteIndexAsCallback = callbackify(deleteIndex$1);\n\nvar plugin = {};\nplugin.createIndex = toPromise(function (requestDef, callback) {\n\n  if (typeof requestDef !== 'object') {\n    return callback(new Error('you must provide an index to create'));\n  }\n\n  var createIndex$$1 = isRemote(this) ?\n    createIndex : createIndexAsCallback;\n  createIndex$$1(this, requestDef, callback);\n});\n\nplugin.find = toPromise(function (requestDef, callback) {\n\n  if (typeof callback === 'undefined') {\n    callback = requestDef;\n    requestDef = undefined;\n  }\n\n  if (typeof requestDef !== 'object') {\n    return callback(new Error('you must provide search parameters to find()'));\n  }\n\n  var find$$1 = isRemote(this) ? find : findAsCallback;\n  find$$1(this, requestDef, callback);\n});\n\nplugin.explain = toPromise(function (requestDef, callback) {\n\n  if (typeof callback === 'undefined') {\n    callback = requestDef;\n    requestDef = undefined;\n  }\n\n  if (typeof requestDef !== 'object') {\n    return callback(new Error('you must provide search parameters to explain()'));\n  }\n\n  var find$$1 = isRemote(this) ? explain : explainAsCallback;\n  find$$1(this, requestDef, callback);\n});\n\nplugin.getIndexes = toPromise(function (callback) {\n\n  var getIndexes$$1 = isRemote(this) ? getIndexes : getIndexesAsCallback;\n  getIndexes$$1(this, callback);\n});\n\nplugin.deleteIndex = toPromise(function (indexDef, callback) {\n\n  if (typeof indexDef !== 'object') {\n    return callback(new Error('you must provide an index to delete'));\n  }\n\n  var deleteIndex$$1 = isRemote(this) ?\n    deleteIndex : deleteIndexAsCallback;\n  deleteIndex$$1(this, indexDef, callback);\n});\n\nexport default plugin;\n","/**\n * Module dependencies.\n */\n\ntry {\n  var EventEmitter = require('events').EventEmitter;\n  if (!EventEmitter) throw new Error();\n} catch (err) {\n  var Emitter = require('emitter');\n}\n\n/**\n * Defer.\n */\n\nvar defer = typeof process !== 'undefined' && process && typeof process.nextTick === 'function'\n  ? process.nextTick\n  : function(fn){ setTimeout(fn); };\n\n/**\n * Noop.\n */\n\nfunction noop(){}\n\n/**\n * Expose `Batch`.\n */\n\nmodule.exports = Batch;\n\n/**\n * Create a new Batch.\n */\n\nfunction Batch() {\n  if (!(this instanceof Batch)) return new Batch;\n  this.fns = [];\n  this.concurrency(Infinity);\n  this.throws(true);\n  for (var i = 0, len = arguments.length; i < len; ++i) {\n    this.push(arguments[i]);\n  }\n}\n\n/**\n * Inherit from `EventEmitter.prototype`.\n */\n\nif (EventEmitter) {\n  Batch.prototype.__proto__ = EventEmitter.prototype;\n} else {\n  Emitter(Batch.prototype);\n}\n\n/**\n * Set concurrency to `n`.\n *\n * @param {Number} n\n * @return {Batch}\n * @api public\n */\n\nBatch.prototype.concurrency = function(n){\n  this.n = n;\n  return this;\n};\n\n/**\n * Queue a function.\n *\n * @param {Function} fn\n * @return {Batch}\n * @api public\n */\n\nBatch.prototype.push = function(fn){\n  this.fns.push(fn);\n  return this;\n};\n\n/**\n * Set wether Batch will or will not throw up.\n *\n * @param  {Boolean} throws\n * @return {Batch}\n * @api public\n */\nBatch.prototype.throws = function(throws) {\n  this.e = !!throws;\n  return this;\n};\n\n/**\n * Execute all queued functions in parallel,\n * executing `cb(err, results)`.\n *\n * @param {Function} cb\n * @return {Batch}\n * @api public\n */\n\nBatch.prototype.end = function(cb){\n  var self = this\n    , total = this.fns.length\n    , pending = total\n    , results = []\n    , errors = []\n    , cb = cb || noop\n    , fns = this.fns\n    , max = this.n\n    , throws = this.e\n    , index = 0\n    , done;\n\n  // empty\n  if (!fns.length) return defer(function(){\n    cb(null, results);\n  });\n\n  // process\n  function next() {\n    var i = index++;\n    var fn = fns[i];\n    if (!fn) return;\n    var start = new Date;\n\n    try {\n      fn(callback);\n    } catch (err) {\n      callback(err);\n    }\n\n    function callback(err, res){\n      if (done) return;\n      if (err && throws) return done = true, defer(function(){\n        cb(err);\n      });\n      var complete = total - pending + 1;\n      var end = new Date;\n\n      results[i] = res;\n      errors[i] = err;\n\n      self.emit('progress', {\n        index: i,\n        value: res,\n        error: err,\n        pending: pending,\n        total: total,\n        complete: complete,\n        percent: complete / total * 100 | 0,\n        start: start,\n        end: end,\n        duration: end - start\n      });\n\n      if (--pending) next();\n      else defer(function(){\n        if(!throws) cb(errors, results);\n        else cb(null, results);\n      });\n    }\n  }\n\n  // concurrency\n  for (var i = 0; i < fns.length; i++) {\n    if (i == max) break;\n    next();\n  }\n\n  return this;\n};\n","import PouchDB from \"pouchdb-browser\";\r\nimport find from \"pouchdb-find\";\r\nPouchDB.plugin(find);\r\n\r\nimport Batch from \"batch\";\r\n\r\nimport { upsert } from \"../utils/db\";\r\nimport { get } from \"../utils/api\";\r\n\r\nself.addEventListener(\"message\", async e => {\r\n  if (!e) return;\r\n\r\n  const { action, dbName, url } = e.data;\r\n\r\n  const db = new PouchDB(dbName);\r\n\r\n  const messages = await db.find({\r\n    selector: {\r\n      type: \"message\",\r\n      status: {\r\n        $nin: [\"FAILED\", \"NOTSENT\"]\r\n      },\r\n      retrieved: {\r\n        $ne: true\r\n      }\r\n    }\r\n  });\r\n\r\n  const batch = new Batch();\r\n  batch.concurrency(1);\r\n  batch.on(\"progress\", e => {});\r\n\r\n  messages.docs.forEach(entry => {\r\n    batch.push(async done => {\r\n      const { id, fiscal_code } = entry.message;\r\n      const path = `messages/${fiscal_code}/${id}`;\r\n      const message = await get({ dbName, url, path });\r\n\r\n      if (message.statusCode) {\r\n        // API returned an error\r\n        console.error(id);\r\n      } else {\r\n        const operation = await upsert(db, entry._id, {\r\n          ...entry,\r\n          ...message,\r\n          retrieved: true\r\n        });\r\n      }\r\n\r\n      done();\r\n    });\r\n  });\r\n\r\n  // Actually startes the batch\r\n  batch.end((err, data) => {\r\n    if (!err) {\r\n      postMessage({\r\n        ...e.data,\r\n        completed: true\r\n      });\r\n    }\r\n  });\r\n});\r\n"]}